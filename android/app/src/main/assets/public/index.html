<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <title>Tarteel-e-Quran - Student Portal</title>
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
    <script type="module" crossorigin src="./assets/index-a54f297a.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/vendor-e1e3bd03.js">
    <link rel="modulepreload" crossorigin href="./assets/material-da7e7f42.js">
    <link rel="modulepreload" crossorigin href="./assets/firebase-f79b6b7d.js">
  </head>
  <body>
    <div id="root"></div>
    <!-- WebRTC Support -->
    <script>
      console.log('üîß Student: Initializing WebRTC polyfills...');
      
      // Crypto.randomUUID polyfill for older browsers
      if (!crypto.randomUUID) {
        crypto.randomUUID = function() {
          return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
            var r = Math.random() * 16 | 0;
            var v = c === 'x' ? r : (r & 0x3 | 0x8);
            return v.toString(16);
          });
        };
      }
      
      // Ensure WebRTC API compatibility
      window.RTCPeerConnection = window.RTCPeerConnection || window.webkitRTCPeerConnection || window.mozRTCPeerConnection;
      
      // Legacy getUserMedia fallback (deprecated but needed for older browsers)
      navigator.getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
      
      // Enhanced MediaDevices API polyfill
      if (!navigator.mediaDevices) {
        console.log('üì± Student: Creating mediaDevices polyfill...');
        navigator.mediaDevices = {};
      }
      
      if (!navigator.mediaDevices.getUserMedia) {
        console.log('üé• Student: Creating getUserMedia polyfill...');
        navigator.mediaDevices.getUserMedia = function(constraints) {
          console.log('üé• Student: Polyfill getUserMedia called with:', constraints);
          
          // First try the modern API
          var getUserMedia = navigator.getUserMedia || navigator.webkitGetUserMedia || navigator.mozGetUserMedia;
          
          if (!getUserMedia) {
            console.error('‚ùå Student: No getUserMedia implementation found');
            return Promise.reject(new Error('WebRTC getUserMedia is not supported in this browser. Please use Chrome, Firefox, or Safari.'));
          }
          
          console.log('‚úÖ Student: Using legacy getUserMedia');
          return new Promise(function(resolve, reject) {
            try {
              getUserMedia.call(navigator, constraints, function(stream) {
                console.log('‚úÖ Student: getUserMedia success via polyfill');
                resolve(stream);
              }, function(error) {
                console.error('‚ùå Student: getUserMedia error via polyfill:', error);
                reject(error);
              });
            } catch (error) {
              console.error('‚ùå Student: Exception in getUserMedia polyfill:', error);
              reject(error);
            }
          });
        };
      } else {
        console.log('‚úÖ Student: Native getUserMedia available');
      }
      
      // Test mediaDevices availability
      if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
        console.log('‚úÖ Student: mediaDevices.getUserMedia is available');
      } else {
        console.error('‚ùå Student: mediaDevices.getUserMedia is still not available after polyfill');
      }
      
      // Check for HTTPS requirement for web apps
      if (location.protocol !== 'https:' && 
          location.hostname !== 'localhost' && 
          location.hostname !== '127.0.0.1') {
        console.warn('‚ö†Ô∏è  WebRTC requires HTTPS for camera/microphone access (except on localhost)');
      }
      
      console.log('‚úÖ Student: WebRTC polyfills initialized');
    </script>
    
  </body>
</html>