import{c as gi,a as U,j as s,B as p,T as S,A as mt,b as Fe,d as Te,C as cr,u as we,e as it,f as Ne,I as ee,g as v,G as ne,h as Ue,i as Ye,k as lr,l as gt,P as ge,m as xi,n as bi,o as an,S as _t,D as He,F as lt,p as dt,q as yi,r as wi,s as vi,M as ut,L as ls,t as Ci,v as Si,w as ds,x as ki,y as ji,z as Ei,E as dr,H as on,J as ur,K as cn,N as Ti,O as Ii,Q as zr,R as In,U as us,V as Ri,W as hs,X as Pi,Y as Fi,Z as Tr,_ as Ir,$ as Mi}from"./material-da7e7f42.js";import{c as _i,r as d,R as Oi,a as Wt}from"./vendor-e1e3bd03.js";import{i as Ai,g as Li,a as Di,c as nr,b as ye,d as ce,q as Oe,o as tt,e as xt,w as me,u as Ge,s as xe,f as fs,h as Wi,j as $r,T as Ni,l as Rn,k as Ui,m as Bi,n as zi,p as Et,r as $i}from"./firebase-f79b6b7d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var Hr={},Pn=_i;Hr.createRoot=Pn.createRoot,Hr.hydrateRoot=Pn.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function At(){return At=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},At.apply(this,arguments)}var qe;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(qe||(qe={}));const Fn="popstate";function Hi(r){r===void 0&&(r={});function e(i,a){let{pathname:o="/",search:l="",hash:c=""}=at(i.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Vr("",{pathname:o,search:l,hash:c},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(i,a){let o=i.document.querySelector("base"),l="";if(o&&o.getAttribute("href")){let c=i.location.href,f=c.indexOf("#");l=f===-1?c:c.slice(0,f)}return l+"#"+(typeof a=="string"?a:ps(a))}function n(i,a){ln(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return qi(e,t,n,r)}function ae(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function ln(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Vi(){return Math.random().toString(36).substr(2,8)}function Mn(r,e){return{usr:r.state,key:r.key,idx:e}}function Vr(r,e,t,n){return t===void 0&&(t=null),At({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?at(e):e,{state:t,key:e&&e.key||n||Vi()})}function ps(r){let{pathname:e="/",search:t="",hash:n=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function at(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}function qi(r,e,t,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,l=qe.Pop,c=null,f=h();f==null&&(f=0,o.replaceState(At({},o.state,{idx:f}),""));function h(){return(o.state||{idx:null}).idx}function u(){l=qe.Pop;let x=h(),L=x==null?null:x-f;f=x,c&&c({action:l,location:w.location,delta:L})}function y(x,L){l=qe.Push;let I=Vr(w.location,x,L);t&&t(I,x),f=h()+1;let j=Mn(I,f),E=w.createHref(I);try{o.pushState(j,"",E)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;i.location.assign(E)}a&&c&&c({action:l,location:w.location,delta:1})}function _(x,L){l=qe.Replace;let I=Vr(w.location,x,L);t&&t(I,x),f=h();let j=Mn(I,f),E=w.createHref(I);o.replaceState(j,"",E),a&&c&&c({action:l,location:w.location,delta:0})}function m(x){let L=i.location.origin!=="null"?i.location.origin:i.location.href,I=typeof x=="string"?x:ps(x);return I=I.replace(/ $/,"%20"),ae(L,"No window.location.(origin|href) available to create URL for href: "+I),new URL(I,L)}let w={get action(){return l},get location(){return r(i,o)},listen(x){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(Fn,u),c=x,()=>{i.removeEventListener(Fn,u),c=null}},createHref(x){return e(i,x)},createURL:m,encodeLocation(x){let L=m(x);return{pathname:L.pathname,search:L.search,hash:L.hash}},push:y,replace:_,go(x){return o.go(x)}};return w}var _n;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(_n||(_n={}));function Yi(r,e,t){return t===void 0&&(t="/"),Gi(r,e,t,!1)}function Gi(r,e,t,n){let i=typeof e=="string"?at(e):e,a=xs(i.pathname||"/",t);if(a==null)return null;let o=ms(r);Ji(o);let l=null;for(let c=0;l==null&&c<o.length;++c){let f=aa(a);l=sa(o[c],f,n)}return l}function ms(r,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let i=(a,o,l)=>{let c={relativePath:l===void 0?a.path||"":l,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(ae(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let f=rt([n,c.relativePath]),h=t.concat(c);a.children&&a.children.length>0&&(ae(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),ms(a.children,e,h,f)),!(a.path==null&&!a.index)&&e.push({path:f,score:ra(f,a.index),routesMeta:h})};return r.forEach((a,o)=>{var l;if(a.path===""||!((l=a.path)!=null&&l.includes("?")))i(a,o);else for(let c of gs(a.path))i(a,o,c)}),e}function gs(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),a=t.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=gs(n.join("/")),l=[];return l.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&l.push(...o),l.map(c=>r.startsWith("/")&&c===""?"/":c)}function Ji(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:na(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const Xi=/^:[\w-]+$/,Ki=3,Qi=2,Zi=1,ea=10,ta=-2,On=r=>r==="*";function ra(r,e){let t=r.split("/"),n=t.length;return t.some(On)&&(n+=ta),e&&(n+=Qi),t.filter(i=>!On(i)).reduce((i,a)=>i+(Xi.test(a)?Ki:a===""?Zi:ea),n)}function na(r,e){return r.length===e.length&&r.slice(0,-1).every((n,i)=>n===e[i])?r[r.length-1]-e[e.length-1]:0}function sa(r,e,t){t===void 0&&(t=!1);let{routesMeta:n}=r,i={},a="/",o=[];for(let l=0;l<n.length;++l){let c=n[l],f=l===n.length-1,h=a==="/"?e:e.slice(a.length)||"/",u=An({path:c.relativePath,caseSensitive:c.caseSensitive,end:f},h),y=c.route;if(!u&&f&&t&&!n[n.length-1].route.index&&(u=An({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!u)return null;Object.assign(i,u.params),o.push({params:i,pathname:rt([a,u.pathname]),pathnameBase:da(rt([a,u.pathnameBase])),route:y}),u.pathnameBase!=="/"&&(a=rt([a,u.pathnameBase]))}return o}function An(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=ia(r.path,r.caseSensitive,r.end),i=e.match(t);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),l=i.slice(1);return{params:n.reduce((f,h,u)=>{let{paramName:y,isOptional:_}=h;if(y==="*"){let w=l[u]||"";o=a.slice(0,a.length-w.length).replace(/(.)\/+$/,"$1")}const m=l[u];return _&&!m?f[y]=void 0:f[y]=(m||"").replace(/%2F/g,"/"),f},{}),pathname:a,pathnameBase:o,pattern:r}}function ia(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),ln(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,l,c)=>(n.push({paramName:l,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function aa(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return ln(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function xs(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function oa(r,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:i=""}=typeof r=="string"?at(r):r;return{pathname:t?t.startsWith("/")?t:ca(t,e):e,search:ua(n),hash:ha(i)}}function ca(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Rr(r,e,t,n){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function la(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function bs(r,e){let t=la(r);return e?t.map((n,i)=>i===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function ys(r,e,t,n){n===void 0&&(n=!1);let i;typeof r=="string"?i=at(r):(i=At({},r),ae(!i.pathname||!i.pathname.includes("?"),Rr("?","pathname","search",i)),ae(!i.pathname||!i.pathname.includes("#"),Rr("#","pathname","hash",i)),ae(!i.search||!i.search.includes("#"),Rr("#","search","hash",i)));let a=r===""||i.pathname==="",o=a?"/":i.pathname,l;if(o==null)l=t;else{let u=e.length-1;if(!n&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),u-=1;i.pathname=y.join("/")}l=u>=0?e[u]:"/"}let c=oa(i,l),f=o&&o!=="/"&&o.endsWith("/"),h=(a||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(f||h)&&(c.pathname+="/"),c}const rt=r=>r.join("/").replace(/\/\/+/g,"/"),da=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),ua=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,ha=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function fa(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const ws=["post","put","patch","delete"];new Set(ws);const pa=["get",...ws];new Set(pa);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Lt(){return Lt=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Lt.apply(this,arguments)}const dn=d.createContext(null),ma=d.createContext(null),Nt=d.createContext(null),hr=d.createContext(null),ot=d.createContext({outlet:null,matches:[],isDataRoute:!1}),vs=d.createContext(null);function Ut(){return d.useContext(hr)!=null}function yt(){return Ut()||ae(!1),d.useContext(hr).location}function Cs(r){d.useContext(Nt).static||d.useLayoutEffect(r)}function Ss(){let{isDataRoute:r}=d.useContext(ot);return r?Ia():ga()}function ga(){Ut()||ae(!1);let r=d.useContext(dn),{basename:e,future:t,navigator:n}=d.useContext(Nt),{matches:i}=d.useContext(ot),{pathname:a}=yt(),o=JSON.stringify(bs(i,t.v7_relativeSplatPath)),l=d.useRef(!1);return Cs(()=>{l.current=!0}),d.useCallback(function(f,h){if(h===void 0&&(h={}),!l.current)return;if(typeof f=="number"){n.go(f);return}let u=ys(f,JSON.parse(o),a,h.relative==="path");r==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:rt([e,u.pathname])),(h.replace?n.replace:n.push)(u,h.state,h)},[e,n,o,a,r])}function xa(r,e){return ba(r,e)}function ba(r,e,t,n){Ut()||ae(!1);let{navigator:i}=d.useContext(Nt),{matches:a}=d.useContext(ot),o=a[a.length-1],l=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let f=yt(),h;if(e){var u;let x=typeof e=="string"?at(e):e;c==="/"||(u=x.pathname)!=null&&u.startsWith(c)||ae(!1),h=x}else h=f;let y=h.pathname||"/",_=y;if(c!=="/"){let x=c.replace(/^\//,"").split("/");_="/"+y.replace(/^\//,"").split("/").slice(x.length).join("/")}let m=Yi(r,{pathname:_}),w=Sa(m&&m.map(x=>Object.assign({},x,{params:Object.assign({},l,x.params),pathname:rt([c,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?c:rt([c,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),a,t,n);return e&&w?d.createElement(hr.Provider,{value:{location:Lt({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:qe.Pop}},w):w}function ya(){let r=Ta(),e=fa(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},a=null;return d.createElement(d.Fragment,null,d.createElement("h2",null,"Unexpected Application Error!"),d.createElement("h3",{style:{fontStyle:"italic"}},e),t?d.createElement("pre",{style:i},t):null,a)}const wa=d.createElement(ya,null);class va extends d.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?d.createElement(ot.Provider,{value:this.props.routeContext},d.createElement(vs.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ca(r){let{routeContext:e,match:t,children:n}=r,i=d.useContext(dn);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),d.createElement(ot.Provider,{value:e},n)}function Sa(r,e,t,n){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),r==null){var a;if(!t)return null;if(t.errors)r=t.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let o=r,l=(i=t)==null?void 0:i.errors;if(l!=null){let h=o.findIndex(u=>u.route.id&&(l==null?void 0:l[u.route.id])!==void 0);h>=0||ae(!1),o=o.slice(0,Math.min(o.length,h+1))}let c=!1,f=-1;if(t&&n&&n.v7_partialHydration)for(let h=0;h<o.length;h++){let u=o[h];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(f=h),u.route.id){let{loaderData:y,errors:_}=t,m=u.route.loader&&y[u.route.id]===void 0&&(!_||_[u.route.id]===void 0);if(u.route.lazy||m){c=!0,f>=0?o=o.slice(0,f+1):o=[o[0]];break}}}return o.reduceRight((h,u,y)=>{let _,m=!1,w=null,x=null;t&&(_=l&&u.route.id?l[u.route.id]:void 0,w=u.route.errorElement||wa,c&&(f<0&&y===0?(Ra("route-fallback",!1),m=!0,x=null):f===y&&(m=!0,x=u.route.hydrateFallbackElement||null)));let L=e.concat(o.slice(0,y+1)),I=()=>{let j;return _?j=w:m?j=x:u.route.Component?j=d.createElement(u.route.Component,null):u.route.element?j=u.route.element:j=h,d.createElement(Ca,{match:u,routeContext:{outlet:h,matches:L,isDataRoute:t!=null},children:j})};return t&&(u.route.ErrorBoundary||u.route.errorElement||y===0)?d.createElement(va,{location:t.location,revalidation:t.revalidation,component:w,error:_,children:I(),routeContext:{outlet:null,matches:L,isDataRoute:!0}}):I()},null)}var ks=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(ks||{}),sr=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(sr||{});function ka(r){let e=d.useContext(dn);return e||ae(!1),e}function ja(r){let e=d.useContext(ma);return e||ae(!1),e}function Ea(r){let e=d.useContext(ot);return e||ae(!1),e}function js(r){let e=Ea(),t=e.matches[e.matches.length-1];return t.route.id||ae(!1),t.route.id}function Ta(){var r;let e=d.useContext(vs),t=ja(sr.UseRouteError),n=js(sr.UseRouteError);return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function Ia(){let{router:r}=ka(ks.UseNavigateStable),e=js(sr.UseNavigateStable),t=d.useRef(!1);return Cs(()=>{t.current=!0}),d.useCallback(function(i,a){a===void 0&&(a={}),t.current&&(typeof i=="number"?r.navigate(i):r.navigate(i,Lt({fromRouteId:e},a)))},[r,e])}const Ln={};function Ra(r,e,t){!e&&!Ln[r]&&(Ln[r]=!0)}function Pa(r,e){r==null||r.v7_startTransition,(r==null?void 0:r.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Dn(r){let{to:e,replace:t,state:n,relative:i}=r;Ut()||ae(!1);let{future:a,static:o}=d.useContext(Nt),{matches:l}=d.useContext(ot),{pathname:c}=yt(),f=Ss(),h=ys(e,bs(l,a.v7_relativeSplatPath),c,i==="path"),u=JSON.stringify(h);return d.useEffect(()=>f(JSON.parse(u),{replace:t,state:n,relative:i}),[f,u,i,t,n]),null}function $e(r){ae(!1)}function Fa(r){let{basename:e="/",children:t=null,location:n,navigationType:i=qe.Pop,navigator:a,static:o=!1,future:l}=r;Ut()&&ae(!1);let c=e.replace(/^\/*/,"/"),f=d.useMemo(()=>({basename:c,navigator:a,static:o,future:Lt({v7_relativeSplatPath:!1},l)}),[c,l,a,o]);typeof n=="string"&&(n=at(n));let{pathname:h="/",search:u="",hash:y="",state:_=null,key:m="default"}=n,w=d.useMemo(()=>{let x=xs(h,c);return x==null?null:{location:{pathname:x,search:u,hash:y,state:_,key:m},navigationType:i}},[c,h,u,y,_,m,i]);return w==null?null:d.createElement(Nt.Provider,{value:f},d.createElement(hr.Provider,{children:t,value:w}))}function Wn(r){let{children:e,location:t}=r;return xa(qr(e),t)}new Promise(()=>{});function qr(r,e){e===void 0&&(e=[]);let t=[];return d.Children.forEach(r,(n,i)=>{if(!d.isValidElement(n))return;let a=[...e,i];if(n.type===d.Fragment){t.push.apply(t,qr(n.props.children,a));return}n.type!==$e&&ae(!1),!n.props.index||!n.props.children||ae(!1);let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=qr(n.props.children,a)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Ma="6";try{window.__reactRouterVersion=Ma}catch{}const _a="startTransition",Nn=Oi[_a];function Oa(r){let{basename:e,children:t,future:n,window:i}=r,a=d.useRef();a.current==null&&(a.current=Hi({window:i,v5Compat:!0}));let o=a.current,[l,c]=d.useState({action:o.action,location:o.location}),{v7_startTransition:f}=n||{},h=d.useCallback(u=>{f&&Nn?Nn(()=>c(u)):c(u)},[c,f]);return d.useLayoutEffect(()=>o.listen(h),[o,h]),d.useEffect(()=>Pa(n),[n]),d.createElement(Fa,{basename:e,children:t,location:l.location,navigationType:l.action,navigator:o,future:n})}var Un;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(Un||(Un={}));var Bn;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(Bn||(Bn={}));const Pr=gi({palette:{mode:"light",primary:{main:"#76a6f6",light:"#a3c4f9",dark:"#4a7bc7",contrastText:"#FFFFFF"},secondary:{main:"#a3c4f9",light:"#d1e2fc",dark:"#76a6f6",contrastText:"#2C2C2C"},background:{default:"#FFFFFF",paper:"#FFFFFF",surface:"#FFFFFF"},surface:{main:"#FFFFFF",light:"#FFFFFF",dark:"#FFFFFF"},text:{primary:"#2C2C2C",secondary:"#5A5A5A",disabled:"#9E9E9E"},divider:"rgba(44, 44, 44, 0.12)",error:{main:"#D32F2F",light:"#EF5350",dark:"#C62828"},warning:{main:"#F57C00",light:"#FF9800",dark:"#E65100"},success:{main:"#388E3C",light:"#4CAF50",dark:"#2E7D32"},info:{main:"#76a6f6",light:"#a3c4f9",dark:"#4a7bc7"}},breakpoints:{values:{xs:0,sm:480,md:768,lg:1024,xl:1440}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontSize:"1.75rem",fontWeight:700,letterSpacing:"-0.02em","@media (min-width:768px)":{fontSize:"2.5rem"}},h2:{fontSize:"1.5rem",fontWeight:600,letterSpacing:"-0.01em","@media (min-width:768px)":{fontSize:"2rem"}},h3:{fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em","@media (min-width:768px)":{fontSize:"1.75rem"}},h4:{fontSize:"1.125rem",fontWeight:600,letterSpacing:"-0.005em","@media (min-width:768px)":{fontSize:"1.5rem"}},h5:{fontSize:"1rem",fontWeight:600,"@media (min-width:768px)":{fontSize:"1.25rem"}},h6:{fontSize:"0.875rem",fontWeight:600,"@media (min-width:768px)":{fontSize:"1.125rem"}},body1:{fontSize:"0.875rem",lineHeight:1.6},body2:{fontSize:"0.75rem",lineHeight:1.5},button:{fontSize:"0.875rem",fontWeight:500,textTransform:"none",letterSpacing:"0.02em"},caption:{fontSize:"0.75rem",fontWeight:400,letterSpacing:"0.03em"}},shape:{borderRadius:12},shadows:["none","0px 1px 3px rgba(0, 0, 0, 0.1)","0px 1px 4px rgba(0, 0, 0, 0.1)","0px 2px 4px rgba(0, 0, 0, 0.1)","0px 2px 6px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 1px 3px rgba(0, 0, 0, 0.1)","0px 1px 4px rgba(0, 0, 0, 0.1)","0px 2px 4px rgba(0, 0, 0, 0.1)","0px 2px 6px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)"],components:{MuiCssBaseline:{styleOverrides:{body:{scrollbarWidth:"thin",scrollbarColor:"#76a6f6 #FFFFFF","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"#FFFFFF"},"&::-webkit-scrollbar-thumb":{background:"#76a6f6",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{background:"#4a7bc7"}}}},MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"12px 24px",minHeight:"44px",transition:"all 0.2s ease-in-out","@media (max-width:768px)":{padding:"14px 28px",minHeight:"48px"}},contained:{backgroundColor:"#76a6f6",color:"#FFFFFF",boxShadow:"none","&:hover":{backgroundColor:"#4a7bc7",boxShadow:"none"}},outlined:{borderColor:"#76a6f6",backgroundColor:"#FFFFFF",color:"#76a6f6","&:hover":{borderColor:"#4a7bc7",backgroundColor:"#76a6f6",color:"#FFFFFF"}},text:{color:"#76a6f6","&:hover":{backgroundColor:"rgba(118, 166, 246, 0.04)"}}}},MuiCard:{styleOverrides:{root:{backgroundColor:"#FFFFFF",border:"1px solid #E0E0E0",borderRadius:16,boxShadow:"0px 1px 3px rgba(0, 0, 0, 0.1)",transition:"all 0.3s ease-in-out",padding:"16px","@media (min-width:768px)":{padding:"24px"},"&:hover":{boxShadow:"0px 2px 6px rgba(0, 0, 0, 0.1)"}}}},MuiPaper:{styleOverrides:{root:{backgroundColor:"#FFFFFF",border:"1px solid #E0E0E0"}}},MuiDrawer:{styleOverrides:{paper:{backgroundColor:"#FFFFFF",borderRight:"1px solid #E0E0E0"}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:"#FFFFFF",borderBottom:"1px solid #E0E0E0",boxShadow:"none"}}},MuiListItemButton:{styleOverrides:{root:{borderRadius:8,margin:"4px 8px",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"#F5F5F5"},"&.Mui-selected":{backgroundColor:"#F0F0F0",borderLeft:"3px solid #76a6f6","&:hover":{backgroundColor:"#E8E8E8"}}}}},MuiChip:{styleOverrides:{root:{backgroundColor:"#F5F5F5",border:"1px solid #E0E0E0"},filled:{backgroundColor:"#76a6f6",color:"#FFFFFF"},outlined:{borderColor:"#76a6f6",color:"#76a6f6"}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{backgroundColor:"#FFFFFF",borderRadius:8,"& fieldset":{borderColor:"#E0E0E0"},"&:hover fieldset":{borderColor:"#76a6f6"},"&.Mui-focused fieldset":{borderColor:"#76a6f6"}}}}}}}),zn=U([s.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),s.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),Aa=U([s.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),s.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),La=U(s.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),$n=U(s.jsx("path",{d:"M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 4h5v8l-2.5-1.5L6 12z"}),"Book"),Da=U(s.jsx("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3m13.71-9.37-1.34-1.34a.9959.9959 0 0 0-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41"}),"Brush"),Wa=U(s.jsx("path",{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99"}),"Call"),un=U(s.jsx("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9"}),"CallEnd"),Yt=U(s.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat"),Fr=U(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),hn=U(s.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle"),Na=U(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),ir=U(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Ua=U(s.jsx("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8m-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12m3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8m5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8m3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"ColorLens"),Ba=U(s.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Create"),za=U(s.jsx("path",{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H6V6h12z"}),"CropSquare"),$a=U(s.jsx("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard"),Ha=U(s.jsx("path",{d:"m18.85 10.39 1.06-1.06c.78-.78.78-2.05 0-2.83L18.5 5.09c-.78-.78-2.05-.78-2.83 0l-1.06 1.06zm-5.66-2.83L4 16.76V21h4.24l9.19-9.19zM19 17.5c0 2.19-2.54 3.5-5 3.5-.55 0-1-.45-1-1s.45-1 1-1c1.54 0 3-.73 3-1.5 0-.47-.48-.87-1.23-1.2l1.48-1.48c1.07.63 1.75 1.47 1.75 2.68M4.58 13.35C3.61 12.79 3 12.06 3 11c0-1.8 1.89-2.63 3.56-3.36C7.59 7.18 9 6.56 9 6c0-.41-.78-1-2-1-1.26 0-1.8.61-1.83.64-.35.41-.98.46-1.4.12-.41-.34-.49-.95-.15-1.38C3.73 4.24 4.76 3 7 3s4 1.32 4 3c0 1.87-1.93 2.72-3.64 3.47C6.42 9.88 5 10.5 5 11c0 .31.43.6 1.07.86z"}),"Draw"),Va=U(s.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),qa=U(s.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"EmojiEmotions"),Ya=U(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),Yr=U(s.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),Ga=U(s.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),Ja=U(s.jsx("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),Es=U(s.jsx("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),Gr=U(s.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 12H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Message"),Ts=U(s.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic"),Is=U(s.jsx("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff"),Xa=U(s.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),Ka=U(s.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications"),Qa=U(s.jsx("path",{d:"M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5"}),"PanTool"),Pt=U(s.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),Za=U(s.jsx("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"Redo"),Rs=U(s.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),Hn=U(s.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),Gt=U([s.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),s.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule"),eo=U(s.jsx("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School"),to=U(s.jsx("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73z"}),"ScreenShare"),Ps=U(s.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),ro=U(s.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),no=U(s.jsx("path",{d:"m21.22 18.02 2 2H24v-2zm.77-2 .01-10c0-1.11-.9-2-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74M2.39 1.73 1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10c0 1.1.89 2 2 2H0v2h18.13l2.71 2.71 1.27-1.27zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47"}),"StopScreenShare"),so=U(s.jsx("path",{d:"M2.5 4v3h5v12h3V7h5V4zm19 5h-9v3h3v7h3v-7h3z"}),"TextFields"),io=U(s.jsx("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"}),"Timeline"),ao=U(s.jsx("path",{d:"m16 18 2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"}),"TrendingDown"),Mr=U(s.jsx("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),oo=U(s.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),Jt=U(s.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11zM14 13h-3v3H9v-3H6v-2h3V8h2v3h3z"}),"VideoCall"),fn=U(s.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam"),Jr=U(s.jsx("path",{d:"m21 6.5-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18zM3.27 2 2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73z"}),"VideocamOff"),co=U(s.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),lo=U(s.jsx("path",{d:"M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M5 9v6h4l5 5V4L9 9z"}),"VolumeDown"),uo=U(s.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"}),"VolumeUp");function ho({onLogin:r}){const[e,t]=d.useState({email:"",password:""}),[n,i]=d.useState(!1),[a,o]=d.useState(""),l=async f=>{f.preventDefault(),o(""),i(!0);try{const h=await r(e.email,e.password);h.success||o(h.error||"Login failed")}catch{o("An unexpected error occurred")}finally{i(!1)}},c=f=>{t({...e,[f.target.name]:f.target.value})};return s.jsxs(p,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:[s.jsxs(p,{sx:{flex:"1 1 auto",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",px:3,py:6,minHeight:{xs:"40vh",sm:"50vh"}},children:[s.jsx(p,{component:"img",src:"/Tarteele-Quran-Logo-only.JPG",alt:"Tarteel-e-Quran Logo",sx:{width:{xs:120,sm:150},height:{xs:120,sm:150},objectFit:"contain",margin:"0 auto",mb:3,display:"block",borderRadius:3,boxShadow:"0 8px 32px rgba(255, 255, 255, 0.2)"}}),s.jsx(S,{variant:"h3",gutterBottom:!0,sx:{fontWeight:700,color:"#FFFFFF",mb:1},children:"Tarteel-e-Quran"}),s.jsx(S,{variant:"h5",gutterBottom:!0,sx:{fontWeight:500,color:"rgba(255, 255, 255, 0.9)",mb:2},children:"Student Portal"}),s.jsx(S,{variant:"h6",sx:{color:"rgba(255, 255, 255, 0.8)",fontWeight:300},children:"Welcome! Sign in to access your classes"})]}),s.jsxs(p,{sx:{backgroundColor:"#FFFFFF",borderRadius:{xs:0,sm:"28px 28px 0 0"},px:{xs:3,sm:4},py:{xs:4,sm:5},boxShadow:"0 -4px 20px rgba(0, 0, 0, 0.1)",minHeight:{xs:"60vh",sm:"auto"}},children:[a&&s.jsx(mt,{severity:"error",sx:{mb:3,width:"100%"},children:a}),s.jsxs(p,{component:"form",onSubmit:l,sx:{maxWidth:400,mx:"auto",width:"100%"},children:[s.jsx(Fe,{fullWidth:!0,label:"Email",name:"email",type:"email",value:e.email,onChange:c,margin:"normal",required:!0,autoFocus:!0,sx:{mb:2,"& .MuiOutlinedInput-root":{backgroundColor:"#FFFFFF",borderRadius:"12px","& fieldset":{borderColor:"#E0E0E0",borderWidth:"2px"},"&:hover fieldset":{borderColor:"#76a6f6"},"&.Mui-focused fieldset":{borderColor:"#76a6f6",borderWidth:"2px"}}},InputProps:{startAdornment:s.jsx(Va,{sx:{color:"action.active",mr:1}})}}),s.jsx(Fe,{fullWidth:!0,label:"Password",name:"password",type:"password",value:e.password,onChange:c,margin:"normal",required:!0,sx:{mb:2,"& .MuiOutlinedInput-root":{backgroundColor:"#FFFFFF",borderRadius:"12px","& fieldset":{borderColor:"#E0E0E0",borderWidth:"2px"},"&:hover fieldset":{borderColor:"#76a6f6"},"&.Mui-focused fieldset":{borderColor:"#76a6f6",borderWidth:"2px"}}},InputProps:{startAdornment:s.jsx(Ga,{sx:{color:"action.active",mr:1}})}}),s.jsx(Te,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:n,sx:{mt:2,mb:2,py:1.5,borderRadius:"12px",backgroundColor:"#76a6f6",color:"#FFFFFF",fontWeight:600,fontSize:"1rem",boxShadow:"0 4px 12px rgba(118, 166, 246, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{backgroundColor:"#4a7bc7",transform:"translateY(-2px)",boxShadow:"0 8px 20px rgba(118, 166, 246, 0.4)"},"&:active":{transform:"translateY(0px)",boxShadow:"0 4px 12px rgba(118, 166, 246, 0.3)"},"&:disabled":{backgroundColor:"#BDBDBD",color:"#757575",boxShadow:"none",transform:"none"}},children:n?s.jsx(cr,{size:24,color:"inherit"}):"Sign In"})]})]})]})}const fo="modulepreload",po=function(r,e){return new URL(r,e).href},Vn={},nt=function(e,t,n){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=po(a,n),a in Vn)return;Vn[a]=!0;const o=a.endsWith(".css"),l=o?'[rel="stylesheet"]':"";if(!!n)for(let h=i.length-1;h>=0;h--){const u=i[h];if(u.href===a&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${l}`))return;const f=document.createElement("link");if(f.rel=o?"stylesheet":fo,o||(f.as="script",f.crossOrigin=""),f.href=a,document.head.appendChild(f),o)return new Promise((h,u)=>{f.addEventListener("load",h),f.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})},mo={apiKey:"AIzaSyDrXbi2vqMua2jwvoEOsdEccUEGZAonIS4",authDomain:"tarteel-quran.firebaseapp.com",projectId:"tarteel-quran",storageBucket:"tarteel-quran.firebasestorage.app",messagingSenderId:"51402909238",appId:"1:51402909238:web:c4160931526c345c7a9a97",measurementId:"G-RDWBDV3HJ3"},pn=Ai(mo),se=Li(pn),pe=Di(pn),Fs=Object.freeze(Object.defineProperty({__proto__:null,auth:pe,db:se,default:pn},Symbol.toStringTag,{value:"Module"}));class go{constructor(){this.usersCollection=nr(se,"users"),this.auth=pe}async getUserById(e){try{const t=await ye(ce(se,"users",e));return t.exists()?{success:!0,user:{id:t.id,...t.data()}}:{success:!1,error:"User not found"}}catch(t){return console.error("Error fetching user:",t),{success:!1,error:t.message}}}async getMyTeacher(e){try{const t=await ye(ce(se,"users",e));if(!t.exists())return{success:!1,error:"Student not found"};const i=t.data().assignedTeacher;if(!i)return{success:!1,error:"No teacher assigned to this student"};const a=await ye(ce(se,"users",i));if(!a.exists())return{success:!1,error:"Assigned teacher not found"};const o=a.data();return{success:!0,teacher:{id:a.id,...o}}}catch(t){return console.error("Error fetching assigned teacher:",t),{success:!1,error:t.message}}}async getAllUsers(){try{const e=Oe(this.usersCollection,tt("createdAt","desc"));return{success:!0,users:(await xt(e)).docs.map(i=>({id:i.id,...i.data()}))}}catch(e){return console.error("Error fetching users:",e),{success:!1,error:e.message}}}async getUsersByRole(e){try{const t=Oe(this.usersCollection,me("role","==",e),tt("createdAt","desc"));return{success:!0,users:(await xt(t)).docs.map(a=>({id:a.id,...a.data()}))}}catch(t){return console.error(`Error fetching users with role ${e}:`,t),{success:!1,error:t.message}}}async setOnlineStatus(e=!0){var t;try{const n=this.auth.currentUser;if(!n)return console.warn("❌ Cannot set online status: No authenticated user"),{success:!1,error:"User must be authenticated"};const i=ce(this.usersCollection,n.uid);return await Ge(i,{isOnline:e,lastSeen:xe(),updatedAt:xe()}),{success:!0}}catch(n){return console.error("❌ Error updating online status:",n),console.error("❌ Error details:",{code:n.code,message:n.message,userId:(t=this.auth.currentUser)==null?void 0:t.uid}),{success:!1,error:n.message}}}async setOnline(){return this.setOnlineStatus(!0)}async setOffline(){return this.setOnlineStatus(!1)}setupOnlineStatusTracking(){const e=this.auth.currentUser;if(!e){console.warn("❌ Cannot setup online tracking: user not authenticated");return}const t=5*60*1e3;let n=null;const i=()=>{this.setOnline()},a=()=>{this.setOffline()};return window.addEventListener("online",i),window.addEventListener("offline",a),window.addEventListener("beforeunload",a),this.setOnline(),n=setInterval(async()=>{try{const o=ce(this.usersCollection,e.uid);await Ge(o,{lastSeen:xe(),updatedAt:xe()})}catch(o){console.error("💓 Heartbeat update failed:",o)}},t),()=>{n&&clearInterval(n),window.removeEventListener("online",i),window.removeEventListener("offline",a),window.removeEventListener("beforeunload",a),this.setOffline()}}}const Me=new go,qn=Object.freeze(Object.defineProperty({__proto__:null,default:Me},Symbol.toStringTag,{value:"Module"}));class xo{constructor(){this.db=se,this.auth=pe,this.messagesCollection=nr(se,"messages"),this.conversationsCollection=nr(se,"conversations")}async sendMessage(e,t,n="text",i={}){try{const a=this.auth.currentUser;if(!a)throw new Error("User must be authenticated to send messages");const[o,l]=await Promise.all([ye(ce(se,"users",a.uid)),ye(ce(se,"users",e))]);if(!o.exists()||!l.exists())throw new Error("User not found");const c=o.data(),f=l.data(),h=await this.createOrGetConversation(a.uid,e,c,f),u={senderId:a.uid,receiverId:e,content:t.trim(),type:n,conversationId:h,senderRole:c.role||"student",receiverRole:f.role||"teacher",timestamp:xe(),createdAt:new Date().toISOString(),isRead:!1,metadata:{senderName:c.username||c.name||"Unknown",receiverName:f.username||f.name||"Unknown",...i}},y=await fs(this.messagesCollection,u);return await this.updateConversationLastMessage(h,t,a.uid),{success:!0,messageId:y.id,conversationId:h,message:"Message sent successfully"}}catch(a){return console.error("❌ Failed to send message:",a),{success:!1,error:a.message}}}async createOrGetConversation(e,t,n,i){const a=[e,t].sort(),o=a.join("_");try{if(!(await ye(ce(se,"conversations",o))).exists()){const c={id:o,participants:a,participantRoles:[n.role||"student",i.role||"teacher"],participantNames:[n.username||n.name||"Unknown",i.username||i.name||"Unknown"],lastMessage:"",lastMessageTime:xe(),createdAt:xe(),unreadCount:{[e]:0,[t]:0}};await Wi(ce(se,"conversations",o),c)}return o}catch(l){throw console.error("❌ Error creating/getting conversation:",l),l}}async updateConversationLastMessage(e,t,n){try{const i=ce(se,"conversations",e),a=await ye(i);if(a.exists()){const o=a.data(),l={...o.unreadCount};o.participants.forEach(c=>{c!==n&&(l[c]=(l[c]||0)+1)}),await Ge(i,{lastMessage:t.substring(0,100),lastMessageTime:xe(),unreadCount:l})}}catch(i){console.error("❌ Error updating conversation:",i)}}getConversations(e){const t=this.auth.currentUser;if(!t)return console.error("User must be authenticated to get conversations"),e([]),()=>{};const n=Oe(this.conversationsCollection,me("participants","array-contains",t.uid),tt("lastMessageTime","desc"));return $r(n,i=>{if(!this.auth.currentUser){e([]);return}const a=i.docs.map(o=>({id:o.id,...o.data()}));e(a)},i=>{console.error("❌ Error listening to conversations:",i),i.code,e([])})}getMessages(e,t){if(!e)return console.error("Conversation ID is required"),t([]),()=>{};if(!this.auth.currentUser)return console.error("User must be authenticated to get messages"),t([]),()=>{};const i=Oe(this.messagesCollection,me("conversationId","==",e),tt("timestamp","asc"));return $r(i,a=>{if(!this.auth.currentUser){t([]);return}const o=a.docs.map(l=>({id:l.id,...l.data()}));t(o)},a=>{console.error("❌ Error listening to messages:",a),a.code,t([])})}async markAsRead(e,t=null){try{const n=this.auth.currentUser,i=t||(n==null?void 0:n.uid);if(!i)throw new Error("User must be authenticated");const a=Oe(this.messagesCollection,me("conversationId","==",e),me("receiverId","==",i),me("isRead","==",!1)),o=await xt(a),l=[];if(o.docs.forEach(c=>{l.push(Ge(c.ref,{isRead:!0}))}),l.length>0){await Promise.all(l);const c=ce(se,"conversations",e),f=await ye(c);if(f.exists()){const u={...f.data().unreadCount};u[i]=0,await Ge(c,{unreadCount:u})}}return{success:!0,markedCount:l.length}}catch(n){return console.error("❌ Error marking messages as read:",n),{success:!1,error:n.message}}}async getRecentMessages(e=10){try{const t=this.auth.currentUser;if(!t)return{success:!1,error:"User not authenticated"};const n=Oe(this.messagesCollection,me("receiverId","==",t.uid),tt("timestamp","desc")),a=(await xt(n)).docs.slice(0,e).map(l=>({id:l.id,...l.data()})),o=a.filter(l=>!l.isRead).length;return{success:!0,messages:a,totalCount:a.length,unreadCount:o}}catch(t){return console.error("❌ Error getting recent messages:",t),{success:!1,error:t.message}}}}const Ft=new xo;class bo{constructor(){this.auth=pe,this.callsCollection=nr(se,"calls")}async startCall(e,t,n="video"){try{const i=this.auth.currentUser;if(!i)throw new Error("User must be authenticated to start a call");const a={studentId:i.uid,teacherId:e,teacherName:t||"Unknown Teacher",callType:n,status:"started",startTime:xe(),endTime:null,duration:0,createdAt:xe(),updatedAt:xe()},o=await fs(this.callsCollection,a);return{success:!0,callId:o.id,call:{id:o.id,...a}}}catch(i){return console.error("❌ Error starting call log:",i),{success:!1,error:i.message}}}async endCall(e,t="completed"){try{if(!e)return console.warn("No call ID provided to end call"),{success:!1,error:"Call ID required"};const n=Ni.now(),i=ce(this.callsCollection,e),a={status:t==="rejected"?"rejected":"completed",endTime:n,endReason:t,updatedAt:xe()};return await Ge(i,a),{success:!0,callId:e}}catch(n){return console.error("❌ Error ending call:",n),{success:!1,error:n.message}}}async updateCallDuration(e,t){try{if(!e)return{success:!1,error:"Call ID required"};const n=ce(this.callsCollection,e);return await Ge(n,{duration:t,updatedAt:xe()}),{success:!0}}catch(n){return console.error("❌ Error updating call duration:",n),{success:!1,error:n.message}}}async getMyCallCount(e="all"){try{const t=this.auth.currentUser;if(!t)return{success:!1,error:"User must be authenticated"};let n;return e==="all"?n=Oe(this.callsCollection,me("studentId","==",t.uid)):n=Oe(this.callsCollection,me("studentId","==",t.uid),me("status","==",e)),{success:!0,count:(await xt(n)).size}}catch(t){return console.error("❌ Error getting call count:",t),{success:!1,error:t.message}}}async getMyCallHistory(e=10,t=1,n="all"){try{const i=this.auth.currentUser;if(!i)return{success:!1,error:"User must be authenticated"};const a=(t-1)*e;let o;return n==="all"?o=Oe(this.callsCollection,me("studentId","==",i.uid),tt("startTime","desc"),Rn(e+a)):o=Oe(this.callsCollection,me("studentId","==",i.uid),me("status","==",n),tt("startTime","desc"),Rn(e+a)),{success:!0,calls:(await xt(o)).docs.map(h=>{var u,y,_,m;return{id:h.id,callId:h.id,...h.data(),startTime:(u=h.data().startTime)==null?void 0:u.toDate(),endTime:(y=h.data().endTime)==null?void 0:y.toDate(),createdAt:(_=h.data().createdAt)==null?void 0:_.toDate(),updatedAt:(m=h.data().updatedAt)==null?void 0:m.toDate()}}).slice(a,a+e)}}catch(i){return console.error("❌ Error getting call history:",i),{success:!1,error:i.message,calls:[]}}}async getMyCallStats(){try{const e=await this.getMyCallHistory(1e3,1,"all");if(!e.success)return e;const t=e.calls,n=new Date,i=t.length,a=new Date(n);a.setDate(n.getDate()-n.getDay()+1),a.setHours(0,0,0,0);const o=t.filter(w=>w.startTime&&w.startTime>=a).length,l=new Date(n.getFullYear(),n.getMonth(),1),c=t.filter(w=>w.startTime&&w.startTime>=l).length,f=t.filter(w=>w.status==="ended"||w.status==="completed").length,h=i>0?Math.round(f/i*100):0,u=t.filter(w=>(w.status==="ended"||w.status==="completed")&&w.duration),y=u.reduce((w,x)=>w+(x.duration||0),0),_=u.length>0?y/u.length:0;return{success:!0,stats:{totalCalls:i,callsThisWeek:o,callsThisMonth:c,successRate:h,successfulCalls:f,rejectedCalls:t.filter(w=>w.status==="rejected").length,failedCalls:t.filter(w=>w.status==="failed").length,totalDuration:y,averageDuration:_,totalRecordingSize:t.reduce((w,x)=>w+(x.recording&&x.recording.totalSize?x.recording.totalSize:0),0)}}}catch(e){return console.error("❌ Error calculating call stats:",e),{success:!1,error:e.message,stats:{totalCalls:0,callsThisWeek:0,callsThisMonth:0,successRate:0,successfulCalls:0,rejectedCalls:0,failedCalls:0,totalDuration:0,averageDuration:0,totalRecordingSize:0}}}}}const _e=new bo;function yo({user:r,webrtcService:e}){var j,E;const t=we(),n=it(t.breakpoints.down("md")),[i,a]=d.useState(!0),[o,l]=d.useState(!1),[c,f]=d.useState(null),[h,u]=d.useState([]),[y,_]=d.useState([]),[m,w]=d.useState({totalClasses:0,unreadMessages:0,callsThisWeek:0,callsThisMonth:0,successRate:0,previousWeekClasses:0});d.useEffect(()=>(x(),()=>{window.dashboardConversationsUnsubscribe&&(window.dashboardConversationsUnsubscribe(),window.dashboardConversationsUnsubscribe=null),window.teacherStatusUnsubscribe&&(window.teacherStatusUnsubscribe(),window.teacherStatusUnsubscribe=null)}),[]);const x=async()=>{try{if(a(!0),!(r!=null&&r.id)){console.warn("No user ID available for loading dashboard data");return}const P=await Me.getMyTeacher(r.id);if(P.success){f(P.teacher);const{doc:B,onSnapshot:$}=await nt(()=>import("./firebase-f79b6b7d.js").then(k=>k.t),[],import.meta.url),{db:b}=await nt(()=>Promise.resolve().then(()=>Fs),void 0,import.meta.url);if(P.teacher.id){const k=B(b,"users",P.teacher.id),O=$(k,R=>{if(R.exists()){const A={id:R.id,...R.data()};f(A)}});window.teacherStatusUnsubscribe=O}}try{const B=Ft.getConversations($=>{const k=$.slice(0,3).map(R=>{var A,D,q;return{id:R.id,content:R.lastMessage||"No messages yet",senderId:"Teacher",timestamp:((D=(A=R.lastMessageTime)==null?void 0:A.toDate)==null?void 0:D.call(A))||new Date,isRead:((q=R.unreadCount)==null?void 0:q[r.id])===0}});u(k);const O=$.reduce((R,A)=>{var D;return R+(((D=A.unreadCount)==null?void 0:D[r.id])||0)},0);w(R=>({...R,unreadMessages:O}))});window.dashboardConversationsUnsubscribe=B}catch(B){console.error("Failed to setup messages listener:",B),u([])}try{const B=await _e.getMyCallStats();if(B.success){const $=B.stats,b=new Date;b.setDate(b.getDate()-14);const k=await _e.getMyCallHistory(200),O=k.success?k.calls.filter(R=>{const A=R.startTime,D=new Date;return D.setDate(D.getDate()-7),A&&A>=b&&A<D}).length:0;w(R=>({...R,totalClasses:$.totalCalls,callsThisWeek:$.callsThisWeek,callsThisMonth:$.callsThisMonth,successRate:$.successRate,previousWeekClasses:O}))}}catch(B){console.error("Failed to load call statistics:",B),w($=>({...$,totalClasses:0,callsThisWeek:0,callsThisMonth:0,successRate:0,previousWeekClasses:0}))}_([])}catch(P){console.error("Failed to load dashboard data:",P)}finally{a(!1)}},L=()=>{window.location.href="#/messages"};function I({icon:P,title:B,value:$,change:b,color:k,subtitle:O,onClick:R,compact:A=!1}){const D=we(),q=b>=0;return s.jsxs(Ue,{sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:"90px",md:"auto"},background:`linear-gradient(135deg, ${v(k,.1)} 0%, ${v(k,.05)} 100%)`,border:`1px solid ${v(k,.2)}`,position:"relative",overflow:"hidden",transition:"all 0.3s ease-in-out",cursor:R?"pointer":"default","&:hover":{transform:{xs:"none",md:"translateY(-4px)"},boxShadow:{xs:"none",md:`0 12px 32px ${v(k,.3)}`},border:{xs:`1px solid ${v(k,.2)}`,md:`1px solid ${v(k,.4)}`}}},onClick:R,children:[s.jsx(Ye,{sx:{p:{xs:.8,md:3}},children:s.jsxs(p,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:{xs:1,md:2}},children:[s.jsxs(p,{children:[s.jsx(p,{sx:{width:{xs:24,md:48},height:{xs:24,md:48},borderRadius:2,background:`linear-gradient(135deg, ${k} 0%, ${v(k,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mb:{xs:.8,md:2},boxShadow:`0 4px 16px ${v(k,.4)}`},children:Wt.cloneElement(P,{sx:{...P.props.sx,fontSize:{xs:14,md:24}}})}),s.jsx(S,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5,fontSize:{xs:"0.6rem",md:"0.75rem"},lineHeight:1.2},children:B}),s.jsx(S,{variant:"h4",sx:{fontWeight:700,mt:.2,mb:.3,fontSize:{xs:"1rem",md:"2.125rem"},lineHeight:1},children:typeof $=="number"?$.toLocaleString():$}),O&&s.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.55rem",md:"0.75rem"},lineHeight:1.2,opacity:.8},children:O})]}),b!==void 0&&s.jsxs(p,{sx:{display:{xs:"none",sm:"flex"},alignItems:"center",justifyContent:"center",px:{xs:.8,md:1.2},py:{xs:.2,md:.4},borderRadius:1,backgroundColor:q?v(D.palette.success.main,.1):v(D.palette.error.main,.1),color:q?D.palette.success.main:D.palette.error.main,border:`1px solid ${q?v(D.palette.success.main,.3):v(D.palette.error.main,.3)}`,fontSize:{xs:"0.55rem",md:"0.75rem"},fontWeight:600,lineHeight:1},children:[q?s.jsx(Mr,{sx:{fontSize:{xs:10,md:14},mr:.3}}):s.jsx(ao,{sx:{fontSize:{xs:10,md:14},mr:.3}}),`${q?"+":""}${b}%`]})]})}),s.jsx(p,{sx:{display:{xs:"none",md:"block"},position:"absolute",right:-24,bottom:-24,width:96,height:96,borderRadius:"50%",background:`radial-gradient(circle, ${v(k,.1)} 0%, transparent 70%)`}})]})}return i?s.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:s.jsx(cr,{})}):s.jsxs(p,{children:[s.jsxs(p,{sx:{mb:{xs:2,md:4},display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs(p,{children:[s.jsxs(S,{variant:"h4",sx:{fontWeight:700,mb:{xs:.5,md:1},fontSize:{xs:"1.5rem",md:"2.125rem"}},children:["Good day, ",r==null?void 0:r.username,"!"]}),s.jsx(S,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",md:"0.875rem"}},children:"Ready for today's learning session?"})]}),s.jsx(Ne,{title:"Refresh dashboard",children:s.jsx(ee,{onClick:async()=>{l(!0),await x(),setTimeout(()=>l(!1),1e3)},sx:{backgroundColor:v(t.palette.primary.main,.1),"&:hover":{backgroundColor:v(t.palette.primary.main,.2)}},children:s.jsx(Rs,{sx:{fontSize:20,animation:o?"spin 1s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})})})]}),n?s.jsxs(p,{sx:{mb:{xs:2,md:3},mx:-2,px:2,overflow:"hidden"},children:[s.jsxs(p,{sx:{display:"flex",gap:1,overflowX:"auto",pb:1,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",WebkitOverflowScrolling:"touch"},children:[s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(I,{icon:s.jsx($n,{sx:{color:"white"}}),title:"Total Classes",value:m.totalClasses,change:m.previousWeekClasses>0?Math.round((m.callsThisWeek-m.previousWeekClasses)/m.previousWeekClasses*100):m.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:`${m.callsThisMonth} this month`})}),s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(I,{icon:s.jsx(zn,{sx:{color:"white"}}),title:"This Week",value:m.callsThisWeek,change:m.previousWeekClasses>0?Math.round((m.callsThisWeek-m.previousWeekClasses)/m.previousWeekClasses*100):m.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:"Classes attended"})}),s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(I,{icon:s.jsx(Gr,{sx:{color:"white"}}),title:"New Messages",value:m.unreadMessages,change:void 0,color:t.palette.primary.main,subtitle:"From teacher",onClick:()=>window.location.href="#/messages"})}),s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(I,{icon:s.jsx(Mr,{sx:{color:"white"}}),title:"Success Rate",value:`${m.successRate}%`,change:m.callsThisWeek>m.previousWeekClasses?Math.round((m.callsThisWeek-m.previousWeekClasses)/Math.max(m.previousWeekClasses,1)*100):0,color:t.palette.primary.main,subtitle:"Call completion"})})]}),s.jsx(p,{sx:{display:"flex",justifyContent:"center",mt:1,gap:.5},children:[0,1,2,3].map(P=>s.jsx(p,{sx:{width:6,height:6,borderRadius:"50%",backgroundColor:t.palette.action.disabled,transition:"all 0.3s"}},P))})]}):s.jsxs(ne,{container:!0,spacing:{xs:1.5,md:3},sx:{mb:{xs:2,md:4}},children:[s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(I,{icon:s.jsx($n,{sx:{color:"white"}}),title:"Total Classes",value:m.totalClasses,change:m.previousWeekClasses>0?Math.round((m.callsThisWeek-m.previousWeekClasses)/m.previousWeekClasses*100):m.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:`${m.callsThisMonth} this month`})}),s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(I,{icon:s.jsx(zn,{sx:{color:"white"}}),title:"This Week",value:m.callsThisWeek,change:m.previousWeekClasses>0?Math.round((m.callsThisWeek-m.previousWeekClasses)/m.previousWeekClasses*100):m.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:"Classes attended"})}),s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(I,{icon:s.jsx(Gr,{sx:{color:"white"}}),title:"New Messages",value:m.unreadMessages,change:void 0,color:t.palette.primary.main,subtitle:"From teacher",onClick:()=>window.location.href="#/messages"})}),s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(I,{icon:s.jsx(Mr,{sx:{color:"white"}}),title:"Success Rate",value:`${m.successRate}%`,change:m.callsThisWeek>m.previousWeekClasses?Math.round((m.callsThisWeek-m.previousWeekClasses)/Math.max(m.previousWeekClasses,1)*100):0,color:t.palette.primary.main,subtitle:"Call completion"})})]}),s.jsxs(ne,{container:!0,spacing:{xs:2,md:3},sx:{mt:{xs:1,md:2}},children:[s.jsx(ne,{item:!0,xs:12,md:6,children:s.jsx(Ue,{sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:"120px",md:"auto"},background:`linear-gradient(135deg, ${v(t.palette.primary.main,.08)} 0%, ${v(t.palette.primary.main,.05)} 100%)`,border:`1px solid ${v(t.palette.primary.main,.12)}`,borderRadius:{xs:2,md:3},transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:{xs:"none",md:`0 8px 32px ${v(t.palette.primary.main,.15)}`}}},children:s.jsx(Ye,{sx:{p:{xs:1.2,md:3},"&:last-child":{pb:{xs:1.2,md:3}}},children:c?s.jsxs(p,{children:[s.jsxs(p,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:1,md:1.5},children:[s.jsxs(p,{display:"flex",alignItems:"center",flex:1,children:[s.jsx(lr,{sx:{width:{xs:32,md:40},height:{xs:32,md:40},mr:{xs:1,md:1.5},background:`linear-gradient(135deg, ${t.palette.primary.main} 0%, ${t.palette.primary.dark} 100%)`,fontSize:{xs:"0.9rem",md:"1.2rem"},fontWeight:700},children:(E=(j=c.username)==null?void 0:j[0])==null?void 0:E.toUpperCase()}),s.jsxs(p,{flex:1,children:[s.jsx(S,{variant:"body1",sx:{fontSize:{xs:"0.9rem",md:"1rem"},fontWeight:600,lineHeight:1.2},children:c.username}),s.jsx(gt,{icon:s.jsx(hn,{sx:{fontSize:{xs:10,md:12}}}),label:c.isOnline?"Online":"Offline",color:c.isOnline?"success":"default",size:"small",sx:{fontSize:{xs:"0.65rem",md:"0.7rem"},height:{xs:18,md:20},mt:.5}})]})]}),s.jsxs(p,{display:"flex",alignItems:"center",gap:.5,children:[m.unreadMessages>0&&s.jsx(gt,{label:m.unreadMessages,color:"error",size:"small",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},height:{xs:18,md:20}}}),s.jsx(Te,{variant:"contained",size:"small",onClick:L,sx:{background:`linear-gradient(135deg, ${t.palette.primary.main} 0%, ${t.palette.primary.dark} 100%)`,color:"white",fontWeight:600,py:{xs:.5,md:.75},px:{xs:1.5,md:2},borderRadius:1.5,textTransform:"none",fontSize:{xs:"0.75rem",md:"0.875rem"},minWidth:{xs:"auto",md:"80px"},boxShadow:`0 2px 8px ${v(t.palette.primary.main,.3)}`,"&:hover":{boxShadow:`0 4px 12px ${v(t.palette.primary.main,.4)}`}},children:"Message"})]})]}),h.length>0&&s.jsxs(p,{sx:{borderTop:`1px solid ${v(t.palette.divider,.1)}`,pt:{xs:.8,md:1}},children:[s.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},mb:.5,display:"block"},children:"Recent message:"}),s.jsx(p,{children:h.slice(0,1).map(P=>{var B;return s.jsxs(p,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[s.jsx(p,{flex:1,children:s.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",md:"0.85rem"},fontWeight:400,lineHeight:1.2,color:"text.secondary"},children:['"',(B=P.content)==null?void 0:B.substring(0,n?25:35),'..."']})}),!P.isRead&&s.jsx(p,{sx:{width:{xs:6,md:8},height:{xs:6,md:8},borderRadius:"50%",bgcolor:"error.main",ml:1}})]},P.id)})})]})]}):s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",sx:{mb:1,fontSize:{xs:"0.9rem",md:"1rem"}},children:"My Teacher"}),s.jsx(mt,{severity:"info",sx:{fontSize:"0.8rem"},children:"No teacher assigned yet."})]})})})}),s.jsx(ne,{item:!0,xs:12,md:6,children:s.jsx(Ue,{sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:"80px",md:"auto"},background:`linear-gradient(135deg, ${v(t.palette.primary.main,.08)} 0%, ${v(t.palette.primary.main,.05)} 100%)`,border:`1px solid ${v(t.palette.primary.main,.12)}`,borderRadius:{xs:2,md:3},transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:{xs:"none",md:`0 8px 32px ${v(t.palette.primary.main,.15)}`}}},children:s.jsxs(Ye,{sx:{p:{xs:1.2,md:3},"&:last-child":{pb:{xs:1.2,md:3}}},children:[s.jsx(p,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:.5,md:2},children:s.jsxs(p,{display:"flex",alignItems:"center",children:[s.jsx(Gt,{sx:{color:t.palette.primary.main,fontSize:{xs:18,md:24},mr:{xs:.5,md:1}}}),s.jsx(S,{variant:"body2",sx:{fontSize:{xs:"0.9rem",md:"1rem"},fontWeight:600,color:t.palette.primary.main},children:"Today's Schedule"})]})}),y.length===0?s.jsx(S,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",md:"0.875rem"},fontStyle:"italic"},children:"No classes scheduled for today"}):s.jsxs(p,{children:[y.slice(0,2).map((P,B)=>s.jsxs(p,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{py:{xs:.5,md:1},borderBottom:B<1?`1px solid ${v(t.palette.divider,.1)}`:"none"},children:[s.jsxs(p,{children:[s.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",md:"0.9rem"},fontWeight:500,lineHeight:1.2},children:[P.time," - ",P.subject]}),s.jsxs(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"}},children:["with ",P.teacher]})]}),s.jsx(Te,{variant:"contained",size:"small",sx:{background:`linear-gradient(135deg, ${t.palette.primary.main} 0%, ${t.palette.primary.dark} 100%)`,color:"white",fontWeight:600,borderRadius:1.5,textTransform:"none",fontSize:{xs:"0.7rem",md:"0.75rem"},py:{xs:.3,md:.5},px:{xs:1,md:1.5},minWidth:{xs:"auto",md:"60px"},boxShadow:`0 2px 8px ${v(t.palette.primary.main,.3)}`},children:"Join"})]},P.id)),y.length>2&&s.jsxs(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},display:"block",mt:.5},children:["+",y.length-2," more classes"]})]})]})})})]})]})}function wo({message:r,isOwn:e,currentTime:t=new Date}){const n=we();return s.jsx(p,{sx:{display:"flex",justifyContent:e?"flex-end":"flex-start",mb:2},children:s.jsxs(ge,{sx:{p:2,maxWidth:"70%",borderRadius:2,bgcolor:e?v(n.palette.primary.main,.9):v(n.palette.background.paper,.9),color:e?"white":"text.primary",boxShadow:`0 2px 8px ${v(n.palette.common.black,.1)}`},children:[s.jsx(S,{variant:"body1",sx:{wordBreak:"break-word"},children:r.content}),s.jsx(S,{variant:"caption",sx:{display:"block",mt:.5,opacity:.7,fontSize:"0.7rem"},children:(()=>{if(!r.timestamp)return"Unknown time";const i=r.timestamp instanceof Date?r.timestamp:new Date(r.timestamp);if(isNaN(i.getTime()))return"Unknown time";const o=t-i,l=Math.floor(o/1e3),c=Math.floor(l/60),f=Math.floor(c/60),h=Math.floor(f/24);return l<60?"Just now":c<60?`${c} min${c>1?"s":""} ago`:f<24?`${f} hour${f>1?"s":""} ago`:h<7?`${h} day${h>1?"s":""} ago`:i.toLocaleDateString()})()})]})})}function vo({user:r}){const e=we(),[t,n]=d.useState([]),[i,a]=d.useState(0),[o,l]=d.useState([]),[c,f]=d.useState("");d.useState(!1);const h=d.useRef(null),[u,y]=d.useState(new Date),[_,m]=d.useState([]),w=()=>{var E;(E=h.current)==null||E.scrollIntoView({behavior:"smooth"})};d.useEffect(()=>{const E=setInterval(()=>{y(new Date)},6e4);return()=>clearInterval(E)},[]),d.useEffect(()=>{let E=null;return r&&(E=Ft.getConversations(P=>{m(P),x(P)})),()=>{E&&E()}},[r]),d.useEffect(()=>{let E=null;if(t[i]){const P=t[i];E=Ft.getMessages(P.firebaseId||P.id,B=>{const $=B.map(b=>{var k,O,R,A;return{id:b.id,senderId:b.senderId,recipientId:b.receiverId,content:b.content,timestamp:((O=(k=b.timestamp)==null?void 0:k.toDate)==null?void 0:O.call(k))||new Date(b.createdAt),senderName:((R=b.metadata)==null?void 0:R.senderName)||"Unknown",recipientName:((A=b.metadata)==null?void 0:A.receiverName)||"Unknown",isOwn:b.senderId===r.id,isRead:b.isRead}});l($),Ft.markAsRead(P.firebaseId||P.id)})}else l([]);return()=>{E&&E()}},[i,t,r]),d.useEffect(()=>{w()},[o]);const x=async E=>{var P,B,$,b,k,O,R;try{const A=[];if(!(r!=null&&r.id)){console.warn("No user ID available for loading conversations");return}const D=await Me.getMyTeacher(r.id);if(D!=null&&D.success&&D.teacher){const Y=D.teacher,H=E.find(le=>le.participants.includes(Y.id));A.push({id:Y.id,firebaseId:H==null?void 0:H.id,user:{id:Y.id,name:Y.username||Y.name||"My Teacher",avatar:s.jsx(eo,{}),status:Y.isOnline?"online":"offline",role:"teacher"},lastMessage:(H==null?void 0:H.lastMessage)||"",timestamp:((B=(P=H==null?void 0:H.lastMessageTime)==null?void 0:P.toDate)==null?void 0:B.call(P))||new Date(0),unread:(($=H==null?void 0:H.unreadCount)==null?void 0:$[r.id])||0})}const q=await Me.getUsersByRole("admin");if(q!=null&&q.success&&((b=q.users)==null?void 0:b.length)>0){const Y=q.users[0],H=E.find(le=>le.participants.includes(Y.id));A.push({id:Y.id,firebaseId:H==null?void 0:H.id,user:{id:Y.id,name:Y.username||Y.name||"Admin",avatar:s.jsx(Aa,{}),status:Y.isOnline?"online":"offline",role:"admin"},lastMessage:(H==null?void 0:H.lastMessage)||"",timestamp:((O=(k=H==null?void 0:H.lastMessageTime)==null?void 0:k.toDate)==null?void 0:O.call(k))||new Date(0),unread:((R=H==null?void 0:H.unreadCount)==null?void 0:R[r.id])||0})}n(A)}catch(A){console.error("Failed to load Firebase conversations:",A)}},L=async()=>{if(!c.trim()||!t[i])return;const E=c.trim(),P=t[i];f("");try{const B=await Ft.sendMessage(P.id,E,"text");B.success||(console.error("❌ Failed to send message via Firebase:",B.error),f(E),alert("Failed to send message: "+B.error))}catch(B){console.error("❌ Error sending message via Firebase:",B),f(E),alert("Failed to send message: "+B.message)}},I=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),L())},j=(E,P)=>{a(P)};return s.jsx(p,{sx:{height:"calc(100vh - 112px)",display:"flex",flexDirection:"column",bgcolor:"background.default",overflow:"hidden",position:"absolute",top:0,left:0,right:0},children:s.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",border:`1px solid ${v(e.palette.divider,.2)}`,borderRadius:2,bgcolor:v(e.palette.background.paper,.3),overflow:"hidden"},children:[s.jsxs(ge,{elevation:0,sx:{flexShrink:0,borderRadius:"8px 8px 0 0",borderBottom:`1px solid ${v(e.palette.divider,.1)}`,background:`linear-gradient(135deg, ${v(e.palette.background.paper,.95)} 0%, ${v(e.palette.background.paper,.9)} 100%)`},children:[s.jsx(p,{sx:{px:3},children:s.jsx(S,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Messages"})}),s.jsx(xi,{value:i,onChange:j,sx:{px:2,"& .MuiTab-root":{minHeight:64,textTransform:"none",fontSize:"1rem",fontWeight:500}},children:t.map((E,P)=>s.jsx(bi,{label:s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[s.jsx(an,{badgeContent:E.unread,color:"error",sx:{"& .MuiBadge-badge":{fontSize:"0.7rem"}},children:s.jsx(lr,{sx:{width:32,height:32,bgcolor:E.user.role==="teacher"?e.palette.secondary.main:e.palette.primary.main},children:E.user.avatar})}),s.jsxs(p,{sx:{textAlign:"left"},children:[s.jsx(S,{variant:"body1",children:E.user.name}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:.5},children:[s.jsx(hn,{sx:{fontSize:8,color:E.user.status==="online"?e.palette.success.main:e.palette.text.disabled}}),s.jsx(S,{variant:"caption",color:"text.secondary",children:E.user.status==="online"?"Online":"Offline"})]})]})]})},E.id))})]}),t[i]&&s.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[s.jsxs(p,{sx:{flex:1,overflow:"auto",p:3,display:"flex",flexDirection:"column"},children:[o.length===0?s.jsx(p,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"text.secondary"},children:s.jsxs(S,{variant:"body1",children:["Start a conversation with ",t[i].user.name]})}):s.jsx(s.Fragment,{children:o.map(E=>s.jsx(wo,{message:E,isOwn:E.isOwn,currentTime:u},E.id))}),s.jsx("div",{ref:h})]}),s.jsx(p,{sx:{flexShrink:0,p:2,pb:3,borderTop:`1px solid ${v(e.palette.divider,.1)}`,bgcolor:v(e.palette.background.paper,.1)},children:s.jsxs(p,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[s.jsx(Fe,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:`Message ${t[i].user.name}...`,value:c,onChange:E=>f(E.target.value),onKeyPress:I,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:v(e.palette.background.default,.5)}}}),s.jsx(ee,{onClick:L,disabled:!c.trim(),sx:{bgcolor:e.palette.primary.main,color:"white","&:hover":{bgcolor:e.palette.primary.dark},"&:disabled":{bgcolor:v(e.palette.primary.main,.3)},width:48,height:48},children:s.jsx(Ps,{})})]})})]})]})})}function Co({user:r}){const e=we();it(e.breakpoints.down("md"));const[t,n]=d.useState({username:(r==null?void 0:r.username)||"",email:(r==null?void 0:r.email)||"",currentPassword:"",newPassword:"",confirmPassword:""}),[i,a]=d.useState({messageAlerts:!0,teacherOnline:!0,classReminders:!0}),[o,l]=d.useState({hdVideo:!0,microphoneDefault:!0,cameraDefault:!0});d.useEffect(()=>{try{const j=localStorage.getItem("studentNotificationSettings"),E=localStorage.getItem("studentStudySettings");j&&a(JSON.parse(j)),E&&l(JSON.parse(E))}catch(j){console.error("Failed to load settings from localStorage:",j)}},[]);const[c,f]=d.useState(!1),[h,u]=d.useState(!1),[y,_]=d.useState(""),m=(j,E)=>{n(P=>({...P,[j]:E}))},w=j=>{a(E=>({...E,[j]:!E[j]}))},x=j=>{l(E=>({...E,[j]:!E[j]}))},L=async()=>{try{if(u(!0),_(""),!t.username.trim())throw new Error("Username is required");if(t.newPassword.trim()!==""){if(!t.currentPassword)throw new Error("Current password is required to change password");if(t.newPassword.length<6)throw new Error("New password must be at least 6 characters");if(t.newPassword!==t.confirmPassword)throw new Error("New passwords do not match");await Ui(pe.currentUser,t.newPassword)}t.username!==r.username&&await Bi(pe.currentUser,{displayName:t.username});const E=ce(se,"users",r.id);await Ge(E,{username:t.username,updatedAt:new Date}),await Me.setOnline(),f(!0),n(P=>({...P,currentPassword:"",newPassword:"",confirmPassword:""}))}catch(j){console.error("Profile update error:",j),_(j.message||"Failed to update profile")}finally{u(!1)}setTimeout(()=>{f(!1),_("")},5e3)},I=()=>{try{localStorage.setItem("studentNotificationSettings",JSON.stringify(i)),localStorage.setItem("studentStudySettings",JSON.stringify(o)),f(!0)}catch(j){console.error("Failed to save settings:",j),_("Failed to save settings")}setTimeout(()=>{f(!1),_("")},3e3)};return s.jsxs(p,{children:[s.jsxs(p,{sx:{mb:4},children:[s.jsx(S,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Settings"}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"Manage your profile, preferences and privacy settings"})]}),c&&s.jsx(mt,{severity:"success",sx:{mb:3},children:"Settings saved successfully!"}),y&&s.jsx(mt,{severity:"error",sx:{mb:3},children:y}),s.jsxs(_t,{spacing:3,children:[s.jsx(Ue,{sx:{background:`linear-gradient(135deg, ${v(e.palette.primary.main,.08)} 0%, ${v(e.palette.info.main,.05)} 100%)`,border:`1px solid ${v(e.palette.primary.main,.12)}`,borderRadius:3,transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:`0 8px 32px ${v(e.palette.primary.main,.15)}`}},children:s.jsxs(Ye,{sx:{p:3},children:[s.jsxs(p,{display:"flex",alignItems:"center",mb:3,children:[s.jsx(p,{sx:{width:40,height:40,borderRadius:2,background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${v(e.palette.primary.main,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mr:2,boxShadow:`0 4px 16px ${v(e.palette.primary.main,.4)}`},children:s.jsx(Pt,{sx:{color:"white",fontSize:20}})}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",fontWeight:700,sx:{background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${e.palette.info.main} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Profile Settings"}),s.jsx(S,{variant:"caption",color:"text.secondary",children:"Update your personal information"})]})]}),s.jsx(Fe,{fullWidth:!0,label:"Username",value:t.username,onChange:j=>m("username",j.target.value),margin:"normal"}),s.jsx(Fe,{fullWidth:!0,label:"Email",type:"email",value:t.email,onChange:j=>m("email",j.target.value),margin:"normal",disabled:!0,helperText:"Email cannot be changed. Contact your teacher or administrator."}),s.jsx(He,{sx:{my:2}}),s.jsx(S,{variant:"subtitle2",gutterBottom:!0,children:"Change Password"}),s.jsx(Fe,{fullWidth:!0,label:"Current Password",type:"password",value:t.currentPassword,onChange:j=>m("currentPassword",j.target.value),margin:"normal"}),s.jsx(Fe,{fullWidth:!0,label:"New Password",type:"password",value:t.newPassword,onChange:j=>m("newPassword",j.target.value),margin:"normal",helperText:"Must be at least 6 characters",error:!!(t.newPassword&&t.newPassword.length<6)}),s.jsx(Fe,{fullWidth:!0,label:"Confirm New Password",type:"password",value:t.confirmPassword,onChange:j=>m("confirmPassword",j.target.value),margin:"normal",helperText:t.newPassword&&t.confirmPassword&&t.newPassword!==t.confirmPassword?"Passwords do not match":"",error:!!(t.newPassword&&t.confirmPassword&&t.newPassword!==t.confirmPassword)}),s.jsx(Te,{variant:"contained",startIcon:h?s.jsx(cr,{size:20,color:"inherit"}):s.jsx(Hn,{}),onClick:L,disabled:h,sx:{mt:3,background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${e.palette.primary.dark} 100%)`,color:"white",fontWeight:700,py:1.5,borderRadius:2,textTransform:"none",boxShadow:`0 3px 12px ${v(e.palette.primary.main,.4)}`,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"translateY(-1px)",boxShadow:`0 6px 20px ${v(e.palette.primary.main,.5)}`}},fullWidth:!0,children:h?"Saving...":"Save Profile"})]})}),s.jsx(Ue,{sx:{background:`linear-gradient(135deg, ${v(e.palette.success.main,.08)} 0%, ${v(e.palette.warning.main,.05)} 100%)`,border:`1px solid ${v(e.palette.success.main,.12)}`,borderRadius:3,transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:`0 8px 32px ${v(e.palette.success.main,.15)}`}},children:s.jsxs(Ye,{sx:{p:3},children:[s.jsxs(p,{display:"flex",alignItems:"center",mb:3,children:[s.jsx(p,{sx:{width:40,height:40,borderRadius:2,background:`linear-gradient(135deg, ${e.palette.success.main} 0%, ${v(e.palette.success.main,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mr:2,boxShadow:`0 4px 16px ${v(e.palette.success.main,.4)}`},children:s.jsx(Ka,{sx:{color:"white",fontSize:20}})}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",fontWeight:700,sx:{background:`linear-gradient(135deg, ${e.palette.success.main} 0%, ${e.palette.warning.main} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Notification Settings"}),s.jsx(S,{variant:"caption",color:"text.secondary",children:"Control your notification preferences"})]})]}),s.jsxs(_t,{spacing:2,children:[s.jsx(lt,{control:s.jsx(dt,{checked:i.messageAlerts,onChange:()=>w("messageAlerts")}),label:"Message Alerts",sx:{mx:0}}),s.jsx(lt,{control:s.jsx(dt,{checked:i.teacherOnline,onChange:()=>w("teacherOnline")}),label:"Teacher Online Notifications",sx:{mx:0}}),s.jsx(lt,{control:s.jsx(dt,{checked:i.classReminders,onChange:()=>w("classReminders")}),label:"Class Reminders",sx:{mx:0}})]})]})}),s.jsx(Ue,{sx:{background:`linear-gradient(135deg, ${v(e.palette.info.main,.08)} 0%, ${v(e.palette.secondary.main,.05)} 100%)`,border:`1px solid ${v(e.palette.info.main,.12)}`,borderRadius:3,transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:`0 8px 32px ${v(e.palette.info.main,.15)}`}},children:s.jsxs(Ye,{sx:{p:3},children:[s.jsxs(p,{display:"flex",alignItems:"center",mb:3,children:[s.jsx(p,{sx:{width:40,height:40,borderRadius:2,background:`linear-gradient(135deg, ${e.palette.info.main} 0%, ${v(e.palette.info.main,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mr:2,boxShadow:`0 4px 16px ${v(e.palette.info.main,.4)}`},children:s.jsx(Jt,{sx:{color:"white",fontSize:20}})}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",fontWeight:700,sx:{background:`linear-gradient(135deg, ${e.palette.info.main} 0%, ${e.palette.secondary.main} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Video Call Settings"}),s.jsx(S,{variant:"caption",color:"text.secondary",children:"Configure your video call preferences"})]})]}),s.jsxs(_t,{spacing:2,children:[s.jsx(lt,{control:s.jsx(dt,{checked:o.hdVideo,onChange:()=>x("hdVideo")}),label:"HD Video Quality",sx:{mx:0}}),s.jsx(lt,{control:s.jsx(dt,{checked:o.microphoneDefault,onChange:()=>x("microphoneDefault")}),label:"Turn on Microphone by Default",sx:{mx:0}}),s.jsx(lt,{control:s.jsx(dt,{checked:o.cameraDefault,onChange:()=>x("cameraDefault")}),label:"Turn on Camera by Default",sx:{mx:0}})]}),s.jsx(Te,{variant:"contained",startIcon:s.jsx(Hn,{}),onClick:I,sx:{mt:3,background:`linear-gradient(135deg, ${e.palette.info.main} 0%, ${e.palette.info.dark} 100%)`,color:"white",fontWeight:700,py:1.5,borderRadius:2,textTransform:"none",boxShadow:`0 3px 12px ${v(e.palette.info.main,.4)}`,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"translateY(-1px)",boxShadow:`0 6px 20px ${v(e.palette.info.main,.5)}`}},fullWidth:!0,children:"Save Settings"})]})})]})]})}const Ms=6048e5,So=864e5,Yn=Symbol.for("constructDateFrom");function Ke(r,e){return typeof r=="function"?r(e):r&&typeof r=="object"&&Yn in r?r[Yn](e):r instanceof Date?new r.constructor(e):new Date(e)}function Ie(r,e){return Ke(e||r,r)}let ko={};function fr(){return ko}function Dt(r,e){var l,c,f,h;const t=fr(),n=(e==null?void 0:e.weekStartsOn)??((c=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((h=(f=t.locale)==null?void 0:f.options)==null?void 0:h.weekStartsOn)??0,i=Ie(r,e==null?void 0:e.in),a=i.getDay(),o=(a<n?7:0)+a-n;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function ar(r,e){return Dt(r,{...e,weekStartsOn:1})}function _s(r,e){const t=Ie(r,e==null?void 0:e.in),n=t.getFullYear(),i=Ke(t,0);i.setFullYear(n+1,0,4),i.setHours(0,0,0,0);const a=ar(i),o=Ke(t,0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);const l=ar(o);return t.getTime()>=a.getTime()?n+1:t.getTime()>=l.getTime()?n:n-1}function Gn(r){const e=Ie(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function jo(r,...e){const t=Ke.bind(null,r||e.find(n=>typeof n=="object"));return e.map(t)}function Jn(r,e){const t=Ie(r,e==null?void 0:e.in);return t.setHours(0,0,0,0),t}function Eo(r,e,t){const[n,i]=jo(t==null?void 0:t.in,r,e),a=Jn(n),o=Jn(i),l=+a-Gn(a),c=+o-Gn(o);return Math.round((l-c)/So)}function To(r,e){const t=_s(r,e),n=Ke((e==null?void 0:e.in)||r,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),ar(n)}function Io(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function Ro(r){return!(!Io(r)&&typeof r!="number"||isNaN(+Ie(r)))}function Po(r,e){const t=Ie(r,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const Fo={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},Mo=(r,e,t)=>{let n;const i=Fo[r];return typeof i=="string"?n=i:e===1?n=i.one:n=i.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function _r(r){return(e={})=>{const t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}const _o={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Oo={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},Ao={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Lo={date:_r({formats:_o,defaultWidth:"full"}),time:_r({formats:Oo,defaultWidth:"full"}),dateTime:_r({formats:Ao,defaultWidth:"full"})},Do={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},Wo=(r,e,t,n)=>Do[r];function Tt(r){return(e,t)=>{const n=t!=null&&t.context?String(t.context):"standalone";let i;if(n==="formatting"&&r.formattingValues){const o=r.defaultFormattingWidth||r.defaultWidth,l=t!=null&&t.width?String(t.width):o;i=r.formattingValues[l]||r.formattingValues[o]}else{const o=r.defaultWidth,l=t!=null&&t.width?String(t.width):r.defaultWidth;i=r.values[l]||r.values[o]}const a=r.argumentCallback?r.argumentCallback(e):e;return i[a]}}const No={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Uo={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Bo={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},zo={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},$o={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Ho={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Vo=(r,e)=>{const t=Number(r),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},qo={ordinalNumber:Vo,era:Tt({values:No,defaultWidth:"wide"}),quarter:Tt({values:Uo,defaultWidth:"wide",argumentCallback:r=>r-1}),month:Tt({values:Bo,defaultWidth:"wide"}),day:Tt({values:zo,defaultWidth:"wide"}),dayPeriod:Tt({values:$o,defaultWidth:"wide",formattingValues:Ho,defaultFormattingWidth:"wide"})};function It(r){return(e,t={})=>{const n=t.width,i=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],a=e.match(i);if(!a)return null;const o=a[0],l=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],c=Array.isArray(l)?Go(l,u=>u.test(o)):Yo(l,u=>u.test(o));let f;f=r.valueCallback?r.valueCallback(c):c,f=t.valueCallback?t.valueCallback(f):f;const h=e.slice(o.length);return{value:f,rest:h}}}function Yo(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function Go(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function Jo(r){return(e,t={})=>{const n=e.match(r.matchPattern);if(!n)return null;const i=n[0],a=e.match(r.parsePattern);if(!a)return null;let o=r.valueCallback?r.valueCallback(a[0]):a[0];o=t.valueCallback?t.valueCallback(o):o;const l=e.slice(i.length);return{value:o,rest:l}}}const Xo=/^(\d+)(th|st|nd|rd)?/i,Ko=/\d+/i,Qo={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},Zo={any:[/^b/i,/^(a|c)/i]},ec={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},tc={any:[/1/i,/2/i,/3/i,/4/i]},rc={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},nc={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},sc={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},ic={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},ac={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},oc={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},cc={ordinalNumber:Jo({matchPattern:Xo,parsePattern:Ko,valueCallback:r=>parseInt(r,10)}),era:It({matchPatterns:Qo,defaultMatchWidth:"wide",parsePatterns:Zo,defaultParseWidth:"any"}),quarter:It({matchPatterns:ec,defaultMatchWidth:"wide",parsePatterns:tc,defaultParseWidth:"any",valueCallback:r=>r+1}),month:It({matchPatterns:rc,defaultMatchWidth:"wide",parsePatterns:nc,defaultParseWidth:"any"}),day:It({matchPatterns:sc,defaultMatchWidth:"wide",parsePatterns:ic,defaultParseWidth:"any"}),dayPeriod:It({matchPatterns:ac,defaultMatchWidth:"any",parsePatterns:oc,defaultParseWidth:"any"})},lc={code:"en-US",formatDistance:Mo,formatLong:Lo,formatRelative:Wo,localize:qo,match:cc,options:{weekStartsOn:0,firstWeekContainsDate:1}};function dc(r,e){const t=Ie(r,e==null?void 0:e.in);return Eo(t,Po(t))+1}function uc(r,e){const t=Ie(r,e==null?void 0:e.in),n=+ar(t)-+To(t);return Math.round(n/Ms)+1}function Os(r,e){var h,u,y,_;const t=Ie(r,e==null?void 0:e.in),n=t.getFullYear(),i=fr(),a=(e==null?void 0:e.firstWeekContainsDate)??((u=(h=e==null?void 0:e.locale)==null?void 0:h.options)==null?void 0:u.firstWeekContainsDate)??i.firstWeekContainsDate??((_=(y=i.locale)==null?void 0:y.options)==null?void 0:_.firstWeekContainsDate)??1,o=Ke((e==null?void 0:e.in)||r,0);o.setFullYear(n+1,0,a),o.setHours(0,0,0,0);const l=Dt(o,e),c=Ke((e==null?void 0:e.in)||r,0);c.setFullYear(n,0,a),c.setHours(0,0,0,0);const f=Dt(c,e);return+t>=+l?n+1:+t>=+f?n:n-1}function hc(r,e){var l,c,f,h;const t=fr(),n=(e==null?void 0:e.firstWeekContainsDate)??((c=(l=e==null?void 0:e.locale)==null?void 0:l.options)==null?void 0:c.firstWeekContainsDate)??t.firstWeekContainsDate??((h=(f=t.locale)==null?void 0:f.options)==null?void 0:h.firstWeekContainsDate)??1,i=Os(r,e),a=Ke((e==null?void 0:e.in)||r,0);return a.setFullYear(i,0,n),a.setHours(0,0,0,0),Dt(a,e)}function fc(r,e){const t=Ie(r,e==null?void 0:e.in),n=+Dt(t,e)-+hc(t,e);return Math.round(n/Ms)+1}function Q(r,e){const t=r<0?"-":"",n=Math.abs(r).toString().padStart(e,"0");return t+n}const Be={y(r,e){const t=r.getFullYear(),n=t>0?t:1-t;return Q(e==="yy"?n%100:n,e.length)},M(r,e){const t=r.getMonth();return e==="M"?String(t+1):Q(t+1,2)},d(r,e){return Q(r.getDate(),e.length)},a(r,e){const t=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(r,e){return Q(r.getHours()%12||12,e.length)},H(r,e){return Q(r.getHours(),e.length)},m(r,e){return Q(r.getMinutes(),e.length)},s(r,e){return Q(r.getSeconds(),e.length)},S(r,e){const t=e.length,n=r.getMilliseconds(),i=Math.trunc(n*Math.pow(10,t-3));return Q(i,e.length)}},ht={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},Xn={G:function(r,e,t){const n=r.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(n,{width:"abbreviated"});case"GGGGG":return t.era(n,{width:"narrow"});case"GGGG":default:return t.era(n,{width:"wide"})}},y:function(r,e,t){if(e==="yo"){const n=r.getFullYear(),i=n>0?n:1-n;return t.ordinalNumber(i,{unit:"year"})}return Be.y(r,e)},Y:function(r,e,t,n){const i=Os(r,n),a=i>0?i:1-i;if(e==="YY"){const o=a%100;return Q(o,2)}return e==="Yo"?t.ordinalNumber(a,{unit:"year"}):Q(a,e.length)},R:function(r,e){const t=_s(r);return Q(t,e.length)},u:function(r,e){const t=r.getFullYear();return Q(t,e.length)},Q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return Q(n,2);case"Qo":return t.ordinalNumber(n,{unit:"quarter"});case"QQQ":return t.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(n,{width:"wide",context:"formatting"})}},q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return Q(n,2);case"qo":return t.ordinalNumber(n,{unit:"quarter"});case"qqq":return t.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(n,{width:"wide",context:"standalone"})}},M:function(r,e,t){const n=r.getMonth();switch(e){case"M":case"MM":return Be.M(r,e);case"Mo":return t.ordinalNumber(n+1,{unit:"month"});case"MMM":return t.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(n,{width:"wide",context:"formatting"})}},L:function(r,e,t){const n=r.getMonth();switch(e){case"L":return String(n+1);case"LL":return Q(n+1,2);case"Lo":return t.ordinalNumber(n+1,{unit:"month"});case"LLL":return t.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(n,{width:"wide",context:"standalone"})}},w:function(r,e,t,n){const i=fc(r,n);return e==="wo"?t.ordinalNumber(i,{unit:"week"}):Q(i,e.length)},I:function(r,e,t){const n=uc(r);return e==="Io"?t.ordinalNumber(n,{unit:"week"}):Q(n,e.length)},d:function(r,e,t){return e==="do"?t.ordinalNumber(r.getDate(),{unit:"date"}):Be.d(r,e)},D:function(r,e,t){const n=dc(r);return e==="Do"?t.ordinalNumber(n,{unit:"dayOfYear"}):Q(n,e.length)},E:function(r,e,t){const n=r.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(n,{width:"short",context:"formatting"});case"EEEE":default:return t.day(n,{width:"wide",context:"formatting"})}},e:function(r,e,t,n){const i=r.getDay(),a=(i-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return Q(a,2);case"eo":return t.ordinalNumber(a,{unit:"day"});case"eee":return t.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(i,{width:"short",context:"formatting"});case"eeee":default:return t.day(i,{width:"wide",context:"formatting"})}},c:function(r,e,t,n){const i=r.getDay(),a=(i-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return Q(a,e.length);case"co":return t.ordinalNumber(a,{unit:"day"});case"ccc":return t.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(i,{width:"narrow",context:"standalone"});case"cccccc":return t.day(i,{width:"short",context:"standalone"});case"cccc":default:return t.day(i,{width:"wide",context:"standalone"})}},i:function(r,e,t){const n=r.getDay(),i=n===0?7:n;switch(e){case"i":return String(i);case"ii":return Q(i,e.length);case"io":return t.ordinalNumber(i,{unit:"day"});case"iii":return t.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(n,{width:"short",context:"formatting"});case"iiii":default:return t.day(n,{width:"wide",context:"formatting"})}},a:function(r,e,t){const i=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(r,e,t){const n=r.getHours();let i;switch(n===12?i=ht.noon:n===0?i=ht.midnight:i=n/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(r,e,t){const n=r.getHours();let i;switch(n>=17?i=ht.evening:n>=12?i=ht.afternoon:n>=4?i=ht.morning:i=ht.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(r,e,t){if(e==="ho"){let n=r.getHours()%12;return n===0&&(n=12),t.ordinalNumber(n,{unit:"hour"})}return Be.h(r,e)},H:function(r,e,t){return e==="Ho"?t.ordinalNumber(r.getHours(),{unit:"hour"}):Be.H(r,e)},K:function(r,e,t){const n=r.getHours()%12;return e==="Ko"?t.ordinalNumber(n,{unit:"hour"}):Q(n,e.length)},k:function(r,e,t){let n=r.getHours();return n===0&&(n=24),e==="ko"?t.ordinalNumber(n,{unit:"hour"}):Q(n,e.length)},m:function(r,e,t){return e==="mo"?t.ordinalNumber(r.getMinutes(),{unit:"minute"}):Be.m(r,e)},s:function(r,e,t){return e==="so"?t.ordinalNumber(r.getSeconds(),{unit:"second"}):Be.s(r,e)},S:function(r,e){return Be.S(r,e)},X:function(r,e,t){const n=r.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return Qn(n);case"XXXX":case"XX":return et(n);case"XXXXX":case"XXX":default:return et(n,":")}},x:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"x":return Qn(n);case"xxxx":case"xx":return et(n);case"xxxxx":case"xxx":default:return et(n,":")}},O:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+Kn(n,":");case"OOOO":default:return"GMT"+et(n,":")}},z:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+Kn(n,":");case"zzzz":default:return"GMT"+et(n,":")}},t:function(r,e,t){const n=Math.trunc(+r/1e3);return Q(n,e.length)},T:function(r,e,t){return Q(+r,e.length)}};function Kn(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),i=Math.trunc(n/60),a=n%60;return a===0?t+String(i):t+String(i)+e+Q(a,2)}function Qn(r,e){return r%60===0?(r>0?"-":"+")+Q(Math.abs(r)/60,2):et(r,e)}function et(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),i=Q(Math.trunc(n/60),2),a=Q(n%60,2);return t+i+e+a}const Zn=(r,e)=>{switch(r){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},As=(r,e)=>{switch(r){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},pc=(r,e)=>{const t=r.match(/(P+)(p+)?/)||[],n=t[1],i=t[2];if(!i)return Zn(r,e);let a;switch(n){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",Zn(n,e)).replace("{{time}}",As(i,e))},mc={p:As,P:pc},gc=/^D+$/,xc=/^Y+$/,bc=["D","DD","YY","YYYY"];function yc(r){return gc.test(r)}function wc(r){return xc.test(r)}function vc(r,e,t){const n=Cc(r,e,t);if(console.warn(n),bc.includes(r))throw new RangeError(n)}function Cc(r,e,t){const n=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${e}\`) for formatting ${n} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Sc=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,kc=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,jc=/^'([^]*?)'?$/,Ec=/''/g,Tc=/[a-zA-Z]/;function Ht(r,e,t){var h,u,y,_,m,w,x,L;const n=fr(),i=(t==null?void 0:t.locale)??n.locale??lc,a=(t==null?void 0:t.firstWeekContainsDate)??((u=(h=t==null?void 0:t.locale)==null?void 0:h.options)==null?void 0:u.firstWeekContainsDate)??n.firstWeekContainsDate??((_=(y=n.locale)==null?void 0:y.options)==null?void 0:_.firstWeekContainsDate)??1,o=(t==null?void 0:t.weekStartsOn)??((w=(m=t==null?void 0:t.locale)==null?void 0:m.options)==null?void 0:w.weekStartsOn)??n.weekStartsOn??((L=(x=n.locale)==null?void 0:x.options)==null?void 0:L.weekStartsOn)??0,l=Ie(r,t==null?void 0:t.in);if(!Ro(l))throw new RangeError("Invalid time value");let c=e.match(kc).map(I=>{const j=I[0];if(j==="p"||j==="P"){const E=mc[j];return E(I,i.formatLong)}return I}).join("").match(Sc).map(I=>{if(I==="''")return{isToken:!1,value:"'"};const j=I[0];if(j==="'")return{isToken:!1,value:Ic(I)};if(Xn[j])return{isToken:!0,value:I};if(j.match(Tc))throw new RangeError("Format string contains an unescaped latin alphabet character `"+j+"`");return{isToken:!1,value:I}});i.localize.preprocessor&&(c=i.localize.preprocessor(l,c));const f={firstWeekContainsDate:a,weekStartsOn:o,locale:i};return c.map(I=>{if(!I.isToken)return I.value;const j=I.value;(!(t!=null&&t.useAdditionalWeekYearTokens)&&wc(j)||!(t!=null&&t.useAdditionalDayOfYearTokens)&&yc(j))&&vc(j,e,String(r));const E=Xn[j[0]];return E(l,j,i.localize,f)}).join("")}function Ic(r){const e=r.match(jc);return e?e[1].replace(Ec,"'"):r}function ze({icon:r,title:e,value:t,subtitle:n,color:i}){return we(),s.jsxs(Ue,{sx:{height:"100%",background:`linear-gradient(135deg, ${v(i,.1)} 0%, ${v(i,.05)} 100%)`,border:`1px solid ${v(i,.2)}`,position:"relative",overflow:"hidden",transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-4px)"},boxShadow:{xs:"none",md:`0 12px 32px ${v(i,.3)}`},border:{xs:`1px solid ${v(i,.2)}`,md:`1px solid ${v(i,.4)}`}}},children:[s.jsx(Ye,{sx:{p:{xs:2,md:3}},children:s.jsx(p,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:{xs:1,md:2}},children:s.jsxs(p,{children:[s.jsx(p,{sx:{width:{xs:32,md:48},height:{xs:32,md:48},borderRadius:2,background:`linear-gradient(135deg, ${i} 0%, ${v(i,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mb:{xs:1,md:2},boxShadow:`0 4px 16px ${v(i,.4)}`},children:Wt.cloneElement(r,{sx:{...r.props.sx,fontSize:{xs:18,md:24},color:"white"}})}),s.jsx(S,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5,fontSize:{xs:"0.6rem",md:"0.75rem"},lineHeight:1.2},children:e}),s.jsx(S,{variant:"h4",sx:{fontWeight:700,mt:.2,mb:.3,fontSize:{xs:"1.25rem",md:"2.125rem"},lineHeight:1},children:typeof t=="number"?t.toLocaleString():t}),n&&s.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",md:"0.75rem"},lineHeight:1.2,opacity:.8},children:n})]})})}),s.jsx(p,{sx:{display:{xs:"none",md:"block"},position:"absolute",right:-24,bottom:-24,width:96,height:96,borderRadius:"50%",background:`radial-gradient(circle, ${v(i,.1)} 0%, transparent 70%)`}})]})}const Rc=()=>{var fe,Qe;const r=we(),e=it(r.breakpoints.down("md")),[t,n]=d.useState([]),[i,a]=d.useState(!0),[o,l]=d.useState(null),[c,f]=d.useState(!1),[h,u]=d.useState(null),[y,_]=d.useState(null),[m,w]=d.useState(null),[x,L]=d.useState("all"),[I,j]=d.useState(null),[E,P]=d.useState(1),[B,$]=d.useState(0),b=10;d.useEffect(()=>{O(),D()},[x,E]);const k=async N=>{try{const X=await ye(ce(se,"users",N));if(X.exists()){const K=X.data();return{username:K.username||"Unknown Teacher",email:K.email||"No email available"}}}catch(X){console.warn("Could not fetch teacher details for ID:",N,X)}return{username:"Unknown Teacher",email:"No email available"}},O=async()=>{try{a(!0);const N=await _e.getMyCallCount(x);if(N.success){const K=N.count;$(Math.ceil(K/b))}const X=await _e.getMyCallHistory(b,E,x);if(X.success){const K=await Promise.all(X.calls.map(async F=>{if(F.teacherId){const W=await k(F.teacherId);return{...F,teacher:{username:W.username,email:W.email}}}return{...F,teacher:{username:"Unknown Teacher",email:"No email available"}}}));n(K),j(null)}else throw new Error(X.error||"Failed to fetch call logs")}catch(N){console.error("❌ Error fetching call logs:",N),j("Failed to load call logs. Please try again.")}finally{a(!1)}},R=(N,X)=>{P(X)},A=N=>{L(N.target.value),P(1)},D=async()=>{try{const N=await _e.getMyCallStats();N.success?w(N.stats):console.error("❌ Failed to fetch stats:",N.error)}catch(N){console.error("❌ Error fetching stats:",N)}},q=async N=>{try{const X=t.find(K=>K.id===N||K.callId===N);if(X)l(X),f(!0);else throw new Error("Call not found")}catch(X){console.error("❌ Error fetching call details:",X),j("Failed to load call details.")}},Y=(N,X)=>{u(N.currentTarget),_(X)},H=()=>{u(null),_(null)},le=()=>{H(),q(y)},de=N=>{switch(N){case"ended":return"success";case"rejected":return"error";case"failed":return"error";case"accepted":case"connected":return"primary";default:return"default"}},oe=N=>{switch(N){case"ended":return s.jsx(Fr,{});case"rejected":case"failed":return s.jsx(Ya,{});case"accepted":case"connected":return s.jsx(Jt,{});default:return s.jsx(Gt,{})}},z=N=>{if(!N)return"N/A";const X=Math.floor(N/60),K=N%60;return`${X}m ${K}s`},re=N=>{if(!N)return"N/A";const X=["B","KB","MB","GB"],K=Math.floor(Math.log(N)/Math.log(1024));return`${(N/Math.pow(1024,K)).toFixed(1)} ${X[K]}`};return i?s.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:s.jsx(cr,{})}):s.jsxs(p,{children:[s.jsxs(p,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs(p,{children:[s.jsxs(S,{variant:"h4",sx:{fontWeight:700,mb:1,display:"flex",alignItems:"center",gap:1},children:[s.jsx(Yr,{}),"Call History"]}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"View your past video calls and sessions"})]}),s.jsx(Ne,{title:"Refresh call logs",children:s.jsx(ee,{onClick:()=>{O(),D()},sx:{backgroundColor:v(r.palette.primary.main,.1),"&:hover":{backgroundColor:v(r.palette.primary.main,.2)}},children:s.jsx(Rs,{sx:{fontSize:20}})})})]}),I&&s.jsx(mt,{severity:"error",sx:{mb:3},onClose:()=>j(null),children:I}),m&&(e?s.jsx(p,{sx:{mb:3,mx:-2,px:2,overflow:"hidden"},children:s.jsxs(p,{sx:{display:"flex",gap:1.5,overflowX:"auto",pb:1,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",WebkitOverflowScrolling:"touch"},children:[s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(ze,{icon:s.jsx(Jt,{}),title:"Total Calls",value:m.totalCalls,color:r.palette.primary.main,subtitle:"All time"})}),s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(ze,{icon:s.jsx(Fr,{}),title:"Successful",value:m.successfulCalls,color:r.palette.success.main,subtitle:`${m.totalCalls>0?Math.round(m.successfulCalls/m.totalCalls*100):0}% rate`})}),s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(ze,{icon:s.jsx(Gt,{}),title:"Duration",value:z(m.totalDuration),color:r.palette.info.main,subtitle:`Avg: ${z(Math.round(m.averageDuration))}`})}),s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(ze,{icon:s.jsx(Pt,{}),title:"Recording",value:re(m.totalRecordingSize),color:r.palette.secondary.main,subtitle:"Storage used"})})]})}):s.jsxs(ne,{container:!0,spacing:3,sx:{mb:4},children:[s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(ze,{icon:s.jsx(Jt,{}),title:"Total Calls",value:m.totalCalls,color:r.palette.primary.main,subtitle:"All time"})}),s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(ze,{icon:s.jsx(Fr,{}),title:"Successful",value:m.successfulCalls,color:r.palette.success.main,subtitle:`${m.totalCalls>0?Math.round(m.successfulCalls/m.totalCalls*100):0}% success rate`})}),s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(ze,{icon:s.jsx(Gt,{}),title:"Duration",value:z(m.totalDuration),color:r.palette.info.main,subtitle:`Avg: ${z(Math.round(m.averageDuration))}`})}),s.jsx(ne,{item:!0,xs:12,sm:6,md:3,children:s.jsx(ze,{icon:s.jsx(Pt,{}),title:"Recording",value:re(m.totalRecordingSize),color:r.palette.secondary.main,subtitle:"Storage used"})})]})),s.jsx(p,{sx:{mb:3},children:s.jsxs(yi,{size:"small",sx:{minWidth:120},children:[s.jsx(wi,{children:"Status Filter"}),s.jsxs(vi,{value:x,label:"Status Filter",onChange:A,children:[s.jsx(ut,{value:"all",children:"All"}),s.jsx(ut,{value:"ended",children:"Completed"}),s.jsx(ut,{value:"rejected",children:"Rejected"}),s.jsx(ut,{value:"failed",children:"Failed"}),s.jsx(ut,{value:"accepted",children:"In Progress"})]})]})}),t.length===0?s.jsx(Ue,{sx:{mb:3},children:s.jsxs(Ye,{sx:{textAlign:"center",py:4},children:[s.jsx(Yr,{sx:{fontSize:48,color:"text.secondary",mb:2}}),s.jsx(S,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No calls found"}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"Your call history will appear here once you start making video calls."})]})}):s.jsx(Ue,{sx:{mb:3},children:s.jsx(ls,{sx:{p:0},children:t.map((N,X)=>{var K;return s.jsxs(Wt.Fragment,{children:[s.jsxs(Ci,{sx:{py:2,px:2,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:v(r.palette.primary.main,.04)}},children:[s.jsx(Si,{children:s.jsx(lr,{sx:{backgroundColor:v(r.palette.primary.main,.1),color:r.palette.primary.main,width:40,height:40},children:s.jsx(Pt,{sx:{fontSize:20}})})}),s.jsx(ds,{sx:{pr:5},primary:s.jsxs(p,{sx:{mb:.5},children:[s.jsx(S,{variant:"body1",fontWeight:600,sx:{fontSize:"0.95rem",mb:.5},children:((K=N.teacher)==null?void 0:K.username)||"Unknown Teacher"}),s.jsx(gt,{label:N.status,color:de(N.status),size:"small",icon:oe(N.status),sx:{height:20,fontSize:"0.65rem","& .MuiSvgIcon-root":{fontSize:11}}})]}),secondary:s.jsxs(p,{children:[s.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.5,pr:1},children:[s.jsx(S,{variant:"caption",color:"text.secondary",children:N.startTime?Ht(new Date(N.startTime),"MMM d, HH:mm"):"N/A"}),s.jsx(S,{variant:"caption",color:"text.secondary",fontWeight:500,children:z(N.duration)})]}),N.recording&&N.recording.enabled&&s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[s.jsx(p,{sx:{width:6,height:6,borderRadius:"50%",backgroundColor:r.palette.success.main}}),s.jsx(S,{variant:"caption",color:"success.main",fontWeight:500,children:"Recorded"})]})]})}),s.jsx(ki,{children:s.jsx(ee,{edge:"end",onClick:F=>Y(F,N.callId||N.id),size:"small",sx:{backgroundColor:"transparent","&:hover":{backgroundColor:v(r.palette.action.hover,.5)}},children:s.jsx(Xa,{sx:{fontSize:18}})})})]}),X<t.length-1&&s.jsx(He,{sx:{mx:2}})]},N.callId||N.id)})})}),B>1&&s.jsx(p,{sx:{display:"flex",justifyContent:"center",mt:3},children:s.jsx(ji,{count:B,page:E,onChange:R,color:"primary",size:"large",showFirstButton:!0,showLastButton:!0,sx:{"& .MuiPaginationItem-root":{fontSize:"1rem"}}})}),s.jsx(Ei,{anchorEl:h,open:!!h,onClose:H,children:s.jsxs(ut,{onClick:le,children:[s.jsx(co,{sx:{mr:1}}),"View Details"]})}),s.jsxs(dr,{open:c,onClose:()=>f(!1),maxWidth:"md",fullWidth:!0,children:[s.jsx(on,{sx:{bgcolor:"primary.main",color:"white"},children:"Call Details"}),s.jsx(ur,{children:o&&s.jsx(p,{sx:{mt:2},children:s.jsxs(ne,{container:!0,spacing:3,children:[s.jsx(ne,{item:!0,xs:12,md:6,children:s.jsxs(ge,{sx:{p:2,bgcolor:"grey.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"primary",children:"Call Information"}),s.jsx(He,{sx:{mb:2}}),s.jsxs(_t,{spacing:2,children:[s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call ID"}),s.jsx(S,{variant:"body1",sx:{fontFamily:"monospace",fontSize:"0.9rem"},children:o.callId||o.id})]}),s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Status"}),s.jsx(gt,{label:o.status,color:de(o.status),size:"small",icon:oe(o.status)})]}),s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Duration"}),s.jsx(S,{variant:"body1",children:z(o.duration)})]})]})]})}),s.jsx(ne,{item:!0,xs:12,md:6,children:s.jsxs(ge,{sx:{p:2,bgcolor:"grey.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"primary",children:"Teacher Information"}),s.jsx(He,{sx:{mb:2}}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[s.jsx(Pt,{sx:{fontSize:56,color:"primary.main"}}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",children:((fe=o.teacher)==null?void 0:fe.username)||"Unknown Teacher"}),s.jsx(S,{variant:"body2",color:"text.secondary",children:((Qe=o.teacher)==null?void 0:Qe.email)||"No email available"})]})]})]})}),s.jsx(ne,{item:!0,xs:12,children:s.jsxs(ge,{sx:{p:2,bgcolor:"grey.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"primary",children:"Timeline"}),s.jsx(He,{sx:{mb:2}}),s.jsxs(_t,{spacing:2,children:[s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call Started"}),s.jsx(S,{variant:"body1",children:o.startTime?Ht(new Date(o.startTime),"EEEE, MMMM d, yyyy 'at' HH:mm:ss"):"N/A"})]}),o.acceptedAt&&s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call Accepted"}),s.jsx(S,{variant:"body1",children:Ht(new Date(o.acceptedAt),"EEEE, MMMM d, yyyy 'at' HH:mm:ss")})]}),o.endTime&&s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call Ended"}),s.jsx(S,{variant:"body1",children:Ht(new Date(o.endTime),"EEEE, MMMM d, yyyy 'at' HH:mm:ss")})]})]})]})}),o.recording&&o.recording.enabled&&s.jsx(ne,{item:!0,xs:12,children:s.jsxs(ge,{sx:{p:2,bgcolor:"success.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"success.main",children:"Recording Information"}),s.jsx(He,{sx:{mb:2}}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"This call was recorded for quality and training purposes. The recording is securely stored and only accessible by authorized personnel."}),o.recording.chunks&&o.recording.chunks.length>0&&s.jsxs(S,{variant:"body2",sx:{mt:1},children:["Recording contains ",o.recording.chunks.length," segment(s)"]})]})}),o.notes&&s.jsx(ne,{item:!0,xs:12,children:s.jsxs(ge,{sx:{p:2,bgcolor:"info.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"info.main",children:"Teacher Notes"}),s.jsx(He,{sx:{mb:2}}),s.jsx(S,{variant:"body1",children:o.notes})]})})]})})}),s.jsx(cn,{children:s.jsx(Te,{onClick:()=>f(!1),variant:"contained",children:"Close"})})]})]})},Xt=280,Pc=[{path:"/dashboard",label:"Dashboard",icon:s.jsx($a,{}),description:"Overview and study progress"},{path:"/messages",label:"Messages",icon:s.jsx(Gr,{}),description:"Chat with teacher and admin"},{path:"/call-logs",label:"Call History",icon:s.jsx(Yr,{}),description:"View past video call sessions"},{path:"/settings",label:"Settings",icon:s.jsx(ro,{}),description:"App preferences and profile"}];function Fc({user:r,onLogout:e,apiClient:t,mobileOpen:n,handleDrawerToggle:i}){const a=we(),o=Ss(),l=yt(),[c,f]=d.useState({messages:0}),h=it(a.breakpoints.down("lg"));d.useEffect(()=>{u()},[]);const u=async()=>{try{if(!t)return;f({messages:0})}catch(x){console.error("Failed to load badge data:",x)}},y=Pc.map(x=>({...x,badge:x.path==="/messages"?c.messages:null})),_=()=>{e()},m=x=>{o(x),h&&i()},w=s.jsxs(s.Fragment,{children:[s.jsxs(p,{sx:{p:3,background:"rgba(255, 255, 255, 0.15)",borderBottom:"1px solid rgba(255, 255, 255, 0.25)",position:"relative",zIndex:2,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)"},children:[s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[s.jsx(p,{component:"img",src:"/logo only.png",alt:"Tarteel-e-Quran Logo",sx:{width:32,height:32,objectFit:"contain"}}),s.jsx(S,{variant:"h5",sx:{fontWeight:700,color:"text.primary"},children:"Student Portal"})]}),s.jsxs(S,{variant:"caption",sx:{color:"text.secondary",fontWeight:500},children:["Welcome, ",(r==null?void 0:r.username)||"Student","!"]})]}),s.jsx(p,{sx:{flex:1,p:2,overflow:"hidden",display:"flex",flexDirection:"column"},children:s.jsx(p,{sx:{flex:1,overflowY:"auto",overflowX:"hidden","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:`rgba(${a.palette.primary.main.replace("#","").match(/.{2}/g).map(x=>parseInt(x,16)).join(", ")}, 0.1)`,borderRadius:"10px"},"&::-webkit-scrollbar-thumb":{backgroundColor:a.palette.primary.main,borderRadius:"10px","&:hover":{backgroundColor:a.palette.primary.dark}}},children:s.jsx(ls,{sx:{gap:1},children:y.map(x=>{const L=l.pathname===x.path;return s.jsx(Ne,{title:x.description,placement:"right",arrow:!0,children:s.jsxs(Ti,{selected:L,onClick:()=>m(x.path),sx:{borderRadius:2,mb:1,minHeight:{xs:56,md:48},px:{xs:3,md:2},position:"relative",overflow:"hidden","&::before":L?{content:'""',position:"absolute",left:0,top:0,bottom:0,width:4,backgroundColor:a.palette.primary.main,borderRadius:"0 4px 4px 0"}:{},"&:hover":{backgroundColor:`rgba(${a.palette.primary.main.replace("#","").match(/.{2}/g).map(I=>parseInt(I,16)).join(", ")}, 0.08)`,transform:"translateX(4px)","& .MuiListItemIcon-root":{color:a.palette.primary.main}}},children:[s.jsx(Ii,{sx:{color:L?a.palette.primary.main:"text.secondary",minWidth:40,transition:"all 0.2s ease-in-out"},children:x.badge?s.jsx(an,{badgeContent:x.badge,color:"error",children:x.icon}):x.icon}),s.jsx(ds,{primary:x.label,primaryTypographyProps:{fontSize:"0.875rem",fontWeight:L?600:500,color:L?"primary.main":"text.primary"}})]})},x.path)})})})}),s.jsx(p,{sx:{p:2,background:"rgba(255, 255, 255, 0.1)",borderTop:"1px solid rgba(255, 255, 255, 0.2)",position:"relative",zIndex:2,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:s.jsxs(p,{onClick:_,sx:{display:"flex",alignItems:"center",p:2,borderRadius:2,cursor:"pointer",backgroundColor:"rgba(0, 0, 0, 0.04)",border:`1px solid ${a.palette.divider}`,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:a.palette.error.main,borderColor:a.palette.error.main,transform:"translateY(-2px)",boxShadow:`0 4px 12px ${a.palette.error.main}40`,"& .MuiSvgIcon-root":{color:"#FFFFFF"},"& .MuiTypography-root":{color:"#FFFFFF",fontWeight:600}}},children:[s.jsx(Ja,{sx:{fontSize:18,color:a.palette.text.secondary,mr:2,transition:"all 0.2s ease-in-out"}}),s.jsx(S,{variant:"body2",sx:{fontWeight:600,color:a.palette.text.primary,transition:"all 0.2s ease-in-out"},children:"Sign Out"})]})})]});return s.jsxs(p,{component:"nav",sx:{width:{lg:Xt},flexShrink:{lg:0}},children:[s.jsx(zr,{variant:"temporary",open:n,onClose:i,ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"transparent"}}},sx:{display:{xs:"block",lg:"none"},"& .MuiDrawer-paper":{width:Xt,boxSizing:"border-box",background:"rgba(255, 255, 255, 0.1)",borderRadius:0,border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.12),
              0 4px 16px rgba(0, 0, 0, 0.08),
              inset 0 1px 0 rgba(255, 255, 255, 0.3),
              inset 0 -1px 0 rgba(255, 255, 255, 0.1)
            `,backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"50%",background:"linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 50%, transparent 100%)",pointerEvents:"none",zIndex:1,borderRadius:0},overflow:"hidden",display:"flex",flexDirection:"column"}},children:w}),s.jsx(zr,{variant:"permanent",sx:{display:{xs:"none",lg:"block"},"& .MuiDrawer-paper":{width:Xt,boxSizing:"border-box",background:"rgba(255, 255, 255, 0.1)",marginTop:0,marginLeft:0,marginBottom:0,marginRight:0,height:"100vh",borderRadius:0,border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.12),
              0 4px 16px rgba(0, 0, 0, 0.08),
              inset 0 1px 0 rgba(255, 255, 255, 0.3),
              inset 0 -1px 0 rgba(255, 255, 255, 0.1)
            `,backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"50%",background:"linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 50%, transparent 100%)",pointerEvents:"none",zIndex:1,borderRadius:0},transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden",display:"flex",flexDirection:"column"}},open:!0,children:w})]})}function Mc({currentPath:r,handleDrawerToggle:e}){const t=we();yt();const n=it(t.breakpoints.down("lg"));return s.jsx(s.Fragment,{children:n&&s.jsx(ge,{elevation:2,sx:{height:100,display:"flex",alignItems:"center",justifyContent:"space-between",px:3,pt:"env(safe-area-inset-top)",background:t.palette.primary.main,backdropFilter:"blur(20px)",borderRadius:0,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",WebkitAppRegion:"drag",position:"fixed",top:0,left:{xs:0,md:0},right:0,zIndex:t.zIndex.appBar+1,"&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"1px",background:"linear-gradient(90deg, transparent 0%, rgba(51, 150, 211, 0.5) 50%, transparent 100%)"}},children:s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(ee,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:e,sx:{WebkitAppRegion:"no-drag"},children:s.jsx(Es,{})}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{component:"img",src:"/logo only.png",alt:"Tarteel-e-Quran Logo",sx:{width:40,height:40,objectFit:"contain"}}),s.jsx(S,{variant:"h6",sx:{color:"white",fontWeight:600,fontSize:"1.1rem"},children:"Tarteel-e-Quran"})]})]})})})}function _c({children:r,user:e,onLogout:t,socketManager:n,apiClient:i}){const a=we();yt();const[o,l]=d.useState(!1),c=()=>{l(!o)};return s.jsxs(p,{sx:{display:"flex",minHeight:"100vh",backgroundColor:a.palette.background.default,padding:0},children:[s.jsx(Fc,{user:e,onLogout:t,apiClient:i,mobileOpen:o,handleDrawerToggle:c}),s.jsxs(p,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",width:{xs:"100%",lg:`calc(100% - ${Xt}px)`},marginLeft:{xs:0,lg:0},position:"relative",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden"},children:[s.jsx(Mc,{handleDrawerToggle:c}),s.jsx(p,{sx:{flex:1,mt:{xs:"calc(100px + env(safe-area-inset-top))",lg:"0px"},p:{xs:2,sm:3},overflow:"auto",overflowX:"hidden",position:"relative",height:{xs:"calc(100vh - 100px - env(safe-area-inset-top))",lg:"100vh"},"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0, 0, 0, 0.2)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"rgba(0, 0, 0, 0.3)"}},children:r})]})]})}const Oc=d.createContext(),Ac=({children:r,apiClient:e})=>{const[t,n]=d.useState({}),[i,a]=d.useState({});d.useEffect(()=>{try{const b=localStorage.getItem("student-app-cache");if(b){const k=JSON.parse(b),O=Date.now(),R={};Object.keys(k).forEach(A=>{const D=k[A];D&&D.timestamp&&O-D.timestamp<6e5&&(R[A]=D)}),n(R)}}catch(b){console.error("Error loading cache from localStorage:",b)}},[]),d.useEffect(()=>{try{localStorage.setItem("student-app-cache",JSON.stringify(t))}catch(b){console.error("Error saving cache to localStorage:",b)}},[t]);const o=d.useCallback(b=>{const k=t[b];return k?Date.now()-k.timestamp>6e5?(n(R=>{const A={...R};return delete A[b],A}),null):k.data:null},[t]),l=d.useCallback((b,k)=>{n(O=>({...O,[b]:{data:k,timestamp:Date.now()}}))},[]),c=d.useCallback(b=>i[b]||!1,[i]),f=d.useCallback((b,k)=>{a(O=>({...O,[b]:k}))},[]),h=d.useCallback(async(b,k,O=!1)=>{if(!O){const R=o(b);if(R)return R}if(c(b))return null;try{f(b,!0);const R=await k();return l(b,R),R}catch(R){throw console.error(`Error fetching ${b}:`,R),R}finally{f(b,!1)}},[o,l,c,f]),u=d.useCallback(async(b=!1)=>{const k=(await nt(()=>Promise.resolve().then(()=>qn),void 0,import.meta.url)).default,{auth:O}=await nt(()=>Promise.resolve().then(()=>Fs),void 0,import.meta.url),R=O.currentUser;return R?h("myTeacher",()=>k.getMyTeacher(R.uid),b):{success:!1,teacher:null,error:"No authenticated user"}},[h]),y=d.useCallback(async(b=!1)=>h("mySchedule",()=>e.getMySchedule(),b),[h,e]),_=d.useCallback(async(b=!1)=>h("myMessages",()=>e.getMessages(),b),[h,e]),m=d.useCallback(async(b=!1)=>{const k=(await nt(()=>Promise.resolve().then(()=>qn),void 0,import.meta.url)).default;return h("users",()=>k.getAllUsers(),b)},[h]),w=d.useCallback(async(b=!1)=>h("myCalls",()=>e.getMyCalls(),b),[h,e]),x=d.useCallback(async(b=!1)=>h("studentStats",async()=>{const k=await fetch(`${e.baseURL}/users/my-stats`,{headers:e.getAuthHeaders()});return await e.handleResponse(k)},b),[h,e]),L=d.useCallback(async(b=10,k=!1)=>h(`recentActivity_${b}`,async()=>{const O=await fetch(`${e.baseURL}/activities/recent?limit=${b}`,{headers:e.getAuthHeaders()});return await e.handleResponse(O)},k),[h,e]),I=d.useCallback(async(b=!1)=>h("upcomingClasses",async()=>{const k=await fetch(`${e.baseURL}/calls/upcoming`,{headers:e.getAuthHeaders()});return await e.handleResponse(k)},b),[h,e]),j=d.useCallback(b=>{typeof b=="string"&&(b=[b]),n(k=>{const O={...k};return b.forEach(R=>{if(R.includes("*")){const A=R.replace("*","");Object.keys(O).forEach(D=>{D.startsWith(A)&&delete O[D]})}else delete O[R]}),O})},[]),E=d.useCallback(()=>{n({}),localStorage.removeItem("student-app-cache")},[]),P=d.useCallback(async()=>{j(["studentStats","myTeacher","upcomingClasses","recentActivity_10"]);try{await Promise.all([x(!0),u(!0),I(!0),L(10,!0)])}catch(k){console.error("Error refreshing dashboard:",k)}},[x,u,I,L,j]),B=d.useCallback(()=>{const b=Object.keys(t),k=Date.now();return{totalItems:b.length,validItems:b.filter(O=>k-t[O].timestamp<6e5).length,expiredItems:b.filter(O=>k-t[O].timestamp>=6e5).length,loadingItems:Object.keys(i).filter(O=>i[O]).length,cacheKeys:b}},[t,i]),$={getCachedData:o,setCachedData:l,fetchWithCache:h,isLoading:c,getMyTeacher:u,getMySchedule:y,getMyMessages:_,getMyCalls:w,getUsers:m,getStudentStats:x,getRecentActivity:L,getUpcomingClasses:I,invalidateCache:j,clearCache:E,refreshDashboard:P,getCacheStats:B,cache:t,loadingStates:i};return s.jsx(Oc.Provider,{value:$,children:r})},Ae=Object.create(null);Ae.open="0";Ae.close="1";Ae.ping="2";Ae.pong="3";Ae.message="4";Ae.upgrade="5";Ae.noop="6";const Kt=Object.create(null);Object.keys(Ae).forEach(r=>{Kt[Ae[r]]=r});const Xr={type:"error",data:"parser error"},Ls=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Ds=typeof ArrayBuffer=="function",Ws=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,mn=({type:r,data:e},t,n)=>Ls&&e instanceof Blob?t?n(e):es(e,n):Ds&&(e instanceof ArrayBuffer||Ws(e))?t?n(e):es(new Blob([e]),n):n(Ae[r]+(e||"")),es=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function ts(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Or;function Lc(r,e){if(Ls&&r.data instanceof Blob)return r.data.arrayBuffer().then(ts).then(e);if(Ds&&(r.data instanceof ArrayBuffer||Ws(r.data)))return e(ts(r.data));mn(r,!1,t=>{Or||(Or=new TextEncoder),e(Or.encode(t))})}const rs="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Mt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<rs.length;r++)Mt[rs.charCodeAt(r)]=r;const Dc=r=>{let e=r.length*.75,t=r.length,n,i=0,a,o,l,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const f=new ArrayBuffer(e),h=new Uint8Array(f);for(n=0;n<t;n+=4)a=Mt[r.charCodeAt(n)],o=Mt[r.charCodeAt(n+1)],l=Mt[r.charCodeAt(n+2)],c=Mt[r.charCodeAt(n+3)],h[i++]=a<<2|o>>4,h[i++]=(o&15)<<4|l>>2,h[i++]=(l&3)<<6|c&63;return f},Wc=typeof ArrayBuffer=="function",gn=(r,e)=>{if(typeof r!="string")return{type:"message",data:Ns(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Nc(r.substring(1),e)}:Kt[t]?r.length>1?{type:Kt[t],data:r.substring(1)}:{type:Kt[t]}:Xr},Nc=(r,e)=>{if(Wc){const t=Dc(r);return Ns(t,e)}else return{base64:!0,data:r}},Ns=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Us=String.fromCharCode(30),Uc=(r,e)=>{const t=r.length,n=new Array(t);let i=0;r.forEach((a,o)=>{mn(a,!1,l=>{n[o]=l,++i===t&&e(n.join(Us))})})},Bc=(r,e)=>{const t=r.split(Us),n=[];for(let i=0;i<t.length;i++){const a=gn(t[i],e);if(n.push(a),a.type==="error")break}return n};function zc(){return new TransformStream({transform(r,e){Lc(r,t=>{const n=t.length;let i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);const a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{i=new Uint8Array(9);const a=new DataView(i.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}r.data&&typeof r.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let Ar;function Vt(r){return r.reduce((e,t)=>e+t.length,0)}function qt(r,e){if(r[0].length===e)return r.shift();const t=new Uint8Array(e);let n=0;for(let i=0;i<e;i++)t[i]=r[0][n++],n===r[0].length&&(r.shift(),n=0);return r.length&&n<r[0].length&&(r[0]=r[0].slice(n)),t}function $c(r,e){Ar||(Ar=new TextDecoder);const t=[];let n=0,i=-1,a=!1;return new TransformStream({transform(o,l){for(t.push(o);;){if(n===0){if(Vt(t)<1)break;const c=qt(t,1);a=(c[0]&128)===128,i=c[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(Vt(t)<2)break;const c=qt(t,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),n=3}else if(n===2){if(Vt(t)<8)break;const c=qt(t,8),f=new DataView(c.buffer,c.byteOffset,c.length),h=f.getUint32(0);if(h>Math.pow(2,53-32)-1){l.enqueue(Xr);break}i=h*Math.pow(2,32)+f.getUint32(4),n=3}else{if(Vt(t)<i)break;const c=qt(t,i);l.enqueue(gn(a?c:Ar.decode(c),e)),n=0}if(i===0||i>r){l.enqueue(Xr);break}}}})}const Bs=4;function ie(r){if(r)return Hc(r)}function Hc(r){for(var e in ie.prototype)r[e]=ie.prototype[e];return r}ie.prototype.on=ie.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};ie.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};ie.prototype.off=ie.prototype.removeListener=ie.prototype.removeAllListeners=ie.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};ie.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};ie.prototype.emitReserved=ie.prototype.emit;ie.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};ie.prototype.hasListeners=function(r){return!!this.listeners(r).length};const pr=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),be=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),Vc="arraybuffer";function zs(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const qc=be.setTimeout,Yc=be.clearTimeout;function mr(r,e){e.useNativeTimers?(r.setTimeoutFn=qc.bind(be),r.clearTimeoutFn=Yc.bind(be)):(r.setTimeoutFn=be.setTimeout.bind(be),r.clearTimeoutFn=be.clearTimeout.bind(be))}const Gc=1.33;function Jc(r){return typeof r=="string"?Xc(r):Math.ceil((r.byteLength||r.size)*Gc)}function Xc(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function $s(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function Kc(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function Qc(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let a=t[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class Zc extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class xn extends ie{constructor(e){super(),this.writable=!1,mr(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new Zc(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=gn(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=Kc(e);return t.length?"?"+t:""}}class el extends xn{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Bc(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Uc(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=$s()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let Hs=!1;try{Hs=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const tl=Hs;function rl(){}class nl extends el{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let n=location.port;n||(n=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,a)=>{this.onError("xhr post error",i,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}let pt=class Qt extends ie{constructor(e,t,n){super(),this.createRequest=e,mr(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var e;const t=zs(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=Qt.requestsCount++,Qt.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=rl,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete Qt.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};pt.requestsCount=0;pt.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",ns);else if(typeof addEventListener=="function"){const r="onpagehide"in be?"pagehide":"unload";addEventListener(r,ns,!1)}}function ns(){for(let r in pt.requests)pt.requests.hasOwnProperty(r)&&pt.requests[r].abort()}const sl=function(){const r=Vs({xdomain:!1});return r&&r.responseType!==null}();class il extends nl{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=sl&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new pt(Vs,this.uri(),e)}}function Vs(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||tl))return new XMLHttpRequest}catch{}if(!e)try{return new be[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const qs=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class al extends xn{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=qs?{}:zs(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;mn(n,this.supportsBinary,a=>{try{this.doWrite(n,a)}catch{}i&&pr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=$s()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const Lr=be.WebSocket||be.MozWebSocket;class ol extends al{createSocket(e,t,n){return qs?new Lr(e,t,n):t?new Lr(e,t):new Lr(e)}doWrite(e,t){this.ws.send(t)}}class cl extends xn{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=$c(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=zc();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const a=()=>{n.read().then(({done:l,value:c})=>{l||(this.onPacket(c),a())}).catch(l=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this._writer.write(n).then(()=>{i&&pr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const ll={websocket:ol,webtransport:cl,polling:il},dl=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,ul=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function Kr(r){if(r.length>8e3)throw"URI too long";const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=dl.exec(r||""),a={},o=14;for(;o--;)a[ul[o]]=i[o]||"";return t!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=hl(a,a.path),a.queryKey=fl(a,a.query),a}function hl(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function fl(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,a){i&&(t[i]=a)}),t}const Qr=typeof addEventListener=="function"&&typeof removeEventListener=="function",Zt=[];Qr&&addEventListener("offline",()=>{Zt.forEach(r=>r())},!1);class Je extends ie{constructor(e,t){if(super(),this.binaryType=Vc,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const n=Kr(e);t.hostname=n.host,t.secure=n.protocol==="https"||n.protocol==="wss",t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=Kr(t.host).host);mr(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(n=>{const i=n.prototype.name;this.transports.push(i),this._transportsByName[i]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=Qc(this.opts.query)),Qr&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},Zt.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=Bs,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&Je.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",Je.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=Jc(i)),n>0&&t>this._maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,pr(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(Je.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),Qr&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=Zt.indexOf(this._offlineEventListener);n!==-1&&Zt.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}Je.protocol=Bs;class pl extends Je{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;Je.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!n)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;Je.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function a(){n||(n=!0,h(),t.close(),t=null)}const o=u=>{const y=new Error("probe error: "+u);y.transport=t.name,a(),this.emitReserved("upgradeError",y)};function l(){o("transport closed")}function c(){o("socket closed")}function f(u){t&&u.name!==t.name&&a()}const h=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",l),this.off("close",c),this.off("upgrading",f)};t.once("open",i),t.once("error",o),t.once("close",l),this.once("close",c),this.once("upgrading",f),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}let ml=class extends pl{constructor(e,t={}){const n=typeof e=="object"?e:t;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>ll[i]).filter(i=>!!i)),super(e,n)}};function gl(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=Kr(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(t&&t.port===n.port?"":":"+n.port),n}const xl=typeof ArrayBuffer=="function",bl=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Ys=Object.prototype.toString,yl=typeof Blob=="function"||typeof Blob<"u"&&Ys.call(Blob)==="[object BlobConstructor]",wl=typeof File=="function"||typeof File<"u"&&Ys.call(File)==="[object FileConstructor]";function bn(r){return xl&&(r instanceof ArrayBuffer||bl(r))||yl&&r instanceof Blob||wl&&r instanceof File}function er(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(er(r[t]))return!0;return!1}if(bn(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return er(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&er(r[t]))return!0;return!1}function vl(r){const e=[],t=r.data,n=r;return n.data=Zr(t,e),n.attachments=e.length,{packet:n,buffers:e}}function Zr(r,e){if(!r)return r;if(bn(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=Zr(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=Zr(r[n],e));return t}return r}function Cl(r,e){return r.data=en(r.data,e),delete r.attachments,r}function en(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=en(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=en(r[t],e));return r}const Sl=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],kl=5;var G;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(G||(G={}));class jl{constructor(e){this.replacer=e}encode(e){return(e.type===G.EVENT||e.type===G.ACK)&&er(e)?this.encodeAsBinary({type:e.type===G.EVENT?G.BINARY_EVENT:G.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===G.BINARY_EVENT||e.type===G.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=vl(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}function ss(r){return Object.prototype.toString.call(r)==="[object Object]"}class yn extends ie{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===G.BINARY_EVENT;n||t.type===G.BINARY_ACK?(t.type=n?G.EVENT:G.ACK,this.reconstructor=new El(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(bn(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(G[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===G.BINARY_EVENT||n.type===G.BINARY_ACK){const a=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(a,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const a=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(a,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const a=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(a,t+1))}if(e.charAt(++t)){const a=this.tryParse(e.substr(t));if(yn.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case G.CONNECT:return ss(t);case G.DISCONNECT:return t===void 0;case G.CONNECT_ERROR:return typeof t=="string"||ss(t);case G.EVENT:case G.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Sl.indexOf(t[0])===-1);case G.ACK:case G.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class El{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Cl(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Tl=Object.freeze(Object.defineProperty({__proto__:null,Decoder:yn,Encoder:jl,get PacketType(){return G},protocol:kl},Symbol.toStringTag,{value:"Module"}));function Ee(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Il=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Gs extends ie{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Ee(e,"open",this.onopen.bind(this)),Ee(e,"packet",this.onpacket.bind(this)),Ee(e,"error",this.onerror.bind(this)),Ee(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var n,i,a;if(Il.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:G.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const h=this.ids++,u=t.pop();this._registerAckCallback(h,u),o.id=h}const l=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!l||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let l=0;l<this.sendBuffer.length;l++)this.sendBuffer[l].id===e&&this.sendBuffer.splice(l,1);t.call(this,new Error("operation has timed out"))},i),o=(...l)=>{this.io.clearTimeoutFn(a),t.apply(this,l)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((n,i)=>{const a=(o,l)=>o?i(o):n(l);a.withError=!0,t.push(a),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...a)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:G.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case G.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case G.EVENT:case G.BINARY_EVENT:this.onevent(e);break;case G.ACK:case G.BINARY_ACK:this.onack(e);break;case G.DISCONNECT:this.ondisconnect();break;case G.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:G.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:G.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function wt(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}wt.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};wt.prototype.reset=function(){this.attempts=0};wt.prototype.setMin=function(r){this.ms=r};wt.prototype.setMax=function(r){this.max=r};wt.prototype.setJitter=function(r){this.jitter=r};class tn extends ie{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,mr(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new wt({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Tl;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new ml(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Ee(t,"open",function(){n.onopen(),e&&e()}),a=l=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",l),e?e(l):this.maybeReconnectOnOpen()},o=Ee(t,"error",a);if(this._timeout!==!1){const l=this._timeout,c=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),t.close()},l);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Ee(e,"ping",this.onping.bind(this)),Ee(e,"data",this.ondata.bind(this)),Ee(e,"error",this.onerror.bind(this)),Ee(e,"close",this.onclose.bind(this)),Ee(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){pr(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Gs(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const Rt={};function tr(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=gl(r,e.path||"/socket.io"),n=t.source,i=t.id,a=t.path,o=Rt[i]&&a in Rt[i].nsps,l=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return l?c=new tn(n,e):(Rt[i]||(Rt[i]=new tn(n,e)),c=Rt[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(tr,{Manager:tn,Socket:Gs,io:tr,connect:tr});/*! Capacitor: https://capacitorjs.com/ - MIT License */var bt;(function(r){r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE"})(bt||(bt={}));class Dr extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const Rl=r=>{var e,t;return r!=null&&r.androidBridge?"android":!((t=(e=r==null?void 0:r.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},Pl=r=>{const e=r.CapacitorCustomPlatform||null,t=r.Capacitor||{},n=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:Rl(r),a=()=>i()!=="web",o=u=>{const y=f.get(u);return!!(y!=null&&y.platforms.has(i())||l(u))},l=u=>{var y;return(y=t.PluginHeaders)===null||y===void 0?void 0:y.find(_=>_.name===u)},c=u=>r.console.error(u),f=new Map,h=(u,y={})=>{const _=f.get(u);if(_)return console.warn(`Capacitor plugin "${u}" already registered. Cannot register plugins twice.`),_.proxy;const m=i(),w=l(u);let x;const L=async()=>(!x&&m in y?x=typeof y[m]=="function"?x=await y[m]():x=y[m]:e!==null&&!x&&"web"in y&&(x=typeof y.web=="function"?x=await y.web():x=y.web),x),I=(b,k)=>{var O,R;if(w){const A=w==null?void 0:w.methods.find(D=>k===D.name);if(A)return A.rtype==="promise"?D=>t.nativePromise(u,k.toString(),D):(D,q)=>t.nativeCallback(u,k.toString(),D,q);if(b)return(O=b[k])===null||O===void 0?void 0:O.bind(b)}else{if(b)return(R=b[k])===null||R===void 0?void 0:R.bind(b);throw new Dr(`"${u}" plugin is not implemented on ${m}`,bt.Unimplemented)}},j=b=>{let k;const O=(...R)=>{const A=L().then(D=>{const q=I(D,b);if(q){const Y=q(...R);return k=Y==null?void 0:Y.remove,Y}else throw new Dr(`"${u}.${b}()" is not implemented on ${m}`,bt.Unimplemented)});return b==="addListener"&&(A.remove=async()=>k()),A};return O.toString=()=>`${b.toString()}() { [capacitor code] }`,Object.defineProperty(O,"name",{value:b,writable:!1,configurable:!1}),O},E=j("addListener"),P=j("removeListener"),B=(b,k)=>{const O=E({eventName:b},k),R=async()=>{const D=await O;P({eventName:b,callbackId:D},k)},A=new Promise(D=>O.then(()=>D({remove:R})));return A.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await R()},A},$=new Proxy({},{get(b,k){switch(k){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return w?B:E;case"removeListener":return P;default:return j(k)}}});return n[u]=$,f.set(u,{name:u,proxy:$,platforms:new Set([...Object.keys(y),...w?[m]:[]])}),$};return t.convertFileSrc||(t.convertFileSrc=u=>u),t.getPlatform=i,t.handleError=c,t.isNativePlatform=a,t.isPluginAvailable=o,t.registerPlugin=h,t.Exception=Dr,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},Fl=r=>r.Capacitor=Pl(r),Xe=Fl(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}),Js=Xe.registerPlugin;class Xs{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(t);const a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),n&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,t);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,n){const i=this.listeners[e];if(!i){if(n){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}return}i.forEach(a=>a(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:n=>{this.notifyListeners(t,n)}}}unimplemented(e="not implemented"){return new Xe.Exception(e,bt.Unimplemented)}unavailable(e="not available"){return new Xe.Exception(e,bt.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const i=n.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(n=>{this.notifyListeners(e,n)}))}}const is=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),as=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class Ml extends Xs{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(n=>{if(n.length<=0)return;let[i,a]=n.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=as(i).trim(),a=as(a).trim(),t[i]=a}),t}async setCookie(e){try{const t=is(e.key),n=is(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${i}; path=${a}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}Js("CapacitorCookies",{web:()=>new Ml});const _l=async r=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{const i=n.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},n.onerror=i=>t(i),n.readAsDataURL(r)}),Ol=(r={})=>{const e=Object.keys(r);return Object.keys(r).map(i=>i.toLocaleLowerCase()).reduce((i,a,o)=>(i[a]=r[e[o]],i),{})},Al=(r,e=!0)=>r?Object.entries(r).reduce((n,i)=>{const[a,o]=i;let l,c;return Array.isArray(o)?(c="",o.forEach(f=>{l=e?encodeURIComponent(f):f,c+=`${a}=${l}&`}),c.slice(0,-1)):(l=e?encodeURIComponent(o):o,c=`${a}=${l}`),`${n}&${c}`},"").substr(1):null,Ll=(r,e={})=>{const t=Object.assign({method:r.method||"GET",headers:r.headers},e),i=Ol(r.headers)["content-type"]||"";if(typeof r.data=="string")t.body=r.data;else if(i.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[o,l]of Object.entries(r.data||{}))a.set(o,l);t.body=a.toString()}else if(i.includes("multipart/form-data")||r.data instanceof FormData){const a=new FormData;if(r.data instanceof FormData)r.data.forEach((l,c)=>{a.append(c,l)});else for(const l of Object.keys(r.data))a.append(l,r.data[l]);t.body=a;const o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(i.includes("application/json")||typeof r.data=="object")&&(t.body=JSON.stringify(r.data));return t};class Dl extends Xs{async request(e){const t=Ll(e,e.webFetchExtra),n=Al(e.params,e.shouldEncodeUrlParams),i=n?`${e.url}?${n}`:e.url,a=await fetch(i,t),o=a.headers.get("content-type")||"";let{responseType:l="text"}=a.ok?e:{};o.includes("application/json")&&(l="json");let c,f;switch(l){case"arraybuffer":case"blob":f=await a.blob(),c=await _l(f);break;case"json":c=await a.json();break;case"document":case"text":default:c=await a.text()}const h={};return a.headers.forEach((u,y)=>{h[y]=u}),{data:c,headers:h,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}Js("CapacitorHttp",{web:()=>new Dl});const st={apiBaseUrl:"http://192.95.33.150:5003/api",socketUrl:"http://192.95.33.150:5003",appEnv:"production"},rn=()=>({apiBaseUrl:st.apiBaseUrl,socketUrl:st.socketUrl,appEnv:st.appEnv});let Ks=st.apiBaseUrl,nn=st.socketUrl;const Wl=({apiBaseUrl:r,socketUrl:e,appEnv:t}={})=>{Ks=r||st.apiBaseUrl,nn=e||st.socketUrl},Nl=({socketManager:r,isVisible:e,onClose:t,callId:n,isTeacher:i=!1})=>{const a=d.useRef(null),[o,l]=d.useState(!1),[c,f]=d.useState("pen"),[h,u]=d.useState("#000000"),[y,_]=d.useState(3),[m,w]=d.useState(null),[x,L]=d.useState(null),[I,j]=d.useState([]),[E,P]=d.useState(-1),[B,$]=d.useState(""),[b,k]=d.useState(null),[O,R]=d.useState(!1),A=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#000080","#008000"],D=[{id:"pen",icon:s.jsx(Ba,{}),label:"Pen (Precise)"},{id:"brush",icon:s.jsx(Da,{}),label:"Brush (Thick)"},{id:"eraser",icon:s.jsx(La,{}),label:"Eraser"},{id:"line",icon:s.jsx(io,{}),label:"Line"},{id:"rectangle",icon:s.jsx(za,{}),label:"Rectangle"},{id:"circle",icon:s.jsx(hn,{}),label:"Circle"},{id:"text",icon:s.jsx(so,{}),label:"Text"}];d.useEffect(()=>{const g=a.current;if(!g)return;const M=g.getContext("2d");g.width=g.offsetWidth,g.height=g.offsetHeight,M.fillStyle="white",M.fillRect(0,0,g.width,g.height),q()},[e]),d.useEffect(()=>{if(!(r!=null&&r.socket))return;const g=C=>{C.callId===n&&oe(C)},M=C=>{C.callId===n&&N(!1)};return r.socket.on("whiteboard-draw",g),r.socket.on("whiteboard-clear",M),()=>{r.socket.off("whiteboard-draw",g),r.socket.off("whiteboard-clear",M)}},[r,n]);const q=()=>{const g=a.current;if(!g)return;const M=g.toDataURL(),C=I.slice(0,E+1);C.push(M),j(C),P(C.length-1)},Y=()=>{if(E>0){const g=E-1;P(g),le(I[g])}},H=()=>{if(E<I.length-1){const g=E+1;P(g),le(I[g])}},le=g=>{const M=a.current,C=M.getContext("2d"),Z=new Image;Z.onload=()=>{C.clearRect(0,0,M.width,M.height),C.drawImage(Z,0,0)},Z.src=g},de=g=>{const C=a.current.getBoundingClientRect();return{x:g.clientX-C.left,y:g.clientY-C.top}},oe=g=>{const C=a.current.getContext("2d");switch(C.strokeStyle=g.color,C.lineWidth=g.lineWidth,C.lineCap="round",C.lineJoin="round",g.tool){case"pen":C.globalCompositeOperation="source-over",g.type==="start"?(C.beginPath(),C.moveTo(g.x,g.y)):g.type==="draw"&&(C.lineTo(g.x,g.y),C.stroke());break;case"brush":C.globalCompositeOperation="source-over",C.lineCap="round",C.lineJoin="round",g.type==="start"?(C.beginPath(),C.moveTo(g.x,g.y)):g.type==="draw"&&(C.lineTo(g.x,g.y),C.stroke());break;case"eraser":C.globalCompositeOperation="destination-out",C.lineCap="round",C.lineJoin="round",g.type==="start"?(C.beginPath(),C.moveTo(g.x,g.y)):g.type==="draw"&&(C.lineTo(g.x,g.y),C.stroke());break;case"line":g.type==="complete"&&(C.beginPath(),C.moveTo(g.startX,g.startY),C.lineTo(g.endX,g.endY),C.stroke());break;case"rectangle":g.type==="complete"&&(C.beginPath(),C.rect(g.x,g.y,g.width,g.height),C.stroke());break;case"circle":C.globalCompositeOperation="source-over",g.type==="complete"&&(C.beginPath(),C.arc(g.x,g.y,g.radius,0,2*Math.PI),C.stroke());break;case"text":C.globalCompositeOperation="source-over",g.type==="complete"&&(C.font=`${g.fontSize||16}px Arial`,C.fillStyle=g.color,C.fillText(g.text,g.x,g.y));break}},z=g=>{var C,Z;if(!(r!=null&&r.socket)){console.error("🎨 Student Whiteboard: Cannot broadcast - no socket available");return}if(!r.socket.connected){console.error("🎨 Student Whiteboard: Cannot broadcast - socket not connected");return}const M={...g,callId:n,senderId:((C=r.socket.userData)==null?void 0:C.userId)||"student",senderName:((Z=r.socket.userData)==null?void 0:Z.username)||"Student"};r.socket.emit("whiteboard-draw",M)},re=g=>{const M=de(g);if(l(!0),w(M),c==="text")k(M),R(!0);else if(c==="pen"||c==="brush"||c==="eraser"){const C={type:"start",tool:c,x:M.x,y:M.y,color:c==="eraser"?"#FFFFFF":h,lineWidth:c==="brush"?y*3:c==="eraser"?y*2:y};oe(C),z(C)}},fe=g=>{if(!o)return;const M=de(g);if(c==="pen"||c==="brush"||c==="eraser"){const C={type:"draw",tool:c,x:M.x,y:M.y,color:c==="eraser"?"#FFFFFF":h,lineWidth:c==="brush"?y*3:c==="eraser"?y*2:y};oe(C),z(C)}},Qe=g=>{if(!o)return;const M=de(g);if(l(!1),c==="line"){const C={type:"complete",tool:"line",startX:m.x,startY:m.y,endX:M.x,endY:M.y,color:h,lineWidth:y};oe(C),z(C)}else if(c==="rectangle"){const C={type:"complete",tool:"rectangle",x:Math.min(m.x,M.x),y:Math.min(m.y,M.y),width:Math.abs(M.x-m.x),height:Math.abs(M.y-m.y),color:h,lineWidth:y};oe(C),z(C)}else if(c==="circle"){const C=Math.sqrt(Math.pow(M.x-m.x,2)+Math.pow(M.y-m.y,2)),Z={type:"complete",tool:"circle",x:m.x,y:m.y,radius:C,color:h,lineWidth:y};oe(Z),z(Z)}q(),w(null)},N=(g=!0)=>{var Z,Re;const M=a.current,C=M.getContext("2d");if(C.fillStyle="white",C.fillRect(0,0,M.width,M.height),g&&(r!=null&&r.socket)){const Pe={callId:n,senderId:((Z=r.socket.userData)==null?void 0:Z.userId)||"student",senderName:((Re=r.socket.userData)==null?void 0:Re.username)||"Student"};r.socket.emit("whiteboard-clear",Pe)}q()},X=()=>{if(B.trim()&&b){const g={type:"complete",tool:"text",x:b.x,y:b.y,text:B.trim(),color:h,fontSize:y+12};oe(g),z(g),q()}$(""),k(null),R(!1)},K=()=>{$(""),k(null),R(!1)},F=g=>{L(g.currentTarget)},W=()=>{L(null)};return e?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1e4,display:"flex",flexDirection:"column"},children:[s.jsxs(ge,{elevation:3,sx:{m:2,p:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[s.jsx(In,{size:"small",children:D.map(g=>s.jsx(Ne,{title:g.label,children:s.jsx(ee,{onClick:()=>f(g.id),sx:{backgroundColor:c===g.id?"primary.main":"transparent",color:c===g.id?"white":"inherit"},children:g.icon})},g.id))}),s.jsx(Ne,{title:"Colors",children:s.jsx(ee,{onClick:F,sx:{backgroundColor:h,border:"2px solid #ccc",width:40,height:40},children:s.jsx(Ua,{sx:{color:h==="#FFFFFF"?"#000":"#fff"}})})}),s.jsx(us,{open:!!x,anchorEl:x,onClose:W,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx(p,{sx:{p:1},children:s.jsx(ne,{container:!0,spacing:1,sx:{width:180},children:A.map(g=>s.jsx(ne,{item:!0,xs:3,children:s.jsx(p,{onClick:()=>{u(g),W()},sx:{width:30,height:30,backgroundColor:g,border:g===h?"3px solid #2196f3":"1px solid #ccc",cursor:"pointer",borderRadius:1}})},g))})})}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:120},children:[s.jsx(S,{variant:"caption",children:"Size:"}),s.jsx(Ri,{value:y,onChange:(g,M)=>_(M),min:1,max:20,size:"small",sx:{width:80}})]}),s.jsxs(In,{size:"small",children:[s.jsx(Ne,{title:"Undo",children:s.jsx("span",{children:s.jsx(ee,{onClick:Y,disabled:E<=0,children:s.jsx(oo,{})})})}),s.jsx(Ne,{title:"Redo",children:s.jsx("span",{children:s.jsx(ee,{onClick:H,disabled:E>=I.length-1,children:s.jsx(Za,{})})})}),s.jsx(Ne,{title:"Clear All",children:s.jsx(ee,{onClick:()=>N(!0),children:s.jsx(Na,{})})})]}),s.jsx(Ne,{title:"Close Whiteboard",children:s.jsx(ee,{onClick:t,sx:{ml:"auto"},children:s.jsx(ir,{})})})]}),s.jsx(p,{sx:{flex:1,m:2,mt:0,position:"relative"},children:s.jsx("canvas",{ref:a,onMouseDown:re,onMouseMove:fe,onMouseUp:Qe,onMouseLeave:()=>l(!1),style:{width:"100%",height:"100%",border:"2px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:c==="pen"||c==="brush"||c==="eraser"?"crosshair":c==="text"?"text":"crosshair"}})}),s.jsxs(dr,{open:O,onClose:K,maxWidth:"sm",fullWidth:!0,children:[s.jsx(on,{children:"Add Text"}),s.jsx(ur,{children:s.jsx(Fe,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:3,value:B,onChange:g=>$(g.target.value),placeholder:"Enter text to add to whiteboard...",variant:"outlined",onKeyDown:g=>{g.key==="Enter"&&!g.shiftKey&&(g.preventDefault(),X())}})}),s.jsxs(cn,{children:[s.jsx(Te,{onClick:K,children:"Cancel"}),s.jsx(Te,{onClick:X,variant:"contained",disabled:!B.trim(),children:"Add Text"})]})]})]}):null};function Ul({isOpen:r=!1,callData:e,callStatus:t="connecting",onEndCall:n,webrtcService:i,socketManager:a,currentUser:o,sttLanguage:l="en-US"}){var En,Tn;const c=d.useRef(null),f=d.useRef(null),[h,u]=d.useState(!0),[y,_]=d.useState(!0),[m,w]=d.useState(null),[x,L]=d.useState(null),[I,j]=d.useState(.7),[E,P]=d.useState(!1),[B,$]=d.useState(!1),[b,k]=d.useState(new Map),[O,R]=d.useState(!1),[A,D]=d.useState(!1),[q,Y]=d.useState([]),[H,le]=d.useState(""),[de,oe]=d.useState(null),[z,re]=d.useState(0),fe=d.useRef(null),[Qe,N]=d.useState(""),[X,K]=d.useState(""),[F,W]=d.useState(!1),[g,M]=d.useState(!1),[C,Z]=d.useState(!0);d.useState([]);const[Re,Pe]=d.useState("connecting"),[wn,Bt]=d.useState(0),[ed,vn]=d.useState(0),[ct,ni]=d.useState(l||"en-US");d.useEffect(()=>{l&&l!==ct&&ni(l)},[l,ct]);const zt=d.useRef(null),$t=d.useRef(null);d.useRef(null),d.useEffect(()=>{if(!i)return;i.getStatus().hasLocalStream&&w(i.localStream);const J=V=>{L(V.detail.stream)};return i.addEventListener("remote-stream",J),()=>{i.removeEventListener("remote-stream",J)}},[i]),d.useEffect(()=>{C&&setTimeout(()=>{Pe("connected")},1e3)},[]),d.useEffect(()=>(t==="connected"&&(m||x)&&(W(!1),Z(!0),M(!0),Cn()),()=>{gr()}),[t,m,x,e]);const Cn=()=>{Pe("connecting"),M(!0),m&&si(),x&&ii(),setTimeout(()=>{Pe("connected")},500)},gr=()=>{if(Pe("disconnected"),M(!1),Bt(0),vn(0),zt.current){try{const{audioContext:T,processor:J,source:V}=zt.current;V&&J&&(V.disconnect(),J.disconnect()),T&&T.state!=="closed"&&T.close()}catch(T){console.error("❌ Error cleaning up mic AudioContext:",T)}zt.current=null}if($t.current){try{const{audioContext:T,processor:J,source:V}=$t.current;V&&J&&(V.disconnect(),J.disconnect()),T&&T.state!=="closed"&&T.close()}catch(T){console.error("❌ Error cleaning up speaker AudioContext:",T)}$t.current=null}},si=()=>{try{if(!m){console.error("❌ No local stream available for mic transcription");return}const T=new(window.AudioContext||window.webkitAudioContext),J=T.createMediaStreamSource(m),V=T.createScriptProcessor(4096,1,1);zt.current={audioContext:T,processor:V,source:J};let te=[],he=Date.now(),ue=null,Le=!1,vt=!1;const xr=.01,br=.005,yr=1e3,wr=8e3,Ct=Number.POSITIVE_INFINITY;V.onaudioprocess=async vr=>{var St,kt;const ve=vr.inputBuffer.getChannelData(0),Ze=Math.sqrt(ve.reduce((De,Se)=>De+Se*Se,0)/ve.length);Bt(Math.min(100,Ze*1e3));const Ce=Date.now(),Cr=Ze>xr,Sr=Ze<br;if(Cr&&!Le&&(Le=!0,vt=!0,ue=null,he=Ce,te=[]),Le){const De=new Int16Array(ve.length);for(let ke=0;ke<ve.length;ke++)De[ke]=Math.max(-32768,Math.min(32767,ve[ke]*32768));te.push(...De),Sr?ue||(ue=Ce):ue=null;const Se=Ce-he,jt=ue?Ce-ue:0;if((jt>=Ct&&Se>=yr||Se>=wr)&&te.length>0){const ke=jt>=Ct?"silence detected":"max duration reached",kr=new Int16Array(te),jr=Buffer.from(kr.buffer).toString("base64");te=[],he=Ce,Le=!1,vt=!1,ue=null;try{if(!((St=window.electronAPI)!=null&&St.stt)){console.error("❌ electronAPI.stt not available");return}const je=await window.electronAPI.stt.transcribeAudio(jr,{participantType:"teacher",languageCode:ct,encoding:"LINEAR16",sampleRateHertz:T.sampleRate});if(je.success&&((kt=je.transcript)!=null&&kt.trim())){const Er=je.transcript.trim();N(Er)}}catch(je){console.error("❌ STT processing error:",je)}}}},J.connect(V),V.connect(T.destination)}catch(T){console.error("❌ Mic transcription error:",T)}},ii=()=>{try{const T=new(window.AudioContext||window.webkitAudioContext),J=T.createMediaStreamSource(x),V=T.createScriptProcessor(4096,1,1);$t.current={audioContext:T,processor:V,source:J};let te=[],he=Date.now(),ue=null,Le=!1,vt=!1;const xr=.01,br=.005,yr=1e3,wr=8e3,Ct=Number.POSITIVE_INFINITY;V.onaudioprocess=async vr=>{var St,kt;const ve=vr.inputBuffer.getChannelData(0),Ze=Math.sqrt(ve.reduce((De,Se)=>De+Se*Se,0)/ve.length);vn(Math.min(100,Ze*1e3));const Ce=Date.now(),Cr=Ze>xr,Sr=Ze<br;if(Cr&&!Le&&(Le=!0,vt=!0,ue=null,he=Ce,te=[]),Le){const De=new Int16Array(ve.length);for(let ke=0;ke<ve.length;ke++)De[ke]=Math.max(-32768,Math.min(32767,ve[ke]*32768));te.push(...De),Sr?ue||(ue=Ce):ue=null;const Se=Ce-he,jt=ue?Ce-ue:0;if((jt>=Ct&&Se>=yr||Se>=wr)&&te.length>0){const ke=jt>=Ct?"silence detected":"max duration reached",kr=new Int16Array(te),jr=Buffer.from(kr.buffer).toString("base64");te=[],he=Ce,Le=!1,vt=!1,ue=null;try{if(!((St=window.electronAPI)!=null&&St.stt)){console.error("❌ electronAPI.stt not available for speaker");return}const je=await window.electronAPI.stt.transcribeAudio(jr,{participantType:"student",languageCode:ct,encoding:"LINEAR16",sampleRateHertz:T.sampleRate});if(je.success&&((kt=je.transcript)!=null&&kt.trim())){const Er=je.transcript.trim();K(Er)}}catch(je){console.error("❌ STT processing error:",je)}}}},J.connect(V),V.connect(T.destination)}catch(T){console.error("❌ Speaker transcription error:",T)}};d.useEffect(()=>()=>{g&&gr()},[g]),d.useEffect(()=>{c.current&&m&&(c.current.srcObject=m,c.current.addEventListener("loadedmetadata",async()=>{try{await c.current.play()}catch(T){console.warn("🎥 Student: Local video autoplay failed:",T)}}))},[m]),d.useEffect(()=>{f.current&&x?(f.current.srcObject=x,f.current.volume=I,f.current.addEventListener("loadedmetadata",async()=>{try{await f.current.play()}catch(T){console.warn("📢 Student: Remote video autoplay failed:",T)}})):(f.current||console.warn("🎥 Student: Remote video ref not available"),x||console.warn("🎥 Student: Remote stream not available"))},[x,I]);const ai=()=>{if(i){const T=i.toggleAudio();u(T)}},oi=async()=>{if(i)try{const T=await i.toggleVideo();_(T),c.current&&i.localStream&&(c.current.srcObject=i.localStream)}catch(T){console.error("❌ Student: Failed to toggle video:",T)}};d.useEffect(()=>{if(!i)return;const T=()=>P(!0),J=()=>P(!1);return i.addEventListener("screen-share-started",T),i.addEventListener("screen-share-stopped",J),()=>{i.removeEventListener("screen-share-started",T),i.removeEventListener("screen-share-stopped",J)}},[i]),d.useEffect(()=>{if(!(a!=null&&a.socket))return;const T=V=>{V.callId===(e==null?void 0:e.callId)&&k(te=>{const he=new Map(te);return V.isRaised?(he.set(V.studentId,{name:V.studentName,timestamp:V.timestamp||Date.now()}),R(!0),"Notification"in window&&Notification.permission==="granted"&&new Notification("Student Hand Raised",{body:`${V.studentName} wants to speak`,icon:"✋"})):(he.delete(V.studentId),he.size===0&&R(!1)),he})},J=V=>{var te;V.senderId!==((te=a.socket.userData)==null?void 0:te.userId)&&(Y(he=>{const ue={id:Date.now()+Math.random(),message:V.message,sender:V.senderName||"Student",senderId:V.senderId,timestamp:new Date,isOwnMessage:!1};return[...he,ue]}),A||re(he=>he+1))};return a.socket.on("student-raise-hand",T),a.socket.on("call-chat-message",J),()=>{a.socket.off("student-raise-hand",T),a.socket.off("call-chat-message",J)}},[a]);const ci=T=>{k(J=>{const V=new Map(J);return V.delete(T),V}),a!=null&&a.socket&&a.socket.emit("hand-acknowledged",{callId:(e==null?void 0:e.callId)||"unknown",studentId:T}),b.size<=1&&R(!1)},Sn=()=>{R(!1)},kn=()=>{D(!A),A||re(0)},jn=()=>{var J,V;if(!H.trim())return;if(!a){console.error("❌ Teacher: socketManager is null/undefined"),alert("Unable to send message: Socket manager not initialized. Please refresh the page.");return}if(!a.socket){console.error("❌ Teacher: socketManager.socket is null/undefined"),alert("Unable to send message: Socket not connected. Please check your connection.");return}if(!a.socket.connected){console.error("❌ Teacher: Socket not connected"),alert("Unable to send message: Not connected to server. Please try again.");return}const T={callId:(e==null?void 0:e.callId)||"unknown",message:H.trim(),senderId:((J=a.socket.userData)==null?void 0:J.userId)||"teacher",senderName:((V=a.socket.userData)==null?void 0:V.username)||"Teacher",timestamp:new Date().toISOString()};try{Y(te=>[...te,{id:Date.now()+Math.random(),message:T.message,sender:"You",senderId:T.senderId,timestamp:new Date,isOwnMessage:!0}]),a.socket.emit("call-chat-message",T,te=>{te&&te.error&&(console.error("❌ Teacher: Message send failed:",te.error),alert("Failed to send message. Please try again."))}),le("")}catch(te){console.error("❌ Teacher: Error sending message:",te)}},li=T=>{T.key==="Enter"&&!T.shiftKey&&(T.preventDefault(),jn())},di=T=>{oe(T.currentTarget)},ui=()=>{oe(null)},hi=T=>{le(J=>J+T),oe(null)},fi=["😀","😂","🥰","😍","🤔","👍","👎","❤️","🎉","🎊","😊","😎","🙄","😢","😭","😡","🤗","🤷","🙏","👏","🔥","⭐","✅","❌","💯","🎯","📝","💡","🚀","🎈"];return d.useEffect(()=>{fe.current&&(fe.current.scrollTop=fe.current.scrollHeight)},[q]),d.useEffect(()=>{g&&ct&&(gr(),setTimeout(()=>{Cn()},500))},[ct]),r?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"#000",zIndex:9999,display:"flex",flexDirection:"column"},children:[s.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",position:"relative"},children:[s.jsx(p,{sx:{position:"absolute",top:"max(20px, env(safe-area-inset-top))",left:"max(20px, env(safe-area-inset-left))",zIndex:1e4},children:s.jsxs(p,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s.jsx(gt,{label:`Status: ${t}`,color:t==="connected"?"success":"warning",size:"small"}),!1,b.size>0&&s.jsx(gt,{label:`✋ ${b.size} hand${b.size>1?"s":""} raised`,color:"warning",size:"small",sx:{backgroundColor:"#ff9800",color:"white"}})]})}),s.jsxs(p,{sx:{flex:1,position:"relative",display:"flex",justifyContent:"center",alignItems:"center"},children:[s.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,controls:!1,style:{width:"100%",height:"100%",objectFit:"cover",backgroundColor:"#222"}}),!x&&s.jsxs(p,{sx:{position:"absolute",color:"white",textAlign:"center"},children:[s.jsx(S,{variant:"h6",children:t==="connecting"?"Calling student...":"Waiting for video"}),s.jsx(S,{variant:"body2",color:"grey.400",children:t==="connecting"?"Waiting for student to answer":"Establishing connection"})]}),s.jsxs(p,{sx:{position:"absolute",top:"max(20px, env(safe-area-inset-top))",right:"max(20px, env(safe-area-inset-right))",width:{xs:100,sm:120},height:{xs:140,sm:160},"@media (max-height: 500px) and (orientation: landscape)":{width:80,height:100,top:"10px",right:"10px"},borderRadius:3,overflow:"hidden",border:"none",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)"},children:[s.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),!y&&s.jsx(p,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"#333",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(Jr,{sx:{color:"white",fontSize:40}})})]})]}),s.jsxs(p,{sx:{position:"absolute",left:"max(12px, env(safe-area-inset-left))",top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:{xs:1,sm:1.5},zIndex:1e4,padding:{xs:"6px",sm:"8px"},backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",borderRadius:"20px",border:"1px solid rgba(118, 166, 246, 0.2)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)","@media (max-height: 500px) and (orientation: landscape)":{padding:"4px",gap:.5,left:"max(8px, env(safe-area-inset-left))"}},children:[s.jsx(ee,{onClick:ai,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:h?"rgba(118, 166, 246, 0.15)":"rgba(244, 67, 54, 0.9)",backdropFilter:"blur(10px)",color:h?"#76a6f6":"white",border:`2px solid ${h?"#76a6f6":"#f44336"}`,boxShadow:`0 4px 20px ${h?"rgba(118, 166, 246, 0.25)":"rgba(244, 67, 54, 0.3)"}`,transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:h?"#76a6f6":"#d32f2f",color:"white",boxShadow:`0 6px 24px ${h?"rgba(118, 166, 246, 0.4)":"rgba(244, 67, 54, 0.4)"}`}},children:h?s.jsx(Ts,{sx:{fontSize:{xs:20,sm:24}}}):s.jsx(Is,{sx:{fontSize:{xs:20,sm:24}}})}),s.jsx(ee,{onClick:oi,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:y?"rgba(118, 166, 246, 0.15)":"rgba(244, 67, 54, 0.9)",backdropFilter:"blur(10px)",color:y?"#76a6f6":"white",border:`2px solid ${y?"#76a6f6":"#f44336"}`,boxShadow:`0 4px 20px ${y?"rgba(118, 166, 246, 0.25)":"rgba(244, 67, 54, 0.3)"}`,transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:y?"#76a6f6":"#d32f2f",color:"white",boxShadow:`0 6px 24px ${y?"rgba(118, 166, 246, 0.4)":"rgba(244, 67, 54, 0.4)"}`}},children:y?s.jsx(fn,{sx:{fontSize:{xs:20,sm:24}}}):s.jsx(Jr,{sx:{fontSize:{xs:20,sm:24}}})}),s.jsx(an,{badgeContent:z,color:"error",sx:{"& .MuiBadge-badge":{backgroundColor:"#ff4444",color:"white",fontWeight:"bold",fontSize:"10px",minWidth:"16px",height:"16px"}},children:s.jsx(ee,{onClick:kn,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:A?"#76a6f6":"rgba(118, 166, 246, 0.15)",backdropFilter:"blur(10px)",color:A?"white":"#76a6f6",border:"2px solid #76a6f6",boxShadow:"0 4px 20px rgba(118, 166, 246, 0.25)",transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:"#76a6f6",color:"white",boxShadow:"0 6px 24px rgba(118, 166, 246, 0.4)"}},children:s.jsx(Yt,{sx:{fontSize:{xs:20,sm:24}}})})}),s.jsx(ee,{onClick:n,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:"#f44336",backdropFilter:"blur(10px)",color:"white",border:"2px solid #f44336",boxShadow:"0 4px 20px rgba(244, 67, 54, 0.3)",transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:"#d32f2f",boxShadow:"0 6px 24px rgba(244, 67, 54, 0.4)"}},children:s.jsx(un,{sx:{fontSize:{xs:20,sm:24}}})})]}),B&&s.jsx(Nl,{socketManager:a,isVisible:B,onClose:()=>$(!1),callId:(e==null?void 0:e.callId)||"unknown",isTeacher:!0})]}),s.jsx(hs,{direction:"left",in:A,mountOnEnter:!0,unmountOnExit:!0,children:s.jsxs(p,{sx:{position:"absolute",top:{xs:"max(10px, env(safe-area-inset-top))",sm:"max(20px, env(safe-area-inset-top))"},right:{xs:"max(10px, env(safe-area-inset-right))",sm:"max(20px, env(safe-area-inset-right))"},width:{xs:"calc(100vw - 20px)",sm:"calc(100vw - 40px)",md:400},maxWidth:{xs:"95vw",sm:350,md:400},height:{xs:"calc(100vh - 120px)","@media (max-height: 500px) and (orientation: landscape)":"calc(100vh - 80px)"},"@media (max-height: 500px) and (orientation: landscape)":{width:"300px",maxWidth:"40vw",height:"calc(100vh - 80px)"},background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(20px)",borderRadius:"16px",border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",zIndex:10001},children:[s.jsxs(p,{sx:{p:2,background:"rgba(118, 166, 246, 0.2)",backdropFilter:"blur(10px)",color:"#FFFFFF",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"16px 16px 0 0"},children:[s.jsxs(S,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,fontWeight:600,fontSize:"16px",color:"#FFFFFF"},children:[s.jsx(Yt,{sx:{fontSize:20,color:"#76a6f6"}}),"Chat",((En=a==null?void 0:a.socket)==null?void 0:En.connected)&&s.jsx(p,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"#4caf50",ml:1},title:"Connected"}),!((Tn=a==null?void 0:a.socket)!=null&&Tn.connected)&&s.jsx(p,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"#f44336",ml:1},title:"Disconnected"})]}),s.jsx(ee,{size:"medium",onClick:kn,sx:{color:"rgba(255, 255, 255, 0.8)",borderRadius:1,minWidth:44,minHeight:44,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"#FFFFFF"}},children:s.jsx(ir,{fontSize:"small"})})]}),s.jsx(p,{ref:fe,sx:{flex:1,overflowY:"auto",p:2,minHeight:0,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"rgba(255, 255, 255, 0.1)",borderRadius:"3px"},"&::-webkit-scrollbar-thumb":{background:"rgba(118, 166, 246, 0.6)",borderRadius:"3px","&:hover":{background:"rgba(118, 166, 246, 0.8)"}}},children:q.length===0?s.jsxs(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"rgba(255, 255, 255, 0.7)",flexDirection:"column",gap:1},children:[s.jsx(Yt,{sx:{fontSize:48,opacity:.4,color:"rgba(255, 255, 255, 0.5)"}}),s.jsx(S,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"No messages yet"}),s.jsx(S,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Start a conversation!"})]}):q.map(T=>s.jsxs(p,{sx:{mb:1.5,p:1.5,borderRadius:2,backgroundColor:T.isOwnMessage?"rgba(118, 166, 246, 0.9)":"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",marginLeft:T.isOwnMessage?4:0,marginRight:T.isOwnMessage?0:4,border:T.isOwnMessage?"1px solid rgba(118, 166, 246, 0.3)":"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)"},children:[s.jsx(S,{variant:"body2",sx:{fontWeight:600,mb:.5,color:T.isOwnMessage?"#ffffff":"rgba(255, 255, 255, 0.9)",fontSize:"13px"},children:T.sender}),s.jsx(S,{variant:"body2",sx:{mb:.5,color:T.isOwnMessage?"#ffffff":"rgba(255, 255, 255, 0.95)",lineHeight:1.4},children:T.message}),s.jsx(S,{variant:"caption",sx:{color:T.isOwnMessage?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.6)",fontSize:"11px"},children:T.timestamp.toLocaleTimeString()})]},T.id))}),s.jsx(He,{sx:{borderColor:"rgba(255, 255, 255, 0.2)"}}),s.jsxs(p,{sx:{p:2,background:"rgba(118, 166, 246, 0.15)",backdropFilter:"blur(10px)",borderTop:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"0 0 16px 16px",flexShrink:0},children:[s.jsxs(p,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[s.jsx(p,{sx:{flex:1,position:"relative"},children:s.jsx(Fe,{fullWidth:!0,size:"small",placeholder:"Type a message...",value:H,onChange:T=>le(T.target.value),onKeyPress:li,multiline:!0,maxRows:3,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",color:"#ffffff",borderRadius:2,"& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(118, 166, 246, 0.7)"},"&.Mui-focused fieldset":{borderColor:"#76a6f6"}},"& .MuiInputBase-input::placeholder":{color:"rgba(255, 255, 255, 0.7)"}},InputProps:{endAdornment:s.jsx(ee,{size:"medium",onClick:di,sx:{p:.5,minWidth:44,minHeight:44},children:s.jsx(qa,{sx:{fontSize:20,color:"rgba(255, 255, 255, 0.7)"}})})}})}),s.jsx("span",{children:s.jsx(ee,{onClick:jn,disabled:!H.trim(),sx:{backgroundColor:"#76a6f6",color:"white",borderRadius:2,boxShadow:"0 4px 12px rgba(118, 166, 246, 0.3)","&:hover":{backgroundColor:"#5a91e6",transform:"translateY(-1px)",boxShadow:"0 6px 16px rgba(118, 166, 246, 0.4)"},"&:disabled":{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.5)",boxShadow:"none",transform:"none"}},children:s.jsx(Ps,{})})})]}),s.jsx(us,{open:!!de,anchorEl:de,onClose:ui,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},sx:{zIndex:10005},children:s.jsx(p,{sx:{p:2,maxWidth:{xs:"95vw",sm:300},background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(20px)",borderRadius:2,border:"1px solid rgba(118, 166, 246, 0.3)",display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:1},children:fi.map((T,J)=>s.jsx(ee,{onClick:()=>hi(T),sx:{fontSize:"1.2rem",width:44,height:44,color:"white","&:hover":{backgroundColor:"rgba(118, 166, 246, 0.3)"}},children:T},J))})})]})]})}),!1,s.jsxs(dr,{open:O,onClose:Sn,maxWidth:!1,fullWidth:!0,PaperProps:{sx:{backgroundColor:"#2d2d30",color:"#e8e8e8",border:"2px solid #ff9800",maxWidth:{xs:"95vw",sm:"400px"},margin:{xs:"16px",sm:"auto"}}},children:[s.jsxs(on,{sx:{backgroundColor:"#ff9800",color:"white",display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{sx:{fontSize:"24px"},children:"✋"}),"Student Hand Raised"]}),s.jsx(ur,{sx:{pt:2},children:Array.from(b.entries()).map(([T,J])=>s.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,mb:1,backgroundColor:"#3d3d40",borderRadius:1},children:[s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{sx:{fontSize:"20px"},children:"✋"}),s.jsxs(S,{variant:"body1",children:[J.name," wants to speak"]})]}),s.jsx(S,{variant:"caption",sx:{color:"#a0a0a0"},children:new Date(J.timestamp).toLocaleTimeString()})]},T))}),s.jsxs(cn,{children:[s.jsx(Te,{onClick:Sn,sx:{color:"#e8e8e8"},children:"Dismiss"}),Array.from(b.keys()).map(T=>s.jsx(Te,{onClick:()=>ci(T),variant:"contained",sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Acknowledge"},T))]})]})]}):null}function Bl({isOpen:r=!1,callData:e,callStatus:t="connecting",onEndCall:n,webrtcService:i,socketManager:a}){const o=we(),l=it(o.breakpoints.down("md")),c=it(o.breakpoints.down("sm")),f=d.useRef(null),h=d.useRef(null),[u,y]=d.useState(!0),[_,m]=d.useState(!0),[w,x]=d.useState(!1),[L,I]=d.useState(!1),[j,E]=d.useState(!1),[P,B]=d.useState(!1),[$,b]=d.useState(.7),[k,O]=d.useState(null),[R,A]=d.useState(null);d.useEffect(()=>{if(!i)return;const z=i.getStatus();z.hasLocalStream&&i.localStream?O(i.localStream):e!=null&&e.localStream&&O(e.localStream),z.hasRemoteStream&&i.remoteStream&&A(i.remoteStream)},[i,e]),d.useEffect(()=>{if(!i||k)return;const z=setInterval(()=>{i.localStream&&!k&&O(i.localStream)},500),re=setTimeout(()=>clearInterval(z),5e3);return()=>{clearInterval(z),clearTimeout(re)}},[i,k]),d.useEffect(()=>{k&&f.current&&(f.current.srcObject=k,f.current.addEventListener("loadedmetadata",async()=>{try{await f.current.play()}catch(z){console.warn("🎥 Student Mobile: Local video autoplay failed:",z)}}))},[k]),d.useEffect(()=>{R&&h.current&&(h.current.srcObject=R,h.current.volume=$,h.current.addEventListener("loadedmetadata",async()=>{try{h.current.muted=!1,h.current.autoplay=!0,h.current.playsInline=!0,await h.current.play()}catch(z){console.warn("🎥 Student Mobile: Remote video autoplay failed, will try to play when user interacts:",z);const re=async()=>{try{await h.current.play(),document.removeEventListener("click",re)}catch(fe){console.error("🎥 Student Mobile: Failed to play remote video even after interaction:",fe)}};document.addEventListener("click",re,{once:!0})}}))},[R,$]),d.useEffect(()=>{if(!i)return;const z=re=>{A(re.detail.stream)};return i.addEventListener("remote-stream",z),()=>{i.removeEventListener("remote-stream",z)}},[i]);const D=()=>{if(i){const z=i.toggleAudio();y(z)}},q=async()=>{if(i)try{const z=await i.toggleVideo();m(z),i.localStream&&O(i.localStream)}catch(z){console.error("❌ Student Mobile: Failed to toggle video:",z)}};d.useEffect(()=>{h.current&&(h.current.volume=$)},[$]);const Y={backgroundColor:v(o.palette.background.paper,.9),backdropFilter:"blur(10px)",color:o.palette.primary.main,border:`2px solid ${v(o.palette.primary.main,.3)}`,boxShadow:`0 4px 12px ${v(o.palette.primary.main,.3)}`,transition:"all 0.3s ease",width:l?48:56,height:l?48:56,"&:hover":{transform:"translateY(-2px)",backgroundColor:o.palette.primary.main,color:"white",boxShadow:`0 6px 16px ${v(o.palette.primary.main,.4)}`}},H={...Y,backgroundColor:o.palette.primary.main,color:"white","&:hover":{backgroundColor:o.palette.primary.dark,color:"white"}},le={backgroundColor:"#f44336",color:"white",border:"2px solid #f44336",boxShadow:"0 4px 12px rgba(244, 67, 54, 0.3)",transition:"all 0.3s ease",width:l?56:64,height:l?56:64,"&:hover":{transform:"translateY(-2px)",backgroundColor:"#d32f2f",boxShadow:"0 6px 16px rgba(244, 67, 54, 0.4)"}},de=[{icon:u?s.jsx(Ts,{}):s.jsx(Is,{}),onClick:D,active:u,color:u?"primary":"error"},{icon:_?s.jsx(fn,{}):s.jsx(Jr,{}),onClick:q,active:_,color:_?"primary":"error"},{icon:s.jsx(un,{}),onClick:n,style:le}],oe=[{icon:L?s.jsx(no,{}):s.jsx(to,{}),onClick:()=>I(!L),active:L,label:"Screen Share"},{icon:s.jsx(Ha,{}),onClick:()=>E(!j),active:j,label:"Whiteboard"},{icon:s.jsx(lo,{}),onClick:()=>b(Math.max(0,$-.1)),label:"Volume Down"},{icon:s.jsx(uo,{}),onClick:()=>b(Math.min(1,$+.1)),label:"Volume Up"},{icon:s.jsx(Yt,{}),onClick:()=>B(!P),active:P,label:"Chat"},{icon:s.jsx(Qa,{}),onClick:()=>{},label:"Raise Hand"}];return r?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#000",zIndex:1e4,display:"flex",flexDirection:"column"},children:[s.jsxs(p,{sx:{flex:1,position:"relative",overflow:"hidden",display:"flex",flexDirection:l?"column":"row"},children:[s.jsxs(p,{sx:{flex:1,backgroundColor:"#1a1a1a",display:"flex",alignItems:"center",justifyContent:"center",position:"relative"},children:[s.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),s.jsxs(p,{sx:{position:"absolute",top:20,left:20,right:20,zIndex:1,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsx(ge,{sx:{px:2,py:1,backgroundColor:v(o.palette.background.paper,.9),backdropFilter:"blur(10px)"},children:s.jsxs(S,{variant:"body2",color:"textSecondary",children:[t==="connecting"&&"📞 Connecting...",t==="connected"&&"🟢 Connected",t==="ended"&&"📞 Call Ended",!k&&" (No local stream)",!R&&" (No remote stream)",k&&R&&" (Both streams ready)"]})}),s.jsx(ge,{sx:{px:2,py:1,backgroundColor:v(o.palette.background.paper,.9),backdropFilter:"blur(10px)"},children:s.jsx(S,{variant:"body2",fontWeight:600,children:(e==null?void 0:e.teacherName)||"Teacher"})})]})]}),s.jsx(p,{sx:{position:"absolute",bottom:l?100:20,right:20,width:l?120:200,height:l?160:150,backgroundColor:"#2a2a2a",borderRadius:2,overflow:"hidden",border:`2px solid ${v(o.palette.primary.main,.5)}`,zIndex:2},children:s.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),s.jsxs(p,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:v(o.palette.background.paper,.95),backdropFilter:"blur(20px)",borderTop:`1px solid ${v(o.palette.divider,.1)}`,p:2,display:"flex",justifyContent:"center",alignItems:"center",gap:2,zIndex:3,px:c?1:2,py:c?1.5:2},children:[l&&s.jsx(Pi,{size:"medium",onClick:()=>x(!0),sx:{...Y,mr:1},children:s.jsx(Es,{})}),de.map((z,re)=>s.jsx(ee,{onClick:z.onClick,sx:z.style||(z.active?H:Y),children:z.icon},re))]}),s.jsx(zr,{anchor:"left",open:w,onClose:()=>x(!1),PaperProps:{sx:{width:280,backgroundColor:v(o.palette.background.paper,.95),backdropFilter:"blur(20px)",border:`1px solid ${v(o.palette.divider,.1)}`}},children:s.jsxs(p,{sx:{p:3},children:[s.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[s.jsx(S,{variant:"h6",color:"primary",children:"Call Controls"}),s.jsx(ee,{onClick:()=>x(!1),children:s.jsx(ir,{})})]}),oe.map((z,re)=>s.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:2,p:1,borderRadius:1,"&:hover":{backgroundColor:v(o.palette.primary.main,.1)}},children:[s.jsx(ee,{onClick:z.onClick,sx:z.active?H:Y,children:z.icon}),s.jsx(S,{variant:"body1",sx:{ml:2,flex:1},children:z.label})]},re))]})}),s.jsx(hs,{direction:"left",in:P,mountOnEnter:!0,unmountOnExit:!0,children:s.jsxs(p,{sx:{position:"fixed",top:0,right:0,width:l?"100%":380,height:"100%",backgroundColor:v(o.palette.background.paper,.95),backdropFilter:"blur(20px)",border:`1px solid ${v(o.palette.divider,.1)}`,zIndex:10001,display:"flex",flexDirection:"column"},children:[s.jsxs(p,{sx:{p:2,backgroundColor:v(o.palette.primary.main,.1),borderBottom:`1px solid ${v(o.palette.divider,.1)}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsx(S,{variant:"h6",color:"primary",children:"Chat"}),s.jsx(ee,{onClick:()=>B(!1),children:s.jsx(ir,{})})]}),s.jsx(p,{sx:{flex:1,p:2},children:s.jsx(S,{variant:"body2",color:"textSecondary",children:"Chat feature coming soon..."})})]})})]}):null}function zl({open:r,callerName:e,callerInfo:t,onAccept:n,onReject:i,autoRejectTimer:a=30}){var _;const o=we(),[l,c]=d.useState(a),[f,h]=d.useState(!0);d.useEffect(()=>{if(!r){c(a);return}const m=setInterval(()=>{c(w=>w<=1?(i==null||i({reason:"auto-timeout"}),0):w-1)},1e3);return()=>clearInterval(m)},[r,a,i]),d.useEffect(()=>{if(!r)return;const m=setInterval(()=>{h(w=>!w)},1e3);return()=>clearInterval(m)},[r]),d.useEffect(()=>{let m=null,w=null;if(r)return setTimeout(async()=>{try{w=new(window.AudioContext||window.webkitAudioContext),w.state==="suspended"&&await w.resume();const L=()=>{try{if(w.state!=="running"){console.warn("📞 Student: AudioContext not running, state:",w.state);return}const I=w.createOscillator(),j=w.createGain();I.connect(j),j.connect(w.destination),I.frequency.setValueAtTime(1e3,w.currentTime),j.gain.setValueAtTime(.5,w.currentTime),j.gain.exponentialRampToValueAtTime(.01,w.currentTime+.3),I.start(w.currentTime),I.stop(w.currentTime+.3)}catch(I){console.warn("📞 Student: Failed to play individual beep:",I)}};L(),m=setInterval(L,1500)}catch(L){console.warn("📞 Student: Could not create audio context for ringtone:",L),console.warn("📞 Student: This is normal on some mobile browsers - ringtone will be visual only");try{if("vibrate"in navigator){const I=[200,100,200,100,200],j=setInterval(()=>{navigator.vibrate(I)},2e3);navigator.vibrate(I),m=j}}catch(I){console.warn("📞 Student: Vibration also not available:",I)}}},100),()=>{m&&clearInterval(m),w&&w.state!=="closed"&&w.close()}},[r]);const u=()=>{c(0),n==null||n()},y=()=>{c(0),i==null||i({reason:"user-declined"})};return s.jsx(dr,{open:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:4,backgroundColor:o.palette.background.paper,backgroundImage:`linear-gradient(135deg, ${v(o.palette.primary.main,.05)} 0%, ${v(o.palette.secondary.main,.05)} 100%)`}},children:s.jsxs(ur,{sx:{p:4,textAlign:"center"},children:[s.jsx(S,{variant:"h5",sx:{mb:1,fontWeight:600},children:"Incoming Video Call"}),s.jsx(S,{variant:"body2",color:"textSecondary",sx:{mb:4},children:"Your teacher is calling you"}),s.jsxs(p,{sx:{position:"relative",display:"flex",justifyContent:"center",mb:3},children:[s.jsx(Fi,{in:f,children:s.jsx(p,{sx:{position:"absolute",width:200,height:200,borderRadius:"50%",border:`3px solid ${v(o.palette.primary.main,.3)}`,animation:"ripple 2s infinite","@keyframes ripple":{"0%":{transform:"scale(0.8)",opacity:1},"100%":{transform:"scale(1.2)",opacity:0}}}})}),s.jsx(lr,{sx:{width:120,height:120,fontSize:"3rem",backgroundColor:o.palette.primary.main,border:`4px solid ${o.palette.background.paper}`,boxShadow:o.shadows[8]},children:(_=e==null?void 0:e.charAt(0))==null?void 0:_.toUpperCase()}),s.jsx(p,{sx:{position:"absolute",bottom:0,right:"calc(50% - 80px)",backgroundColor:o.palette.success.main,borderRadius:"50%",p:1,border:`3px solid ${o.palette.background.paper}`},children:s.jsx(fn,{sx:{color:"white",fontSize:20}})})]}),s.jsx(S,{variant:"h6",sx:{mb:1,fontWeight:600},children:e}),t&&s.jsx(S,{variant:"body2",color:"textSecondary",sx:{mb:2},children:t}),s.jsx(ge,{elevation:0,sx:{backgroundColor:v(o.palette.warning.main,.1),color:o.palette.warning.main,py:1,px:2,borderRadius:2,mb:4,display:"inline-block"},children:s.jsxs(S,{variant:"body2",sx:{fontWeight:600},children:["Auto-reject in ",l,"s"]})}),s.jsxs(p,{sx:{display:"flex",justifyContent:"space-around",alignItems:"center",mt:4},children:[s.jsx(ee,{onClick:y,sx:{backgroundColor:o.palette.error.main,color:"white",width:80,height:80,"&:hover":{backgroundColor:o.palette.error.dark,transform:"scale(1.1)"},transition:"all 0.2s ease-in-out"},children:s.jsx(un,{sx:{fontSize:32}})}),s.jsx(ee,{onClick:u,sx:{backgroundColor:o.palette.success.main,color:"white",width:80,height:80,animation:"pulse 2s infinite","&:hover":{backgroundColor:o.palette.success.dark,transform:"scale(1.1)"},transition:"all 0.2s ease-in-out","@keyframes pulse":{"0%":{boxShadow:`0 0 0 0 ${v(o.palette.success.main,.7)}`},"70%":{boxShadow:`0 0 0 20px ${v(o.palette.success.main,0)}`},"100%":{boxShadow:`0 0 0 0 ${v(o.palette.success.main,0)}`}}},children:s.jsx(Wa,{sx:{fontSize:32}})})]}),s.jsxs(p,{sx:{display:"flex",justifyContent:"space-around",mt:2},children:[s.jsx(S,{variant:"caption",color:"error",children:"Decline"}),s.jsx(S,{variant:"caption",color:"success.main",children:"Accept"})]}),s.jsx(ge,{elevation:0,sx:{backgroundColor:v(o.palette.info.main,.1),color:o.palette.info.main,p:2,borderRadius:2,mt:3},children:s.jsx(S,{variant:"caption",children:"📹 This call will be automatically recorded for educational purposes"})})]})})}class $l extends Wt.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var n,i;if(console.error("Error caught by ErrorBoundary:",e,t),(n=e.message)!=null&&n.includes("removeChild")||(i=e.message)!=null&&i.includes("not a child of this node")){console.warn("Non-critical DOM cleanup error, ignoring:",e.message),setTimeout(()=>{this.setState({hasError:!1,error:null})},100);return}}render(){var e,t;return this.state.hasError&&!((t=(e=this.state.error)==null?void 0:e.message)!=null&&t.includes("removeChild"))?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#000",zIndex:9999,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"white",textAlign:"center",p:3},children:[s.jsx(S,{variant:"h5",gutterBottom:!0,children:"Meeting Error"}),s.jsx(S,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:600},children:"Something went wrong with the meeting interface. Please try refreshing or rejoining."}),s.jsx(Te,{variant:"contained",color:"primary",onClick:()=>window.location.reload(),children:"Refresh Page"})]}):this.props.children}}class Hl extends EventTarget{constructor(e=null){super();const t={host:"31.97.188.80",port:3478,username:"coturn_user",credential:"test123"};this.rtcConfig={iceServers:[],iceCandidatePoolSize:10};const n=e||t;this.configureTurnServer(n),this.peerConnection=null,this.localStream=null,this.remoteStream=null,this.isInCall=!1,this.isCaller=!1,this.callId=null,this.remoteUserId=null,this.socket=null,this.userId=null,this.isAudioEnabled=!0,this.isVideoEnabled=!0,this.connectionRetries=0,this.maxRetries=1,this.isEnding=!1,this.isScreenSharing=!1,this.screenStream=null,this.cameraStream=null,this.videoSender=null,this.audioSender=null,this.screenShareEndHandler=null,this.adminPeerConnection=null,this.failureTimeoutId=null,this.pendingIceCandidates=[],this.hasRemoteDescription=!1,this.recoveringVideoTrack=!1,this.callStartTime=null,this.apiClient=null}configureTurnServer(e){if(!e){console.warn("⚠️ Student: No TURN config provided, keeping existing configuration");return}const t=this.normalizeTurnConfig(e),{urls:n,host:i,port:a,username:o,credential:l}=t;if(!n.length){console.warn("⚠️ Student: TURN config missing URLs, keeping existing configuration");return}this.rtcConfig={iceServers:[{urls:n,username:o,credential:l}],iceCandidatePoolSize:10,iceTransportPolicy:"relay",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",iceConnectionReceiveTimeout:3e4,iceInactiveTimeout:3e4,continualGatheringPolicy:"gather_continually"},console.log("✅ Student: TURN server configured:",{host:i,port:a,username:o,urls:n,iceTransportPolicy:this.rtcConfig.iceTransportPolicy,mode:"TURN relay only (no direct P2P or STUN)"})}normalizeTurnConfig(e){const t=e.port||3478;let n=[];return Array.isArray(e.urls)&&e.urls.length>0?n=e.urls:typeof e.urls=="string"&&(n=[e.urls]),n.length===0&&e.host&&(n=[`turn:${e.host}:${t}`,`turn:${e.host}:${t}?transport=tcp`]),{host:e.host||null,port:t,username:e.username,credential:e.credential,urls:n}}initialize(e,t=null){var n;this.socket=e,this.userId=t||((n=e.userData)==null?void 0:n.userId),this.setupSocketListeners()}setApiClient(e){this.apiClient=e}async trackCallDuration(){if(!(!this.callStartTime||!this.apiClient||!this.remoteUserId))try{const e=new Date,t=Math.floor((e-this.callStartTime)/1e3);t>=5&&await this.apiClient.trackCallSession(t,this.callStartTime,e,this.remoteUserId,this.remoteUserName||"Unknown","teacher")}catch(e){console.error("❌ Failed to track call duration:",e)}}setupSocketListeners(){if(!this.socket){console.error("❌ Student WebRTC: No socket available for listeners");return}this.socket.on("webrtc-offer",async e=>{var n,i;const t=this.peerConnection&&(this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="disconnected"||this.peerConnection.iceConnectionState==="failed"||this.peerConnection.iceConnectionState==="disconnected");if(this.isInCall&&this.callId!==e.callId&&!t){console.warn("🚫 Student(mobile): Rejecting additional offer while already in call",{currentCallId:this.callId,newCallId:e.callId,callerId:e.callerId,connectionState:(n=this.peerConnection)==null?void 0:n.connectionState,iceState:(i=this.peerConnection)==null?void 0:i.iceConnectionState}),this.socket.emit("webrtc-call-rejected",{callId:e.callId,recipientId:e.callerId,reason:"already-in-call"});return}if(t&&this.cleanup(),e.iceRestart&&this.callId===e.callId){await this.handleIceRestartOffer(e);return}this.dispatchEvent(new CustomEvent("incoming-call",{detail:e}))}),this.socket.on("webrtc-answer",async e=>{await this.handleAnswer(e)}),this.socket.on("webrtc-ice-candidate",async e=>{await this.handleIceCandidate(e)}),this.socket.on("webrtc-call-end",e=>{console.warn("📴 Student: Received webrtc-call-end from remote",e),this.endCall(!1)}),this.socket.on("webrtc-call-rejected",e=>{console.warn("❌ Student: Call rejected by remote",e),this.dispatchEvent(new CustomEvent("call-rejected",{detail:e})),this.cleanup()}),this.socket.on("incoming-call-cancelled",(e={})=>{console.warn("🔕 Student(mobile): Incoming call cancelled on another device",e),this.dispatchEvent(new CustomEvent("incoming-call-cancelled",{detail:e}))}),this.socket.on("admin-webrtc-offer",async e=>{await this.handleAdminOffer(e)}),this.socket.on("admin-ice-candidate",async e=>{if(this.adminPeerConnection&&e.candidate)try{await this.adminPeerConnection.addIceCandidate(new RTCIceCandidate(e.candidate))}catch(t){console.error("❌ Student: Failed to add admin ICE candidate:",t)}})}async startCall(e,t){var n;try{this.remoteUserId=e,this.remoteUserName=t,this.isCaller=!0,this.callId=`call_${Date.now()}_${Math.random().toString(36).substring(7)}`,this.callStartTime=new Date,await this.getUserMedia({refresh:!0}),this.createPeerConnection(),this.localStream.getTracks().forEach(a=>{this.peerConnection.addTrack(a,this.localStream)}),this.updateSenderReferences();const i=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});return await this.peerConnection.setLocalDescription(i),await this.waitForICEGathering(),this.socket.emit("webrtc-offer",{callId:this.callId,recipientId:e,callerId:this.userId||((n=this.socket.userData)==null?void 0:n.userId),callerName:t,offer:this.peerConnection.localDescription}),this.isInCall=!0,this.dispatchEvent(new CustomEvent("call-started",{detail:{callId:this.callId,remoteUserId:e,localStream:this.localStream}})),{success:!0,callId:this.callId}}catch(i){throw console.error("❌ Failed to start call:",i),this.cleanup(),i}}async answerCall(e){try{if(this.callId=e.callId,this.remoteUserId=e.callerId,this.isCaller=!1,await this.getUserMedia({refresh:!0}),this.createPeerConnection(),this.localStream.getTracks().forEach(n=>{this.peerConnection.addTrack(n,this.localStream)}),this.updateSenderReferences(),await this.peerConnection.setRemoteDescription(e.offer),this.hasRemoteDescription=!0,this.pendingIceCandidates.length>0){for(const n of this.pendingIceCandidates)try{await this.peerConnection.addIceCandidate(new RTCIceCandidate(n))}catch(i){console.error("❌ Student: Failed to add queued ICE candidate:",i)}this.pendingIceCandidates=[]}const t=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(t),await this.waitForICEGathering(),this.socket.emit("webrtc-answer",{callId:this.callId,recipientId:e.callerId,answer:this.peerConnection.localDescription}),this.isInCall=!0,this.dispatchEvent(new CustomEvent("call-answered",{detail:{callId:this.callId,localStream:this.localStream}})),{success:!0}}catch(t){throw console.error("❌ Failed to answer call:",t),this.rejectCall(e.callId,e.callerId),t}}rejectCall(e,t,n="user-rejected"){console.warn("🚫 Student(mobile): Rejecting call",{callId:e,callerId:t,reason:n}),this.socket.emit("webrtc-call-rejected",{callId:e,recipientId:t,reason:n}),this.cleanup()}endCall(e=!0){var t,n;if(this.isEnding){console.warn("⚠️ Student: endCall invoked while already ending");return}this.isEnding=!0,console.warn("⚠️ Student: endCall invoked",{sendSignal:e,callId:this.callId,remoteUserId:this.remoteUserId,connectionState:(t=this.peerConnection)==null?void 0:t.connectionState,iceState:(n=this.peerConnection)==null?void 0:n.iceConnectionState}),this.trackCallDuration(),e&&this.callId&&this.remoteUserId&&this.socket.emit("webrtc-call-end",{callId:this.callId,recipientId:this.remoteUserId}),this.dispatchEvent(new CustomEvent("call-ended",{detail:{sendSignal:e}})),this.cleanup(),setTimeout(()=>{this.isEnding=!1},100)}async getUserMedia({refresh:e=!1}={}){var t,n,i,a;try{if(!e&&this.cameraStream&&this.cameraStream.getVideoTracks().length)return this.localStream=this.cameraStream,this.isVideoEnabled=((t=this.cameraStream.getVideoTracks()[0])==null?void 0:t.enabled)!==!1,this.isAudioEnabled=((n=this.cameraStream.getAudioTracks()[0])==null?void 0:n.enabled)!==!1,this.attachLocalTrackListeners(this.cameraStream),this.cameraStream;if(!navigator.mediaDevices)throw new Error("MediaDevices API not available. This browser does not support WebRTC.");if(!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia is not available. Please use a modern browser like Chrome, Firefox, or Safari.");if(e&&this.cameraStream){try{this.cameraStream.getTracks().forEach(c=>c.stop())}catch(c){console.warn("⚠️ Student: Failed to stop previous camera stream during refresh:",c)}this.cameraStream=null}const o={video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1,volume:1,latency:0,googEchoCancellation:!0,googExperimentalEchoCancellation:!0,googAutoGainControl:!0,googExperimentalAutoGainControl:!0,googNoiseSuppression:!0,googExperimentalNoiseSuppression:!0,googBeamforming:!0,googArrayGeometry:!0,googAudioMirroring:!1,mozEchoCancellation:!0,mozNoiseSuppression:!0,mozAutoGainControl:!0}},l=await navigator.mediaDevices.getUserMedia(o);return this.cameraStream=l,this.localStream=l,this.isVideoEnabled=((i=l.getVideoTracks()[0])==null?void 0:i.enabled)!==!1,this.isAudioEnabled=((a=l.getAudioTracks()[0])==null?void 0:a.enabled)!==!1,this.attachLocalTrackListeners(l),l}catch(o){throw console.error("❌ Student: Failed to get user media:",o),console.error("❌ Student: Error name:",o.name),console.error("❌ Student: Error message:",o.message),o.name==="NotAllowedError"?new Error("Camera and microphone access denied. Please allow access and try again."):o.name==="NotFoundError"?new Error("No camera or microphone found. Please check your devices."):o.name==="NotReadableError"?new Error("Camera or microphone is already in use by another application."):o.name==="OverconstrainedError"?new Error("Camera constraints cannot be satisfied. Try with different settings."):new Error(`Media access failed: ${o.message}`)}}createPeerConnection(){this.peerConnection=new RTCPeerConnection(this.rtcConfig),this.peerConnection.ontrack=e=>{this.remoteStream=e.streams[0],this.dispatchEvent(new CustomEvent("remote-stream",{detail:{stream:this.remoteStream}}))},this.peerConnection.onnegotiationneeded=()=>{this.updateSenderReferences()},this.peerConnection.onicecandidate=e=>{e.candidate&&this.socket.emit("webrtc-ice-candidate",{callId:this.callId,recipientId:this.remoteUserId,candidate:e.candidate})},this.peerConnection.onconnectionstatechange=()=>{const e=this.peerConnection.connectionState;e==="connected"?(this.clearFailureTimeout(),this.dispatchEvent(new CustomEvent("connection-established"))):e==="failed"?(console.error("❌ Student: WebRTC connection failed"),this.scheduleFailureHandler()):e==="disconnected"&&setTimeout(()=>{this.peerConnection&&this.peerConnection.connectionState},15e3)},this.peerConnection.oniceconnectionstatechange=()=>{const e=this.peerConnection.iceConnectionState;if(e==="connected"||e==="completed")this.dispatchEvent(new CustomEvent("call-connected"));else if(e==="failed"){console.error("❌ Student: ICE connection failed - TURN server may not be working");try{this.peerConnection&&typeof this.peerConnection.restartIce=="function"&&this.peerConnection.restartIce().catch(()=>{})}catch(t){console.warn("⚠️ Student: ICE restart attempt after failure did not succeed:",t)}}else if(e==="disconnected"){let t=0;const n=setInterval(()=>{if(t++,!this.peerConnection){clearInterval(n);return}const i=this.peerConnection.iceConnectionState;if(i==="connected"||i==="completed")clearInterval(n);else if(t>=5){clearInterval(n);try{this.peerConnection&&typeof this.peerConnection.restartIce=="function"&&this.peerConnection.restartIce().catch(()=>{})}catch(a){console.warn("⚠️ Student: ICE restart attempt after prolonged disconnect failed:",a)}}},5e3)}},this.peerConnection.onicegatheringstatechange=()=>{}}updateSenderReferences(){if(!this.peerConnection){this.videoSender=null,this.audioSender=null;return}const e=this.peerConnection.getSenders();this.videoSender=e.find(t=>t.track&&t.track.kind==="video")||null,this.audioSender=e.find(t=>t.track&&t.track.kind==="audio")||null}getVideoSender(){return this.videoSender&&this.videoSender.track?this.videoSender:(this.updateSenderReferences(),this.videoSender)}getAudioSender(){return this.audioSender&&this.audioSender.track?this.audioSender:(this.updateSenderReferences(),this.audioSender)}async handleAnswer(e){if(this.peerConnection&&e.answer){if(await this.peerConnection.setRemoteDescription(e.answer),this.hasRemoteDescription=!0,this.pendingIceCandidates.length>0){for(const t of this.pendingIceCandidates)try{await this.peerConnection.addIceCandidate(new RTCIceCandidate(t))}catch(n){console.error("❌ Student: Failed to add queued ICE candidate:",n)}this.pendingIceCandidates=[]}this.dispatchEvent(new CustomEvent("call-connected"))}}async handleIceRestartOffer(e){try{if(this.peerConnection&&e.offer){await this.peerConnection.setRemoteDescription(e.offer);const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),this.socket.emit("webrtc-answer",{callId:this.callId,recipientId:e.callerId,answer:t})}}catch(t){console.error("❌ Student: Failed to handle ICE restart:",t)}}async handleIceCandidate(e){if(this.peerConnection&&e.candidate){if(!this.hasRemoteDescription){this.pendingIceCandidates.push(e.candidate);return}try{await this.peerConnection.addIceCandidate(new RTCIceCandidate(e.candidate))}catch(t){console.error("❌ Student: Failed to add ICE candidate:",t),console.error("❌ Student: Problematic candidate:",e.candidate)}}}async toggleVideo(){var e,t;try{this.isScreenSharing&&await this.stopScreenShare();const n=await this.getUserMedia({refresh:!this.cameraStream});this.cameraStream=n||this.cameraStream,this.attachLocalTrackListeners(this.cameraStream);const i=(t=(e=this.cameraStream)==null?void 0:e.getVideoTracks())==null?void 0:t[0];if(!i)return console.warn("⚠️ Student: No video track available to toggle"),!1;i.enabled=!i.enabled,this.isVideoEnabled=i.enabled;const a=this.getVideoSender();return a&&i&&await a.replaceTrack(i),this.localStream=this.cameraStream,this.isVideoEnabled}catch(n){return console.error("❌ Student: Failed to toggle video:",n),!1}}toggleAudio(){const e=this.cameraStream||this.localStream;if(e){const t=e.getAudioTracks()[0];if(t)return t.enabled=!t.enabled,this.isAudioEnabled=t.enabled,this.localStream=e,this.isAudioEnabled}return!1}attachLocalTrackListeners(e){e&&e.getTracks().forEach(t=>{t.kind==="video"&&(t.onended=()=>{console.warn("⚠️ Student: Local video track ended unexpectedly"),this.recoverVideoTrack("track-ended")},t.onmute=()=>{var n;!this.isScreenSharing&&((n=this.getVideoSender())==null?void 0:n.track)===t&&setTimeout(()=>{var i;t.muted&&!this.isScreenSharing&&((i=this.getVideoSender())==null?void 0:i.track)===t&&(console.warn("⚠️ Student: Local video track muted for extended period, attempting recovery"),this.recoverVideoTrack("track-muted"))},3e3)})})}async recoverVideoTrack(e){var t;if(this.isScreenSharing){console.warn("⚠️ Student: Skipping video recovery during screen share",{reason:e});return}if(!this.isVideoEnabled){console.warn("⚠️ Student: Video disabled by user, skipping recovery",{reason:e});return}if(this.recoveringVideoTrack){console.warn("⚠️ Student: Video recovery already in progress, skipping",{reason:e});return}this.recoveringVideoTrack=!0,console.warn("🔧 Student: Attempting to recover video track",{reason:e});try{const n=await this.getUserMedia({refresh:!0});if(!n){console.warn("⚠️ Student: getUserMedia returned no stream during recovery");return}this.attachLocalTrackListeners(n);const i=(t=n.getVideoTracks())==null?void 0:t[0],a=this.getVideoSender();a&&i?(i.enabled=this.isVideoEnabled,await a.replaceTrack(i),this.localStream=n,console.log("✅ Student: Video track recovered successfully",{reason:e})):console.warn("⚠️ Student: Unable to recover video track - missing sender or track",{hasSender:!!a,hasTrack:!!i,reason:e})}catch(n){console.error("❌ Student: Failed to recover video track:",n)}finally{this.recoveringVideoTrack=!1}}async startScreenShare(){try{if(!window.isSecureContext)throw new Error("Screen sharing requires HTTPS or localhost");if(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)throw new Error("Screen sharing not supported in this browser. Please use Chrome 72+, Firefox 66+, or Safari 13+");const e=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},frameRate:{ideal:15,max:30}},audio:!1});if(!this.peerConnection)throw new Error("No active call to share screen");this.cameraStream=this.cameraStream||this.localStream||await this.getUserMedia({refresh:!1});const t=this.getVideoSender();if(t){const n=e.getVideoTracks()[0];return await t.replaceTrack(n),this.isScreenSharing=!0,this.screenStream=e,this.screenShareEndHandler&&(n.removeEventListener("ended",this.screenShareEndHandler),n.removeEventListener("inactive",this.screenShareEndHandler)),this.screenShareEndHandler=()=>{this.stopScreenShare().catch(i=>{console.error("❌ Student: Screen share auto-stop failed:",i)})},n.addEventListener("ended",this.screenShareEndHandler),n.addEventListener("inactive",this.screenShareEndHandler),this.socket.emit("webrtc-screen-share",{callId:this.callId,recipientId:this.remoteUserId,isSharing:!0}),this.dispatchEvent(new CustomEvent("screen-share-started")),!0}throw new Error("No video sender found")}catch(e){throw console.error("❌ Student: Screen share failed:",e),e}}async stopScreenShare(){var e,t;try{if(!this.isScreenSharing)return;if(this.isScreenSharing=!1,this.screenStream){try{const o=this.screenStream.getVideoTracks()[0];o&&this.screenShareEndHandler&&(o.removeEventListener("ended",this.screenShareEndHandler),o.removeEventListener("inactive",this.screenShareEndHandler)),this.screenStream.getTracks().forEach(l=>l.stop())}catch(o){console.warn("⚠️ Student: Error stopping screen share stream:",o)}this.screenStream=null,this.screenShareEndHandler=null}const n=await this.getUserMedia({refresh:!this.cameraStream});this.cameraStream=n||this.cameraStream,this.attachLocalTrackListeners(this.cameraStream);const i=(t=(e=this.cameraStream)==null?void 0:e.getVideoTracks())==null?void 0:t[0],a=this.getVideoSender();a&&i&&(await a.replaceTrack(i),i.enabled=this.isVideoEnabled),this.localStream=this.cameraStream||this.localStream,this.socket.emit("webrtc-screen-share",{callId:this.callId,recipientId:this.remoteUserId,isSharing:!1}),this.dispatchEvent(new CustomEvent("screen-share-stopped"))}catch(n){throw console.error("❌ Student: Failed to stop screen share:",n),n}}getStatus(){var e;return{isInCall:this.isInCall,isCaller:this.isCaller,callId:this.callId,remoteUserId:this.remoteUserId,hasLocalStream:!!this.localStream,hasRemoteStream:!!this.remoteStream,isAudioEnabled:this.isAudioEnabled,isVideoEnabled:this.isVideoEnabled,isScreenSharing:this.isScreenSharing,connectionState:(e=this.peerConnection)==null?void 0:e.connectionState}}scheduleFailureHandler(){this.clearFailureTimeout(),this.failureTimeoutId=setTimeout(()=>{if(this.peerConnection&&this.peerConnection.connectionState==="failed"){console.warn("⚠️ Student: WebRTC still reporting failed state; keeping call alive for manual recovery");try{typeof this.peerConnection.restartIce=="function"&&this.peerConnection.restartIce().catch(()=>{})}catch(e){console.warn("⚠️ Student: ICE restart attempt failed:",e)}}},1e4)}clearFailureTimeout(){this.failureTimeoutId&&(clearTimeout(this.failureTimeoutId),this.failureTimeoutId=null)}waitForICEGathering(e=5e3){return new Promise(t=>{if(!this.peerConnection||this.peerConnection.iceGatheringState==="complete"){t();return}const n=setTimeout(()=>{t()},e),i=()=>{this.peerConnection.iceGatheringState==="complete"&&(clearTimeout(n),this.peerConnection.removeEventListener("icegatheringstatechange",i),t())};this.peerConnection.addEventListener("icegatheringstatechange",i)})}cleanup(){if(console.warn("🧹 Student: cleanup invoked",{hadPeerConnection:!!this.peerConnection,hadLocalStream:!!this.localStream,hadScreenStream:!!this.screenStream,hadAdminConnection:!!this.adminPeerConnection}),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.cameraStream&&this.cameraStream!==this.localStream){try{this.cameraStream.getTracks().forEach(e=>e.stop())}catch(e){console.warn("⚠️ Student: Failed to stop camera stream during cleanup:",e)}this.cameraStream=null}if(this.screenStream&&(this.screenStream.getTracks().forEach(e=>e.stop()),this.screenStream=null),this.screenShareEndHandler=null,this.adminPeerConnection){try{this.adminPeerConnection.close()}catch(e){console.warn("⚠️ Student: Failed to close admin peer connection:",e)}this.adminPeerConnection=null}this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.isInCall=!1,this.isCaller=!1,this.callId=null,this.remoteUserId=null,this.remoteStream=null,this.isAudioEnabled=!0,this.isVideoEnabled=!0,this.clearFailureTimeout(),this.isEnding=!1,this.isScreenSharing=!1,this.videoSender=null,this.audioSender=null,this.pendingIceCandidates=[],this.hasRemoteDescription=!1,this.recoveringVideoTrack=!1}destroy(){this.cleanup(),this.socket&&(this.socket.off("webrtc-offer"),this.socket.off("webrtc-answer"),this.socket.off("webrtc-ice-candidate"),this.socket.off("webrtc-call-end"),this.socket.off("webrtc-call-rejected"),this.socket.off("admin-webrtc-offer"),this.socket.off("admin-ice-candidate"))}async handleAdminOffer(e){var t;try{this.localStream||await this.getUserMedia({refresh:!this.cameraStream}),this.adminPeerConnection=new RTCPeerConnection(this.rtcConfig),this.localStream&&this.localStream.getTracks().forEach(i=>{this.adminPeerConnection.addTrack(i,this.localStream)}),this.adminPeerConnection.onicecandidate=i=>{var a;i.candidate&&this.socket.emit("admin-ice-candidate",{targetId:e.adminId,adminId:e.adminId,sourceId:((a=this.socket)==null?void 0:a.id)||this.userId,callId:e.callId,candidate:i.candidate})},await this.adminPeerConnection.setRemoteDescription(new RTCSessionDescription(e.offer));const n=await this.adminPeerConnection.createAnswer();await this.adminPeerConnection.setLocalDescription(n),this.socket.emit("admin-webrtc-answer",{targetId:e.adminId,adminId:e.adminId,sourceId:((t=this.socket)==null?void 0:t.id)||this.userId,callId:e.callId,answer:n})}catch(n){console.error("❌ Student: Failed to handle admin offer:",n)}}}const Qs="appConfig",Zs="webrtc",ei="student-app-config";let Ve=ti(),rr=null,Ot=null;const or=new Set;function ti(r={}){const e=rn(),t=ri(r.turn||r.turnConfig||r.turnServer);return{apiBaseUrl:r.apiBaseUrl||r.apiUrl||e.apiBaseUrl,socketUrl:r.socketUrl||r.signalingUrl||e.socketUrl,appEnv:r.appEnv||r.environment||e.appEnv,turn:t,updatedAt:r.updatedAt||null}}function ri(r){if(!r)return null;if(Array.isArray(r)){const[c]=r;return ri(c)}const{host:e,port:t,username:n,credential:i,password:a,urls:o}=r,l=Array.isArray(o)?o:typeof o=="string"?[o]:[];return{host:e||null,port:t||3478,username:n||r.user||null,credential:i||a||null,urls:l}}function ft(r){Ve=ti(r),Wl({apiBaseUrl:Ve.apiBaseUrl,socketUrl:Ve.socketUrl,appEnv:Ve.appEnv}),Vl(Ve),or.forEach(e=>{try{e(Ve)}catch(t){console.error("AppConfig listener failed:",t)}})}function Vl(r){try{const e={config:r,cachedAt:Date.now()};localStorage.setItem(ei,JSON.stringify(e))}catch(e){console.warn("Failed to cache app config:",e)}}function os(){try{const r=localStorage.getItem(ei);if(!r)return null;const e=JSON.parse(r);if(e&&e.config)return e.config}catch(r){console.warn("Failed to parse cached app config:",r)}return null}async function ql(){const r=ce(se,Qs,Zs),e=await ye(r);if(!e.exists())return console.warn("App config document not found in Firestore, using defaults"),null;const t=e.data()||{};return{...t,updatedAt:t.updatedAt||t.lastUpdated||null}}const Yl=async({listen:r=!0}={})=>(rr||(rr=(async()=>{try{const e=await ql();if(e)ft(e);else{const t=os();ft(t||rn())}}catch(e){console.error("Failed to load app config from Firestore:",e);const t=os();ft(t||rn())}if(r&&!Ot){const e=ce(se,Qs,Zs);Ot=$r(e,t=>{if(t.exists()){const n=t.data()||{};ft({...n,updatedAt:n.updatedAt||n.lastUpdated||null})}},t=>{console.error("App config snapshot listener error:",t)})}return Ve})()),rr),sn=()=>Ve,Gl=r=>typeof r!="function"?()=>{}:(or.add(r),()=>or.delete(r)),Jl=()=>{Ot&&(Ot(),Ot=null),or.clear(),rr=null},cs="incoming-call-alerts";class Xl extends EventTarget{constructor(){super(),this.initialized=!1,this.currentToken=null,this.user=null,this.baseUrl=null,this.listeners=[],this.lastInviteId=null,this.pushPlugin=Nr(),this.localPlugin=Ur(),this.pluginsLoaded=!1,this.lastNotificationId=null}async initialize(e){var a;if(!Xe.isNativePlatform()){console.info("📵 Push notifications are only available on native builds; skipping registration.");return}if(this.initialized&&((a=this.user)==null?void 0:a.id)===(e==null?void 0:e.id))return;await this.ensurePluginsLoaded(),this.user=e;const t=sn(),n=((t==null?void 0:t.apiBaseUrl)||Ks||"").replace(/\/$/,"");if(this.baseUrl=n.replace(/\/api$/,"")||null,!await this.ensurePermissions()){console.warn("⚠️ Push notifications permission not granted. Call notifications will rely on foreground socket only.");return}await this.ensureNotificationChannel(),await this.attachListeners();try{await this.pushPlugin.register(),this.initialized=!0,console.log("✅ Push notifications registration requested")}catch(o){console.error("❌ Failed to register for push notifications:",o)}}async ensurePermissions(){try{return(await this.localPlugin.checkPermissions()).display!=="granted"&&(await this.localPlugin.requestPermissions()).display!=="granted"?(console.warn("⚠️ Local notification permission denied"),!1):(await this.pushPlugin.checkPermissions()).receive==="granted"?!0:(await this.pushPlugin.requestPermissions()).receive==="granted"}catch(e){return console.error("❌ Failed to verify push notification permissions:",e),!1}}async ensureNotificationChannel(){if(Xe.getPlatform()==="android")try{await this.localPlugin.createChannel({id:cs,name:"Incoming Calls",description:"Alerts for teacher calls",sound:"default",importance:5,visibility:1,lights:!0,vibration:!0})}catch(e){console.warn("⚠️ Failed to create Android notification channel:",e)}}async attachListeners(){if(this.listeners.length>0)return;const e=await this.pushPlugin.addListener("registration",a=>{this.handleRegistration(a).catch(o=>{console.error("❌ Failed to handle push registration:",o)})}),t=await this.pushPlugin.addListener("registrationError",a=>{console.error("❌ Push registration error:",a)}),n=await this.pushPlugin.addListener("pushNotificationReceived",a=>{this.handleNotification(a).catch(o=>{console.error("❌ Failed to process incoming push notification:",o)})}),i=await this.pushPlugin.addListener("pushNotificationActionPerformed",a=>{this.handleNotificationAction(a).catch(o=>{console.error("❌ Failed to handle notification action:",o)})});this.listeners.push(e,t,n,i)}async handleRegistration(e){const t=(e==null?void 0:e.value)||(e==null?void 0:e.token)||e;if(!t){console.warn("⚠️ Received empty push token");return}if(this.currentToken=t,!this.user||!this.baseUrl){console.warn("⚠️ Cannot sync push token yet. Missing user or API base URL.");return}try{const n={userId:this.user.id,role:this.user.role,token:t,platform:Xe.getPlatform(),app:"student",updatedAt:new Date().toISOString()},i=await fetch(`${this.baseUrl}/push/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const a=await i.text();throw new Error(`Registration failed: ${i.status} ${a}`)}console.log("✅ Push token registered with signaling server")}catch(n){console.error("❌ Failed to sync push token with backend:",n)}}async handleNotification(e){const t=(e==null?void 0:e.data)||{};if(t.type==="call_invite"&&!(t.callId&&t.callId===this.lastInviteId)){this.lastInviteId=t.callId||null;try{const n=Date.now()%1e5;await this.localPlugin.schedule({notifications:[{id:n,title:t.title||"Incoming call",body:t.body||`${t.callerName||"Teacher"} is calling you`,extra:t,channelId:cs,sound:"default",schedule:{at:new Date(Date.now()+250)}}]}),this.lastNotificationId=n}catch(n){console.error("❌ Failed to schedule local notification:",n)}this.dispatchEvent(new CustomEvent("call-invite",{detail:t}))}}async handleNotificationAction(e){var n,i;const t=((n=e==null?void 0:e.notification)==null?void 0:n.data)||((i=e==null?void 0:e.notification)==null?void 0:i.extra)||{};t.type==="call_invite"&&this.dispatchEvent(new CustomEvent("call-invite-action",{detail:t}))}async clear(){this.user=null,this.currentToken=null,this.baseUrl=null,this.lastInviteId=null,this.initialized=!1,await Promise.all(this.listeners.map(async e=>{try{await e.remove()}catch(t){console.warn("⚠️ Failed to remove push listener:",t)}})),this.listeners=[],this.pushPlugin=Nr(),this.localPlugin=Ur(),this.pluginsLoaded=!1,this.lastNotificationId=null}async dismissLastInvite(){if(this.lastNotificationId){try{await this.ensurePluginsLoaded(),await this.localPlugin.cancel({notifications:[{id:this.lastNotificationId}]})}catch(e){console.warn("⚠️ Failed to cancel local notification:",e)}this.lastNotificationId=null}}async ensurePluginsLoaded(){if(!this.pluginsLoaded)try{const[{PushNotifications:e},{LocalNotifications:t}]=await Promise.all([nt(()=>import("./index-09ce5e15.js"),["./index-09ce5e15.js","./material-da7e7f42.js","./vendor-e1e3bd03.js","./firebase-f79b6b7d.js"],import.meta.url),nt(()=>import("./index-27ea8e4d.js"),["./index-27ea8e4d.js","./material-da7e7f42.js","./vendor-e1e3bd03.js","./firebase-f79b6b7d.js"],import.meta.url)]);this.pushPlugin=e,this.localPlugin=t,this.pluginsLoaded=!0}catch(e){console.error("❌ Failed to load Capacitor notification plugins:",e),this.pushPlugin=Nr(),this.localPlugin=Ur(),this.pluginsLoaded=!1}}}const Wr=new Xl;function Nr(){return{async addListener(){return{remove:async()=>{}}},async register(){},async checkPermissions(){return{receive:"denied"}},async requestPermissions(){return{receive:"denied"}}}}function Ur(){return{async checkPermissions(){return{display:"granted"}},async requestPermissions(){return{display:"granted"}},async createChannel(){},async schedule(){}}}class Kl{constructor(){this.token=null}saveToken(e){this.token=e,localStorage.setItem("firebase_token",e)}clearToken(){this.token=null,localStorage.removeItem("auth_token"),localStorage.removeItem("firebase_token")}}class Ql{constructor(){this.socket=null,this.eventHandlers=new Map,this.connected=!1}connect(e,t){this.socket&&this.disconnect();try{this.socket=tr(e,{transports:["websocket","polling"],autoConnect:!0,forceNew:!0,timeout:1e4}),this.socket.on("connect",()=>{this.connected=!0,this.socket.userData=t,this.socket.emit("join-room",t),this.emit("connected",{socket:this.socket,userData:t})}),this.socket.on("disconnect",()=>{this.connected=!1,this.emit("disconnected")}),this.socket.on("receive-message",n=>{this.emit("message-received",n)}),this.socket.on("ai-alert",n=>{this.emit("ai-alert",n)}),this.socket.on("error",n=>{console.error("🔍 Student: Socket error:",n)}),this.socket.on("connect_error",n=>{console.error("Socket connection error:",n),this.emit("connection-error",n)})}catch(n){console.error("Failed to initialize socket:",n)}}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}off(e,t){if(this.eventHandlers.has(e)){const n=this.eventHandlers.get(e),i=n.indexOf(t);i>-1&&n.splice(i,1)}}emit(e,t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).forEach(n=>{try{n(t)}catch(i){console.error(`Error in ${e} handler:`,i)}})}sendMessage(e){this.socket&&this.connected?this.socket.emit("send-message",e):console.error("Socket not connected, cannot send message. Connected:",this.connected,"Socket exists:",!!this.socket)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.connected=!1,this.eventHandlers.clear()}}const Br=new Kl,We=new Ql;function Zl(){const r=Xe.isNativePlatform();Xe.getPlatform(),d.useEffect(()=>{const F=g=>{console.error("🚨 Global Error:",g)},W=g=>{console.error("🚨 Unhandled Promise Rejection:",g.reason)};return window.addEventListener("error",F),window.addEventListener("unhandledrejection",W),()=>{window.removeEventListener("error",F),window.removeEventListener("unhandledrejection",W)}},[]);const[e,t]=d.useState(!1),[n,i]=d.useState(null),[a,o]=d.useState(!0),[l,c]=d.useState(!1),[f,h]=d.useState(null),[u]=d.useState(()=>{try{return new Hl}catch(F){return console.error("❌ Failed to initialize WebRTC service:",F),console.error("❌ WebRTC Error Stack:",F.stack),null}}),[y,_]=d.useState(!1),[m,w]=d.useState(null),[x,L]=d.useState(!1),[I,j]=d.useState("idle"),[E,P]=d.useState(null),[B,$]=d.useState(null),[b,k]=d.useState(!1),[O,R]=d.useState(0),[A,D]=d.useState(null),[q,Y]=d.useState(null),[H,le]=d.useState({open:!1,message:"",severity:"info"}),de=(F,W="info")=>{le({open:!0,message:F,severity:W})},oe=(F,W)=>{W!=="clickaway"&&le(g=>({...g,open:!1}))};d.useEffect(()=>{let F=!0,W=null;const g=C=>{var Z,Re;!F||!u||(Z=C==null?void 0:C.turn)!=null&&Z.username&&((Re=C==null?void 0:C.turn)!=null&&Re.credential)&&u.configureTurnServer(C.turn)};return(async()=>{Br.clearToken(),localStorage.removeItem("student-app-cache");try{const C=await Yl();if(!F)return;g(C),W=Gl(g)}catch(C){console.error("❌ Failed to initialise app config:",C),F&&h(C)}finally{F&&(c(!0),await z())}})(),()=>{F=!1,W&&W(),Jl()}},[u]),d.useEffect(()=>{const F=W=>{u&&W.socket&&W.userData?(u.initialize(W.socket,W.userData.userId),re()):console.error("❌ Student: Missing webrtcService or socket data:",{webrtcService:!!u,socket:!!(W!=null&&W.socket),userData:!!(W!=null&&W.userData)})};if(We.connected&&u&&!u.socket){const W={userId:n==null?void 0:n.id,username:n==null?void 0:n.username,role:"student"};u.initialize(We.socket,W.userId),re()}return We.on("connected",F),()=>{We.off("connected",F)}},[u,n]),d.useEffect(()=>{if(!u)return;const F=async g=>{const M=await _e.startCall(g.detail.teacherId||g.detail.callerId,g.detail.teacherName||g.detail.callerName||"Teacher","video");M.success&&(D(M.callId),Y(new Date))},W=async g=>{A&&(await _e.endCall(A,g.detail.reason||"normal"),D(null),Y(null))};return u.addEventListener("call-started",F),u.addEventListener("call-ended",W),()=>{u.removeEventListener("call-started",F),u.removeEventListener("call-ended",W)}},[u,A]);const z=async()=>{try{return new Promise(F=>{const W=zi(pe,async g=>{if(W(),g)try{const M=await ye(ce(se,"users",g.uid));if(M.exists()&&M.data().role==="student"){const C=M.data(),Z={id:g.uid,email:g.email,username:C.username||g.displayName,role:C.role,...C};i(Z),t(!0);const{socketUrl:Re}=sn(),Pe=Re||nn;We.connect(Pe,{userId:Z.id,username:Z.username,role:"student"}),Me.setOnline(),setTimeout(()=>{Me.setupOnlineStatusTracking()},1e3)}else console.warn("User not student or not found in database"),await Et(pe)}catch(M){console.error("Error verifying user role:",M),await Et(pe)}o(!1),F()})})}catch(F){console.error("Token verification failed:",F),o(!1)}},re=()=>{if(!u){console.warn("❌ Student: WebRTC service not available for event handlers");return}u.addEventListener("incoming-call",F=>{w({type:"webrtc-call",callId:F.detail.callId,callerId:F.detail.callerId,callerName:F.detail.callerName,offer:F.detail.offer}),_(!0)}),u.addEventListener("call-started",async F=>{j("connecting"),P(F.detail),L(!0),Y(new Date);const g=await _e.startCall(F.detail.teacherId||F.detail.callerId,F.detail.teacherName||F.detail.callerName||"Teacher","video");g.success?D(g.callId):console.error("Failed to log call start:",g.error)}),u.addEventListener("call-connected",()=>{j("connected")}),u.addEventListener("call-answered",F=>{j("connecting");const W={...F.detail,teacherName:(m==null?void 0:m.callerName)||"Teacher"};P(W),setTimeout(()=>{L(!0)},500)}),u.addEventListener("remote-stream",F=>{I==="connecting"&&j("connected")}),u.addEventListener("call-ended",()=>{K("completed")}),u.addEventListener("call-rejected",F=>{var M;const W=(M=F.detail)==null?void 0:M.reason;console.log("❌ Student: Call rejected",{reason:W,detail:F.detail}),y&&!x&&(W==="auto-timeout"||W==="cancelled-by-teacher"||!W?de("Missed call.","warning"):W==="already-in-call"&&de("Call ignored on this device (already in a call).","info")),K("rejected")}),u.addEventListener("incoming-call-cancelled",()=>{console.log("🔕 Student(mobile): Call answered on another device, closing incoming modal"),_(!1),w(null),de("Call answered on another device.","info"),Wr.dismissLastInvite().catch(F=>{console.warn("⚠️ Failed to cancel local notification:",F)})}),u.addEventListener("connection-failed",F=>{console.warn("⚠️ Student: WebRTC reported connection failure, keeping call active for manual recovery",F==null?void 0:F.detail)})},fe=async(F,W)=>{try{const g=await $i(pe,F,W),M=await ye(ce(se,"users",g.user.uid));if(!M.exists())throw await Et(pe),new Error("User not found in database");const C=M.data();if(C.role!=="student")throw await Et(pe),new Error("Student access required. User role is: "+C.role);const Z={id:g.user.uid,email:g.user.email,username:C.username||g.user.displayName,role:C.role,...C};i(Z),t(!0);const{socketUrl:Re}=sn(),Pe=Re||nn;We.connect(Pe,{userId:Z.id,username:Z.username,role:"student"}),Me.setOnline(),setTimeout(()=>{Me.setupOnlineStatusTracking()},1e3);const wn=await g.user.getIdToken();Br.saveToken(wn);try{await Wr.initialize(Z)}catch(Bt){console.error("❌ Failed to initialise push notifications:",Bt)}return{success:!0}}catch(g){console.error("Login error:",g);let M="Login failed";return g.code==="auth/invalid-credential"||g.code==="auth/wrong-password"?M="Invalid email or password":g.code==="auth/user-not-found"?M="No account found with this email":g.code==="auth/invalid-email"?M="Invalid email format":g.message&&(M=g.message),{success:!1,error:M}}},Qe=async()=>{K(),await Me.setOffline(),await Wr.clear();try{await Et(pe)}catch(F){console.error("Firebase sign out error:",F)}Br.clearToken(),We.disconnect(),i(null),t(!1)},N=async()=>{try{if(!u)throw new Error("WebRTC service not initialized");_(!1),await u.answerCall(m)}catch(F){console.error("Failed to accept call:",F),alert("Failed to answer call: "+F.message),K()}},X=(F={})=>{const W=F.reason||"user-rejected";console.log("❌ Student(mobile): Rejecting incoming call",{reason:W}),W==="auto-timeout"?de("Missed call.","warning"):(W==="user-declined"||W==="user-rejected")&&de("Call declined.","info");const g=W==="user-declined"?"user-rejected":W;u&&m&&u.rejectCall(m.callId,m.callerId,g),_(!1),w(null)},K=async(F="completed")=>{if(A&&q){const g=Math.round((new Date-q)/1e3),M=await _e.endCall(A,F);M.success?await _e.updateCallDuration(A,g):console.error("Failed to log call end:",M.error)}u&&u.getStatus().isInCall&&u.endCall(),L(!1),j("idle"),P(null),$(null),_(!1),w(null),k(!1),R(0),D(null),Y(null)};return f?s.jsxs(Tr,{theme:Pr,children:[s.jsx(Ir,{}),s.jsxs(p,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",p:3,children:[s.jsx("h2",{children:"App Error"}),s.jsx("p",{children:"Something went wrong. Please restart the app."}),s.jsx("p",{style:{fontSize:"12px",opacity:.7},children:f.toString()}),s.jsx("button",{onClick:()=>window.location.reload(),children:"Reload App"})]})]}):!l||a?s.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:"Loading..."}):e?s.jsxs(Tr,{theme:Pr,children:[s.jsx(Ir,{}),s.jsxs(Ac,{apiClient:null,children:[s.jsx(Wn,{children:s.jsx($e,{path:"/*",element:s.jsx(_c,{user:n,onLogout:Qe,children:s.jsxs(Wn,{children:[s.jsx($e,{path:"/",element:s.jsx(Dn,{to:"/dashboard",replace:!0})}),s.jsx($e,{path:"/dashboard",element:s.jsx(yo,{user:n,webrtcService:u})}),s.jsx($e,{path:"/messages",element:s.jsx(vo,{user:n})}),s.jsx($e,{path:"/call-logs",element:s.jsx(Rc,{})}),s.jsx($e,{path:"/settings",element:s.jsx(Co,{user:n})}),s.jsx($e,{path:"*",element:s.jsx(Dn,{to:"/dashboard",replace:!0})})]})})})}),s.jsx(zl,{open:y,callerName:(m==null?void 0:m.callerName)||"Teacher",callerInfo:m==null?void 0:m.callerInfo,onAccept:N,onReject:X}),x&&s.jsx($l,{children:r?s.jsx(Bl,{isOpen:x,callData:E,callStatus:I,onEndCall:K,webrtcService:u,socketManager:We}):s.jsx(Ul,{isOpen:x,callData:E,callStatus:I,onEndCall:K,webrtcService:u,socketManager:We})}),s.jsx(Mi,{open:H.open,autoHideDuration:4e3,onClose:oe,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(mt,{onClose:oe,severity:H.severity,variant:"filled",children:H.message})})]})]}):s.jsxs(Tr,{theme:Pr,children:[s.jsx(Ir,{}),s.jsx(ho,{onLogin:fe})]})}Hr.createRoot(document.getElementById("root")).render(s.jsx(Wt.StrictMode,{children:s.jsx(Oa,{children:s.jsx(Zl,{})})}));export{Xs as W,nt as _,Js as r};
