import{c as Si,a as U,j as s,B as p,T as S,A as vt,b as We,d as Ae,C as pr,u as Ie,e as ut,f as Ve,I as se,g as v,G as oe,h as qe,i as et,k as mr,l as Ct,P as ke,m as ki,n as ji,o as fn,S as Nt,D as Ke,F as mt,p as gt,q as Ei,r as Ti,s as Ii,M as xt,L as ps,t as Ri,v as Pi,w as ms,x as Fi,y as Mi,z as _i,E as gr,H as pn,J as xr,K as mn,N as Oi,O as Ai,Q as Jr,R as _n,U as gs,V as Li,W as xs,X as Di,Y as Wi,Z as Or,_ as Ar,$ as Ni}from"./material-da7e7f42.js";import{c as zi,r as l,R as Ui,a as Ht}from"./vendor-e1e3bd03.js";import{i as Bi,g as $i,a as Hi,c as lr,b as Te,d as fe,q as Ue,o as ot,e as St,w as Se,u as tt,s as je,f as bs,h as Vi,j as Xr,T as qi,l as On,k as Yi,m as Gi,n as Ji,p as Mt,r as Xi}from"./firebase-f79b6b7d.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const a of i)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const a={};return i.integrity&&(a.integrity=i.integrity),i.referrerPolicy&&(a.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?a.credentials="include":i.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(i){if(i.ep)return;i.ep=!0;const a=t(i);fetch(i.href,a)}})();var Kr={},An=zi;Kr.createRoot=An.createRoot,Kr.hydrateRoot=An.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Ut(){return Ut=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Ut.apply(this,arguments)}var Ze;(function(r){r.Pop="POP",r.Push="PUSH",r.Replace="REPLACE"})(Ze||(Ze={}));const Ln="popstate";function Ki(r){r===void 0&&(r={});function e(i,a){let{pathname:o="/",search:d="",hash:c=""}=ht(i.location.hash.substr(1));return!o.startsWith("/")&&!o.startsWith(".")&&(o="/"+o),Qr("",{pathname:o,search:d,hash:c},a.state&&a.state.usr||null,a.state&&a.state.key||"default")}function t(i,a){let o=i.document.querySelector("base"),d="";if(o&&o.getAttribute("href")){let c=i.location.href,f=c.indexOf("#");d=f===-1?c:c.slice(0,f)}return d+"#"+(typeof a=="string"?a:ys(a))}function n(i,a){gn(i.pathname.charAt(0)==="/","relative pathnames are not supported in hash history.push("+JSON.stringify(a)+")")}return Zi(e,t,n,r)}function ue(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function gn(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function Qi(){return Math.random().toString(36).substr(2,8)}function Dn(r,e){return{usr:r.state,key:r.key,idx:e}}function Qr(r,e,t,n){return t===void 0&&(t=null),Ut({pathname:typeof r=="string"?r:r.pathname,search:"",hash:""},typeof e=="string"?ht(e):e,{state:t,key:e&&e.key||n||Qi()})}function ys(r){let{pathname:e="/",search:t="",hash:n=""}=r;return t&&t!=="?"&&(e+=t.charAt(0)==="?"?t:"?"+t),n&&n!=="#"&&(e+=n.charAt(0)==="#"?n:"#"+n),e}function ht(r){let e={};if(r){let t=r.indexOf("#");t>=0&&(e.hash=r.substr(t),r=r.substr(0,t));let n=r.indexOf("?");n>=0&&(e.search=r.substr(n),r=r.substr(0,n)),r&&(e.pathname=r)}return e}function Zi(r,e,t,n){n===void 0&&(n={});let{window:i=document.defaultView,v5Compat:a=!1}=n,o=i.history,d=Ze.Pop,c=null,f=h();f==null&&(f=0,o.replaceState(Ut({},o.state,{idx:f}),""));function h(){return(o.state||{idx:null}).idx}function u(){d=Ze.Pop;let x=h(),N=x==null?null:x-f;f=x,c&&c({action:d,location:w.location,delta:N})}function y(x,N){d=Ze.Push;let R=Qr(w.location,x,N);t&&t(R,x),f=h()+1;let j=Dn(R,f),I=w.createHref(R);try{o.pushState(j,"",I)}catch(F){if(F instanceof DOMException&&F.name==="DataCloneError")throw F;i.location.assign(I)}a&&c&&c({action:d,location:w.location,delta:1})}function O(x,N){d=Ze.Replace;let R=Qr(w.location,x,N);t&&t(R,x),f=h();let j=Dn(R,f),I=w.createHref(R);o.replaceState(j,"",I),a&&c&&c({action:d,location:w.location,delta:0})}function g(x){let N=i.location.origin!=="null"?i.location.origin:i.location.href,R=typeof x=="string"?x:ys(x);return R=R.replace(/ $/,"%20"),ue(N,"No window.location.(origin|href) available to create URL for href: "+R),new URL(R,N)}let w={get action(){return d},get location(){return r(i,o)},listen(x){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(Ln,u),c=x,()=>{i.removeEventListener(Ln,u),c=null}},createHref(x){return e(i,x)},createURL:g,encodeLocation(x){let N=g(x);return{pathname:N.pathname,search:N.search,hash:N.hash}},push:y,replace:O,go(x){return o.go(x)}};return w}var Wn;(function(r){r.data="data",r.deferred="deferred",r.redirect="redirect",r.error="error"})(Wn||(Wn={}));function ea(r,e,t){return t===void 0&&(t="/"),ta(r,e,t,!1)}function ta(r,e,t,n){let i=typeof e=="string"?ht(e):e,a=Cs(i.pathname||"/",t);if(a==null)return null;let o=ws(r);ra(o);let d=null;for(let c=0;d==null&&c<o.length;++c){let f=fa(a);d=ua(o[c],f,n)}return d}function ws(r,e,t,n){e===void 0&&(e=[]),t===void 0&&(t=[]),n===void 0&&(n="");let i=(a,o,d)=>{let c={relativePath:d===void 0?a.path||"":d,caseSensitive:a.caseSensitive===!0,childrenIndex:o,route:a};c.relativePath.startsWith("/")&&(ue(c.relativePath.startsWith(n),'Absolute route path "'+c.relativePath+'" nested under path '+('"'+n+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),c.relativePath=c.relativePath.slice(n.length));let f=ct([n,c.relativePath]),h=t.concat(c);a.children&&a.children.length>0&&(ue(a.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+f+'".')),ws(a.children,e,h,f)),!(a.path==null&&!a.index)&&e.push({path:f,score:la(f,a.index),routesMeta:h})};return r.forEach((a,o)=>{var d;if(a.path===""||!((d=a.path)!=null&&d.includes("?")))i(a,o);else for(let c of vs(a.path))i(a,o,c)}),e}function vs(r){let e=r.split("/");if(e.length===0)return[];let[t,...n]=e,i=t.endsWith("?"),a=t.replace(/\?$/,"");if(n.length===0)return i?[a,""]:[a];let o=vs(n.join("/")),d=[];return d.push(...o.map(c=>c===""?a:[a,c].join("/"))),i&&d.push(...o),d.map(c=>r.startsWith("/")&&c===""?"/":c)}function ra(r){r.sort((e,t)=>e.score!==t.score?t.score-e.score:da(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}const na=/^:[\w-]+$/,sa=3,ia=2,aa=1,oa=10,ca=-2,Nn=r=>r==="*";function la(r,e){let t=r.split("/"),n=t.length;return t.some(Nn)&&(n+=ca),e&&(n+=ia),t.filter(i=>!Nn(i)).reduce((i,a)=>i+(na.test(a)?sa:a===""?aa:oa),n)}function da(r,e){return r.length===e.length&&r.slice(0,-1).every((n,i)=>n===e[i])?r[r.length-1]-e[e.length-1]:0}function ua(r,e,t){t===void 0&&(t=!1);let{routesMeta:n}=r,i={},a="/",o=[];for(let d=0;d<n.length;++d){let c=n[d],f=d===n.length-1,h=a==="/"?e:e.slice(a.length)||"/",u=zn({path:c.relativePath,caseSensitive:c.caseSensitive,end:f},h),y=c.route;if(!u&&f&&t&&!n[n.length-1].route.index&&(u=zn({path:c.relativePath,caseSensitive:c.caseSensitive,end:!1},h)),!u)return null;Object.assign(i,u.params),o.push({params:i,pathname:ct([a,u.pathname]),pathnameBase:xa(ct([a,u.pathnameBase])),route:y}),u.pathnameBase!=="/"&&(a=ct([a,u.pathnameBase]))}return o}function zn(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[t,n]=ha(r.path,r.caseSensitive,r.end),i=e.match(t);if(!i)return null;let a=i[0],o=a.replace(/(.)\/+$/,"$1"),d=i.slice(1);return{params:n.reduce((f,h,u)=>{let{paramName:y,isOptional:O}=h;if(y==="*"){let w=d[u]||"";o=a.slice(0,a.length-w.length).replace(/(.)\/+$/,"$1")}const g=d[u];return O&&!g?f[y]=void 0:f[y]=(g||"").replace(/%2F/g,"/"),f},{}),pathname:a,pathnameBase:o,pattern:r}}function ha(r,e,t){e===void 0&&(e=!1),t===void 0&&(t=!0),gn(r==="*"||!r.endsWith("*")||r.endsWith("/*"),'Route path "'+r+'" will be treated as if it were '+('"'+r.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+r.replace(/\*$/,"/*")+'".'));let n=[],i="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(o,d,c)=>(n.push({paramName:d,isOptional:c!=null}),c?"/?([^\\/]+)?":"/([^\\/]+)"));return r.endsWith("*")?(n.push({paramName:"*"}),i+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?i+="\\/*$":r!==""&&r!=="/"&&(i+="(?:(?=\\/|$))"),[new RegExp(i,e?void 0:"i"),n]}function fa(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return gn(!1,'The URL path "'+r+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+e+").")),r}}function Cs(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=r.charAt(t);return n&&n!=="/"?null:r.slice(t)||"/"}function pa(r,e){e===void 0&&(e="/");let{pathname:t,search:n="",hash:i=""}=typeof r=="string"?ht(r):r;return{pathname:t?t.startsWith("/")?t:ma(t,e):e,search:ba(n),hash:ya(i)}}function ma(r,e){let t=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(i=>{i===".."?t.length>1&&t.pop():i!=="."&&t.push(i)}),t.length>1?t.join("/"):"/"}function Lr(r,e,t,n){return"Cannot include a '"+r+"' character in a manually specified "+("`to."+e+"` field ["+JSON.stringify(n)+"].  Please separate it out to the ")+("`to."+t+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function ga(r){return r.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function Ss(r,e){let t=ga(r);return e?t.map((n,i)=>i===t.length-1?n.pathname:n.pathnameBase):t.map(n=>n.pathnameBase)}function ks(r,e,t,n){n===void 0&&(n=!1);let i;typeof r=="string"?i=ht(r):(i=Ut({},r),ue(!i.pathname||!i.pathname.includes("?"),Lr("?","pathname","search",i)),ue(!i.pathname||!i.pathname.includes("#"),Lr("#","pathname","hash",i)),ue(!i.search||!i.search.includes("#"),Lr("#","search","hash",i)));let a=r===""||i.pathname==="",o=a?"/":i.pathname,d;if(o==null)d=t;else{let u=e.length-1;if(!n&&o.startsWith("..")){let y=o.split("/");for(;y[0]==="..";)y.shift(),u-=1;i.pathname=y.join("/")}d=u>=0?e[u]:"/"}let c=pa(i,d),f=o&&o!=="/"&&o.endsWith("/"),h=(a||o===".")&&t.endsWith("/");return!c.pathname.endsWith("/")&&(f||h)&&(c.pathname+="/"),c}const ct=r=>r.join("/").replace(/\/\/+/g,"/"),xa=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),ba=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,ya=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function wa(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}const js=["post","put","patch","delete"];new Set(js);const va=["get",...js];new Set(va);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function Bt(){return Bt=Object.assign?Object.assign.bind():function(r){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(r[n]=t[n])}return r},Bt.apply(this,arguments)}const xn=l.createContext(null),Ca=l.createContext(null),Vt=l.createContext(null),br=l.createContext(null),ft=l.createContext({outlet:null,matches:[],isDataRoute:!1}),Es=l.createContext(null);function qt(){return l.useContext(br)!=null}function jt(){return qt()||ue(!1),l.useContext(br).location}function Ts(r){l.useContext(Vt).static||l.useLayoutEffect(r)}function Is(){let{isDataRoute:r}=l.useContext(ft);return r?Aa():Sa()}function Sa(){qt()||ue(!1);let r=l.useContext(xn),{basename:e,future:t,navigator:n}=l.useContext(Vt),{matches:i}=l.useContext(ft),{pathname:a}=jt(),o=JSON.stringify(Ss(i,t.v7_relativeSplatPath)),d=l.useRef(!1);return Ts(()=>{d.current=!0}),l.useCallback(function(f,h){if(h===void 0&&(h={}),!d.current)return;if(typeof f=="number"){n.go(f);return}let u=ks(f,JSON.parse(o),a,h.relative==="path");r==null&&e!=="/"&&(u.pathname=u.pathname==="/"?e:ct([e,u.pathname])),(h.replace?n.replace:n.push)(u,h.state,h)},[e,n,o,a,r])}function ka(r,e){return ja(r,e)}function ja(r,e,t,n){qt()||ue(!1);let{navigator:i}=l.useContext(Vt),{matches:a}=l.useContext(ft),o=a[a.length-1],d=o?o.params:{};o&&o.pathname;let c=o?o.pathnameBase:"/";o&&o.route;let f=jt(),h;if(e){var u;let x=typeof e=="string"?ht(e):e;c==="/"||(u=x.pathname)!=null&&u.startsWith(c)||ue(!1),h=x}else h=f;let y=h.pathname||"/",O=y;if(c!=="/"){let x=c.replace(/^\//,"").split("/");O="/"+y.replace(/^\//,"").split("/").slice(x.length).join("/")}let g=ea(r,{pathname:O}),w=Pa(g&&g.map(x=>Object.assign({},x,{params:Object.assign({},d,x.params),pathname:ct([c,i.encodeLocation?i.encodeLocation(x.pathname).pathname:x.pathname]),pathnameBase:x.pathnameBase==="/"?c:ct([c,i.encodeLocation?i.encodeLocation(x.pathnameBase).pathname:x.pathnameBase])})),a,t,n);return e&&w?l.createElement(br.Provider,{value:{location:Bt({pathname:"/",search:"",hash:"",state:null,key:"default"},h),navigationType:Ze.Pop}},w):w}function Ea(){let r=Oa(),e=wa(r)?r.status+" "+r.statusText:r instanceof Error?r.message:JSON.stringify(r),t=r instanceof Error?r.stack:null,i={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"},a=null;return l.createElement(l.Fragment,null,l.createElement("h2",null,"Unexpected Application Error!"),l.createElement("h3",{style:{fontStyle:"italic"}},e),t?l.createElement("pre",{style:i},t):null,a)}const Ta=l.createElement(Ea,null);class Ia extends l.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||t.revalidation!=="idle"&&e.revalidation==="idle"?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:e.error!==void 0?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){console.error("React Router caught the following error during render",e,t)}render(){return this.state.error!==void 0?l.createElement(ft.Provider,{value:this.props.routeContext},l.createElement(Es.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function Ra(r){let{routeContext:e,match:t,children:n}=r,i=l.useContext(xn);return i&&i.static&&i.staticContext&&(t.route.errorElement||t.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=t.route.id),l.createElement(ft.Provider,{value:e},n)}function Pa(r,e,t,n){var i;if(e===void 0&&(e=[]),t===void 0&&(t=null),n===void 0&&(n=null),r==null){var a;if(!t)return null;if(t.errors)r=t.matches;else if((a=n)!=null&&a.v7_partialHydration&&e.length===0&&!t.initialized&&t.matches.length>0)r=t.matches;else return null}let o=r,d=(i=t)==null?void 0:i.errors;if(d!=null){let h=o.findIndex(u=>u.route.id&&(d==null?void 0:d[u.route.id])!==void 0);h>=0||ue(!1),o=o.slice(0,Math.min(o.length,h+1))}let c=!1,f=-1;if(t&&n&&n.v7_partialHydration)for(let h=0;h<o.length;h++){let u=o[h];if((u.route.HydrateFallback||u.route.hydrateFallbackElement)&&(f=h),u.route.id){let{loaderData:y,errors:O}=t,g=u.route.loader&&y[u.route.id]===void 0&&(!O||O[u.route.id]===void 0);if(u.route.lazy||g){c=!0,f>=0?o=o.slice(0,f+1):o=[o[0]];break}}}return o.reduceRight((h,u,y)=>{let O,g=!1,w=null,x=null;t&&(O=d&&u.route.id?d[u.route.id]:void 0,w=u.route.errorElement||Ta,c&&(f<0&&y===0?(La("route-fallback",!1),g=!0,x=null):f===y&&(g=!0,x=u.route.hydrateFallbackElement||null)));let N=e.concat(o.slice(0,y+1)),R=()=>{let j;return O?j=w:g?j=x:u.route.Component?j=l.createElement(u.route.Component,null):u.route.element?j=u.route.element:j=h,l.createElement(Ra,{match:u,routeContext:{outlet:h,matches:N,isDataRoute:t!=null},children:j})};return t&&(u.route.ErrorBoundary||u.route.errorElement||y===0)?l.createElement(Ia,{location:t.location,revalidation:t.revalidation,component:w,error:O,children:R(),routeContext:{outlet:null,matches:N,isDataRoute:!0}}):R()},null)}var Rs=function(r){return r.UseBlocker="useBlocker",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r}(Rs||{}),dr=function(r){return r.UseBlocker="useBlocker",r.UseLoaderData="useLoaderData",r.UseActionData="useActionData",r.UseRouteError="useRouteError",r.UseNavigation="useNavigation",r.UseRouteLoaderData="useRouteLoaderData",r.UseMatches="useMatches",r.UseRevalidator="useRevalidator",r.UseNavigateStable="useNavigate",r.UseRouteId="useRouteId",r}(dr||{});function Fa(r){let e=l.useContext(xn);return e||ue(!1),e}function Ma(r){let e=l.useContext(Ca);return e||ue(!1),e}function _a(r){let e=l.useContext(ft);return e||ue(!1),e}function Ps(r){let e=_a(),t=e.matches[e.matches.length-1];return t.route.id||ue(!1),t.route.id}function Oa(){var r;let e=l.useContext(Es),t=Ma(dr.UseRouteError),n=Ps(dr.UseRouteError);return e!==void 0?e:(r=t.errors)==null?void 0:r[n]}function Aa(){let{router:r}=Fa(Rs.UseNavigateStable),e=Ps(dr.UseNavigateStable),t=l.useRef(!1);return Ts(()=>{t.current=!0}),l.useCallback(function(i,a){a===void 0&&(a={}),t.current&&(typeof i=="number"?r.navigate(i):r.navigate(i,Bt({fromRouteId:e},a)))},[r,e])}const Un={};function La(r,e,t){!e&&!Un[r]&&(Un[r]=!0)}function Da(r,e){r==null||r.v7_startTransition,(r==null?void 0:r.v7_relativeSplatPath)===void 0&&(!e||e.v7_relativeSplatPath),e&&(e.v7_fetcherPersist,e.v7_normalizeFormMethod,e.v7_partialHydration,e.v7_skipActionErrorRevalidation)}function Bn(r){let{to:e,replace:t,state:n,relative:i}=r;qt()||ue(!1);let{future:a,static:o}=l.useContext(Vt),{matches:d}=l.useContext(ft),{pathname:c}=jt(),f=Is(),h=ks(e,Ss(d,a.v7_relativeSplatPath),c,i==="path"),u=JSON.stringify(h);return l.useEffect(()=>f(JSON.parse(u),{replace:t,state:n,relative:i}),[f,u,i,t,n]),null}function Xe(r){ue(!1)}function Wa(r){let{basename:e="/",children:t=null,location:n,navigationType:i=Ze.Pop,navigator:a,static:o=!1,future:d}=r;qt()&&ue(!1);let c=e.replace(/^\/*/,"/"),f=l.useMemo(()=>({basename:c,navigator:a,static:o,future:Bt({v7_relativeSplatPath:!1},d)}),[c,d,a,o]);typeof n=="string"&&(n=ht(n));let{pathname:h="/",search:u="",hash:y="",state:O=null,key:g="default"}=n,w=l.useMemo(()=>{let x=Cs(h,c);return x==null?null:{location:{pathname:x,search:u,hash:y,state:O,key:g},navigationType:i}},[c,h,u,y,O,g,i]);return w==null?null:l.createElement(Vt.Provider,{value:f},l.createElement(br.Provider,{children:t,value:w}))}function $n(r){let{children:e,location:t}=r;return ka(Zr(e),t)}new Promise(()=>{});function Zr(r,e){e===void 0&&(e=[]);let t=[];return l.Children.forEach(r,(n,i)=>{if(!l.isValidElement(n))return;let a=[...e,i];if(n.type===l.Fragment){t.push.apply(t,Zr(n.props.children,a));return}n.type!==Xe&&ue(!1),!n.props.index||!n.props.children||ue(!1);let o={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(o.children=Zr(n.props.children,a)),t.push(o)}),t}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */const Na="6";try{window.__reactRouterVersion=Na}catch{}const za="startTransition",Hn=Ui[za];function Ua(r){let{basename:e,children:t,future:n,window:i}=r,a=l.useRef();a.current==null&&(a.current=Ki({window:i,v5Compat:!0}));let o=a.current,[d,c]=l.useState({action:o.action,location:o.location}),{v7_startTransition:f}=n||{},h=l.useCallback(u=>{f&&Hn?Hn(()=>c(u)):c(u)},[c,f]);return l.useLayoutEffect(()=>o.listen(h),[o,h]),l.useEffect(()=>Da(n),[n]),l.createElement(Wa,{basename:e,children:t,location:d.location,navigationType:d.action,navigator:o,future:n})}var Vn;(function(r){r.UseScrollRestoration="useScrollRestoration",r.UseSubmit="useSubmit",r.UseSubmitFetcher="useSubmitFetcher",r.UseFetcher="useFetcher",r.useViewTransitionState="useViewTransitionState"})(Vn||(Vn={}));var qn;(function(r){r.UseFetcher="useFetcher",r.UseFetchers="useFetchers",r.UseScrollRestoration="useScrollRestoration"})(qn||(qn={}));const Dr=Si({palette:{mode:"light",primary:{main:"#76a6f6",light:"#a3c4f9",dark:"#4a7bc7",contrastText:"#FFFFFF"},secondary:{main:"#a3c4f9",light:"#d1e2fc",dark:"#76a6f6",contrastText:"#2C2C2C"},background:{default:"#FFFFFF",paper:"#FFFFFF",surface:"#FFFFFF"},surface:{main:"#FFFFFF",light:"#FFFFFF",dark:"#FFFFFF"},text:{primary:"#2C2C2C",secondary:"#5A5A5A",disabled:"#9E9E9E"},divider:"rgba(44, 44, 44, 0.12)",error:{main:"#D32F2F",light:"#EF5350",dark:"#C62828"},warning:{main:"#F57C00",light:"#FF9800",dark:"#E65100"},success:{main:"#388E3C",light:"#4CAF50",dark:"#2E7D32"},info:{main:"#76a6f6",light:"#a3c4f9",dark:"#4a7bc7"}},breakpoints:{values:{xs:0,sm:480,md:768,lg:1024,xl:1440}},typography:{fontFamily:'"Inter", "Roboto", "Helvetica", "Arial", sans-serif',h1:{fontSize:"1.75rem",fontWeight:700,letterSpacing:"-0.02em","@media (min-width:768px)":{fontSize:"2.5rem"}},h2:{fontSize:"1.5rem",fontWeight:600,letterSpacing:"-0.01em","@media (min-width:768px)":{fontSize:"2rem"}},h3:{fontSize:"1.25rem",fontWeight:600,letterSpacing:"-0.01em","@media (min-width:768px)":{fontSize:"1.75rem"}},h4:{fontSize:"1.125rem",fontWeight:600,letterSpacing:"-0.005em","@media (min-width:768px)":{fontSize:"1.5rem"}},h5:{fontSize:"1rem",fontWeight:600,"@media (min-width:768px)":{fontSize:"1.25rem"}},h6:{fontSize:"0.875rem",fontWeight:600,"@media (min-width:768px)":{fontSize:"1.125rem"}},body1:{fontSize:"0.875rem",lineHeight:1.6},body2:{fontSize:"0.75rem",lineHeight:1.5},button:{fontSize:"0.875rem",fontWeight:500,textTransform:"none",letterSpacing:"0.02em"},caption:{fontSize:"0.75rem",fontWeight:400,letterSpacing:"0.03em"}},shape:{borderRadius:12},shadows:["none","0px 1px 3px rgba(0, 0, 0, 0.1)","0px 1px 4px rgba(0, 0, 0, 0.1)","0px 2px 4px rgba(0, 0, 0, 0.1)","0px 2px 6px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 1px 3px rgba(0, 0, 0, 0.1)","0px 1px 4px rgba(0, 0, 0, 0.1)","0px 2px 4px rgba(0, 0, 0, 0.1)","0px 2px 6px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)","0px 3px 8px rgba(0, 0, 0, 0.1)"],components:{MuiCssBaseline:{styleOverrides:{body:{scrollbarWidth:"thin",scrollbarColor:"#76a6f6 #FFFFFF","&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{background:"#FFFFFF"},"&::-webkit-scrollbar-thumb":{background:"#76a6f6",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{background:"#4a7bc7"}}}},MuiButton:{styleOverrides:{root:{borderRadius:8,padding:"12px 24px",minHeight:"44px",transition:"all 0.2s ease-in-out","@media (max-width:768px)":{padding:"14px 28px",minHeight:"48px"}},contained:{backgroundColor:"#76a6f6",color:"#FFFFFF",boxShadow:"none","&:hover":{backgroundColor:"#4a7bc7",boxShadow:"none"}},outlined:{borderColor:"#76a6f6",backgroundColor:"#FFFFFF",color:"#76a6f6","&:hover":{borderColor:"#4a7bc7",backgroundColor:"#76a6f6",color:"#FFFFFF"}},text:{color:"#76a6f6","&:hover":{backgroundColor:"rgba(118, 166, 246, 0.04)"}}}},MuiCard:{styleOverrides:{root:{backgroundColor:"#FFFFFF",border:"1px solid #E0E0E0",borderRadius:16,boxShadow:"0px 1px 3px rgba(0, 0, 0, 0.1)",transition:"all 0.3s ease-in-out",padding:"16px","@media (min-width:768px)":{padding:"24px"},"&:hover":{boxShadow:"0px 2px 6px rgba(0, 0, 0, 0.1)"}}}},MuiPaper:{styleOverrides:{root:{backgroundColor:"#FFFFFF",border:"1px solid #E0E0E0"}}},MuiDrawer:{styleOverrides:{paper:{backgroundColor:"#FFFFFF",borderRight:"1px solid #E0E0E0"}}},MuiAppBar:{styleOverrides:{root:{backgroundColor:"#FFFFFF",borderBottom:"1px solid #E0E0E0",boxShadow:"none"}}},MuiListItemButton:{styleOverrides:{root:{borderRadius:8,margin:"4px 8px",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:"#F5F5F5"},"&.Mui-selected":{backgroundColor:"#F0F0F0",borderLeft:"3px solid #76a6f6","&:hover":{backgroundColor:"#E8E8E8"}}}}},MuiChip:{styleOverrides:{root:{backgroundColor:"#F5F5F5",border:"1px solid #E0E0E0"},filled:{backgroundColor:"#76a6f6",color:"#FFFFFF"},outlined:{borderColor:"#76a6f6",color:"#76a6f6"}}},MuiTextField:{styleOverrides:{root:{"& .MuiOutlinedInput-root":{backgroundColor:"#FFFFFF",borderRadius:8,"& fieldset":{borderColor:"#E0E0E0"},"&:hover fieldset":{borderColor:"#76a6f6"},"&.Mui-focused fieldset":{borderColor:"#76a6f6"}}}}}}}),Yn=U([s.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),s.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime"),Ba=U([s.jsx("path",{d:"M17 11c.34 0 .67.04 1 .09V6.27L10.5 3 3 6.27v4.91c0 4.54 3.2 8.79 7.5 9.82.55-.13 1.08-.32 1.6-.55-.69-.98-1.1-2.17-1.1-3.45 0-3.31 2.69-6 6-6"},"0"),s.jsx("path",{d:"M17 13c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m0 1.38c.62 0 1.12.51 1.12 1.12s-.51 1.12-1.12 1.12-1.12-.51-1.12-1.12.5-1.12 1.12-1.12m0 5.37c-.93 0-1.74-.46-2.24-1.17.05-.72 1.51-1.08 2.24-1.08s2.19.36 2.24 1.08c-.5.71-1.31 1.17-2.24 1.17"},"1")],"AdminPanelSettings"),$a=U(s.jsx("path",{d:"M7.5 5.6 10 7 8.6 4.5 10 2 7.5 3.4 5 2l1.4 2.5L5 7zm12 9.8L17 14l1.4 2.5L17 19l2.5-1.4L22 19l-1.4-2.5L22 14zM22 2l-2.5 1.4L17 2l1.4 2.5L17 7l2.5-1.4L22 7l-1.4-2.5zm-7.63 5.29a.9959.9959 0 0 0-1.41 0L1.29 18.96c-.39.39-.39 1.02 0 1.41l2.34 2.34c.39.39 1.02.39 1.41 0L16.7 11.05c.39-.39.39-1.02 0-1.41zm-1.03 5.49-2.12-2.12 2.44-2.44 2.12 2.12z"}),"AutoFixHigh"),Gn=U(s.jsx("path",{d:"M18 2H6c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 4h5v8l-2.5-1.5L6 12z"}),"Book"),Ha=U(s.jsx("path",{d:"M7 14c-1.66 0-3 1.34-3 3 0 1.31-1.16 2-2 2 .92 1.22 2.49 2 4 2 2.21 0 4-1.79 4-4 0-1.66-1.34-3-3-3m13.71-9.37-1.34-1.34a.9959.9959 0 0 0-1.41 0L9 12.25 11.75 15l8.96-8.96c.39-.39.39-1.02 0-1.41"}),"Brush"),Va=U(s.jsx("path",{d:"M20.01 15.38c-1.23 0-2.42-.2-3.53-.56-.35-.12-.74-.03-1.01.24l-1.57 1.97c-2.83-1.35-5.48-3.9-6.89-6.83l1.95-1.66c.27-.28.35-.67.24-1.02-.37-1.11-.56-2.3-.56-3.53 0-.54-.45-.99-.99-.99H4.19C3.65 3 3 3.24 3 3.99 3 13.28 10.73 21 20.01 21c.71 0 .99-.63.99-1.18v-3.45c0-.54-.45-.99-.99-.99"}),"Call"),bn=U(s.jsx("path",{d:"M12 9c-1.6 0-3.15.25-4.6.72v3.1c0 .39-.23.74-.56.9-.98.49-1.87 1.12-2.66 1.85-.18.18-.43.28-.7.28-.28 0-.53-.11-.71-.29L.29 13.08c-.18-.17-.29-.42-.29-.7 0-.28.11-.53.29-.71C3.34 8.78 7.46 7 12 7s8.66 1.78 11.71 4.67c.18.18.29.43.29.71 0 .28-.11.53-.29.71l-2.48 2.48c-.18.18-.43.29-.71.29-.27 0-.52-.11-.7-.28-.79-.74-1.69-1.36-2.67-1.85-.33-.16-.56-.5-.56-.9v-3.1C15.15 9.25 13.6 9 12 9"}),"CallEnd"),Zt=U(s.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2M6 9h12v2H6zm8 5H6v-2h8zm4-6H6V6h12z"}),"Chat"),Wr=U(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m-2 15-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8z"}),"CheckCircle"),yn=U(s.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle"),qa=U(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Clear"),ur=U(s.jsx("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),Ya=U(s.jsx("path",{d:"M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8m-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12m3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8m5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8m3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"ColorLens"),Ga=U(s.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34a.9959.9959 0 0 0-1.41 0l-1.83 1.83 3.75 3.75z"}),"Create"),Ja=U(s.jsx("path",{d:"M18 4H6c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 14H6V6h12z"}),"CropSquare"),Xa=U(s.jsx("path",{d:"M3 13h8V3H3zm0 8h8v-6H3zm10 0h8V11h-8zm0-18v6h8V3z"}),"Dashboard"),Ka=U(s.jsx("path",{d:"m18.85 10.39 1.06-1.06c.78-.78.78-2.05 0-2.83L18.5 5.09c-.78-.78-2.05-.78-2.83 0l-1.06 1.06zm-5.66-2.83L4 16.76V21h4.24l9.19-9.19zM19 17.5c0 2.19-2.54 3.5-5 3.5-.55 0-1-.45-1-1s.45-1 1-1c1.54 0 3-.73 3-1.5 0-.47-.48-.87-1.23-1.2l1.48-1.48c1.07.63 1.75 1.47 1.75 2.68M4.58 13.35C3.61 12.79 3 12.06 3 11c0-1.8 1.89-2.63 3.56-3.36C7.59 7.18 9 6.56 9 6c0-.41-.78-1-2-1-1.26 0-1.8.61-1.83.64-.35.41-.98.46-1.4.12-.41-.34-.49-.95-.15-1.38C3.73 4.24 4.76 3 7 3s4 1.32 4 3c0 1.87-1.93 2.72-3.64 3.47C6.42 9.88 5 10.5 5 11c0 .31.43.6 1.07.86z"}),"Draw"),Qa=U(s.jsx("path",{d:"M20 4H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2m0 4-8 5-8-5V6l8 5 8-5z"}),"Email"),Za=U(s.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M8.5 8c.83 0 1.5.67 1.5 1.5S9.33 11 8.5 11 7 10.33 7 9.5 7.67 8 8.5 8M12 18c-2.28 0-4.22-1.66-5-4h10c-.78 2.34-2.72 4-5 4m3.5-7c-.83 0-1.5-.67-1.5-1.5S14.67 8 15.5 8s1.5.67 1.5 1.5-.67 1.5-1.5 1.5"}),"EmojiEmotions"),eo=U(s.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),en=U(s.jsx("path",{d:"M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9m-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8z"}),"History"),to=U(s.jsx("path",{d:"M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2m-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2m3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1z"}),"Lock"),ro=U(s.jsx("path",{d:"m17 7-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4z"}),"Logout"),Fs=U(s.jsx("path",{d:"M3 18h18v-2H3zm0-5h18v-2H3zm0-7v2h18V6z"}),"Menu"),tn=U(s.jsx("path",{d:"M20 2H4c-1.1 0-1.99.9-1.99 2L2 22l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2m-2 12H6v-2h12zm0-3H6V9h12zm0-3H6V6h12z"}),"Message"),Ms=U(s.jsx("path",{d:"M12 14c1.66 0 2.99-1.34 2.99-3L15 5c0-1.66-1.34-3-3-3S9 3.34 9 5v6c0 1.66 1.34 3 3 3m5.3-3c0 3-2.54 5.1-5.3 5.1S6.7 14 6.7 11H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c3.28-.48 6-3.3 6-6.72z"}),"Mic"),_s=U(s.jsx("path",{d:"M19 11h-1.7c0 .74-.16 1.43-.43 2.05l1.23 1.23c.56-.98.9-2.09.9-3.28m-4.02.17c0-.06.02-.11.02-.17V5c0-1.66-1.34-3-3-3S9 3.34 9 5v.18zM4.27 3 3 4.27l6.01 6.01V11c0 1.66 1.33 3 2.99 3 .22 0 .44-.03.65-.08l1.66 1.66c-.71.33-1.5.52-2.31.52-2.76 0-5.3-2.1-5.3-5.1H5c0 3.41 2.72 6.23 6 6.72V21h2v-3.28c.91-.13 1.77-.45 2.54-.9L19.73 21 21 19.73z"}),"MicOff"),no=U(s.jsx("path",{d:"M12 8c1.1 0 2-.9 2-2s-.9-2-2-2-2 .9-2 2 .9 2 2 2m0 2c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2m0 6c-1.1 0-2 .9-2 2s.9 2 2 2 2-.9 2-2-.9-2-2-2"}),"MoreVert"),so=U(s.jsx("path",{d:"M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2m6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1z"}),"Notifications"),io=U(s.jsx("path",{d:"M23 5.5V20c0 2.2-1.8 4-4 4h-7.3c-1.08 0-2.1-.43-2.85-1.19L1 14.83s1.26-1.23 1.3-1.25c.22-.19.49-.29.79-.29.22 0 .42.06.6.16.04.01 4.31 2.46 4.31 2.46V4c0-.83.67-1.5 1.5-1.5S11 3.17 11 4v7h1V1.5c0-.83.67-1.5 1.5-1.5S15 .67 15 1.5V11h1V2.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5V11h1V5.5c0-.83.67-1.5 1.5-1.5s1.5.67 1.5 1.5"}),"PanTool"),Lt=U(s.jsx("path",{d:"M12 12c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4m0 2c-2.67 0-8 1.34-8 4v2h16v-2c0-2.66-5.33-4-8-4"}),"Person"),ao=U(s.jsx("path",{d:"M18.4 10.6C16.55 8.99 14.15 8 11.5 8c-4.65 0-8.58 3.03-9.96 7.22L3.9 16c1.05-3.19 4.05-5.5 7.6-5.5 1.95 0 3.73.72 5.12 1.88L13 16h9V7z"}),"Redo"),Os=U(s.jsx("path",{d:"M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4z"}),"Refresh"),Jn=U(s.jsx("path",{d:"M17 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V7zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3m3-10H5V5h10z"}),"Save"),er=U([s.jsx("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2M12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8"},"0"),s.jsx("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"Schedule"),oo=U(s.jsx("path",{d:"M5 13.18v4L12 21l7-3.82v-4L12 17zM12 3 1 9l11 6 9-4.91V17h2V9z"}),"School"),co=U(s.jsx("path",{d:"M16.48 2.52c3.27 1.55 5.61 4.72 5.97 8.48h1.5C23.44 4.84 18.29 0 12 0l-.66.03 3.81 3.81zm-6.25-.77c-.59-.59-1.54-.59-2.12 0L1.75 8.11c-.59.59-.59 1.54 0 2.12l12.02 12.02c.59.59 1.54.59 2.12 0l6.36-6.36c.59-.59.59-1.54 0-2.12zm4.6 19.44L2.81 9.17l6.36-6.36 12.02 12.02zm-7.31.29C4.25 19.94 1.91 16.76 1.55 13H.05C.56 19.16 5.71 24 12 24l.66-.03-3.81-3.81z"}),"ScreenRotation"),lo=U(s.jsx("path",{d:"M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.11-.9-2-2-2H4c-1.11 0-2 .89-2 2v10c0 1.1.89 2 2 2H0v2h24v-2zm-7-3.53v-2.19c-2.78 0-4.61.85-6 2.72.56-2.67 2.11-5.33 6-5.87V7l4 3.73z"}),"ScreenShare"),As=U(s.jsx("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),uo=U(s.jsx("path",{d:"M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6"}),"Settings"),ho=U(s.jsx("path",{d:"m21.22 18.02 2 2H24v-2zm.77-2 .01-10c0-1.11-.9-2-2-2H7.22l5.23 5.23c.18-.04.36-.07.55-.1V7.02l4 3.73-1.58 1.47 5.54 5.54c.61-.33 1.03-.99 1.03-1.74M2.39 1.73 1.11 3l1.54 1.54c-.4.36-.65.89-.65 1.48v10c0 1.1.89 2 2 2H0v2h18.13l2.71 2.71 1.27-1.27zM7 15.02c.31-1.48.92-2.95 2.07-4.06l1.59 1.59c-1.54.38-2.7 1.18-3.66 2.47"}),"StopScreenShare"),fo=U(s.jsx("path",{d:"M2.5 4v3h5v12h3V7h5V4zm19 5h-9v3h3v7h3v-7h3z"}),"TextFields"),po=U(s.jsx("path",{d:"M23 8c0 1.1-.9 2-2 2-.18 0-.35-.02-.51-.07l-3.56 3.55c.05.16.07.34.07.52 0 1.1-.9 2-2 2s-2-.9-2-2c0-.18.02-.36.07-.52l-2.55-2.55c-.16.05-.34.07-.52.07s-.36-.02-.52-.07l-4.55 4.56c.05.16.07.33.07.51 0 1.1-.9 2-2 2s-2-.9-2-2 .9-2 2-2c.18 0 .35.02.51.07l4.56-4.55C8.02 9.36 8 9.18 8 9c0-1.1.9-2 2-2s2 .9 2 2c0 .18-.02.36-.07.52l2.55 2.55c.16-.05.34-.07.52-.07s.36.02.52.07l3.55-3.56C19.02 8.35 19 8.18 19 8c0-1.1.9-2 2-2s2 .9 2 2"}),"Timeline"),mo=U(s.jsx("path",{d:"m16 18 2.29-2.29-4.88-4.88-4 4L2 7.41 3.41 6l6 6 4-4 6.3 6.29L22 12v6z"}),"TrendingDown"),Nr=U(s.jsx("path",{d:"m16 6 2.29 2.29-4.88 4.88-4-4L2 16.59 3.41 18l6-6 4 4 6.3-6.29L22 12V6z"}),"TrendingUp"),go=U(s.jsx("path",{d:"M12.5 8c-2.65 0-5.05.99-6.9 2.6L2 7v9h9l-3.62-3.62c1.39-1.16 3.16-1.88 5.12-1.88 3.54 0 6.55 2.31 7.6 5.5l2.37-.78C21.08 11.03 17.15 8 12.5 8"}),"Undo"),tr=U(s.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11zM14 13h-3v3H9v-3H6v-2h3V8h2v3h3z"}),"VideoCall"),wn=U(s.jsx("path",{d:"M17 10.5V7c0-.55-.45-1-1-1H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.55 0 1-.45 1-1v-3.5l4 4v-11z"}),"Videocam"),rn=U(s.jsx("path",{d:"m21 6.5-4 4V7c0-.55-.45-1-1-1H9.82L21 17.18zM3.27 2 2 3.27 4.73 6H4c-.55 0-1 .45-1 1v10c0 .55.45 1 1 1h12c.21 0 .39-.08.54-.18L19.73 21 21 19.73z"}),"VideocamOff"),xo=U(s.jsx("path",{d:"M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5M12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5m0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3"}),"Visibility"),bo=U(s.jsx("path",{d:"M18.5 12c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M5 9v6h4l5 5V4L9 9z"}),"VolumeDown"),yo=U(s.jsx("path",{d:"M3 9v6h4l5 5V4L7 9zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02M14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77"}),"VolumeUp");function wo({onLogin:r}){const[e,t]=l.useState({email:"",password:""}),[n,i]=l.useState(!1),[a,o]=l.useState(""),d=async f=>{f.preventDefault(),o(""),i(!0);try{const h=await r(e.email,e.password);h.success||o(h.error||"Login failed")}catch{o("An unexpected error occurred")}finally{i(!1)}},c=f=>{t({...e,[f.target.name]:f.target.value})};return s.jsxs(p,{sx:{minHeight:"100vh",display:"flex",flexDirection:"column",background:"linear-gradient(135deg, #667eea 0%, #764ba2 100%)"},children:[s.jsxs(p,{sx:{flex:"1 1 auto",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",textAlign:"center",px:3,py:6,minHeight:{xs:"40vh",sm:"50vh"}},children:[s.jsx(p,{component:"img",src:"/Tarteele-Quran-Logo-only.JPG",alt:"Tarteel-e-Quran Logo",sx:{width:{xs:120,sm:150},height:{xs:120,sm:150},objectFit:"contain",margin:"0 auto",mb:3,display:"block",borderRadius:3,boxShadow:"0 8px 32px rgba(255, 255, 255, 0.2)"}}),s.jsx(S,{variant:"h3",gutterBottom:!0,sx:{fontWeight:700,color:"#FFFFFF",mb:1},children:"Tarteel-e-Quran"}),s.jsx(S,{variant:"h5",gutterBottom:!0,sx:{fontWeight:500,color:"rgba(255, 255, 255, 0.9)",mb:2},children:"Student Portal"}),s.jsx(S,{variant:"h6",sx:{color:"rgba(255, 255, 255, 0.8)",fontWeight:300},children:"Welcome! Sign in to access your classes"})]}),s.jsxs(p,{sx:{backgroundColor:"#FFFFFF",borderRadius:{xs:0,sm:"28px 28px 0 0"},px:{xs:3,sm:4},py:{xs:4,sm:5},boxShadow:"0 -4px 20px rgba(0, 0, 0, 0.1)",minHeight:{xs:"60vh",sm:"auto"}},children:[a&&s.jsx(vt,{severity:"error",sx:{mb:3,width:"100%"},children:a}),s.jsxs(p,{component:"form",onSubmit:d,sx:{maxWidth:400,mx:"auto",width:"100%"},children:[s.jsx(We,{fullWidth:!0,label:"Email",name:"email",type:"email",value:e.email,onChange:c,margin:"normal",required:!0,autoFocus:!0,sx:{mb:2,"& .MuiOutlinedInput-root":{backgroundColor:"#FFFFFF",borderRadius:"12px","& fieldset":{borderColor:"#E0E0E0",borderWidth:"2px"},"&:hover fieldset":{borderColor:"#76a6f6"},"&.Mui-focused fieldset":{borderColor:"#76a6f6",borderWidth:"2px"}}},InputProps:{startAdornment:s.jsx(Qa,{sx:{color:"action.active",mr:1}})}}),s.jsx(We,{fullWidth:!0,label:"Password",name:"password",type:"password",value:e.password,onChange:c,margin:"normal",required:!0,sx:{mb:2,"& .MuiOutlinedInput-root":{backgroundColor:"#FFFFFF",borderRadius:"12px","& fieldset":{borderColor:"#E0E0E0",borderWidth:"2px"},"&:hover fieldset":{borderColor:"#76a6f6"},"&.Mui-focused fieldset":{borderColor:"#76a6f6",borderWidth:"2px"}}},InputProps:{startAdornment:s.jsx(to,{sx:{color:"action.active",mr:1}})}}),s.jsx(Ae,{type:"submit",fullWidth:!0,variant:"contained",size:"large",disabled:n,sx:{mt:2,mb:2,py:1.5,borderRadius:"12px",backgroundColor:"#76a6f6",color:"#FFFFFF",fontWeight:600,fontSize:"1rem",boxShadow:"0 4px 12px rgba(118, 166, 246, 0.3)",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{backgroundColor:"#4a7bc7",transform:"translateY(-2px)",boxShadow:"0 8px 20px rgba(118, 166, 246, 0.4)"},"&:active":{transform:"translateY(0px)",boxShadow:"0 4px 12px rgba(118, 166, 246, 0.3)"},"&:disabled":{backgroundColor:"#BDBDBD",color:"#757575",boxShadow:"none",transform:"none"}},children:n?s.jsx(pr,{size:24,color:"inherit"}):"Sign In"})]})]})]})}const vo="modulepreload",Co=function(r,e){return new URL(r,e).href},Xn={},lt=function(e,t,n){if(!t||t.length===0)return e();const i=document.getElementsByTagName("link");return Promise.all(t.map(a=>{if(a=Co(a,n),a in Xn)return;Xn[a]=!0;const o=a.endsWith(".css"),d=o?'[rel="stylesheet"]':"";if(!!n)for(let h=i.length-1;h>=0;h--){const u=i[h];if(u.href===a&&(!o||u.rel==="stylesheet"))return}else if(document.querySelector(`link[href="${a}"]${d}`))return;const f=document.createElement("link");if(f.rel=o?"stylesheet":vo,o||(f.as="script",f.crossOrigin=""),f.href=a,document.head.appendChild(f),o)return new Promise((h,u)=>{f.addEventListener("load",h),f.addEventListener("error",()=>u(new Error(`Unable to preload CSS for ${a}`)))})})).then(()=>e()).catch(a=>{const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a})},So={apiKey:"AIzaSyDrXbi2vqMua2jwvoEOsdEccUEGZAonIS4",authDomain:"tarteel-quran.firebaseapp.com",projectId:"tarteel-quran",storageBucket:"tarteel-quran.firebasestorage.app",messagingSenderId:"51402909238",appId:"1:51402909238:web:c4160931526c345c7a9a97",measurementId:"G-RDWBDV3HJ3"},vn=Bi(So),ce=$i(vn),Ce=Hi(vn),Ls=Object.freeze(Object.defineProperty({__proto__:null,auth:Ce,db:ce,default:vn},Symbol.toStringTag,{value:"Module"}));class ko{constructor(){this.usersCollection=lr(ce,"users"),this.auth=Ce}async getUserById(e){try{const t=await Te(fe(ce,"users",e));return t.exists()?{success:!0,user:{id:t.id,...t.data()}}:{success:!1,error:"User not found"}}catch(t){return console.error("Error fetching user:",t),{success:!1,error:t.message}}}async getMyTeacher(e){try{const t=await Te(fe(ce,"users",e));if(!t.exists())return{success:!1,error:"Student not found"};const i=t.data().assignedTeacher;if(!i)return{success:!1,error:"No teacher assigned to this student"};const a=await Te(fe(ce,"users",i));if(!a.exists())return{success:!1,error:"Assigned teacher not found"};const o=a.data();return{success:!0,teacher:{id:a.id,...o}}}catch(t){return console.error("Error fetching assigned teacher:",t),{success:!1,error:t.message}}}async getAllUsers(){try{const e=Ue(this.usersCollection,ot("createdAt","desc"));return{success:!0,users:(await St(e)).docs.map(i=>({id:i.id,...i.data()}))}}catch(e){return console.error("Error fetching users:",e),{success:!1,error:e.message}}}async getUsersByRole(e){try{const t=Ue(this.usersCollection,Se("role","==",e),ot("createdAt","desc"));return{success:!0,users:(await St(t)).docs.map(a=>({id:a.id,...a.data()}))}}catch(t){return console.error(`Error fetching users with role ${e}:`,t),{success:!1,error:t.message}}}async setOnlineStatus(e=!0){var t;try{const n=this.auth.currentUser;if(!n)return console.warn("‚ùå Cannot set online status: No authenticated user"),{success:!1,error:"User must be authenticated"};const i=fe(this.usersCollection,n.uid);return await tt(i,{isOnline:e,lastSeen:je(),updatedAt:je()}),{success:!0}}catch(n){return console.error("‚ùå Error updating online status:",n),console.error("‚ùå Error details:",{code:n.code,message:n.message,userId:(t=this.auth.currentUser)==null?void 0:t.uid}),{success:!1,error:n.message}}}async setOnline(){return this.setOnlineStatus(!0)}async setOffline(){return this.setOnlineStatus(!1)}setupOnlineStatusTracking(){const e=this.auth.currentUser;if(!e){console.warn("‚ùå Cannot setup online tracking: user not authenticated");return}const t=5*60*1e3;let n=null;const i=()=>{this.setOnline()},a=()=>{this.setOffline()};return window.addEventListener("online",i),window.addEventListener("offline",a),window.addEventListener("beforeunload",a),this.setOnline(),n=setInterval(async()=>{try{const o=fe(this.usersCollection,e.uid);await tt(o,{lastSeen:je(),updatedAt:je()})}catch(o){console.error("üíì Heartbeat update failed:",o)}},t),()=>{n&&clearInterval(n),window.removeEventListener("online",i),window.removeEventListener("offline",a),window.removeEventListener("beforeunload",a),this.setOffline()}}}const Ne=new ko,Kn=Object.freeze(Object.defineProperty({__proto__:null,default:Ne},Symbol.toStringTag,{value:"Module"}));class jo{constructor(){this.db=ce,this.auth=Ce,this.messagesCollection=lr(ce,"messages"),this.conversationsCollection=lr(ce,"conversations")}async sendMessage(e,t,n="text",i={}){try{const a=this.auth.currentUser;if(!a)throw new Error("User must be authenticated to send messages");const[o,d]=await Promise.all([Te(fe(ce,"users",a.uid)),Te(fe(ce,"users",e))]);if(!o.exists()||!d.exists())throw new Error("User not found");const c=o.data(),f=d.data(),h=await this.createOrGetConversation(a.uid,e,c,f),u={senderId:a.uid,receiverId:e,content:t.trim(),type:n,conversationId:h,senderRole:c.role||"student",receiverRole:f.role||"teacher",timestamp:je(),createdAt:new Date().toISOString(),isRead:!1,metadata:{senderName:c.username||c.name||"Unknown",receiverName:f.username||f.name||"Unknown",...i}},y=await bs(this.messagesCollection,u);return await this.updateConversationLastMessage(h,t,a.uid),{success:!0,messageId:y.id,conversationId:h,message:"Message sent successfully"}}catch(a){return console.error("‚ùå Failed to send message:",a),{success:!1,error:a.message}}}async createOrGetConversation(e,t,n,i){const a=[e,t].sort(),o=a.join("_");try{if(!(await Te(fe(ce,"conversations",o))).exists()){const c={id:o,participants:a,participantRoles:[n.role||"student",i.role||"teacher"],participantNames:[n.username||n.name||"Unknown",i.username||i.name||"Unknown"],lastMessage:"",lastMessageTime:je(),createdAt:je(),unreadCount:{[e]:0,[t]:0}};await Vi(fe(ce,"conversations",o),c)}return o}catch(d){throw console.error("‚ùå Error creating/getting conversation:",d),d}}async updateConversationLastMessage(e,t,n){try{const i=fe(ce,"conversations",e),a=await Te(i);if(a.exists()){const o=a.data(),d={...o.unreadCount};o.participants.forEach(c=>{c!==n&&(d[c]=(d[c]||0)+1)}),await tt(i,{lastMessage:t.substring(0,100),lastMessageTime:je(),unreadCount:d})}}catch(i){console.error("‚ùå Error updating conversation:",i)}}getConversations(e){const t=this.auth.currentUser;if(!t)return console.error("User must be authenticated to get conversations"),e([]),()=>{};const n=Ue(this.conversationsCollection,Se("participants","array-contains",t.uid),ot("lastMessageTime","desc"));return Xr(n,i=>{if(!this.auth.currentUser){e([]);return}const a=i.docs.map(o=>({id:o.id,...o.data()}));e(a)},i=>{console.error("‚ùå Error listening to conversations:",i),i.code,e([])})}getMessages(e,t){if(!e)return console.error("Conversation ID is required"),t([]),()=>{};if(!this.auth.currentUser)return console.error("User must be authenticated to get messages"),t([]),()=>{};const i=Ue(this.messagesCollection,Se("conversationId","==",e),ot("timestamp","asc"));return Xr(i,a=>{if(!this.auth.currentUser){t([]);return}const o=a.docs.map(d=>({id:d.id,...d.data()}));t(o)},a=>{console.error("‚ùå Error listening to messages:",a),a.code,t([])})}async markAsRead(e,t=null){try{const n=this.auth.currentUser,i=t||(n==null?void 0:n.uid);if(!i)throw new Error("User must be authenticated");const a=Ue(this.messagesCollection,Se("conversationId","==",e),Se("receiverId","==",i),Se("isRead","==",!1)),o=await St(a),d=[];if(o.docs.forEach(c=>{d.push(tt(c.ref,{isRead:!0}))}),d.length>0){await Promise.all(d);const c=fe(ce,"conversations",e),f=await Te(c);if(f.exists()){const u={...f.data().unreadCount};u[i]=0,await tt(c,{unreadCount:u})}}return{success:!0,markedCount:d.length}}catch(n){return console.error("‚ùå Error marking messages as read:",n),{success:!1,error:n.message}}}async getRecentMessages(e=10){try{const t=this.auth.currentUser;if(!t)return{success:!1,error:"User not authenticated"};const n=Ue(this.messagesCollection,Se("receiverId","==",t.uid),ot("timestamp","desc")),a=(await St(n)).docs.slice(0,e).map(d=>({id:d.id,...d.data()})),o=a.filter(d=>!d.isRead).length;return{success:!0,messages:a,totalCount:a.length,unreadCount:o}}catch(t){return console.error("‚ùå Error getting recent messages:",t),{success:!1,error:t.message}}}}const Dt=new jo;class Eo{constructor(){this.auth=Ce,this.callsCollection=lr(ce,"calls")}async startCall(e,t,n="video"){try{const i=this.auth.currentUser;if(!i)throw new Error("User must be authenticated to start a call");const a={studentId:i.uid,teacherId:e,teacherName:t||"Unknown Teacher",callType:n,status:"started",startTime:je(),endTime:null,duration:0,createdAt:je(),updatedAt:je()},o=await bs(this.callsCollection,a);return{success:!0,callId:o.id,call:{id:o.id,...a}}}catch(i){return console.error("‚ùå Error starting call log:",i),{success:!1,error:i.message}}}async endCall(e,t="completed"){try{if(!e)return console.warn("No call ID provided to end call"),{success:!1,error:"Call ID required"};const n=qi.now(),i=fe(this.callsCollection,e),a={status:t==="rejected"?"rejected":"completed",endTime:n,endReason:t,updatedAt:je()};return await tt(i,a),{success:!0,callId:e}}catch(n){return console.error("‚ùå Error ending call:",n),{success:!1,error:n.message}}}async updateCallDuration(e,t){try{if(!e)return{success:!1,error:"Call ID required"};const n=fe(this.callsCollection,e);return await tt(n,{duration:t,updatedAt:je()}),{success:!0}}catch(n){return console.error("‚ùå Error updating call duration:",n),{success:!1,error:n.message}}}async getMyCallCount(e="all"){try{const t=this.auth.currentUser;if(!t)return{success:!1,error:"User must be authenticated"};let n;return e==="all"?n=Ue(this.callsCollection,Se("studentId","==",t.uid)):n=Ue(this.callsCollection,Se("studentId","==",t.uid),Se("status","==",e)),{success:!0,count:(await St(n)).size}}catch(t){return console.error("‚ùå Error getting call count:",t),{success:!1,error:t.message}}}async getMyCallHistory(e=10,t=1,n="all"){try{const i=this.auth.currentUser;if(!i)return{success:!1,error:"User must be authenticated"};const a=(t-1)*e;let o;return n==="all"?o=Ue(this.callsCollection,Se("studentId","==",i.uid),ot("startTime","desc"),On(e+a)):o=Ue(this.callsCollection,Se("studentId","==",i.uid),Se("status","==",n),ot("startTime","desc"),On(e+a)),{success:!0,calls:(await St(o)).docs.map(h=>{var u,y,O,g;return{id:h.id,callId:h.id,...h.data(),startTime:(u=h.data().startTime)==null?void 0:u.toDate(),endTime:(y=h.data().endTime)==null?void 0:y.toDate(),createdAt:(O=h.data().createdAt)==null?void 0:O.toDate(),updatedAt:(g=h.data().updatedAt)==null?void 0:g.toDate()}}).slice(a,a+e)}}catch(i){return console.error("‚ùå Error getting call history:",i),{success:!1,error:i.message,calls:[]}}}async getMyCallStats(){try{const e=await this.getMyCallHistory(1e3,1,"all");if(!e.success)return e;const t=e.calls,n=new Date,i=t.length,a=new Date(n);a.setDate(n.getDate()-n.getDay()+1),a.setHours(0,0,0,0);const o=t.filter(w=>w.startTime&&w.startTime>=a).length,d=new Date(n.getFullYear(),n.getMonth(),1),c=t.filter(w=>w.startTime&&w.startTime>=d).length,f=t.filter(w=>w.status==="ended"||w.status==="completed").length,h=i>0?Math.round(f/i*100):0,u=t.filter(w=>(w.status==="ended"||w.status==="completed")&&w.duration),y=u.reduce((w,x)=>w+(x.duration||0),0),O=u.length>0?y/u.length:0;return{success:!0,stats:{totalCalls:i,callsThisWeek:o,callsThisMonth:c,successRate:h,successfulCalls:f,rejectedCalls:t.filter(w=>w.status==="rejected").length,failedCalls:t.filter(w=>w.status==="failed").length,totalDuration:y,averageDuration:O,totalRecordingSize:t.reduce((w,x)=>w+(x.recording&&x.recording.totalSize?x.recording.totalSize:0),0)}}}catch(e){return console.error("‚ùå Error calculating call stats:",e),{success:!1,error:e.message,stats:{totalCalls:0,callsThisWeek:0,callsThisMonth:0,successRate:0,successfulCalls:0,rejectedCalls:0,failedCalls:0,totalDuration:0,averageDuration:0,totalRecordingSize:0}}}}}const ze=new Eo;function To({user:r,webrtcService:e}){var j,I;const t=Ie(),n=ut(t.breakpoints.down("md")),[i,a]=l.useState(!0),[o,d]=l.useState(!1),[c,f]=l.useState(null),[h,u]=l.useState([]),[y,O]=l.useState([]),[g,w]=l.useState({totalClasses:0,unreadMessages:0,callsThisWeek:0,callsThisMonth:0,successRate:0,previousWeekClasses:0});l.useEffect(()=>(x(),()=>{window.dashboardConversationsUnsubscribe&&(window.dashboardConversationsUnsubscribe(),window.dashboardConversationsUnsubscribe=null),window.teacherStatusUnsubscribe&&(window.teacherStatusUnsubscribe(),window.teacherStatusUnsubscribe=null)}),[]);const x=async()=>{try{if(a(!0),!(r!=null&&r.id)){console.warn("No user ID available for loading dashboard data");return}const F=await Ne.getMyTeacher(r.id);if(F.success){f(F.teacher);const{doc:B,onSnapshot:$}=await lt(()=>import("./firebase-f79b6b7d.js").then(k=>k.t),[],import.meta.url),{db:b}=await lt(()=>Promise.resolve().then(()=>Ls),void 0,import.meta.url);if(F.teacher.id){const k=B(b,"users",F.teacher.id),L=$(k,T=>{if(T.exists()){const D={id:T.id,...T.data()};f(D)}});window.teacherStatusUnsubscribe=L}}try{const B=Dt.getConversations($=>{const k=$.slice(0,3).map(T=>{var D,_,Y;return{id:T.id,content:T.lastMessage||"No messages yet",senderId:"Teacher",timestamp:((_=(D=T.lastMessageTime)==null?void 0:D.toDate)==null?void 0:_.call(D))||new Date,isRead:((Y=T.unreadCount)==null?void 0:Y[r.id])===0}});u(k);const L=$.reduce((T,D)=>{var _;return T+(((_=D.unreadCount)==null?void 0:_[r.id])||0)},0);w(T=>({...T,unreadMessages:L}))});window.dashboardConversationsUnsubscribe=B}catch(B){console.error("Failed to setup messages listener:",B),u([])}try{const B=await ze.getMyCallStats();if(B.success){const $=B.stats,b=new Date;b.setDate(b.getDate()-14);const k=await ze.getMyCallHistory(200),L=k.success?k.calls.filter(T=>{const D=T.startTime,_=new Date;return _.setDate(_.getDate()-7),D&&D>=b&&D<_}).length:0;w(T=>({...T,totalClasses:$.totalCalls,callsThisWeek:$.callsThisWeek,callsThisMonth:$.callsThisMonth,successRate:$.successRate,previousWeekClasses:L}))}}catch(B){console.error("Failed to load call statistics:",B),w($=>({...$,totalClasses:0,callsThisWeek:0,callsThisMonth:0,successRate:0,previousWeekClasses:0}))}O([])}catch(F){console.error("Failed to load dashboard data:",F)}finally{a(!1)}},N=()=>{window.location.href="#/messages"};function R({icon:F,title:B,value:$,change:b,color:k,subtitle:L,onClick:T,compact:D=!1}){const _=Ie(),Y=b>=0;return s.jsxs(qe,{sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:"90px",md:"auto"},background:`linear-gradient(135deg, ${v(k,.1)} 0%, ${v(k,.05)} 100%)`,border:`1px solid ${v(k,.2)}`,position:"relative",overflow:"hidden",transition:"all 0.3s ease-in-out",cursor:T?"pointer":"default","&:hover":{transform:{xs:"none",md:"translateY(-4px)"},boxShadow:{xs:"none",md:`0 12px 32px ${v(k,.3)}`},border:{xs:`1px solid ${v(k,.2)}`,md:`1px solid ${v(k,.4)}`}}},onClick:T,children:[s.jsx(et,{sx:{p:{xs:.8,md:3}},children:s.jsxs(p,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:{xs:1,md:2}},children:[s.jsxs(p,{children:[s.jsx(p,{sx:{width:{xs:24,md:48},height:{xs:24,md:48},borderRadius:2,background:`linear-gradient(135deg, ${k} 0%, ${v(k,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mb:{xs:.8,md:2},boxShadow:`0 4px 16px ${v(k,.4)}`},children:Ht.cloneElement(F,{sx:{...F.props.sx,fontSize:{xs:14,md:24}}})}),s.jsx(S,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5,fontSize:{xs:"0.6rem",md:"0.75rem"},lineHeight:1.2},children:B}),s.jsx(S,{variant:"h4",sx:{fontWeight:700,mt:.2,mb:.3,fontSize:{xs:"1rem",md:"2.125rem"},lineHeight:1},children:typeof $=="number"?$.toLocaleString():$}),L&&s.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.55rem",md:"0.75rem"},lineHeight:1.2,opacity:.8},children:L})]}),b!==void 0&&s.jsxs(p,{sx:{display:{xs:"none",sm:"flex"},alignItems:"center",justifyContent:"center",px:{xs:.8,md:1.2},py:{xs:.2,md:.4},borderRadius:1,backgroundColor:Y?v(_.palette.success.main,.1):v(_.palette.error.main,.1),color:Y?_.palette.success.main:_.palette.error.main,border:`1px solid ${Y?v(_.palette.success.main,.3):v(_.palette.error.main,.3)}`,fontSize:{xs:"0.55rem",md:"0.75rem"},fontWeight:600,lineHeight:1},children:[Y?s.jsx(Nr,{sx:{fontSize:{xs:10,md:14},mr:.3}}):s.jsx(mo,{sx:{fontSize:{xs:10,md:14},mr:.3}}),`${Y?"+":""}${b}%`]})]})}),s.jsx(p,{sx:{display:{xs:"none",md:"block"},position:"absolute",right:-24,bottom:-24,width:96,height:96,borderRadius:"50%",background:`radial-gradient(circle, ${v(k,.1)} 0%, transparent 70%)`}})]})}return i?s.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:s.jsx(pr,{})}):s.jsxs(p,{children:[s.jsxs(p,{sx:{mb:{xs:2,md:4},display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs(p,{children:[s.jsxs(S,{variant:"h4",sx:{fontWeight:700,mb:{xs:.5,md:1},fontSize:{xs:"1.5rem",md:"2.125rem"}},children:["Good day, ",r==null?void 0:r.username,"!"]}),s.jsx(S,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",md:"0.875rem"}},children:"Ready for today's learning session?"})]}),s.jsx(Ve,{title:"Refresh dashboard",children:s.jsx(se,{onClick:async()=>{d(!0),await x(),setTimeout(()=>d(!1),1e3)},sx:{backgroundColor:v(t.palette.primary.main,.1),"&:hover":{backgroundColor:v(t.palette.primary.main,.2)}},children:s.jsx(Os,{sx:{fontSize:20,animation:o?"spin 1s linear infinite":"none","@keyframes spin":{"0%":{transform:"rotate(0deg)"},"100%":{transform:"rotate(360deg)"}}}})})})]}),n?s.jsxs(p,{sx:{mb:{xs:2,md:3},mx:-2,px:2,overflow:"hidden"},children:[s.jsxs(p,{sx:{display:"flex",gap:1,overflowX:"auto",pb:1,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",WebkitOverflowScrolling:"touch"},children:[s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(R,{icon:s.jsx(Gn,{sx:{color:"white"}}),title:"Total Classes",value:g.totalClasses,change:g.previousWeekClasses>0?Math.round((g.callsThisWeek-g.previousWeekClasses)/g.previousWeekClasses*100):g.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:`${g.callsThisMonth} this month`})}),s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(R,{icon:s.jsx(Yn,{sx:{color:"white"}}),title:"This Week",value:g.callsThisWeek,change:g.previousWeekClasses>0?Math.round((g.callsThisWeek-g.previousWeekClasses)/g.previousWeekClasses*100):g.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:"Classes attended"})}),s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(R,{icon:s.jsx(tn,{sx:{color:"white"}}),title:"New Messages",value:g.unreadMessages,change:void 0,color:t.palette.primary.main,subtitle:"From teacher",onClick:()=>window.location.href="#/messages"})}),s.jsx(p,{sx:{minWidth:"140px",flex:"0 0 auto"},children:s.jsx(R,{icon:s.jsx(Nr,{sx:{color:"white"}}),title:"Success Rate",value:`${g.successRate}%`,change:g.callsThisWeek>g.previousWeekClasses?Math.round((g.callsThisWeek-g.previousWeekClasses)/Math.max(g.previousWeekClasses,1)*100):0,color:t.palette.primary.main,subtitle:"Call completion"})})]}),s.jsx(p,{sx:{display:"flex",justifyContent:"center",mt:1,gap:.5},children:[0,1,2,3].map(F=>s.jsx(p,{sx:{width:6,height:6,borderRadius:"50%",backgroundColor:t.palette.action.disabled,transition:"all 0.3s"}},F))})]}):s.jsxs(oe,{container:!0,spacing:{xs:1.5,md:3},sx:{mb:{xs:2,md:4}},children:[s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(R,{icon:s.jsx(Gn,{sx:{color:"white"}}),title:"Total Classes",value:g.totalClasses,change:g.previousWeekClasses>0?Math.round((g.callsThisWeek-g.previousWeekClasses)/g.previousWeekClasses*100):g.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:`${g.callsThisMonth} this month`})}),s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(R,{icon:s.jsx(Yn,{sx:{color:"white"}}),title:"This Week",value:g.callsThisWeek,change:g.previousWeekClasses>0?Math.round((g.callsThisWeek-g.previousWeekClasses)/g.previousWeekClasses*100):g.callsThisWeek>0?100:0,color:t.palette.primary.main,subtitle:"Classes attended"})}),s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(R,{icon:s.jsx(tn,{sx:{color:"white"}}),title:"New Messages",value:g.unreadMessages,change:void 0,color:t.palette.primary.main,subtitle:"From teacher",onClick:()=>window.location.href="#/messages"})}),s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(R,{icon:s.jsx(Nr,{sx:{color:"white"}}),title:"Success Rate",value:`${g.successRate}%`,change:g.callsThisWeek>g.previousWeekClasses?Math.round((g.callsThisWeek-g.previousWeekClasses)/Math.max(g.previousWeekClasses,1)*100):0,color:t.palette.primary.main,subtitle:"Call completion"})})]}),s.jsxs(oe,{container:!0,spacing:{xs:2,md:3},sx:{mt:{xs:1,md:2}},children:[s.jsx(oe,{item:!0,xs:12,md:6,children:s.jsx(qe,{sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:"120px",md:"auto"},background:`linear-gradient(135deg, ${v(t.palette.primary.main,.08)} 0%, ${v(t.palette.primary.main,.05)} 100%)`,border:`1px solid ${v(t.palette.primary.main,.12)}`,borderRadius:{xs:2,md:3},transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:{xs:"none",md:`0 8px 32px ${v(t.palette.primary.main,.15)}`}}},children:s.jsx(et,{sx:{p:{xs:1.2,md:3},"&:last-child":{pb:{xs:1.2,md:3}}},children:c?s.jsxs(p,{children:[s.jsxs(p,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:1,md:1.5},children:[s.jsxs(p,{display:"flex",alignItems:"center",flex:1,children:[s.jsx(mr,{sx:{width:{xs:32,md:40},height:{xs:32,md:40},mr:{xs:1,md:1.5},background:`linear-gradient(135deg, ${t.palette.primary.main} 0%, ${t.palette.primary.dark} 100%)`,fontSize:{xs:"0.9rem",md:"1.2rem"},fontWeight:700},children:(I=(j=c.username)==null?void 0:j[0])==null?void 0:I.toUpperCase()}),s.jsxs(p,{flex:1,children:[s.jsx(S,{variant:"body1",sx:{fontSize:{xs:"0.9rem",md:"1rem"},fontWeight:600,lineHeight:1.2},children:c.username}),s.jsx(Ct,{icon:s.jsx(yn,{sx:{fontSize:{xs:10,md:12}}}),label:c.isOnline?"Online":"Offline",color:c.isOnline?"success":"default",size:"small",sx:{fontSize:{xs:"0.65rem",md:"0.7rem"},height:{xs:18,md:20},mt:.5}})]})]}),s.jsxs(p,{display:"flex",alignItems:"center",gap:.5,children:[g.unreadMessages>0&&s.jsx(Ct,{label:g.unreadMessages,color:"error",size:"small",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},height:{xs:18,md:20}}}),s.jsx(Ae,{variant:"contained",size:"small",onClick:N,sx:{background:`linear-gradient(135deg, ${t.palette.primary.main} 0%, ${t.palette.primary.dark} 100%)`,color:"white",fontWeight:600,py:{xs:.5,md:.75},px:{xs:1.5,md:2},borderRadius:1.5,textTransform:"none",fontSize:{xs:"0.75rem",md:"0.875rem"},minWidth:{xs:"auto",md:"80px"},boxShadow:`0 2px 8px ${v(t.palette.primary.main,.3)}`,"&:hover":{boxShadow:`0 4px 12px ${v(t.palette.primary.main,.4)}`}},children:"Message"})]})]}),h.length>0&&s.jsxs(p,{sx:{borderTop:`1px solid ${v(t.palette.divider,.1)}`,pt:{xs:.8,md:1}},children:[s.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},mb:.5,display:"block"},children:"Recent message:"}),s.jsx(p,{children:h.slice(0,1).map(F=>{var B;return s.jsxs(p,{display:"flex",alignItems:"center",justifyContent:"space-between",children:[s.jsx(p,{flex:1,children:s.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",md:"0.85rem"},fontWeight:400,lineHeight:1.2,color:"text.secondary"},children:['"',(B=F.content)==null?void 0:B.substring(0,n?25:35),'..."']})}),!F.isRead&&s.jsx(p,{sx:{width:{xs:6,md:8},height:{xs:6,md:8},borderRadius:"50%",bgcolor:"error.main",ml:1}})]},F.id)})})]})]}):s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",sx:{mb:1,fontSize:{xs:"0.9rem",md:"1rem"}},children:"My Teacher"}),s.jsx(vt,{severity:"info",sx:{fontSize:"0.8rem"},children:"No teacher assigned yet."})]})})})}),s.jsx(oe,{item:!0,xs:12,md:6,children:s.jsx(qe,{sx:{height:{xs:"auto",md:"100%"},minHeight:{xs:"80px",md:"auto"},background:`linear-gradient(135deg, ${v(t.palette.primary.main,.08)} 0%, ${v(t.palette.primary.main,.05)} 100%)`,border:`1px solid ${v(t.palette.primary.main,.12)}`,borderRadius:{xs:2,md:3},transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:{xs:"none",md:`0 8px 32px ${v(t.palette.primary.main,.15)}`}}},children:s.jsxs(et,{sx:{p:{xs:1.2,md:3},"&:last-child":{pb:{xs:1.2,md:3}}},children:[s.jsx(p,{display:"flex",alignItems:"center",justifyContent:"space-between",mb:{xs:.5,md:2},children:s.jsxs(p,{display:"flex",alignItems:"center",children:[s.jsx(er,{sx:{color:t.palette.primary.main,fontSize:{xs:18,md:24},mr:{xs:.5,md:1}}}),s.jsx(S,{variant:"body2",sx:{fontSize:{xs:"0.9rem",md:"1rem"},fontWeight:600,color:t.palette.primary.main},children:"Today's Schedule"})]})}),y.length===0?s.jsx(S,{variant:"body2",color:"text.secondary",sx:{fontSize:{xs:"0.8rem",md:"0.875rem"},fontStyle:"italic"},children:"No classes scheduled for today"}):s.jsxs(p,{children:[y.slice(0,2).map((F,B)=>s.jsxs(p,{display:"flex",alignItems:"center",justifyContent:"space-between",sx:{py:{xs:.5,md:1},borderBottom:B<1?`1px solid ${v(t.palette.divider,.1)}`:"none"},children:[s.jsxs(p,{children:[s.jsxs(S,{variant:"body2",sx:{fontSize:{xs:"0.8rem",md:"0.9rem"},fontWeight:500,lineHeight:1.2},children:[F.time," - ",F.subject]}),s.jsxs(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"}},children:["with ",F.teacher]})]}),s.jsx(Ae,{variant:"contained",size:"small",sx:{background:`linear-gradient(135deg, ${t.palette.primary.main} 0%, ${t.palette.primary.dark} 100%)`,color:"white",fontWeight:600,borderRadius:1.5,textTransform:"none",fontSize:{xs:"0.7rem",md:"0.75rem"},py:{xs:.3,md:.5},px:{xs:1,md:1.5},minWidth:{xs:"auto",md:"60px"},boxShadow:`0 2px 8px ${v(t.palette.primary.main,.3)}`},children:"Join"})]},F.id)),y.length>2&&s.jsxs(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.7rem",md:"0.75rem"},display:"block",mt:.5},children:["+",y.length-2," more classes"]})]})]})})})]})]})}function Io({message:r,isOwn:e,currentTime:t=new Date}){const n=Ie();return s.jsx(p,{sx:{display:"flex",justifyContent:e?"flex-end":"flex-start",mb:2},children:s.jsxs(ke,{sx:{p:2,maxWidth:"70%",borderRadius:2,bgcolor:e?v(n.palette.primary.main,.9):v(n.palette.background.paper,.9),color:e?"white":"text.primary",boxShadow:`0 2px 8px ${v(n.palette.common.black,.1)}`},children:[s.jsx(S,{variant:"body1",sx:{wordBreak:"break-word"},children:r.content}),s.jsx(S,{variant:"caption",sx:{display:"block",mt:.5,opacity:.7,fontSize:"0.7rem"},children:(()=>{if(!r.timestamp)return"Unknown time";const i=r.timestamp instanceof Date?r.timestamp:new Date(r.timestamp);if(isNaN(i.getTime()))return"Unknown time";const o=t-i,d=Math.floor(o/1e3),c=Math.floor(d/60),f=Math.floor(c/60),h=Math.floor(f/24);return d<60?"Just now":c<60?`${c} min${c>1?"s":""} ago`:f<24?`${f} hour${f>1?"s":""} ago`:h<7?`${h} day${h>1?"s":""} ago`:i.toLocaleDateString()})()})]})})}function Ro({user:r}){const e=Ie(),[t,n]=l.useState([]),[i,a]=l.useState(0),[o,d]=l.useState([]),[c,f]=l.useState("");l.useState(!1);const h=l.useRef(null),[u,y]=l.useState(new Date),[O,g]=l.useState([]),w=()=>{var I;(I=h.current)==null||I.scrollIntoView({behavior:"smooth"})};l.useEffect(()=>{const I=setInterval(()=>{y(new Date)},6e4);return()=>clearInterval(I)},[]),l.useEffect(()=>{let I=null;return r&&(I=Dt.getConversations(F=>{g(F),x(F)})),()=>{I&&I()}},[r]),l.useEffect(()=>{let I=null;if(t[i]){const F=t[i];I=Dt.getMessages(F.firebaseId||F.id,B=>{const $=B.map(b=>{var k,L,T,D;return{id:b.id,senderId:b.senderId,recipientId:b.receiverId,content:b.content,timestamp:((L=(k=b.timestamp)==null?void 0:k.toDate)==null?void 0:L.call(k))||new Date(b.createdAt),senderName:((T=b.metadata)==null?void 0:T.senderName)||"Unknown",recipientName:((D=b.metadata)==null?void 0:D.receiverName)||"Unknown",isOwn:b.senderId===r.id,isRead:b.isRead}});d($),Dt.markAsRead(F.firebaseId||F.id)})}else d([]);return()=>{I&&I()}},[i,t,r]),l.useEffect(()=>{w()},[o]);const x=async I=>{var F,B,$,b,k,L,T;try{const D=[];if(!(r!=null&&r.id)){console.warn("No user ID available for loading conversations");return}const _=await Ne.getMyTeacher(r.id);if(_!=null&&_.success&&_.teacher){const J=_.teacher,V=I.find(X=>X.participants.includes(J.id));D.push({id:J.id,firebaseId:V==null?void 0:V.id,user:{id:J.id,name:J.username||J.name||"My Teacher",avatar:s.jsx(oo,{}),status:J.isOnline?"online":"offline",role:"teacher"},lastMessage:(V==null?void 0:V.lastMessage)||"",timestamp:((B=(F=V==null?void 0:V.lastMessageTime)==null?void 0:F.toDate)==null?void 0:B.call(F))||new Date(0),unread:(($=V==null?void 0:V.unreadCount)==null?void 0:$[r.id])||0})}const Y=await Ne.getUsersByRole("admin");if(Y!=null&&Y.success&&((b=Y.users)==null?void 0:b.length)>0){const J=Y.users[0],V=I.find(X=>X.participants.includes(J.id));D.push({id:J.id,firebaseId:V==null?void 0:V.id,user:{id:J.id,name:J.username||J.name||"Admin",avatar:s.jsx(Ba,{}),status:J.isOnline?"online":"offline",role:"admin"},lastMessage:(V==null?void 0:V.lastMessage)||"",timestamp:((L=(k=V==null?void 0:V.lastMessageTime)==null?void 0:k.toDate)==null?void 0:L.call(k))||new Date(0),unread:((T=V==null?void 0:V.unreadCount)==null?void 0:T[r.id])||0})}n(D)}catch(D){console.error("Failed to load Firebase conversations:",D)}},N=async()=>{if(!c.trim()||!t[i])return;const I=c.trim(),F=t[i];f("");try{const B=await Dt.sendMessage(F.id,I,"text");B.success||(console.error("‚ùå Failed to send message via Firebase:",B.error),f(I),alert("Failed to send message: "+B.error))}catch(B){console.error("‚ùå Error sending message via Firebase:",B),f(I),alert("Failed to send message: "+B.message)}},R=I=>{I.key==="Enter"&&!I.shiftKey&&(I.preventDefault(),N())},j=(I,F)=>{a(F)};return s.jsx(p,{sx:{height:"calc(100vh - 112px)",display:"flex",flexDirection:"column",bgcolor:"background.default",overflow:"hidden",position:"absolute",top:0,left:0,right:0},children:s.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",border:`1px solid ${v(e.palette.divider,.2)}`,borderRadius:2,bgcolor:v(e.palette.background.paper,.3),overflow:"hidden"},children:[s.jsxs(ke,{elevation:0,sx:{flexShrink:0,borderRadius:"8px 8px 0 0",borderBottom:`1px solid ${v(e.palette.divider,.1)}`,background:`linear-gradient(135deg, ${v(e.palette.background.paper,.95)} 0%, ${v(e.palette.background.paper,.9)} 100%)`},children:[s.jsx(p,{sx:{px:3},children:s.jsx(S,{variant:"h5",fontWeight:"bold",gutterBottom:!0,children:"Messages"})}),s.jsx(ki,{value:i,onChange:j,sx:{px:2,"& .MuiTab-root":{minHeight:64,textTransform:"none",fontSize:"1rem",fontWeight:500}},children:t.map((I,F)=>s.jsx(ji,{label:s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1.5},children:[s.jsx(fn,{badgeContent:I.unread,color:"error",sx:{"& .MuiBadge-badge":{fontSize:"0.7rem"}},children:s.jsx(mr,{sx:{width:32,height:32,bgcolor:I.user.role==="teacher"?e.palette.secondary.main:e.palette.primary.main},children:I.user.avatar})}),s.jsxs(p,{sx:{textAlign:"left"},children:[s.jsx(S,{variant:"body1",children:I.user.name}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:.5},children:[s.jsx(yn,{sx:{fontSize:8,color:I.user.status==="online"?e.palette.success.main:e.palette.text.disabled}}),s.jsx(S,{variant:"caption",color:"text.secondary",children:I.user.status==="online"?"Online":"Offline"})]})]})]})},I.id))})]}),t[i]&&s.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",overflow:"hidden"},children:[s.jsxs(p,{sx:{flex:1,overflow:"auto",p:3,display:"flex",flexDirection:"column"},children:[o.length===0?s.jsx(p,{sx:{flex:1,display:"flex",alignItems:"center",justifyContent:"center",color:"text.secondary"},children:s.jsxs(S,{variant:"body1",children:["Start a conversation with ",t[i].user.name]})}):s.jsx(s.Fragment,{children:o.map(I=>s.jsx(Io,{message:I,isOwn:I.isOwn,currentTime:u},I.id))}),s.jsx("div",{ref:h})]}),s.jsx(p,{sx:{flexShrink:0,p:2,pb:3,borderTop:`1px solid ${v(e.palette.divider,.1)}`,bgcolor:v(e.palette.background.paper,.1)},children:s.jsxs(p,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[s.jsx(We,{fullWidth:!0,multiline:!0,maxRows:4,placeholder:`Message ${t[i].user.name}...`,value:c,onChange:I=>f(I.target.value),onKeyPress:R,sx:{"& .MuiOutlinedInput-root":{borderRadius:3,backgroundColor:v(e.palette.background.default,.5)}}}),s.jsx(se,{onClick:N,disabled:!c.trim(),sx:{bgcolor:e.palette.primary.main,color:"white","&:hover":{bgcolor:e.palette.primary.dark},"&:disabled":{bgcolor:v(e.palette.primary.main,.3)},width:48,height:48},children:s.jsx(As,{})})]})})]})]})})}function Po({user:r}){const e=Ie();ut(e.breakpoints.down("md"));const[t,n]=l.useState({username:(r==null?void 0:r.username)||"",email:(r==null?void 0:r.email)||"",currentPassword:"",newPassword:"",confirmPassword:""}),[i,a]=l.useState({messageAlerts:!0,teacherOnline:!0,classReminders:!0}),[o,d]=l.useState({hdVideo:!0,microphoneDefault:!0,cameraDefault:!0});l.useEffect(()=>{try{const j=localStorage.getItem("studentNotificationSettings"),I=localStorage.getItem("studentStudySettings");j&&a(JSON.parse(j)),I&&d(JSON.parse(I))}catch(j){console.error("Failed to load settings from localStorage:",j)}},[]);const[c,f]=l.useState(!1),[h,u]=l.useState(!1),[y,O]=l.useState(""),g=(j,I)=>{n(F=>({...F,[j]:I}))},w=j=>{a(I=>({...I,[j]:!I[j]}))},x=j=>{d(I=>({...I,[j]:!I[j]}))},N=async()=>{try{if(u(!0),O(""),!t.username.trim())throw new Error("Username is required");if(t.newPassword.trim()!==""){if(!t.currentPassword)throw new Error("Current password is required to change password");if(t.newPassword.length<6)throw new Error("New password must be at least 6 characters");if(t.newPassword!==t.confirmPassword)throw new Error("New passwords do not match");await Yi(Ce.currentUser,t.newPassword)}t.username!==r.username&&await Gi(Ce.currentUser,{displayName:t.username});const I=fe(ce,"users",r.id);await tt(I,{username:t.username,updatedAt:new Date}),await Ne.setOnline(),f(!0),n(F=>({...F,currentPassword:"",newPassword:"",confirmPassword:""}))}catch(j){console.error("Profile update error:",j),O(j.message||"Failed to update profile")}finally{u(!1)}setTimeout(()=>{f(!1),O("")},5e3)},R=()=>{try{localStorage.setItem("studentNotificationSettings",JSON.stringify(i)),localStorage.setItem("studentStudySettings",JSON.stringify(o)),f(!0)}catch(j){console.error("Failed to save settings:",j),O("Failed to save settings")}setTimeout(()=>{f(!1),O("")},3e3)};return s.jsxs(p,{children:[s.jsxs(p,{sx:{mb:4},children:[s.jsx(S,{variant:"h4",sx:{fontWeight:700,mb:1},children:"Settings"}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"Manage your profile, preferences and privacy settings"})]}),c&&s.jsx(vt,{severity:"success",sx:{mb:3},children:"Settings saved successfully!"}),y&&s.jsx(vt,{severity:"error",sx:{mb:3},children:y}),s.jsxs(Nt,{spacing:3,children:[s.jsx(qe,{sx:{background:`linear-gradient(135deg, ${v(e.palette.primary.main,.08)} 0%, ${v(e.palette.info.main,.05)} 100%)`,border:`1px solid ${v(e.palette.primary.main,.12)}`,borderRadius:3,transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:`0 8px 32px ${v(e.palette.primary.main,.15)}`}},children:s.jsxs(et,{sx:{p:3},children:[s.jsxs(p,{display:"flex",alignItems:"center",mb:3,children:[s.jsx(p,{sx:{width:40,height:40,borderRadius:2,background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${v(e.palette.primary.main,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mr:2,boxShadow:`0 4px 16px ${v(e.palette.primary.main,.4)}`},children:s.jsx(Lt,{sx:{color:"white",fontSize:20}})}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",fontWeight:700,sx:{background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${e.palette.info.main} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Profile Settings"}),s.jsx(S,{variant:"caption",color:"text.secondary",children:"Update your personal information"})]})]}),s.jsx(We,{fullWidth:!0,label:"Username",value:t.username,onChange:j=>g("username",j.target.value),margin:"normal"}),s.jsx(We,{fullWidth:!0,label:"Email",type:"email",value:t.email,onChange:j=>g("email",j.target.value),margin:"normal",disabled:!0,helperText:"Email cannot be changed. Contact your teacher or administrator."}),s.jsx(Ke,{sx:{my:2}}),s.jsx(S,{variant:"subtitle2",gutterBottom:!0,children:"Change Password"}),s.jsx(We,{fullWidth:!0,label:"Current Password",type:"password",value:t.currentPassword,onChange:j=>g("currentPassword",j.target.value),margin:"normal"}),s.jsx(We,{fullWidth:!0,label:"New Password",type:"password",value:t.newPassword,onChange:j=>g("newPassword",j.target.value),margin:"normal",helperText:"Must be at least 6 characters",error:!!(t.newPassword&&t.newPassword.length<6)}),s.jsx(We,{fullWidth:!0,label:"Confirm New Password",type:"password",value:t.confirmPassword,onChange:j=>g("confirmPassword",j.target.value),margin:"normal",helperText:t.newPassword&&t.confirmPassword&&t.newPassword!==t.confirmPassword?"Passwords do not match":"",error:!!(t.newPassword&&t.confirmPassword&&t.newPassword!==t.confirmPassword)}),s.jsx(Ae,{variant:"contained",startIcon:h?s.jsx(pr,{size:20,color:"inherit"}):s.jsx(Jn,{}),onClick:N,disabled:h,sx:{mt:3,background:`linear-gradient(135deg, ${e.palette.primary.main} 0%, ${e.palette.primary.dark} 100%)`,color:"white",fontWeight:700,py:1.5,borderRadius:2,textTransform:"none",boxShadow:`0 3px 12px ${v(e.palette.primary.main,.4)}`,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"translateY(-1px)",boxShadow:`0 6px 20px ${v(e.palette.primary.main,.5)}`}},fullWidth:!0,children:h?"Saving...":"Save Profile"})]})}),s.jsx(qe,{sx:{background:`linear-gradient(135deg, ${v(e.palette.success.main,.08)} 0%, ${v(e.palette.warning.main,.05)} 100%)`,border:`1px solid ${v(e.palette.success.main,.12)}`,borderRadius:3,transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:`0 8px 32px ${v(e.palette.success.main,.15)}`}},children:s.jsxs(et,{sx:{p:3},children:[s.jsxs(p,{display:"flex",alignItems:"center",mb:3,children:[s.jsx(p,{sx:{width:40,height:40,borderRadius:2,background:`linear-gradient(135deg, ${e.palette.success.main} 0%, ${v(e.palette.success.main,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mr:2,boxShadow:`0 4px 16px ${v(e.palette.success.main,.4)}`},children:s.jsx(so,{sx:{color:"white",fontSize:20}})}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",fontWeight:700,sx:{background:`linear-gradient(135deg, ${e.palette.success.main} 0%, ${e.palette.warning.main} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Notification Settings"}),s.jsx(S,{variant:"caption",color:"text.secondary",children:"Control your notification preferences"})]})]}),s.jsxs(Nt,{spacing:2,children:[s.jsx(mt,{control:s.jsx(gt,{checked:i.messageAlerts,onChange:()=>w("messageAlerts")}),label:"Message Alerts",sx:{mx:0}}),s.jsx(mt,{control:s.jsx(gt,{checked:i.teacherOnline,onChange:()=>w("teacherOnline")}),label:"Teacher Online Notifications",sx:{mx:0}}),s.jsx(mt,{control:s.jsx(gt,{checked:i.classReminders,onChange:()=>w("classReminders")}),label:"Class Reminders",sx:{mx:0}})]})]})}),s.jsx(qe,{sx:{background:`linear-gradient(135deg, ${v(e.palette.info.main,.08)} 0%, ${v(e.palette.secondary.main,.05)} 100%)`,border:`1px solid ${v(e.palette.info.main,.12)}`,borderRadius:3,transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-2px)"},boxShadow:`0 8px 32px ${v(e.palette.info.main,.15)}`}},children:s.jsxs(et,{sx:{p:3},children:[s.jsxs(p,{display:"flex",alignItems:"center",mb:3,children:[s.jsx(p,{sx:{width:40,height:40,borderRadius:2,background:`linear-gradient(135deg, ${e.palette.info.main} 0%, ${v(e.palette.info.main,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mr:2,boxShadow:`0 4px 16px ${v(e.palette.info.main,.4)}`},children:s.jsx(tr,{sx:{color:"white",fontSize:20}})}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",fontWeight:700,sx:{background:`linear-gradient(135deg, ${e.palette.info.main} 0%, ${e.palette.secondary.main} 100%)`,backgroundClip:"text",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"},children:"Video Call Settings"}),s.jsx(S,{variant:"caption",color:"text.secondary",children:"Configure your video call preferences"})]})]}),s.jsxs(Nt,{spacing:2,children:[s.jsx(mt,{control:s.jsx(gt,{checked:o.hdVideo,onChange:()=>x("hdVideo")}),label:"HD Video Quality",sx:{mx:0}}),s.jsx(mt,{control:s.jsx(gt,{checked:o.microphoneDefault,onChange:()=>x("microphoneDefault")}),label:"Turn on Microphone by Default",sx:{mx:0}}),s.jsx(mt,{control:s.jsx(gt,{checked:o.cameraDefault,onChange:()=>x("cameraDefault")}),label:"Turn on Camera by Default",sx:{mx:0}})]}),s.jsx(Ae,{variant:"contained",startIcon:s.jsx(Jn,{}),onClick:R,sx:{mt:3,background:`linear-gradient(135deg, ${e.palette.info.main} 0%, ${e.palette.info.dark} 100%)`,color:"white",fontWeight:700,py:1.5,borderRadius:2,textTransform:"none",boxShadow:`0 3px 12px ${v(e.palette.info.main,.4)}`,transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)","&:hover":{transform:"translateY(-1px)",boxShadow:`0 6px 20px ${v(e.palette.info.main,.5)}`}},fullWidth:!0,children:"Save Settings"})]})})]})]})}const Ds=6048e5,Fo=864e5,Qn=Symbol.for("constructDateFrom");function st(r,e){return typeof r=="function"?r(e):r&&typeof r=="object"&&Qn in r?r[Qn](e):r instanceof Date?new r.constructor(e):new Date(e)}function Le(r,e){return st(e||r,r)}let Mo={};function yr(){return Mo}function $t(r,e){var d,c,f,h;const t=yr(),n=(e==null?void 0:e.weekStartsOn)??((c=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:c.weekStartsOn)??t.weekStartsOn??((h=(f=t.locale)==null?void 0:f.options)==null?void 0:h.weekStartsOn)??0,i=Le(r,e==null?void 0:e.in),a=i.getDay(),o=(a<n?7:0)+a-n;return i.setDate(i.getDate()-o),i.setHours(0,0,0,0),i}function hr(r,e){return $t(r,{...e,weekStartsOn:1})}function Ws(r,e){const t=Le(r,e==null?void 0:e.in),n=t.getFullYear(),i=st(t,0);i.setFullYear(n+1,0,4),i.setHours(0,0,0,0);const a=hr(i),o=st(t,0);o.setFullYear(n,0,4),o.setHours(0,0,0,0);const d=hr(o);return t.getTime()>=a.getTime()?n+1:t.getTime()>=d.getTime()?n:n-1}function Zn(r){const e=Le(r),t=new Date(Date.UTC(e.getFullYear(),e.getMonth(),e.getDate(),e.getHours(),e.getMinutes(),e.getSeconds(),e.getMilliseconds()));return t.setUTCFullYear(e.getFullYear()),+r-+t}function _o(r,...e){const t=st.bind(null,r||e.find(n=>typeof n=="object"));return e.map(t)}function es(r,e){const t=Le(r,e==null?void 0:e.in);return t.setHours(0,0,0,0),t}function Oo(r,e,t){const[n,i]=_o(t==null?void 0:t.in,r,e),a=es(n),o=es(i),d=+a-Zn(a),c=+o-Zn(o);return Math.round((d-c)/Fo)}function Ao(r,e){const t=Ws(r,e),n=st((e==null?void 0:e.in)||r,0);return n.setFullYear(t,0,4),n.setHours(0,0,0,0),hr(n)}function Lo(r){return r instanceof Date||typeof r=="object"&&Object.prototype.toString.call(r)==="[object Date]"}function Do(r){return!(!Lo(r)&&typeof r!="number"||isNaN(+Le(r)))}function Wo(r,e){const t=Le(r,e==null?void 0:e.in);return t.setFullYear(t.getFullYear(),0,1),t.setHours(0,0,0,0),t}const No={lessThanXSeconds:{one:"less than a second",other:"less than {{count}} seconds"},xSeconds:{one:"1 second",other:"{{count}} seconds"},halfAMinute:"half a minute",lessThanXMinutes:{one:"less than a minute",other:"less than {{count}} minutes"},xMinutes:{one:"1 minute",other:"{{count}} minutes"},aboutXHours:{one:"about 1 hour",other:"about {{count}} hours"},xHours:{one:"1 hour",other:"{{count}} hours"},xDays:{one:"1 day",other:"{{count}} days"},aboutXWeeks:{one:"about 1 week",other:"about {{count}} weeks"},xWeeks:{one:"1 week",other:"{{count}} weeks"},aboutXMonths:{one:"about 1 month",other:"about {{count}} months"},xMonths:{one:"1 month",other:"{{count}} months"},aboutXYears:{one:"about 1 year",other:"about {{count}} years"},xYears:{one:"1 year",other:"{{count}} years"},overXYears:{one:"over 1 year",other:"over {{count}} years"},almostXYears:{one:"almost 1 year",other:"almost {{count}} years"}},zo=(r,e,t)=>{let n;const i=No[r];return typeof i=="string"?n=i:e===1?n=i.one:n=i.other.replace("{{count}}",e.toString()),t!=null&&t.addSuffix?t.comparison&&t.comparison>0?"in "+n:n+" ago":n};function zr(r){return(e={})=>{const t=e.width?String(e.width):r.defaultWidth;return r.formats[t]||r.formats[r.defaultWidth]}}const Uo={full:"EEEE, MMMM do, y",long:"MMMM do, y",medium:"MMM d, y",short:"MM/dd/yyyy"},Bo={full:"h:mm:ss a zzzz",long:"h:mm:ss a z",medium:"h:mm:ss a",short:"h:mm a"},$o={full:"{{date}} 'at' {{time}}",long:"{{date}} 'at' {{time}}",medium:"{{date}}, {{time}}",short:"{{date}}, {{time}}"},Ho={date:zr({formats:Uo,defaultWidth:"full"}),time:zr({formats:Bo,defaultWidth:"full"}),dateTime:zr({formats:$o,defaultWidth:"full"})},Vo={lastWeek:"'last' eeee 'at' p",yesterday:"'yesterday at' p",today:"'today at' p",tomorrow:"'tomorrow at' p",nextWeek:"eeee 'at' p",other:"P"},qo=(r,e,t,n)=>Vo[r];function _t(r){return(e,t)=>{const n=t!=null&&t.context?String(t.context):"standalone";let i;if(n==="formatting"&&r.formattingValues){const o=r.defaultFormattingWidth||r.defaultWidth,d=t!=null&&t.width?String(t.width):o;i=r.formattingValues[d]||r.formattingValues[o]}else{const o=r.defaultWidth,d=t!=null&&t.width?String(t.width):r.defaultWidth;i=r.values[d]||r.values[o]}const a=r.argumentCallback?r.argumentCallback(e):e;return i[a]}}const Yo={narrow:["B","A"],abbreviated:["BC","AD"],wide:["Before Christ","Anno Domini"]},Go={narrow:["1","2","3","4"],abbreviated:["Q1","Q2","Q3","Q4"],wide:["1st quarter","2nd quarter","3rd quarter","4th quarter"]},Jo={narrow:["J","F","M","A","M","J","J","A","S","O","N","D"],abbreviated:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],wide:["January","February","March","April","May","June","July","August","September","October","November","December"]},Xo={narrow:["S","M","T","W","T","F","S"],short:["Su","Mo","Tu","We","Th","Fr","Sa"],abbreviated:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],wide:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},Ko={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"}},Qo={narrow:{am:"a",pm:"p",midnight:"mi",noon:"n",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},abbreviated:{am:"AM",pm:"PM",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"},wide:{am:"a.m.",pm:"p.m.",midnight:"midnight",noon:"noon",morning:"in the morning",afternoon:"in the afternoon",evening:"in the evening",night:"at night"}},Zo=(r,e)=>{const t=Number(r),n=t%100;if(n>20||n<10)switch(n%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd"}return t+"th"},ec={ordinalNumber:Zo,era:_t({values:Yo,defaultWidth:"wide"}),quarter:_t({values:Go,defaultWidth:"wide",argumentCallback:r=>r-1}),month:_t({values:Jo,defaultWidth:"wide"}),day:_t({values:Xo,defaultWidth:"wide"}),dayPeriod:_t({values:Ko,defaultWidth:"wide",formattingValues:Qo,defaultFormattingWidth:"wide"})};function Ot(r){return(e,t={})=>{const n=t.width,i=n&&r.matchPatterns[n]||r.matchPatterns[r.defaultMatchWidth],a=e.match(i);if(!a)return null;const o=a[0],d=n&&r.parsePatterns[n]||r.parsePatterns[r.defaultParseWidth],c=Array.isArray(d)?rc(d,u=>u.test(o)):tc(d,u=>u.test(o));let f;f=r.valueCallback?r.valueCallback(c):c,f=t.valueCallback?t.valueCallback(f):f;const h=e.slice(o.length);return{value:f,rest:h}}}function tc(r,e){for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&e(r[t]))return t}function rc(r,e){for(let t=0;t<r.length;t++)if(e(r[t]))return t}function nc(r){return(e,t={})=>{const n=e.match(r.matchPattern);if(!n)return null;const i=n[0],a=e.match(r.parsePattern);if(!a)return null;let o=r.valueCallback?r.valueCallback(a[0]):a[0];o=t.valueCallback?t.valueCallback(o):o;const d=e.slice(i.length);return{value:o,rest:d}}}const sc=/^(\d+)(th|st|nd|rd)?/i,ic=/\d+/i,ac={narrow:/^(b|a)/i,abbreviated:/^(b\.?\s?c\.?|b\.?\s?c\.?\s?e\.?|a\.?\s?d\.?|c\.?\s?e\.?)/i,wide:/^(before christ|before common era|anno domini|common era)/i},oc={any:[/^b/i,/^(a|c)/i]},cc={narrow:/^[1234]/i,abbreviated:/^q[1234]/i,wide:/^[1234](th|st|nd|rd)? quarter/i},lc={any:[/1/i,/2/i,/3/i,/4/i]},dc={narrow:/^[jfmasond]/i,abbreviated:/^(jan|feb|mar|apr|may|jun|jul|aug|sep|oct|nov|dec)/i,wide:/^(january|february|march|april|may|june|july|august|september|october|november|december)/i},uc={narrow:[/^j/i,/^f/i,/^m/i,/^a/i,/^m/i,/^j/i,/^j/i,/^a/i,/^s/i,/^o/i,/^n/i,/^d/i],any:[/^ja/i,/^f/i,/^mar/i,/^ap/i,/^may/i,/^jun/i,/^jul/i,/^au/i,/^s/i,/^o/i,/^n/i,/^d/i]},hc={narrow:/^[smtwf]/i,short:/^(su|mo|tu|we|th|fr|sa)/i,abbreviated:/^(sun|mon|tue|wed|thu|fri|sat)/i,wide:/^(sunday|monday|tuesday|wednesday|thursday|friday|saturday)/i},fc={narrow:[/^s/i,/^m/i,/^t/i,/^w/i,/^t/i,/^f/i,/^s/i],any:[/^su/i,/^m/i,/^tu/i,/^w/i,/^th/i,/^f/i,/^sa/i]},pc={narrow:/^(a|p|mi|n|(in the|at) (morning|afternoon|evening|night))/i,any:/^([ap]\.?\s?m\.?|midnight|noon|(in the|at) (morning|afternoon|evening|night))/i},mc={any:{am:/^a/i,pm:/^p/i,midnight:/^mi/i,noon:/^no/i,morning:/morning/i,afternoon:/afternoon/i,evening:/evening/i,night:/night/i}},gc={ordinalNumber:nc({matchPattern:sc,parsePattern:ic,valueCallback:r=>parseInt(r,10)}),era:Ot({matchPatterns:ac,defaultMatchWidth:"wide",parsePatterns:oc,defaultParseWidth:"any"}),quarter:Ot({matchPatterns:cc,defaultMatchWidth:"wide",parsePatterns:lc,defaultParseWidth:"any",valueCallback:r=>r+1}),month:Ot({matchPatterns:dc,defaultMatchWidth:"wide",parsePatterns:uc,defaultParseWidth:"any"}),day:Ot({matchPatterns:hc,defaultMatchWidth:"wide",parsePatterns:fc,defaultParseWidth:"any"}),dayPeriod:Ot({matchPatterns:pc,defaultMatchWidth:"any",parsePatterns:mc,defaultParseWidth:"any"})},xc={code:"en-US",formatDistance:zo,formatLong:Ho,formatRelative:qo,localize:ec,match:gc,options:{weekStartsOn:0,firstWeekContainsDate:1}};function bc(r,e){const t=Le(r,e==null?void 0:e.in);return Oo(t,Wo(t))+1}function yc(r,e){const t=Le(r,e==null?void 0:e.in),n=+hr(t)-+Ao(t);return Math.round(n/Ds)+1}function Ns(r,e){var h,u,y,O;const t=Le(r,e==null?void 0:e.in),n=t.getFullYear(),i=yr(),a=(e==null?void 0:e.firstWeekContainsDate)??((u=(h=e==null?void 0:e.locale)==null?void 0:h.options)==null?void 0:u.firstWeekContainsDate)??i.firstWeekContainsDate??((O=(y=i.locale)==null?void 0:y.options)==null?void 0:O.firstWeekContainsDate)??1,o=st((e==null?void 0:e.in)||r,0);o.setFullYear(n+1,0,a),o.setHours(0,0,0,0);const d=$t(o,e),c=st((e==null?void 0:e.in)||r,0);c.setFullYear(n,0,a),c.setHours(0,0,0,0);const f=$t(c,e);return+t>=+d?n+1:+t>=+f?n:n-1}function wc(r,e){var d,c,f,h;const t=yr(),n=(e==null?void 0:e.firstWeekContainsDate)??((c=(d=e==null?void 0:e.locale)==null?void 0:d.options)==null?void 0:c.firstWeekContainsDate)??t.firstWeekContainsDate??((h=(f=t.locale)==null?void 0:f.options)==null?void 0:h.firstWeekContainsDate)??1,i=Ns(r,e),a=st((e==null?void 0:e.in)||r,0);return a.setFullYear(i,0,n),a.setHours(0,0,0,0),$t(a,e)}function vc(r,e){const t=Le(r,e==null?void 0:e.in),n=+$t(t,e)-+wc(t,e);return Math.round(n/Ds)+1}function te(r,e){const t=r<0?"-":"",n=Math.abs(r).toString().padStart(e,"0");return t+n}const Ge={y(r,e){const t=r.getFullYear(),n=t>0?t:1-t;return te(e==="yy"?n%100:n,e.length)},M(r,e){const t=r.getMonth();return e==="M"?String(t+1):te(t+1,2)},d(r,e){return te(r.getDate(),e.length)},a(r,e){const t=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.toUpperCase();case"aaa":return t;case"aaaaa":return t[0];case"aaaa":default:return t==="am"?"a.m.":"p.m."}},h(r,e){return te(r.getHours()%12||12,e.length)},H(r,e){return te(r.getHours(),e.length)},m(r,e){return te(r.getMinutes(),e.length)},s(r,e){return te(r.getSeconds(),e.length)},S(r,e){const t=e.length,n=r.getMilliseconds(),i=Math.trunc(n*Math.pow(10,t-3));return te(i,e.length)}},bt={am:"am",pm:"pm",midnight:"midnight",noon:"noon",morning:"morning",afternoon:"afternoon",evening:"evening",night:"night"},ts={G:function(r,e,t){const n=r.getFullYear()>0?1:0;switch(e){case"G":case"GG":case"GGG":return t.era(n,{width:"abbreviated"});case"GGGGG":return t.era(n,{width:"narrow"});case"GGGG":default:return t.era(n,{width:"wide"})}},y:function(r,e,t){if(e==="yo"){const n=r.getFullYear(),i=n>0?n:1-n;return t.ordinalNumber(i,{unit:"year"})}return Ge.y(r,e)},Y:function(r,e,t,n){const i=Ns(r,n),a=i>0?i:1-i;if(e==="YY"){const o=a%100;return te(o,2)}return e==="Yo"?t.ordinalNumber(a,{unit:"year"}):te(a,e.length)},R:function(r,e){const t=Ws(r);return te(t,e.length)},u:function(r,e){const t=r.getFullYear();return te(t,e.length)},Q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"Q":return String(n);case"QQ":return te(n,2);case"Qo":return t.ordinalNumber(n,{unit:"quarter"});case"QQQ":return t.quarter(n,{width:"abbreviated",context:"formatting"});case"QQQQQ":return t.quarter(n,{width:"narrow",context:"formatting"});case"QQQQ":default:return t.quarter(n,{width:"wide",context:"formatting"})}},q:function(r,e,t){const n=Math.ceil((r.getMonth()+1)/3);switch(e){case"q":return String(n);case"qq":return te(n,2);case"qo":return t.ordinalNumber(n,{unit:"quarter"});case"qqq":return t.quarter(n,{width:"abbreviated",context:"standalone"});case"qqqqq":return t.quarter(n,{width:"narrow",context:"standalone"});case"qqqq":default:return t.quarter(n,{width:"wide",context:"standalone"})}},M:function(r,e,t){const n=r.getMonth();switch(e){case"M":case"MM":return Ge.M(r,e);case"Mo":return t.ordinalNumber(n+1,{unit:"month"});case"MMM":return t.month(n,{width:"abbreviated",context:"formatting"});case"MMMMM":return t.month(n,{width:"narrow",context:"formatting"});case"MMMM":default:return t.month(n,{width:"wide",context:"formatting"})}},L:function(r,e,t){const n=r.getMonth();switch(e){case"L":return String(n+1);case"LL":return te(n+1,2);case"Lo":return t.ordinalNumber(n+1,{unit:"month"});case"LLL":return t.month(n,{width:"abbreviated",context:"standalone"});case"LLLLL":return t.month(n,{width:"narrow",context:"standalone"});case"LLLL":default:return t.month(n,{width:"wide",context:"standalone"})}},w:function(r,e,t,n){const i=vc(r,n);return e==="wo"?t.ordinalNumber(i,{unit:"week"}):te(i,e.length)},I:function(r,e,t){const n=yc(r);return e==="Io"?t.ordinalNumber(n,{unit:"week"}):te(n,e.length)},d:function(r,e,t){return e==="do"?t.ordinalNumber(r.getDate(),{unit:"date"}):Ge.d(r,e)},D:function(r,e,t){const n=bc(r);return e==="Do"?t.ordinalNumber(n,{unit:"dayOfYear"}):te(n,e.length)},E:function(r,e,t){const n=r.getDay();switch(e){case"E":case"EE":case"EEE":return t.day(n,{width:"abbreviated",context:"formatting"});case"EEEEE":return t.day(n,{width:"narrow",context:"formatting"});case"EEEEEE":return t.day(n,{width:"short",context:"formatting"});case"EEEE":default:return t.day(n,{width:"wide",context:"formatting"})}},e:function(r,e,t,n){const i=r.getDay(),a=(i-n.weekStartsOn+8)%7||7;switch(e){case"e":return String(a);case"ee":return te(a,2);case"eo":return t.ordinalNumber(a,{unit:"day"});case"eee":return t.day(i,{width:"abbreviated",context:"formatting"});case"eeeee":return t.day(i,{width:"narrow",context:"formatting"});case"eeeeee":return t.day(i,{width:"short",context:"formatting"});case"eeee":default:return t.day(i,{width:"wide",context:"formatting"})}},c:function(r,e,t,n){const i=r.getDay(),a=(i-n.weekStartsOn+8)%7||7;switch(e){case"c":return String(a);case"cc":return te(a,e.length);case"co":return t.ordinalNumber(a,{unit:"day"});case"ccc":return t.day(i,{width:"abbreviated",context:"standalone"});case"ccccc":return t.day(i,{width:"narrow",context:"standalone"});case"cccccc":return t.day(i,{width:"short",context:"standalone"});case"cccc":default:return t.day(i,{width:"wide",context:"standalone"})}},i:function(r,e,t){const n=r.getDay(),i=n===0?7:n;switch(e){case"i":return String(i);case"ii":return te(i,e.length);case"io":return t.ordinalNumber(i,{unit:"day"});case"iii":return t.day(n,{width:"abbreviated",context:"formatting"});case"iiiii":return t.day(n,{width:"narrow",context:"formatting"});case"iiiiii":return t.day(n,{width:"short",context:"formatting"});case"iiii":default:return t.day(n,{width:"wide",context:"formatting"})}},a:function(r,e,t){const i=r.getHours()/12>=1?"pm":"am";switch(e){case"a":case"aa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"aaa":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"aaaaa":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"aaaa":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},b:function(r,e,t){const n=r.getHours();let i;switch(n===12?i=bt.noon:n===0?i=bt.midnight:i=n/12>=1?"pm":"am",e){case"b":case"bb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"bbb":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"}).toLowerCase();case"bbbbb":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"bbbb":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},B:function(r,e,t){const n=r.getHours();let i;switch(n>=17?i=bt.evening:n>=12?i=bt.afternoon:n>=4?i=bt.morning:i=bt.night,e){case"B":case"BB":case"BBB":return t.dayPeriod(i,{width:"abbreviated",context:"formatting"});case"BBBBB":return t.dayPeriod(i,{width:"narrow",context:"formatting"});case"BBBB":default:return t.dayPeriod(i,{width:"wide",context:"formatting"})}},h:function(r,e,t){if(e==="ho"){let n=r.getHours()%12;return n===0&&(n=12),t.ordinalNumber(n,{unit:"hour"})}return Ge.h(r,e)},H:function(r,e,t){return e==="Ho"?t.ordinalNumber(r.getHours(),{unit:"hour"}):Ge.H(r,e)},K:function(r,e,t){const n=r.getHours()%12;return e==="Ko"?t.ordinalNumber(n,{unit:"hour"}):te(n,e.length)},k:function(r,e,t){let n=r.getHours();return n===0&&(n=24),e==="ko"?t.ordinalNumber(n,{unit:"hour"}):te(n,e.length)},m:function(r,e,t){return e==="mo"?t.ordinalNumber(r.getMinutes(),{unit:"minute"}):Ge.m(r,e)},s:function(r,e,t){return e==="so"?t.ordinalNumber(r.getSeconds(),{unit:"second"}):Ge.s(r,e)},S:function(r,e){return Ge.S(r,e)},X:function(r,e,t){const n=r.getTimezoneOffset();if(n===0)return"Z";switch(e){case"X":return ns(n);case"XXXX":case"XX":return at(n);case"XXXXX":case"XXX":default:return at(n,":")}},x:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"x":return ns(n);case"xxxx":case"xx":return at(n);case"xxxxx":case"xxx":default:return at(n,":")}},O:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"O":case"OO":case"OOO":return"GMT"+rs(n,":");case"OOOO":default:return"GMT"+at(n,":")}},z:function(r,e,t){const n=r.getTimezoneOffset();switch(e){case"z":case"zz":case"zzz":return"GMT"+rs(n,":");case"zzzz":default:return"GMT"+at(n,":")}},t:function(r,e,t){const n=Math.trunc(+r/1e3);return te(n,e.length)},T:function(r,e,t){return te(+r,e.length)}};function rs(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),i=Math.trunc(n/60),a=n%60;return a===0?t+String(i):t+String(i)+e+te(a,2)}function ns(r,e){return r%60===0?(r>0?"-":"+")+te(Math.abs(r)/60,2):at(r,e)}function at(r,e=""){const t=r>0?"-":"+",n=Math.abs(r),i=te(Math.trunc(n/60),2),a=te(n%60,2);return t+i+e+a}const ss=(r,e)=>{switch(r){case"P":return e.date({width:"short"});case"PP":return e.date({width:"medium"});case"PPP":return e.date({width:"long"});case"PPPP":default:return e.date({width:"full"})}},zs=(r,e)=>{switch(r){case"p":return e.time({width:"short"});case"pp":return e.time({width:"medium"});case"ppp":return e.time({width:"long"});case"pppp":default:return e.time({width:"full"})}},Cc=(r,e)=>{const t=r.match(/(P+)(p+)?/)||[],n=t[1],i=t[2];if(!i)return ss(r,e);let a;switch(n){case"P":a=e.dateTime({width:"short"});break;case"PP":a=e.dateTime({width:"medium"});break;case"PPP":a=e.dateTime({width:"long"});break;case"PPPP":default:a=e.dateTime({width:"full"});break}return a.replace("{{date}}",ss(n,e)).replace("{{time}}",zs(i,e))},Sc={p:zs,P:Cc},kc=/^D+$/,jc=/^Y+$/,Ec=["D","DD","YY","YYYY"];function Tc(r){return kc.test(r)}function Ic(r){return jc.test(r)}function Rc(r,e,t){const n=Pc(r,e,t);if(console.warn(n),Ec.includes(r))throw new RangeError(n)}function Pc(r,e,t){const n=r[0]==="Y"?"years":"days of the month";return`Use \`${r.toLowerCase()}\` instead of \`${r}\` (in \`${e}\`) for formatting ${n} to the input \`${t}\`; see: https://github.com/date-fns/date-fns/blob/master/docs/unicodeTokens.md`}const Fc=/[yYQqMLwIdDecihHKkms]o|(\w)\1*|''|'(''|[^'])+('|$)|./g,Mc=/P+p+|P+|p+|''|'(''|[^'])+('|$)|./g,_c=/^'([^]*?)'?$/,Oc=/''/g,Ac=/[a-zA-Z]/;function Xt(r,e,t){var h,u,y,O,g,w,x,N;const n=yr(),i=(t==null?void 0:t.locale)??n.locale??xc,a=(t==null?void 0:t.firstWeekContainsDate)??((u=(h=t==null?void 0:t.locale)==null?void 0:h.options)==null?void 0:u.firstWeekContainsDate)??n.firstWeekContainsDate??((O=(y=n.locale)==null?void 0:y.options)==null?void 0:O.firstWeekContainsDate)??1,o=(t==null?void 0:t.weekStartsOn)??((w=(g=t==null?void 0:t.locale)==null?void 0:g.options)==null?void 0:w.weekStartsOn)??n.weekStartsOn??((N=(x=n.locale)==null?void 0:x.options)==null?void 0:N.weekStartsOn)??0,d=Le(r,t==null?void 0:t.in);if(!Do(d))throw new RangeError("Invalid time value");let c=e.match(Mc).map(R=>{const j=R[0];if(j==="p"||j==="P"){const I=Sc[j];return I(R,i.formatLong)}return R}).join("").match(Fc).map(R=>{if(R==="''")return{isToken:!1,value:"'"};const j=R[0];if(j==="'")return{isToken:!1,value:Lc(R)};if(ts[j])return{isToken:!0,value:R};if(j.match(Ac))throw new RangeError("Format string contains an unescaped latin alphabet character `"+j+"`");return{isToken:!1,value:R}});i.localize.preprocessor&&(c=i.localize.preprocessor(d,c));const f={firstWeekContainsDate:a,weekStartsOn:o,locale:i};return c.map(R=>{if(!R.isToken)return R.value;const j=R.value;(!(t!=null&&t.useAdditionalWeekYearTokens)&&Ic(j)||!(t!=null&&t.useAdditionalDayOfYearTokens)&&Tc(j))&&Rc(j,e,String(r));const I=ts[j[0]];return I(d,j,i.localize,f)}).join("")}function Lc(r){const e=r.match(_c);return e?e[1].replace(Oc,"'"):r}function Je({icon:r,title:e,value:t,subtitle:n,color:i}){return Ie(),s.jsxs(qe,{sx:{height:"100%",background:`linear-gradient(135deg, ${v(i,.1)} 0%, ${v(i,.05)} 100%)`,border:`1px solid ${v(i,.2)}`,position:"relative",overflow:"hidden",transition:"all 0.3s ease-in-out","&:hover":{transform:{xs:"none",md:"translateY(-4px)"},boxShadow:{xs:"none",md:`0 12px 32px ${v(i,.3)}`},border:{xs:`1px solid ${v(i,.2)}`,md:`1px solid ${v(i,.4)}`}}},children:[s.jsx(et,{sx:{p:{xs:2,md:3}},children:s.jsx(p,{sx:{display:"flex",alignItems:"flex-start",justifyContent:"space-between",gap:{xs:1,md:2}},children:s.jsxs(p,{children:[s.jsx(p,{sx:{width:{xs:32,md:48},height:{xs:32,md:48},borderRadius:2,background:`linear-gradient(135deg, ${i} 0%, ${v(i,.8)} 100%)`,display:"flex",alignItems:"center",justifyContent:"center",mb:{xs:1,md:2},boxShadow:`0 4px 16px ${v(i,.4)}`},children:Ht.cloneElement(r,{sx:{...r.props.sx,fontSize:{xs:18,md:24},color:"white"}})}),s.jsx(S,{variant:"caption",color:"text.secondary",sx:{textTransform:"uppercase",letterSpacing:.5,fontSize:{xs:"0.6rem",md:"0.75rem"},lineHeight:1.2},children:e}),s.jsx(S,{variant:"h4",sx:{fontWeight:700,mt:.2,mb:.3,fontSize:{xs:"1.25rem",md:"2.125rem"},lineHeight:1},children:typeof t=="number"?t.toLocaleString():t}),n&&s.jsx(S,{variant:"caption",color:"text.secondary",sx:{fontSize:{xs:"0.6rem",md:"0.75rem"},lineHeight:1.2,opacity:.8},children:n})]})})}),s.jsx(p,{sx:{display:{xs:"none",md:"block"},position:"absolute",right:-24,bottom:-24,width:96,height:96,borderRadius:"50%",background:`radial-gradient(circle, ${v(i,.1)} 0%, transparent 70%)`}})]})}const Dc=()=>{var be,ge;const r=Ie(),e=ut(r.breakpoints.down("md")),[t,n]=l.useState([]),[i,a]=l.useState(!0),[o,d]=l.useState(null),[c,f]=l.useState(!1),[h,u]=l.useState(null),[y,O]=l.useState(null),[g,w]=l.useState(null),[x,N]=l.useState("all"),[R,j]=l.useState(null),[I,F]=l.useState(1),[B,$]=l.useState(0),b=10;l.useEffect(()=>{L(),_()},[x,I]);const k=async z=>{try{const K=await Te(fe(ce,"users",z));if(K.exists()){const ee=K.data();return{username:ee.username||"Unknown Teacher",email:ee.email||"No email available"}}}catch(K){console.warn("Could not fetch teacher details for ID:",z,K)}return{username:"Unknown Teacher",email:"No email available"}},L=async()=>{try{a(!0);const z=await ze.getMyCallCount(x);if(z.success){const ee=z.count;$(Math.ceil(ee/b))}const K=await ze.getMyCallHistory(b,I,x);if(K.success){const ee=await Promise.all(K.calls.map(async P=>{if(P.teacherId){const W=await k(P.teacherId);return{...P,teacher:{username:W.username,email:W.email}}}return{...P,teacher:{username:"Unknown Teacher",email:"No email available"}}}));n(ee),j(null)}else throw new Error(K.error||"Failed to fetch call logs")}catch(z){console.error("‚ùå Error fetching call logs:",z),j("Failed to load call logs. Please try again.")}finally{a(!1)}},T=(z,K)=>{F(K)},D=z=>{N(z.target.value),F(1)},_=async()=>{try{const z=await ze.getMyCallStats();z.success?w(z.stats):console.error("‚ùå Failed to fetch stats:",z.error)}catch(z){console.error("‚ùå Error fetching stats:",z)}},Y=async z=>{try{const K=t.find(ee=>ee.id===z||ee.callId===z);if(K)d(K),f(!0);else throw new Error("Call not found")}catch(K){console.error("‚ùå Error fetching call details:",K),j("Failed to load call details.")}},J=(z,K)=>{u(z.currentTarget),O(K)},V=()=>{u(null),O(null)},X=()=>{V(),Y(y)},pe=z=>{switch(z){case"ended":return"success";case"rejected":return"error";case"failed":return"error";case"accepted":case"connected":return"primary";default:return"default"}},ae=z=>{switch(z){case"ended":return s.jsx(Wr,{});case"rejected":case"failed":return s.jsx(eo,{});case"accepted":case"connected":return s.jsx(tr,{});default:return s.jsx(er,{})}},he=z=>{if(!z)return"N/A";const K=Math.floor(z/60),ee=z%60;return`${K}m ${ee}s`},xe=z=>{if(!z)return"N/A";const K=["B","KB","MB","GB"],ee=Math.floor(Math.log(z)/Math.log(1024));return`${(z/Math.pow(1024,ee)).toFixed(1)} ${K[ee]}`};return i?s.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px",children:s.jsx(pr,{})}):s.jsxs(p,{children:[s.jsxs(p,{sx:{mb:4,display:"flex",justifyContent:"space-between",alignItems:"center"},children:[s.jsxs(p,{children:[s.jsxs(S,{variant:"h4",sx:{fontWeight:700,mb:1,display:"flex",alignItems:"center",gap:1},children:[s.jsx(en,{}),"Call History"]}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"View your past video calls and sessions"})]}),s.jsx(Ve,{title:"Refresh call logs",children:s.jsx(se,{onClick:()=>{L(),_()},sx:{backgroundColor:v(r.palette.primary.main,.1),"&:hover":{backgroundColor:v(r.palette.primary.main,.2)}},children:s.jsx(Os,{sx:{fontSize:20}})})})]}),R&&s.jsx(vt,{severity:"error",sx:{mb:3},onClose:()=>j(null),children:R}),g&&(e?s.jsx(p,{sx:{mb:3,mx:-2,px:2,overflow:"hidden"},children:s.jsxs(p,{sx:{display:"flex",gap:1.5,overflowX:"auto",pb:1,"&::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none",WebkitOverflowScrolling:"touch"},children:[s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(Je,{icon:s.jsx(tr,{}),title:"Total Calls",value:g.totalCalls,color:r.palette.primary.main,subtitle:"All time"})}),s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(Je,{icon:s.jsx(Wr,{}),title:"Successful",value:g.successfulCalls,color:r.palette.success.main,subtitle:`${g.totalCalls>0?Math.round(g.successfulCalls/g.totalCalls*100):0}% rate`})}),s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(Je,{icon:s.jsx(er,{}),title:"Duration",value:he(g.totalDuration),color:r.palette.info.main,subtitle:`Avg: ${he(Math.round(g.averageDuration))}`})}),s.jsx(p,{sx:{minWidth:"160px",flex:"0 0 auto"},children:s.jsx(Je,{icon:s.jsx(Lt,{}),title:"Recording",value:xe(g.totalRecordingSize),color:r.palette.secondary.main,subtitle:"Storage used"})})]})}):s.jsxs(oe,{container:!0,spacing:3,sx:{mb:4},children:[s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(Je,{icon:s.jsx(tr,{}),title:"Total Calls",value:g.totalCalls,color:r.palette.primary.main,subtitle:"All time"})}),s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(Je,{icon:s.jsx(Wr,{}),title:"Successful",value:g.successfulCalls,color:r.palette.success.main,subtitle:`${g.totalCalls>0?Math.round(g.successfulCalls/g.totalCalls*100):0}% success rate`})}),s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(Je,{icon:s.jsx(er,{}),title:"Duration",value:he(g.totalDuration),color:r.palette.info.main,subtitle:`Avg: ${he(Math.round(g.averageDuration))}`})}),s.jsx(oe,{item:!0,xs:12,sm:6,md:3,children:s.jsx(Je,{icon:s.jsx(Lt,{}),title:"Recording",value:xe(g.totalRecordingSize),color:r.palette.secondary.main,subtitle:"Storage used"})})]})),s.jsx(p,{sx:{mb:3},children:s.jsxs(Ei,{size:"small",sx:{minWidth:120},children:[s.jsx(Ti,{children:"Status Filter"}),s.jsxs(Ii,{value:x,label:"Status Filter",onChange:D,children:[s.jsx(xt,{value:"all",children:"All"}),s.jsx(xt,{value:"ended",children:"Completed"}),s.jsx(xt,{value:"rejected",children:"Rejected"}),s.jsx(xt,{value:"failed",children:"Failed"}),s.jsx(xt,{value:"accepted",children:"In Progress"})]})]})}),t.length===0?s.jsx(qe,{sx:{mb:3},children:s.jsxs(et,{sx:{textAlign:"center",py:4},children:[s.jsx(en,{sx:{fontSize:48,color:"text.secondary",mb:2}}),s.jsx(S,{variant:"h6",color:"text.secondary",gutterBottom:!0,children:"No calls found"}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"Your call history will appear here once you start making video calls."})]})}):s.jsx(qe,{sx:{mb:3},children:s.jsx(ps,{sx:{p:0},children:t.map((z,K)=>{var ee;return s.jsxs(Ht.Fragment,{children:[s.jsxs(Ri,{sx:{py:2,px:2,transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:v(r.palette.primary.main,.04)}},children:[s.jsx(Pi,{children:s.jsx(mr,{sx:{backgroundColor:v(r.palette.primary.main,.1),color:r.palette.primary.main,width:40,height:40},children:s.jsx(Lt,{sx:{fontSize:20}})})}),s.jsx(ms,{sx:{pr:5},primary:s.jsxs(p,{sx:{mb:.5},children:[s.jsx(S,{variant:"body1",fontWeight:600,sx:{fontSize:"0.95rem",mb:.5},children:((ee=z.teacher)==null?void 0:ee.username)||"Unknown Teacher"}),s.jsx(Ct,{label:z.status,color:pe(z.status),size:"small",icon:ae(z.status),sx:{height:20,fontSize:"0.65rem","& .MuiSvgIcon-root":{fontSize:11}}})]}),secondary:s.jsxs(p,{children:[s.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:.5,pr:1},children:[s.jsx(S,{variant:"caption",color:"text.secondary",children:z.startTime?Xt(new Date(z.startTime),"MMM d, HH:mm"):"N/A"}),s.jsx(S,{variant:"caption",color:"text.secondary",fontWeight:500,children:he(z.duration)})]}),z.recording&&z.recording.enabled&&s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:.5,mt:.5},children:[s.jsx(p,{sx:{width:6,height:6,borderRadius:"50%",backgroundColor:r.palette.success.main}}),s.jsx(S,{variant:"caption",color:"success.main",fontWeight:500,children:"Recorded"})]})]})}),s.jsx(Fi,{children:s.jsx(se,{edge:"end",onClick:P=>J(P,z.callId||z.id),size:"small",sx:{backgroundColor:"transparent","&:hover":{backgroundColor:v(r.palette.action.hover,.5)}},children:s.jsx(no,{sx:{fontSize:18}})})})]}),K<t.length-1&&s.jsx(Ke,{sx:{mx:2}})]},z.callId||z.id)})})}),B>1&&s.jsx(p,{sx:{display:"flex",justifyContent:"center",mt:3},children:s.jsx(Mi,{count:B,page:I,onChange:T,color:"primary",size:"large",showFirstButton:!0,showLastButton:!0,sx:{"& .MuiPaginationItem-root":{fontSize:"1rem"}}})}),s.jsx(_i,{anchorEl:h,open:!!h,onClose:V,children:s.jsxs(xt,{onClick:X,children:[s.jsx(xo,{sx:{mr:1}}),"View Details"]})}),s.jsxs(gr,{open:c,onClose:()=>f(!1),maxWidth:"md",fullWidth:!0,children:[s.jsx(pn,{sx:{bgcolor:"primary.main",color:"white"},children:"Call Details"}),s.jsx(xr,{children:o&&s.jsx(p,{sx:{mt:2},children:s.jsxs(oe,{container:!0,spacing:3,children:[s.jsx(oe,{item:!0,xs:12,md:6,children:s.jsxs(ke,{sx:{p:2,bgcolor:"grey.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"primary",children:"Call Information"}),s.jsx(Ke,{sx:{mb:2}}),s.jsxs(Nt,{spacing:2,children:[s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call ID"}),s.jsx(S,{variant:"body1",sx:{fontFamily:"monospace",fontSize:"0.9rem"},children:o.callId||o.id})]}),s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Status"}),s.jsx(Ct,{label:o.status,color:pe(o.status),size:"small",icon:ae(o.status)})]}),s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Duration"}),s.jsx(S,{variant:"body1",children:he(o.duration)})]})]})]})}),s.jsx(oe,{item:!0,xs:12,md:6,children:s.jsxs(ke,{sx:{p:2,bgcolor:"grey.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"primary",children:"Teacher Information"}),s.jsx(Ke,{sx:{mb:2}}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mb:2},children:[s.jsx(Lt,{sx:{fontSize:56,color:"primary.main"}}),s.jsxs(p,{children:[s.jsx(S,{variant:"h6",children:((be=o.teacher)==null?void 0:be.username)||"Unknown Teacher"}),s.jsx(S,{variant:"body2",color:"text.secondary",children:((ge=o.teacher)==null?void 0:ge.email)||"No email available"})]})]})]})}),s.jsx(oe,{item:!0,xs:12,children:s.jsxs(ke,{sx:{p:2,bgcolor:"grey.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"primary",children:"Timeline"}),s.jsx(Ke,{sx:{mb:2}}),s.jsxs(Nt,{spacing:2,children:[s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call Started"}),s.jsx(S,{variant:"body1",children:o.startTime?Xt(new Date(o.startTime),"EEEE, MMMM d, yyyy 'at' HH:mm:ss"):"N/A"})]}),o.acceptedAt&&s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call Accepted"}),s.jsx(S,{variant:"body1",children:Xt(new Date(o.acceptedAt),"EEEE, MMMM d, yyyy 'at' HH:mm:ss")})]}),o.endTime&&s.jsxs(p,{children:[s.jsx(S,{variant:"body2",color:"text.secondary",gutterBottom:!0,children:"Call Ended"}),s.jsx(S,{variant:"body1",children:Xt(new Date(o.endTime),"EEEE, MMMM d, yyyy 'at' HH:mm:ss")})]})]})]})}),o.recording&&o.recording.enabled&&s.jsx(oe,{item:!0,xs:12,children:s.jsxs(ke,{sx:{p:2,bgcolor:"success.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"success.main",children:"Recording Information"}),s.jsx(Ke,{sx:{mb:2}}),s.jsx(S,{variant:"body2",color:"text.secondary",children:"This call was recorded for quality and training purposes. The recording is securely stored and only accessible by authorized personnel."}),o.recording.chunks&&o.recording.chunks.length>0&&s.jsxs(S,{variant:"body2",sx:{mt:1},children:["Recording contains ",o.recording.chunks.length," segment(s)"]})]})}),o.notes&&s.jsx(oe,{item:!0,xs:12,children:s.jsxs(ke,{sx:{p:2,bgcolor:"info.50"},children:[s.jsx(S,{variant:"h6",gutterBottom:!0,color:"info.main",children:"Teacher Notes"}),s.jsx(Ke,{sx:{mb:2}}),s.jsx(S,{variant:"body1",children:o.notes})]})})]})})}),s.jsx(mn,{children:s.jsx(Ae,{onClick:()=>f(!1),variant:"contained",children:"Close"})})]})]})},rr=280,Wc=[{path:"/dashboard",label:"Dashboard",icon:s.jsx(Xa,{}),description:"Overview and study progress"},{path:"/messages",label:"Messages",icon:s.jsx(tn,{}),description:"Chat with teacher and admin"},{path:"/call-logs",label:"Call History",icon:s.jsx(en,{}),description:"View past video call sessions"},{path:"/settings",label:"Settings",icon:s.jsx(uo,{}),description:"App preferences and profile"}];function Nc({user:r,onLogout:e,apiClient:t,mobileOpen:n,handleDrawerToggle:i}){const a=Ie(),o=Is(),d=jt(),[c,f]=l.useState({messages:0}),h=ut(a.breakpoints.down("lg"));l.useEffect(()=>{u()},[]);const u=async()=>{try{if(!t)return;f({messages:0})}catch(x){console.error("Failed to load badge data:",x)}},y=Wc.map(x=>({...x,badge:x.path==="/messages"?c.messages:null})),O=()=>{e()},g=x=>{o(x),h&&i()},w=s.jsxs(s.Fragment,{children:[s.jsxs(p,{sx:{p:3,background:"rgba(255, 255, 255, 0.15)",borderBottom:"1px solid rgba(255, 255, 255, 0.25)",position:"relative",zIndex:2,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)",boxShadow:"0 2px 10px rgba(0, 0, 0, 0.1)"},children:[s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2,mb:1},children:[s.jsx(p,{component:"img",src:"/logo only.png",alt:"Tarteel-e-Quran Logo",sx:{width:32,height:32,objectFit:"contain"}}),s.jsx(S,{variant:"h5",sx:{fontWeight:700,color:"text.primary"},children:"Student Portal"})]}),s.jsxs(S,{variant:"caption",sx:{color:"text.secondary",fontWeight:500},children:["Welcome, ",(r==null?void 0:r.username)||"Student","!"]})]}),s.jsx(p,{sx:{flex:1,p:2,overflow:"hidden",display:"flex",flexDirection:"column"},children:s.jsx(p,{sx:{flex:1,overflowY:"auto",overflowX:"hidden","&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:`rgba(${a.palette.primary.main.replace("#","").match(/.{2}/g).map(x=>parseInt(x,16)).join(", ")}, 0.1)`,borderRadius:"10px"},"&::-webkit-scrollbar-thumb":{backgroundColor:a.palette.primary.main,borderRadius:"10px","&:hover":{backgroundColor:a.palette.primary.dark}}},children:s.jsx(ps,{sx:{gap:1},children:y.map(x=>{const N=d.pathname===x.path;return s.jsx(Ve,{title:x.description,placement:"right",arrow:!0,children:s.jsxs(Oi,{selected:N,onClick:()=>g(x.path),sx:{borderRadius:2,mb:1,minHeight:{xs:56,md:48},px:{xs:3,md:2},position:"relative",overflow:"hidden","&::before":N?{content:'""',position:"absolute",left:0,top:0,bottom:0,width:4,backgroundColor:a.palette.primary.main,borderRadius:"0 4px 4px 0"}:{},"&:hover":{backgroundColor:`rgba(${a.palette.primary.main.replace("#","").match(/.{2}/g).map(R=>parseInt(R,16)).join(", ")}, 0.08)`,transform:"translateX(4px)","& .MuiListItemIcon-root":{color:a.palette.primary.main}}},children:[s.jsx(Ai,{sx:{color:N?a.palette.primary.main:"text.secondary",minWidth:40,transition:"all 0.2s ease-in-out"},children:x.badge?s.jsx(fn,{badgeContent:x.badge,color:"error",children:x.icon}):x.icon}),s.jsx(ms,{primary:x.label,primaryTypographyProps:{fontSize:"0.875rem",fontWeight:N?600:500,color:N?"primary.main":"text.primary"}})]})},x.path)})})})}),s.jsx(p,{sx:{p:2,background:"rgba(255, 255, 255, 0.1)",borderTop:"1px solid rgba(255, 255, 255, 0.2)",position:"relative",zIndex:2,backdropFilter:"blur(10px)",WebkitBackdropFilter:"blur(10px)"},children:s.jsxs(p,{onClick:O,sx:{display:"flex",alignItems:"center",p:2,borderRadius:2,cursor:"pointer",backgroundColor:"rgba(0, 0, 0, 0.04)",border:`1px solid ${a.palette.divider}`,boxShadow:"0 2px 4px rgba(0, 0, 0, 0.1)",transition:"all 0.2s ease-in-out","&:hover":{backgroundColor:a.palette.error.main,borderColor:a.palette.error.main,transform:"translateY(-2px)",boxShadow:`0 4px 12px ${a.palette.error.main}40`,"& .MuiSvgIcon-root":{color:"#FFFFFF"},"& .MuiTypography-root":{color:"#FFFFFF",fontWeight:600}}},children:[s.jsx(ro,{sx:{fontSize:18,color:a.palette.text.secondary,mr:2,transition:"all 0.2s ease-in-out"}}),s.jsx(S,{variant:"body2",sx:{fontWeight:600,color:a.palette.text.primary,transition:"all 0.2s ease-in-out"},children:"Sign Out"})]})})]});return s.jsxs(p,{component:"nav",sx:{width:{lg:rr},flexShrink:{lg:0}},children:[s.jsx(Jr,{variant:"temporary",open:n,onClose:i,ModalProps:{keepMounted:!0,BackdropProps:{sx:{backgroundColor:"transparent"}}},sx:{display:{xs:"block",lg:"none"},"& .MuiDrawer-paper":{width:rr,boxSizing:"border-box",background:"rgba(255, 255, 255, 0.1)",borderRadius:0,border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.12),
              0 4px 16px rgba(0, 0, 0, 0.08),
              inset 0 1px 0 rgba(255, 255, 255, 0.3),
              inset 0 -1px 0 rgba(255, 255, 255, 0.1)
            `,backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"50%",background:"linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 50%, transparent 100%)",pointerEvents:"none",zIndex:1,borderRadius:0},overflow:"hidden",display:"flex",flexDirection:"column"}},children:w}),s.jsx(Jr,{variant:"permanent",sx:{display:{xs:"none",lg:"block"},"& .MuiDrawer-paper":{width:rr,boxSizing:"border-box",background:"rgba(255, 255, 255, 0.1)",marginTop:0,marginLeft:0,marginBottom:0,marginRight:0,height:"100vh",borderRadius:0,border:"1px solid rgba(255, 255, 255, 0.2)",boxShadow:`
              0 8px 32px rgba(0, 0, 0, 0.12),
              0 4px 16px rgba(0, 0, 0, 0.08),
              inset 0 1px 0 rgba(255, 255, 255, 0.3),
              inset 0 -1px 0 rgba(255, 255, 255, 0.1)
            `,backdropFilter:"blur(20px) saturate(180%)",WebkitBackdropFilter:"blur(20px) saturate(180%)","&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"50%",background:"linear-gradient(180deg, rgba(255, 255, 255, 0.2) 0%, rgba(255, 255, 255, 0.05) 50%, transparent 100%)",pointerEvents:"none",zIndex:1,borderRadius:0},transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden",display:"flex",flexDirection:"column"}},open:!0,children:w})]})}function zc({currentPath:r,handleDrawerToggle:e}){const t=Ie();jt();const n=ut(t.breakpoints.down("lg"));return s.jsx(s.Fragment,{children:n&&s.jsx(ke,{elevation:2,sx:{height:100,display:"flex",alignItems:"center",justifyContent:"space-between",px:3,pt:"env(safe-area-inset-top)",background:t.palette.primary.main,backdropFilter:"blur(20px)",borderRadius:0,boxShadow:"0 4px 20px rgba(0, 0, 0, 0.3)",WebkitAppRegion:"drag",position:"fixed",top:0,left:{xs:0,md:0},right:0,zIndex:t.zIndex.appBar+1,"&::before":{content:'""',position:"absolute",top:0,left:0,right:0,height:"1px",background:"linear-gradient(90deg, transparent 0%, rgba(51, 150, 211, 0.5) 50%, transparent 100%)"}},children:s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:2},children:[s.jsx(se,{color:"inherit","aria-label":"open drawer",edge:"start",onClick:e,sx:{WebkitAppRegion:"no-drag"},children:s.jsx(Fs,{})}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{component:"img",src:"/logo only.png",alt:"Tarteel-e-Quran Logo",sx:{width:40,height:40,objectFit:"contain"}}),s.jsx(S,{variant:"h6",sx:{color:"white",fontWeight:600,fontSize:"1.1rem"},children:"Tarteel-e-Quran"})]})]})})})}function Uc({children:r,user:e,onLogout:t,socketManager:n,apiClient:i}){const a=Ie();jt();const[o,d]=l.useState(!1),c=()=>{d(!o)};return s.jsxs(p,{sx:{display:"flex",minHeight:"100vh",backgroundColor:a.palette.background.default,padding:0},children:[s.jsx(Nc,{user:e,onLogout:t,apiClient:i,mobileOpen:o,handleDrawerToggle:c}),s.jsxs(p,{component:"main",sx:{flexGrow:1,display:"flex",flexDirection:"column",height:"100vh",width:{xs:"100%",lg:`calc(100% - ${rr}px)`},marginLeft:{xs:0,lg:0},position:"relative",transition:"all 0.3s cubic-bezier(0.4, 0, 0.2, 1)",overflow:"hidden"},children:[s.jsx(zc,{handleDrawerToggle:c}),s.jsx(p,{sx:{flex:1,mt:{xs:"calc(100px + env(safe-area-inset-top))",lg:"0px"},p:{xs:2,sm:3},overflow:"auto",overflowX:"hidden",position:"relative",height:{xs:"calc(100vh - 100px - env(safe-area-inset-top))",lg:"100vh"},"&::-webkit-scrollbar":{width:"8px"},"&::-webkit-scrollbar-track":{backgroundColor:"transparent"},"&::-webkit-scrollbar-thumb":{backgroundColor:"rgba(0, 0, 0, 0.2)",borderRadius:"4px"},"&::-webkit-scrollbar-thumb:hover":{backgroundColor:"rgba(0, 0, 0, 0.3)"}},children:r})]})]})}const Bc=l.createContext(),$c=({children:r,apiClient:e})=>{const[t,n]=l.useState({}),[i,a]=l.useState({});l.useEffect(()=>{try{const b=localStorage.getItem("student-app-cache");if(b){const k=JSON.parse(b),L=Date.now(),T={};Object.keys(k).forEach(D=>{const _=k[D];_&&_.timestamp&&L-_.timestamp<6e5&&(T[D]=_)}),n(T)}}catch(b){console.error("Error loading cache from localStorage:",b)}},[]),l.useEffect(()=>{try{localStorage.setItem("student-app-cache",JSON.stringify(t))}catch(b){console.error("Error saving cache to localStorage:",b)}},[t]);const o=l.useCallback(b=>{const k=t[b];return k?Date.now()-k.timestamp>6e5?(n(T=>{const D={...T};return delete D[b],D}),null):k.data:null},[t]),d=l.useCallback((b,k)=>{n(L=>({...L,[b]:{data:k,timestamp:Date.now()}}))},[]),c=l.useCallback(b=>i[b]||!1,[i]),f=l.useCallback((b,k)=>{a(L=>({...L,[b]:k}))},[]),h=l.useCallback(async(b,k,L=!1)=>{if(!L){const T=o(b);if(T)return T}if(c(b))return null;try{f(b,!0);const T=await k();return d(b,T),T}catch(T){throw console.error(`Error fetching ${b}:`,T),T}finally{f(b,!1)}},[o,d,c,f]),u=l.useCallback(async(b=!1)=>{const k=(await lt(()=>Promise.resolve().then(()=>Kn),void 0,import.meta.url)).default,{auth:L}=await lt(()=>Promise.resolve().then(()=>Ls),void 0,import.meta.url),T=L.currentUser;return T?h("myTeacher",()=>k.getMyTeacher(T.uid),b):{success:!1,teacher:null,error:"No authenticated user"}},[h]),y=l.useCallback(async(b=!1)=>h("mySchedule",()=>e.getMySchedule(),b),[h,e]),O=l.useCallback(async(b=!1)=>h("myMessages",()=>e.getMessages(),b),[h,e]),g=l.useCallback(async(b=!1)=>{const k=(await lt(()=>Promise.resolve().then(()=>Kn),void 0,import.meta.url)).default;return h("users",()=>k.getAllUsers(),b)},[h]),w=l.useCallback(async(b=!1)=>h("myCalls",()=>e.getMyCalls(),b),[h,e]),x=l.useCallback(async(b=!1)=>h("studentStats",async()=>{const k=await fetch(`${e.baseURL}/users/my-stats`,{headers:e.getAuthHeaders()});return await e.handleResponse(k)},b),[h,e]),N=l.useCallback(async(b=10,k=!1)=>h(`recentActivity_${b}`,async()=>{const L=await fetch(`${e.baseURL}/activities/recent?limit=${b}`,{headers:e.getAuthHeaders()});return await e.handleResponse(L)},k),[h,e]),R=l.useCallback(async(b=!1)=>h("upcomingClasses",async()=>{const k=await fetch(`${e.baseURL}/calls/upcoming`,{headers:e.getAuthHeaders()});return await e.handleResponse(k)},b),[h,e]),j=l.useCallback(b=>{typeof b=="string"&&(b=[b]),n(k=>{const L={...k};return b.forEach(T=>{if(T.includes("*")){const D=T.replace("*","");Object.keys(L).forEach(_=>{_.startsWith(D)&&delete L[_]})}else delete L[T]}),L})},[]),I=l.useCallback(()=>{n({}),localStorage.removeItem("student-app-cache")},[]),F=l.useCallback(async()=>{j(["studentStats","myTeacher","upcomingClasses","recentActivity_10"]);try{await Promise.all([x(!0),u(!0),R(!0),N(10,!0)])}catch(k){console.error("Error refreshing dashboard:",k)}},[x,u,R,N,j]),B=l.useCallback(()=>{const b=Object.keys(t),k=Date.now();return{totalItems:b.length,validItems:b.filter(L=>k-t[L].timestamp<6e5).length,expiredItems:b.filter(L=>k-t[L].timestamp>=6e5).length,loadingItems:Object.keys(i).filter(L=>i[L]).length,cacheKeys:b}},[t,i]),$={getCachedData:o,setCachedData:d,fetchWithCache:h,isLoading:c,getMyTeacher:u,getMySchedule:y,getMyMessages:O,getMyCalls:w,getUsers:g,getStudentStats:x,getRecentActivity:N,getUpcomingClasses:R,invalidateCache:j,clearCache:I,refreshDashboard:F,getCacheStats:B,cache:t,loadingStates:i};return s.jsx(Bc.Provider,{value:$,children:r})},Be=Object.create(null);Be.open="0";Be.close="1";Be.ping="2";Be.pong="3";Be.message="4";Be.upgrade="5";Be.noop="6";const nr=Object.create(null);Object.keys(Be).forEach(r=>{nr[Be[r]]=r});const nn={type:"error",data:"parser error"},Us=typeof Blob=="function"||typeof Blob<"u"&&Object.prototype.toString.call(Blob)==="[object BlobConstructor]",Bs=typeof ArrayBuffer=="function",$s=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r&&r.buffer instanceof ArrayBuffer,Cn=({type:r,data:e},t,n)=>Us&&e instanceof Blob?t?n(e):is(e,n):Bs&&(e instanceof ArrayBuffer||$s(e))?t?n(e):is(new Blob([e]),n):n(Be[r]+(e||"")),is=(r,e)=>{const t=new FileReader;return t.onload=function(){const n=t.result.split(",")[1];e("b"+(n||""))},t.readAsDataURL(r)};function as(r){return r instanceof Uint8Array?r:r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer,r.byteOffset,r.byteLength)}let Ur;function Hc(r,e){if(Us&&r.data instanceof Blob)return r.data.arrayBuffer().then(as).then(e);if(Bs&&(r.data instanceof ArrayBuffer||$s(r.data)))return e(as(r.data));Cn(r,!1,t=>{Ur||(Ur=new TextEncoder),e(Ur.encode(t))})}const os="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",Wt=typeof Uint8Array>"u"?[]:new Uint8Array(256);for(let r=0;r<os.length;r++)Wt[os.charCodeAt(r)]=r;const Vc=r=>{let e=r.length*.75,t=r.length,n,i=0,a,o,d,c;r[r.length-1]==="="&&(e--,r[r.length-2]==="="&&e--);const f=new ArrayBuffer(e),h=new Uint8Array(f);for(n=0;n<t;n+=4)a=Wt[r.charCodeAt(n)],o=Wt[r.charCodeAt(n+1)],d=Wt[r.charCodeAt(n+2)],c=Wt[r.charCodeAt(n+3)],h[i++]=a<<2|o>>4,h[i++]=(o&15)<<4|d>>2,h[i++]=(d&3)<<6|c&63;return f},qc=typeof ArrayBuffer=="function",Sn=(r,e)=>{if(typeof r!="string")return{type:"message",data:Hs(r,e)};const t=r.charAt(0);return t==="b"?{type:"message",data:Yc(r.substring(1),e)}:nr[t]?r.length>1?{type:nr[t],data:r.substring(1)}:{type:nr[t]}:nn},Yc=(r,e)=>{if(qc){const t=Vc(r);return Hs(t,e)}else return{base64:!0,data:r}},Hs=(r,e)=>{switch(e){case"blob":return r instanceof Blob?r:new Blob([r]);case"arraybuffer":default:return r instanceof ArrayBuffer?r:r.buffer}},Vs=String.fromCharCode(30),Gc=(r,e)=>{const t=r.length,n=new Array(t);let i=0;r.forEach((a,o)=>{Cn(a,!1,d=>{n[o]=d,++i===t&&e(n.join(Vs))})})},Jc=(r,e)=>{const t=r.split(Vs),n=[];for(let i=0;i<t.length;i++){const a=Sn(t[i],e);if(n.push(a),a.type==="error")break}return n};function Xc(){return new TransformStream({transform(r,e){Hc(r,t=>{const n=t.length;let i;if(n<126)i=new Uint8Array(1),new DataView(i.buffer).setUint8(0,n);else if(n<65536){i=new Uint8Array(3);const a=new DataView(i.buffer);a.setUint8(0,126),a.setUint16(1,n)}else{i=new Uint8Array(9);const a=new DataView(i.buffer);a.setUint8(0,127),a.setBigUint64(1,BigInt(n))}r.data&&typeof r.data!="string"&&(i[0]|=128),e.enqueue(i),e.enqueue(t)})}})}let Br;function Kt(r){return r.reduce((e,t)=>e+t.length,0)}function Qt(r,e){if(r[0].length===e)return r.shift();const t=new Uint8Array(e);let n=0;for(let i=0;i<e;i++)t[i]=r[0][n++],n===r[0].length&&(r.shift(),n=0);return r.length&&n<r[0].length&&(r[0]=r[0].slice(n)),t}function Kc(r,e){Br||(Br=new TextDecoder);const t=[];let n=0,i=-1,a=!1;return new TransformStream({transform(o,d){for(t.push(o);;){if(n===0){if(Kt(t)<1)break;const c=Qt(t,1);a=(c[0]&128)===128,i=c[0]&127,i<126?n=3:i===126?n=1:n=2}else if(n===1){if(Kt(t)<2)break;const c=Qt(t,2);i=new DataView(c.buffer,c.byteOffset,c.length).getUint16(0),n=3}else if(n===2){if(Kt(t)<8)break;const c=Qt(t,8),f=new DataView(c.buffer,c.byteOffset,c.length),h=f.getUint32(0);if(h>Math.pow(2,53-32)-1){d.enqueue(nn);break}i=h*Math.pow(2,32)+f.getUint32(4),n=3}else{if(Kt(t)<i)break;const c=Qt(t,i);d.enqueue(Sn(a?c:Br.decode(c),e)),n=0}if(i===0||i>r){d.enqueue(nn);break}}}})}const qs=4;function de(r){if(r)return Qc(r)}function Qc(r){for(var e in de.prototype)r[e]=de.prototype[e];return r}de.prototype.on=de.prototype.addEventListener=function(r,e){return this._callbacks=this._callbacks||{},(this._callbacks["$"+r]=this._callbacks["$"+r]||[]).push(e),this};de.prototype.once=function(r,e){function t(){this.off(r,t),e.apply(this,arguments)}return t.fn=e,this.on(r,t),this};de.prototype.off=de.prototype.removeListener=de.prototype.removeAllListeners=de.prototype.removeEventListener=function(r,e){if(this._callbacks=this._callbacks||{},arguments.length==0)return this._callbacks={},this;var t=this._callbacks["$"+r];if(!t)return this;if(arguments.length==1)return delete this._callbacks["$"+r],this;for(var n,i=0;i<t.length;i++)if(n=t[i],n===e||n.fn===e){t.splice(i,1);break}return t.length===0&&delete this._callbacks["$"+r],this};de.prototype.emit=function(r){this._callbacks=this._callbacks||{};for(var e=new Array(arguments.length-1),t=this._callbacks["$"+r],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(t){t=t.slice(0);for(var n=0,i=t.length;n<i;++n)t[n].apply(this,e)}return this};de.prototype.emitReserved=de.prototype.emit;de.prototype.listeners=function(r){return this._callbacks=this._callbacks||{},this._callbacks["$"+r]||[]};de.prototype.hasListeners=function(r){return!!this.listeners(r).length};const wr=(()=>typeof Promise=="function"&&typeof Promise.resolve=="function"?e=>Promise.resolve().then(e):(e,t)=>t(e,0))(),Ee=(()=>typeof self<"u"?self:typeof window<"u"?window:Function("return this")())(),Zc="arraybuffer";function Ys(r,...e){return e.reduce((t,n)=>(r.hasOwnProperty(n)&&(t[n]=r[n]),t),{})}const el=Ee.setTimeout,tl=Ee.clearTimeout;function vr(r,e){e.useNativeTimers?(r.setTimeoutFn=el.bind(Ee),r.clearTimeoutFn=tl.bind(Ee)):(r.setTimeoutFn=Ee.setTimeout.bind(Ee),r.clearTimeoutFn=Ee.clearTimeout.bind(Ee))}const rl=1.33;function nl(r){return typeof r=="string"?sl(r):Math.ceil((r.byteLength||r.size)*rl)}function sl(r){let e=0,t=0;for(let n=0,i=r.length;n<i;n++)e=r.charCodeAt(n),e<128?t+=1:e<2048?t+=2:e<55296||e>=57344?t+=3:(n++,t+=4);return t}function Gs(){return Date.now().toString(36).substring(3)+Math.random().toString(36).substring(2,5)}function il(r){let e="";for(let t in r)r.hasOwnProperty(t)&&(e.length&&(e+="&"),e+=encodeURIComponent(t)+"="+encodeURIComponent(r[t]));return e}function al(r){let e={},t=r.split("&");for(let n=0,i=t.length;n<i;n++){let a=t[n].split("=");e[decodeURIComponent(a[0])]=decodeURIComponent(a[1])}return e}class ol extends Error{constructor(e,t,n){super(e),this.description=t,this.context=n,this.type="TransportError"}}class kn extends de{constructor(e){super(),this.writable=!1,vr(this,e),this.opts=e,this.query=e.query,this.socket=e.socket,this.supportsBinary=!e.forceBase64}onError(e,t,n){return super.emitReserved("error",new ol(e,t,n)),this}open(){return this.readyState="opening",this.doOpen(),this}close(){return(this.readyState==="opening"||this.readyState==="open")&&(this.doClose(),this.onClose()),this}send(e){this.readyState==="open"&&this.write(e)}onOpen(){this.readyState="open",this.writable=!0,super.emitReserved("open")}onData(e){const t=Sn(e,this.socket.binaryType);this.onPacket(t)}onPacket(e){super.emitReserved("packet",e)}onClose(e){this.readyState="closed",super.emitReserved("close",e)}pause(e){}createUri(e,t={}){return e+"://"+this._hostname()+this._port()+this.opts.path+this._query(t)}_hostname(){const e=this.opts.hostname;return e.indexOf(":")===-1?e:"["+e+"]"}_port(){return this.opts.port&&(this.opts.secure&&+(this.opts.port!==443)||!this.opts.secure&&Number(this.opts.port)!==80)?":"+this.opts.port:""}_query(e){const t=il(e);return t.length?"?"+t:""}}class cl extends kn{constructor(){super(...arguments),this._polling=!1}get name(){return"polling"}doOpen(){this._poll()}pause(e){this.readyState="pausing";const t=()=>{this.readyState="paused",e()};if(this._polling||!this.writable){let n=0;this._polling&&(n++,this.once("pollComplete",function(){--n||t()})),this.writable||(n++,this.once("drain",function(){--n||t()}))}else t()}_poll(){this._polling=!0,this.doPoll(),this.emitReserved("poll")}onData(e){const t=n=>{if(this.readyState==="opening"&&n.type==="open"&&this.onOpen(),n.type==="close")return this.onClose({description:"transport closed by the server"}),!1;this.onPacket(n)};Jc(e,this.socket.binaryType).forEach(t),this.readyState!=="closed"&&(this._polling=!1,this.emitReserved("pollComplete"),this.readyState==="open"&&this._poll())}doClose(){const e=()=>{this.write([{type:"close"}])};this.readyState==="open"?e():this.once("open",e)}write(e){this.writable=!1,Gc(e,t=>{this.doWrite(t,()=>{this.writable=!0,this.emitReserved("drain")})})}uri(){const e=this.opts.secure?"https":"http",t=this.query||{};return this.opts.timestampRequests!==!1&&(t[this.opts.timestampParam]=Gs()),!this.supportsBinary&&!t.sid&&(t.b64=1),this.createUri(e,t)}}let Js=!1;try{Js=typeof XMLHttpRequest<"u"&&"withCredentials"in new XMLHttpRequest}catch{}const ll=Js;function dl(){}class ul extends cl{constructor(e){if(super(e),typeof location<"u"){const t=location.protocol==="https:";let n=location.port;n||(n=t?"443":"80"),this.xd=typeof location<"u"&&e.hostname!==location.hostname||n!==e.port}}doWrite(e,t){const n=this.request({method:"POST",data:e});n.on("success",t),n.on("error",(i,a)=>{this.onError("xhr post error",i,a)})}doPoll(){const e=this.request();e.on("data",this.onData.bind(this)),e.on("error",(t,n)=>{this.onError("xhr poll error",t,n)}),this.pollXhr=e}}let wt=class sr extends de{constructor(e,t,n){super(),this.createRequest=e,vr(this,n),this._opts=n,this._method=n.method||"GET",this._uri=t,this._data=n.data!==void 0?n.data:null,this._create()}_create(){var e;const t=Ys(this._opts,"agent","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","autoUnref");t.xdomain=!!this._opts.xd;const n=this._xhr=this.createRequest(t);try{n.open(this._method,this._uri,!0);try{if(this._opts.extraHeaders){n.setDisableHeaderCheck&&n.setDisableHeaderCheck(!0);for(let i in this._opts.extraHeaders)this._opts.extraHeaders.hasOwnProperty(i)&&n.setRequestHeader(i,this._opts.extraHeaders[i])}}catch{}if(this._method==="POST")try{n.setRequestHeader("Content-type","text/plain;charset=UTF-8")}catch{}try{n.setRequestHeader("Accept","*/*")}catch{}(e=this._opts.cookieJar)===null||e===void 0||e.addCookies(n),"withCredentials"in n&&(n.withCredentials=this._opts.withCredentials),this._opts.requestTimeout&&(n.timeout=this._opts.requestTimeout),n.onreadystatechange=()=>{var i;n.readyState===3&&((i=this._opts.cookieJar)===null||i===void 0||i.parseCookies(n.getResponseHeader("set-cookie"))),n.readyState===4&&(n.status===200||n.status===1223?this._onLoad():this.setTimeoutFn(()=>{this._onError(typeof n.status=="number"?n.status:0)},0))},n.send(this._data)}catch(i){this.setTimeoutFn(()=>{this._onError(i)},0);return}typeof document<"u"&&(this._index=sr.requestsCount++,sr.requests[this._index]=this)}_onError(e){this.emitReserved("error",e,this._xhr),this._cleanup(!0)}_cleanup(e){if(!(typeof this._xhr>"u"||this._xhr===null)){if(this._xhr.onreadystatechange=dl,e)try{this._xhr.abort()}catch{}typeof document<"u"&&delete sr.requests[this._index],this._xhr=null}}_onLoad(){const e=this._xhr.responseText;e!==null&&(this.emitReserved("data",e),this.emitReserved("success"),this._cleanup())}abort(){this._cleanup()}};wt.requestsCount=0;wt.requests={};if(typeof document<"u"){if(typeof attachEvent=="function")attachEvent("onunload",cs);else if(typeof addEventListener=="function"){const r="onpagehide"in Ee?"pagehide":"unload";addEventListener(r,cs,!1)}}function cs(){for(let r in wt.requests)wt.requests.hasOwnProperty(r)&&wt.requests[r].abort()}const hl=function(){const r=Xs({xdomain:!1});return r&&r.responseType!==null}();class fl extends ul{constructor(e){super(e);const t=e&&e.forceBase64;this.supportsBinary=hl&&!t}request(e={}){return Object.assign(e,{xd:this.xd},this.opts),new wt(Xs,this.uri(),e)}}function Xs(r){const e=r.xdomain;try{if(typeof XMLHttpRequest<"u"&&(!e||ll))return new XMLHttpRequest}catch{}if(!e)try{return new Ee[["Active"].concat("Object").join("X")]("Microsoft.XMLHTTP")}catch{}}const Ks=typeof navigator<"u"&&typeof navigator.product=="string"&&navigator.product.toLowerCase()==="reactnative";class pl extends kn{get name(){return"websocket"}doOpen(){const e=this.uri(),t=this.opts.protocols,n=Ks?{}:Ys(this.opts,"agent","perMessageDeflate","pfx","key","passphrase","cert","ca","ciphers","rejectUnauthorized","localAddress","protocolVersion","origin","maxPayload","family","checkServerIdentity");this.opts.extraHeaders&&(n.headers=this.opts.extraHeaders);try{this.ws=this.createSocket(e,t,n)}catch(i){return this.emitReserved("error",i)}this.ws.binaryType=this.socket.binaryType,this.addEventListeners()}addEventListeners(){this.ws.onopen=()=>{this.opts.autoUnref&&this.ws._socket.unref(),this.onOpen()},this.ws.onclose=e=>this.onClose({description:"websocket connection closed",context:e}),this.ws.onmessage=e=>this.onData(e.data),this.ws.onerror=e=>this.onError("websocket error",e)}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;Cn(n,this.supportsBinary,a=>{try{this.doWrite(n,a)}catch{}i&&wr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){typeof this.ws<"u"&&(this.ws.onerror=()=>{},this.ws.close(),this.ws=null)}uri(){const e=this.opts.secure?"wss":"ws",t=this.query||{};return this.opts.timestampRequests&&(t[this.opts.timestampParam]=Gs()),this.supportsBinary||(t.b64=1),this.createUri(e,t)}}const $r=Ee.WebSocket||Ee.MozWebSocket;class ml extends pl{createSocket(e,t,n){return Ks?new $r(e,t,n):t?new $r(e,t):new $r(e)}doWrite(e,t){this.ws.send(t)}}class gl extends kn{get name(){return"webtransport"}doOpen(){try{this._transport=new WebTransport(this.createUri("https"),this.opts.transportOptions[this.name])}catch(e){return this.emitReserved("error",e)}this._transport.closed.then(()=>{this.onClose()}).catch(e=>{this.onError("webtransport error",e)}),this._transport.ready.then(()=>{this._transport.createBidirectionalStream().then(e=>{const t=Kc(Number.MAX_SAFE_INTEGER,this.socket.binaryType),n=e.readable.pipeThrough(t).getReader(),i=Xc();i.readable.pipeTo(e.writable),this._writer=i.writable.getWriter();const a=()=>{n.read().then(({done:d,value:c})=>{d||(this.onPacket(c),a())}).catch(d=>{})};a();const o={type:"open"};this.query.sid&&(o.data=`{"sid":"${this.query.sid}"}`),this._writer.write(o).then(()=>this.onOpen())})})}write(e){this.writable=!1;for(let t=0;t<e.length;t++){const n=e[t],i=t===e.length-1;this._writer.write(n).then(()=>{i&&wr(()=>{this.writable=!0,this.emitReserved("drain")},this.setTimeoutFn)})}}doClose(){var e;(e=this._transport)===null||e===void 0||e.close()}}const xl={websocket:ml,webtransport:gl,polling:fl},bl=/^(?:(?![^:@\/?#]+:[^:@\/]*@)(http|https|ws|wss):\/\/)?((?:(([^:@\/?#]*)(?::([^:@\/?#]*))?)?@)?((?:[a-f0-9]{0,4}:){2,7}[a-f0-9]{0,4}|[^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/,yl=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","anchor"];function sn(r){if(r.length>8e3)throw"URI too long";const e=r,t=r.indexOf("["),n=r.indexOf("]");t!=-1&&n!=-1&&(r=r.substring(0,t)+r.substring(t,n).replace(/:/g,";")+r.substring(n,r.length));let i=bl.exec(r||""),a={},o=14;for(;o--;)a[yl[o]]=i[o]||"";return t!=-1&&n!=-1&&(a.source=e,a.host=a.host.substring(1,a.host.length-1).replace(/;/g,":"),a.authority=a.authority.replace("[","").replace("]","").replace(/;/g,":"),a.ipv6uri=!0),a.pathNames=wl(a,a.path),a.queryKey=vl(a,a.query),a}function wl(r,e){const t=/\/{2,9}/g,n=e.replace(t,"/").split("/");return(e.slice(0,1)=="/"||e.length===0)&&n.splice(0,1),e.slice(-1)=="/"&&n.splice(n.length-1,1),n}function vl(r,e){const t={};return e.replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(n,i,a){i&&(t[i]=a)}),t}const an=typeof addEventListener=="function"&&typeof removeEventListener=="function",ir=[];an&&addEventListener("offline",()=>{ir.forEach(r=>r())},!1);class rt extends de{constructor(e,t){if(super(),this.binaryType=Zc,this.writeBuffer=[],this._prevBufferLen=0,this._pingInterval=-1,this._pingTimeout=-1,this._maxPayload=-1,this._pingTimeoutTime=1/0,e&&typeof e=="object"&&(t=e,e=null),e){const n=sn(e);t.hostname=n.host,t.secure=n.protocol==="https"||n.protocol==="wss",t.port=n.port,n.query&&(t.query=n.query)}else t.host&&(t.hostname=sn(t.host).host);vr(this,t),this.secure=t.secure!=null?t.secure:typeof location<"u"&&location.protocol==="https:",t.hostname&&!t.port&&(t.port=this.secure?"443":"80"),this.hostname=t.hostname||(typeof location<"u"?location.hostname:"localhost"),this.port=t.port||(typeof location<"u"&&location.port?location.port:this.secure?"443":"80"),this.transports=[],this._transportsByName={},t.transports.forEach(n=>{const i=n.prototype.name;this.transports.push(i),this._transportsByName[i]=n}),this.opts=Object.assign({path:"/engine.io",agent:!1,withCredentials:!1,upgrade:!0,timestampParam:"t",rememberUpgrade:!1,addTrailingSlash:!0,rejectUnauthorized:!0,perMessageDeflate:{threshold:1024},transportOptions:{},closeOnBeforeunload:!1},t),this.opts.path=this.opts.path.replace(/\/$/,"")+(this.opts.addTrailingSlash?"/":""),typeof this.opts.query=="string"&&(this.opts.query=al(this.opts.query)),an&&(this.opts.closeOnBeforeunload&&(this._beforeunloadEventListener=()=>{this.transport&&(this.transport.removeAllListeners(),this.transport.close())},addEventListener("beforeunload",this._beforeunloadEventListener,!1)),this.hostname!=="localhost"&&(this._offlineEventListener=()=>{this._onClose("transport close",{description:"network connection lost"})},ir.push(this._offlineEventListener))),this.opts.withCredentials&&(this._cookieJar=void 0),this._open()}createTransport(e){const t=Object.assign({},this.opts.query);t.EIO=qs,t.transport=e,this.id&&(t.sid=this.id);const n=Object.assign({},this.opts,{query:t,socket:this,hostname:this.hostname,secure:this.secure,port:this.port},this.opts.transportOptions[e]);return new this._transportsByName[e](n)}_open(){if(this.transports.length===0){this.setTimeoutFn(()=>{this.emitReserved("error","No transports available")},0);return}const e=this.opts.rememberUpgrade&&rt.priorWebsocketSuccess&&this.transports.indexOf("websocket")!==-1?"websocket":this.transports[0];this.readyState="opening";const t=this.createTransport(e);t.open(),this.setTransport(t)}setTransport(e){this.transport&&this.transport.removeAllListeners(),this.transport=e,e.on("drain",this._onDrain.bind(this)).on("packet",this._onPacket.bind(this)).on("error",this._onError.bind(this)).on("close",t=>this._onClose("transport close",t))}onOpen(){this.readyState="open",rt.priorWebsocketSuccess=this.transport.name==="websocket",this.emitReserved("open"),this.flush()}_onPacket(e){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing")switch(this.emitReserved("packet",e),this.emitReserved("heartbeat"),e.type){case"open":this.onHandshake(JSON.parse(e.data));break;case"ping":this._sendPacket("pong"),this.emitReserved("ping"),this.emitReserved("pong"),this._resetPingTimeout();break;case"error":const t=new Error("server error");t.code=e.data,this._onError(t);break;case"message":this.emitReserved("data",e.data),this.emitReserved("message",e.data);break}}onHandshake(e){this.emitReserved("handshake",e),this.id=e.sid,this.transport.query.sid=e.sid,this._pingInterval=e.pingInterval,this._pingTimeout=e.pingTimeout,this._maxPayload=e.maxPayload,this.onOpen(),this.readyState!=="closed"&&this._resetPingTimeout()}_resetPingTimeout(){this.clearTimeoutFn(this._pingTimeoutTimer);const e=this._pingInterval+this._pingTimeout;this._pingTimeoutTime=Date.now()+e,this._pingTimeoutTimer=this.setTimeoutFn(()=>{this._onClose("ping timeout")},e),this.opts.autoUnref&&this._pingTimeoutTimer.unref()}_onDrain(){this.writeBuffer.splice(0,this._prevBufferLen),this._prevBufferLen=0,this.writeBuffer.length===0?this.emitReserved("drain"):this.flush()}flush(){if(this.readyState!=="closed"&&this.transport.writable&&!this.upgrading&&this.writeBuffer.length){const e=this._getWritablePackets();this.transport.send(e),this._prevBufferLen=e.length,this.emitReserved("flush")}}_getWritablePackets(){if(!(this._maxPayload&&this.transport.name==="polling"&&this.writeBuffer.length>1))return this.writeBuffer;let t=1;for(let n=0;n<this.writeBuffer.length;n++){const i=this.writeBuffer[n].data;if(i&&(t+=nl(i)),n>0&&t>this._maxPayload)return this.writeBuffer.slice(0,n);t+=2}return this.writeBuffer}_hasPingExpired(){if(!this._pingTimeoutTime)return!0;const e=Date.now()>this._pingTimeoutTime;return e&&(this._pingTimeoutTime=0,wr(()=>{this._onClose("ping timeout")},this.setTimeoutFn)),e}write(e,t,n){return this._sendPacket("message",e,t,n),this}send(e,t,n){return this._sendPacket("message",e,t,n),this}_sendPacket(e,t,n,i){if(typeof t=="function"&&(i=t,t=void 0),typeof n=="function"&&(i=n,n=null),this.readyState==="closing"||this.readyState==="closed")return;n=n||{},n.compress=n.compress!==!1;const a={type:e,data:t,options:n};this.emitReserved("packetCreate",a),this.writeBuffer.push(a),i&&this.once("flush",i),this.flush()}close(){const e=()=>{this._onClose("forced close"),this.transport.close()},t=()=>{this.off("upgrade",t),this.off("upgradeError",t),e()},n=()=>{this.once("upgrade",t),this.once("upgradeError",t)};return(this.readyState==="opening"||this.readyState==="open")&&(this.readyState="closing",this.writeBuffer.length?this.once("drain",()=>{this.upgrading?n():e()}):this.upgrading?n():e()),this}_onError(e){if(rt.priorWebsocketSuccess=!1,this.opts.tryAllTransports&&this.transports.length>1&&this.readyState==="opening")return this.transports.shift(),this._open();this.emitReserved("error",e),this._onClose("transport error",e)}_onClose(e,t){if(this.readyState==="opening"||this.readyState==="open"||this.readyState==="closing"){if(this.clearTimeoutFn(this._pingTimeoutTimer),this.transport.removeAllListeners("close"),this.transport.close(),this.transport.removeAllListeners(),an&&(this._beforeunloadEventListener&&removeEventListener("beforeunload",this._beforeunloadEventListener,!1),this._offlineEventListener)){const n=ir.indexOf(this._offlineEventListener);n!==-1&&ir.splice(n,1)}this.readyState="closed",this.id=null,this.emitReserved("close",e,t),this.writeBuffer=[],this._prevBufferLen=0}}}rt.protocol=qs;class Cl extends rt{constructor(){super(...arguments),this._upgrades=[]}onOpen(){if(super.onOpen(),this.readyState==="open"&&this.opts.upgrade)for(let e=0;e<this._upgrades.length;e++)this._probe(this._upgrades[e])}_probe(e){let t=this.createTransport(e),n=!1;rt.priorWebsocketSuccess=!1;const i=()=>{n||(t.send([{type:"ping",data:"probe"}]),t.once("packet",u=>{if(!n)if(u.type==="pong"&&u.data==="probe"){if(this.upgrading=!0,this.emitReserved("upgrading",t),!t)return;rt.priorWebsocketSuccess=t.name==="websocket",this.transport.pause(()=>{n||this.readyState!=="closed"&&(h(),this.setTransport(t),t.send([{type:"upgrade"}]),this.emitReserved("upgrade",t),t=null,this.upgrading=!1,this.flush())})}else{const y=new Error("probe error");y.transport=t.name,this.emitReserved("upgradeError",y)}}))};function a(){n||(n=!0,h(),t.close(),t=null)}const o=u=>{const y=new Error("probe error: "+u);y.transport=t.name,a(),this.emitReserved("upgradeError",y)};function d(){o("transport closed")}function c(){o("socket closed")}function f(u){t&&u.name!==t.name&&a()}const h=()=>{t.removeListener("open",i),t.removeListener("error",o),t.removeListener("close",d),this.off("close",c),this.off("upgrading",f)};t.once("open",i),t.once("error",o),t.once("close",d),this.once("close",c),this.once("upgrading",f),this._upgrades.indexOf("webtransport")!==-1&&e!=="webtransport"?this.setTimeoutFn(()=>{n||t.open()},200):t.open()}onHandshake(e){this._upgrades=this._filterUpgrades(e.upgrades),super.onHandshake(e)}_filterUpgrades(e){const t=[];for(let n=0;n<e.length;n++)~this.transports.indexOf(e[n])&&t.push(e[n]);return t}}let Sl=class extends Cl{constructor(e,t={}){const n=typeof e=="object"?e:t;(!n.transports||n.transports&&typeof n.transports[0]=="string")&&(n.transports=(n.transports||["polling","websocket","webtransport"]).map(i=>xl[i]).filter(i=>!!i)),super(e,n)}};function kl(r,e="",t){let n=r;t=t||typeof location<"u"&&location,r==null&&(r=t.protocol+"//"+t.host),typeof r=="string"&&(r.charAt(0)==="/"&&(r.charAt(1)==="/"?r=t.protocol+r:r=t.host+r),/^(https?|wss?):\/\//.test(r)||(typeof t<"u"?r=t.protocol+"//"+r:r="https://"+r),n=sn(r)),n.port||(/^(http|ws)$/.test(n.protocol)?n.port="80":/^(http|ws)s$/.test(n.protocol)&&(n.port="443")),n.path=n.path||"/";const a=n.host.indexOf(":")!==-1?"["+n.host+"]":n.host;return n.id=n.protocol+"://"+a+":"+n.port+e,n.href=n.protocol+"://"+a+(t&&t.port===n.port?"":":"+n.port),n}const jl=typeof ArrayBuffer=="function",El=r=>typeof ArrayBuffer.isView=="function"?ArrayBuffer.isView(r):r.buffer instanceof ArrayBuffer,Qs=Object.prototype.toString,Tl=typeof Blob=="function"||typeof Blob<"u"&&Qs.call(Blob)==="[object BlobConstructor]",Il=typeof File=="function"||typeof File<"u"&&Qs.call(File)==="[object FileConstructor]";function jn(r){return jl&&(r instanceof ArrayBuffer||El(r))||Tl&&r instanceof Blob||Il&&r instanceof File}function ar(r,e){if(!r||typeof r!="object")return!1;if(Array.isArray(r)){for(let t=0,n=r.length;t<n;t++)if(ar(r[t]))return!0;return!1}if(jn(r))return!0;if(r.toJSON&&typeof r.toJSON=="function"&&arguments.length===1)return ar(r.toJSON(),!0);for(const t in r)if(Object.prototype.hasOwnProperty.call(r,t)&&ar(r[t]))return!0;return!1}function Rl(r){const e=[],t=r.data,n=r;return n.data=on(t,e),n.attachments=e.length,{packet:n,buffers:e}}function on(r,e){if(!r)return r;if(jn(r)){const t={_placeholder:!0,num:e.length};return e.push(r),t}else if(Array.isArray(r)){const t=new Array(r.length);for(let n=0;n<r.length;n++)t[n]=on(r[n],e);return t}else if(typeof r=="object"&&!(r instanceof Date)){const t={};for(const n in r)Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=on(r[n],e));return t}return r}function Pl(r,e){return r.data=cn(r.data,e),delete r.attachments,r}function cn(r,e){if(!r)return r;if(r&&r._placeholder===!0){if(typeof r.num=="number"&&r.num>=0&&r.num<e.length)return e[r.num];throw new Error("illegal attachments")}else if(Array.isArray(r))for(let t=0;t<r.length;t++)r[t]=cn(r[t],e);else if(typeof r=="object")for(const t in r)Object.prototype.hasOwnProperty.call(r,t)&&(r[t]=cn(r[t],e));return r}const Fl=["connect","connect_error","disconnect","disconnecting","newListener","removeListener"],Ml=5;var G;(function(r){r[r.CONNECT=0]="CONNECT",r[r.DISCONNECT=1]="DISCONNECT",r[r.EVENT=2]="EVENT",r[r.ACK=3]="ACK",r[r.CONNECT_ERROR=4]="CONNECT_ERROR",r[r.BINARY_EVENT=5]="BINARY_EVENT",r[r.BINARY_ACK=6]="BINARY_ACK"})(G||(G={}));class _l{constructor(e){this.replacer=e}encode(e){return(e.type===G.EVENT||e.type===G.ACK)&&ar(e)?this.encodeAsBinary({type:e.type===G.EVENT?G.BINARY_EVENT:G.BINARY_ACK,nsp:e.nsp,data:e.data,id:e.id}):[this.encodeAsString(e)]}encodeAsString(e){let t=""+e.type;return(e.type===G.BINARY_EVENT||e.type===G.BINARY_ACK)&&(t+=e.attachments+"-"),e.nsp&&e.nsp!=="/"&&(t+=e.nsp+","),e.id!=null&&(t+=e.id),e.data!=null&&(t+=JSON.stringify(e.data,this.replacer)),t}encodeAsBinary(e){const t=Rl(e),n=this.encodeAsString(t.packet),i=t.buffers;return i.unshift(n),i}}function ls(r){return Object.prototype.toString.call(r)==="[object Object]"}class En extends de{constructor(e){super(),this.reviver=e}add(e){let t;if(typeof e=="string"){if(this.reconstructor)throw new Error("got plaintext data when reconstructing a packet");t=this.decodeString(e);const n=t.type===G.BINARY_EVENT;n||t.type===G.BINARY_ACK?(t.type=n?G.EVENT:G.ACK,this.reconstructor=new Ol(t),t.attachments===0&&super.emitReserved("decoded",t)):super.emitReserved("decoded",t)}else if(jn(e)||e.base64)if(this.reconstructor)t=this.reconstructor.takeBinaryData(e),t&&(this.reconstructor=null,super.emitReserved("decoded",t));else throw new Error("got binary data when not reconstructing a packet");else throw new Error("Unknown type: "+e)}decodeString(e){let t=0;const n={type:Number(e.charAt(0))};if(G[n.type]===void 0)throw new Error("unknown packet type "+n.type);if(n.type===G.BINARY_EVENT||n.type===G.BINARY_ACK){const a=t+1;for(;e.charAt(++t)!=="-"&&t!=e.length;);const o=e.substring(a,t);if(o!=Number(o)||e.charAt(t)!=="-")throw new Error("Illegal attachments");n.attachments=Number(o)}if(e.charAt(t+1)==="/"){const a=t+1;for(;++t&&!(e.charAt(t)===","||t===e.length););n.nsp=e.substring(a,t)}else n.nsp="/";const i=e.charAt(t+1);if(i!==""&&Number(i)==i){const a=t+1;for(;++t;){const o=e.charAt(t);if(o==null||Number(o)!=o){--t;break}if(t===e.length)break}n.id=Number(e.substring(a,t+1))}if(e.charAt(++t)){const a=this.tryParse(e.substr(t));if(En.isPayloadValid(n.type,a))n.data=a;else throw new Error("invalid payload")}return n}tryParse(e){try{return JSON.parse(e,this.reviver)}catch{return!1}}static isPayloadValid(e,t){switch(e){case G.CONNECT:return ls(t);case G.DISCONNECT:return t===void 0;case G.CONNECT_ERROR:return typeof t=="string"||ls(t);case G.EVENT:case G.BINARY_EVENT:return Array.isArray(t)&&(typeof t[0]=="number"||typeof t[0]=="string"&&Fl.indexOf(t[0])===-1);case G.ACK:case G.BINARY_ACK:return Array.isArray(t)}}destroy(){this.reconstructor&&(this.reconstructor.finishedReconstruction(),this.reconstructor=null)}}class Ol{constructor(e){this.packet=e,this.buffers=[],this.reconPack=e}takeBinaryData(e){if(this.buffers.push(e),this.buffers.length===this.reconPack.attachments){const t=Pl(this.reconPack,this.buffers);return this.finishedReconstruction(),t}return null}finishedReconstruction(){this.reconPack=null,this.buffers=[]}}const Al=Object.freeze(Object.defineProperty({__proto__:null,Decoder:En,Encoder:_l,get PacketType(){return G},protocol:Ml},Symbol.toStringTag,{value:"Module"}));function Oe(r,e,t){return r.on(e,t),function(){r.off(e,t)}}const Ll=Object.freeze({connect:1,connect_error:1,disconnect:1,disconnecting:1,newListener:1,removeListener:1});class Zs extends de{constructor(e,t,n){super(),this.connected=!1,this.recovered=!1,this.receiveBuffer=[],this.sendBuffer=[],this._queue=[],this._queueSeq=0,this.ids=0,this.acks={},this.flags={},this.io=e,this.nsp=t,n&&n.auth&&(this.auth=n.auth),this._opts=Object.assign({},n),this.io._autoConnect&&this.open()}get disconnected(){return!this.connected}subEvents(){if(this.subs)return;const e=this.io;this.subs=[Oe(e,"open",this.onopen.bind(this)),Oe(e,"packet",this.onpacket.bind(this)),Oe(e,"error",this.onerror.bind(this)),Oe(e,"close",this.onclose.bind(this))]}get active(){return!!this.subs}connect(){return this.connected?this:(this.subEvents(),this.io._reconnecting||this.io.open(),this.io._readyState==="open"&&this.onopen(),this)}open(){return this.connect()}send(...e){return e.unshift("message"),this.emit.apply(this,e),this}emit(e,...t){var n,i,a;if(Ll.hasOwnProperty(e))throw new Error('"'+e.toString()+'" is a reserved event name');if(t.unshift(e),this._opts.retries&&!this.flags.fromQueue&&!this.flags.volatile)return this._addToQueue(t),this;const o={type:G.EVENT,data:t};if(o.options={},o.options.compress=this.flags.compress!==!1,typeof t[t.length-1]=="function"){const h=this.ids++,u=t.pop();this._registerAckCallback(h,u),o.id=h}const d=(i=(n=this.io.engine)===null||n===void 0?void 0:n.transport)===null||i===void 0?void 0:i.writable,c=this.connected&&!(!((a=this.io.engine)===null||a===void 0)&&a._hasPingExpired());return this.flags.volatile&&!d||(c?(this.notifyOutgoingListeners(o),this.packet(o)):this.sendBuffer.push(o)),this.flags={},this}_registerAckCallback(e,t){var n;const i=(n=this.flags.timeout)!==null&&n!==void 0?n:this._opts.ackTimeout;if(i===void 0){this.acks[e]=t;return}const a=this.io.setTimeoutFn(()=>{delete this.acks[e];for(let d=0;d<this.sendBuffer.length;d++)this.sendBuffer[d].id===e&&this.sendBuffer.splice(d,1);t.call(this,new Error("operation has timed out"))},i),o=(...d)=>{this.io.clearTimeoutFn(a),t.apply(this,d)};o.withError=!0,this.acks[e]=o}emitWithAck(e,...t){return new Promise((n,i)=>{const a=(o,d)=>o?i(o):n(d);a.withError=!0,t.push(a),this.emit(e,...t)})}_addToQueue(e){let t;typeof e[e.length-1]=="function"&&(t=e.pop());const n={id:this._queueSeq++,tryCount:0,pending:!1,args:e,flags:Object.assign({fromQueue:!0},this.flags)};e.push((i,...a)=>n!==this._queue[0]?void 0:(i!==null?n.tryCount>this._opts.retries&&(this._queue.shift(),t&&t(i)):(this._queue.shift(),t&&t(null,...a)),n.pending=!1,this._drainQueue())),this._queue.push(n),this._drainQueue()}_drainQueue(e=!1){if(!this.connected||this._queue.length===0)return;const t=this._queue[0];t.pending&&!e||(t.pending=!0,t.tryCount++,this.flags=t.flags,this.emit.apply(this,t.args))}packet(e){e.nsp=this.nsp,this.io._packet(e)}onopen(){typeof this.auth=="function"?this.auth(e=>{this._sendConnectPacket(e)}):this._sendConnectPacket(this.auth)}_sendConnectPacket(e){this.packet({type:G.CONNECT,data:this._pid?Object.assign({pid:this._pid,offset:this._lastOffset},e):e})}onerror(e){this.connected||this.emitReserved("connect_error",e)}onclose(e,t){this.connected=!1,delete this.id,this.emitReserved("disconnect",e,t),this._clearAcks()}_clearAcks(){Object.keys(this.acks).forEach(e=>{if(!this.sendBuffer.some(n=>String(n.id)===e)){const n=this.acks[e];delete this.acks[e],n.withError&&n.call(this,new Error("socket has been disconnected"))}})}onpacket(e){if(e.nsp===this.nsp)switch(e.type){case G.CONNECT:e.data&&e.data.sid?this.onconnect(e.data.sid,e.data.pid):this.emitReserved("connect_error",new Error("It seems you are trying to reach a Socket.IO server in v2.x with a v3.x client, but they are not compatible (more information here: https://socket.io/docs/v3/migrating-from-2-x-to-3-0/)"));break;case G.EVENT:case G.BINARY_EVENT:this.onevent(e);break;case G.ACK:case G.BINARY_ACK:this.onack(e);break;case G.DISCONNECT:this.ondisconnect();break;case G.CONNECT_ERROR:this.destroy();const n=new Error(e.data.message);n.data=e.data.data,this.emitReserved("connect_error",n);break}}onevent(e){const t=e.data||[];e.id!=null&&t.push(this.ack(e.id)),this.connected?this.emitEvent(t):this.receiveBuffer.push(Object.freeze(t))}emitEvent(e){if(this._anyListeners&&this._anyListeners.length){const t=this._anyListeners.slice();for(const n of t)n.apply(this,e)}super.emit.apply(this,e),this._pid&&e.length&&typeof e[e.length-1]=="string"&&(this._lastOffset=e[e.length-1])}ack(e){const t=this;let n=!1;return function(...i){n||(n=!0,t.packet({type:G.ACK,id:e,data:i}))}}onack(e){const t=this.acks[e.id];typeof t=="function"&&(delete this.acks[e.id],t.withError&&e.data.unshift(null),t.apply(this,e.data))}onconnect(e,t){this.id=e,this.recovered=t&&this._pid===t,this._pid=t,this.connected=!0,this.emitBuffered(),this.emitReserved("connect"),this._drainQueue(!0)}emitBuffered(){this.receiveBuffer.forEach(e=>this.emitEvent(e)),this.receiveBuffer=[],this.sendBuffer.forEach(e=>{this.notifyOutgoingListeners(e),this.packet(e)}),this.sendBuffer=[]}ondisconnect(){this.destroy(),this.onclose("io server disconnect")}destroy(){this.subs&&(this.subs.forEach(e=>e()),this.subs=void 0),this.io._destroy(this)}disconnect(){return this.connected&&this.packet({type:G.DISCONNECT}),this.destroy(),this.connected&&this.onclose("io client disconnect"),this}close(){return this.disconnect()}compress(e){return this.flags.compress=e,this}get volatile(){return this.flags.volatile=!0,this}timeout(e){return this.flags.timeout=e,this}onAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.push(e),this}prependAny(e){return this._anyListeners=this._anyListeners||[],this._anyListeners.unshift(e),this}offAny(e){if(!this._anyListeners)return this;if(e){const t=this._anyListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyListeners=[];return this}listenersAny(){return this._anyListeners||[]}onAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.push(e),this}prependAnyOutgoing(e){return this._anyOutgoingListeners=this._anyOutgoingListeners||[],this._anyOutgoingListeners.unshift(e),this}offAnyOutgoing(e){if(!this._anyOutgoingListeners)return this;if(e){const t=this._anyOutgoingListeners;for(let n=0;n<t.length;n++)if(e===t[n])return t.splice(n,1),this}else this._anyOutgoingListeners=[];return this}listenersAnyOutgoing(){return this._anyOutgoingListeners||[]}notifyOutgoingListeners(e){if(this._anyOutgoingListeners&&this._anyOutgoingListeners.length){const t=this._anyOutgoingListeners.slice();for(const n of t)n.apply(this,e.data)}}}function Et(r){r=r||{},this.ms=r.min||100,this.max=r.max||1e4,this.factor=r.factor||2,this.jitter=r.jitter>0&&r.jitter<=1?r.jitter:0,this.attempts=0}Et.prototype.duration=function(){var r=this.ms*Math.pow(this.factor,this.attempts++);if(this.jitter){var e=Math.random(),t=Math.floor(e*this.jitter*r);r=Math.floor(e*10)&1?r+t:r-t}return Math.min(r,this.max)|0};Et.prototype.reset=function(){this.attempts=0};Et.prototype.setMin=function(r){this.ms=r};Et.prototype.setMax=function(r){this.max=r};Et.prototype.setJitter=function(r){this.jitter=r};class ln extends de{constructor(e,t){var n;super(),this.nsps={},this.subs=[],e&&typeof e=="object"&&(t=e,e=void 0),t=t||{},t.path=t.path||"/socket.io",this.opts=t,vr(this,t),this.reconnection(t.reconnection!==!1),this.reconnectionAttempts(t.reconnectionAttempts||1/0),this.reconnectionDelay(t.reconnectionDelay||1e3),this.reconnectionDelayMax(t.reconnectionDelayMax||5e3),this.randomizationFactor((n=t.randomizationFactor)!==null&&n!==void 0?n:.5),this.backoff=new Et({min:this.reconnectionDelay(),max:this.reconnectionDelayMax(),jitter:this.randomizationFactor()}),this.timeout(t.timeout==null?2e4:t.timeout),this._readyState="closed",this.uri=e;const i=t.parser||Al;this.encoder=new i.Encoder,this.decoder=new i.Decoder,this._autoConnect=t.autoConnect!==!1,this._autoConnect&&this.open()}reconnection(e){return arguments.length?(this._reconnection=!!e,e||(this.skipReconnect=!0),this):this._reconnection}reconnectionAttempts(e){return e===void 0?this._reconnectionAttempts:(this._reconnectionAttempts=e,this)}reconnectionDelay(e){var t;return e===void 0?this._reconnectionDelay:(this._reconnectionDelay=e,(t=this.backoff)===null||t===void 0||t.setMin(e),this)}randomizationFactor(e){var t;return e===void 0?this._randomizationFactor:(this._randomizationFactor=e,(t=this.backoff)===null||t===void 0||t.setJitter(e),this)}reconnectionDelayMax(e){var t;return e===void 0?this._reconnectionDelayMax:(this._reconnectionDelayMax=e,(t=this.backoff)===null||t===void 0||t.setMax(e),this)}timeout(e){return arguments.length?(this._timeout=e,this):this._timeout}maybeReconnectOnOpen(){!this._reconnecting&&this._reconnection&&this.backoff.attempts===0&&this.reconnect()}open(e){if(~this._readyState.indexOf("open"))return this;this.engine=new Sl(this.uri,this.opts);const t=this.engine,n=this;this._readyState="opening",this.skipReconnect=!1;const i=Oe(t,"open",function(){n.onopen(),e&&e()}),a=d=>{this.cleanup(),this._readyState="closed",this.emitReserved("error",d),e?e(d):this.maybeReconnectOnOpen()},o=Oe(t,"error",a);if(this._timeout!==!1){const d=this._timeout,c=this.setTimeoutFn(()=>{i(),a(new Error("timeout")),t.close()},d);this.opts.autoUnref&&c.unref(),this.subs.push(()=>{this.clearTimeoutFn(c)})}return this.subs.push(i),this.subs.push(o),this}connect(e){return this.open(e)}onopen(){this.cleanup(),this._readyState="open",this.emitReserved("open");const e=this.engine;this.subs.push(Oe(e,"ping",this.onping.bind(this)),Oe(e,"data",this.ondata.bind(this)),Oe(e,"error",this.onerror.bind(this)),Oe(e,"close",this.onclose.bind(this)),Oe(this.decoder,"decoded",this.ondecoded.bind(this)))}onping(){this.emitReserved("ping")}ondata(e){try{this.decoder.add(e)}catch(t){this.onclose("parse error",t)}}ondecoded(e){wr(()=>{this.emitReserved("packet",e)},this.setTimeoutFn)}onerror(e){this.emitReserved("error",e)}socket(e,t){let n=this.nsps[e];return n?this._autoConnect&&!n.active&&n.connect():(n=new Zs(this,e,t),this.nsps[e]=n),n}_destroy(e){const t=Object.keys(this.nsps);for(const n of t)if(this.nsps[n].active)return;this._close()}_packet(e){const t=this.encoder.encode(e);for(let n=0;n<t.length;n++)this.engine.write(t[n],e.options)}cleanup(){this.subs.forEach(e=>e()),this.subs.length=0,this.decoder.destroy()}_close(){this.skipReconnect=!0,this._reconnecting=!1,this.onclose("forced close")}disconnect(){return this._close()}onclose(e,t){var n;this.cleanup(),(n=this.engine)===null||n===void 0||n.close(),this.backoff.reset(),this._readyState="closed",this.emitReserved("close",e,t),this._reconnection&&!this.skipReconnect&&this.reconnect()}reconnect(){if(this._reconnecting||this.skipReconnect)return this;const e=this;if(this.backoff.attempts>=this._reconnectionAttempts)this.backoff.reset(),this.emitReserved("reconnect_failed"),this._reconnecting=!1;else{const t=this.backoff.duration();this._reconnecting=!0;const n=this.setTimeoutFn(()=>{e.skipReconnect||(this.emitReserved("reconnect_attempt",e.backoff.attempts),!e.skipReconnect&&e.open(i=>{i?(e._reconnecting=!1,e.reconnect(),this.emitReserved("reconnect_error",i)):e.onreconnect()}))},t);this.opts.autoUnref&&n.unref(),this.subs.push(()=>{this.clearTimeoutFn(n)})}}onreconnect(){const e=this.backoff.attempts;this._reconnecting=!1,this.backoff.reset(),this.emitReserved("reconnect",e)}}const At={};function or(r,e){typeof r=="object"&&(e=r,r=void 0),e=e||{};const t=kl(r,e.path||"/socket.io"),n=t.source,i=t.id,a=t.path,o=At[i]&&a in At[i].nsps,d=e.forceNew||e["force new connection"]||e.multiplex===!1||o;let c;return d?c=new ln(n,e):(At[i]||(At[i]=new ln(n,e)),c=At[i]),t.query&&!e.query&&(e.query=t.queryKey),c.socket(t.path,e)}Object.assign(or,{Manager:ln,Socket:Zs,io:or,connect:or});/*! Capacitor: https://capacitorjs.com/ - MIT License */var kt;(function(r){r.Unimplemented="UNIMPLEMENTED",r.Unavailable="UNAVAILABLE"})(kt||(kt={}));class Hr extends Error{constructor(e,t,n){super(e),this.message=e,this.code=t,this.data=n}}const Dl=r=>{var e,t;return r!=null&&r.androidBridge?"android":!((t=(e=r==null?void 0:r.webkit)===null||e===void 0?void 0:e.messageHandlers)===null||t===void 0)&&t.bridge?"ios":"web"},Wl=r=>{const e=r.CapacitorCustomPlatform||null,t=r.Capacitor||{},n=t.Plugins=t.Plugins||{},i=()=>e!==null?e.name:Dl(r),a=()=>i()!=="web",o=u=>{const y=f.get(u);return!!(y!=null&&y.platforms.has(i())||d(u))},d=u=>{var y;return(y=t.PluginHeaders)===null||y===void 0?void 0:y.find(O=>O.name===u)},c=u=>r.console.error(u),f=new Map,h=(u,y={})=>{const O=f.get(u);if(O)return console.warn(`Capacitor plugin "${u}" already registered. Cannot register plugins twice.`),O.proxy;const g=i(),w=d(u);let x;const N=async()=>(!x&&g in y?x=typeof y[g]=="function"?x=await y[g]():x=y[g]:e!==null&&!x&&"web"in y&&(x=typeof y.web=="function"?x=await y.web():x=y.web),x),R=(b,k)=>{var L,T;if(w){const D=w==null?void 0:w.methods.find(_=>k===_.name);if(D)return D.rtype==="promise"?_=>t.nativePromise(u,k.toString(),_):(_,Y)=>t.nativeCallback(u,k.toString(),_,Y);if(b)return(L=b[k])===null||L===void 0?void 0:L.bind(b)}else{if(b)return(T=b[k])===null||T===void 0?void 0:T.bind(b);throw new Hr(`"${u}" plugin is not implemented on ${g}`,kt.Unimplemented)}},j=b=>{let k;const L=(...T)=>{const D=N().then(_=>{const Y=R(_,b);if(Y){const J=Y(...T);return k=J==null?void 0:J.remove,J}else throw new Hr(`"${u}.${b}()" is not implemented on ${g}`,kt.Unimplemented)});return b==="addListener"&&(D.remove=async()=>k()),D};return L.toString=()=>`${b.toString()}() { [capacitor code] }`,Object.defineProperty(L,"name",{value:b,writable:!1,configurable:!1}),L},I=j("addListener"),F=j("removeListener"),B=(b,k)=>{const L=I({eventName:b},k),T=async()=>{const _=await L;F({eventName:b,callbackId:_},k)},D=new Promise(_=>L.then(()=>_({remove:T})));return D.remove=async()=>{console.warn("Using addListener() without 'await' is deprecated."),await T()},D},$=new Proxy({},{get(b,k){switch(k){case"$$typeof":return;case"toJSON":return()=>({});case"addListener":return w?B:I;case"removeListener":return F;default:return j(k)}}});return n[u]=$,f.set(u,{name:u,proxy:$,platforms:new Set([...Object.keys(y),...w?[g]:[]])}),$};return t.convertFileSrc||(t.convertFileSrc=u=>u),t.getPlatform=i,t.handleError=c,t.isNativePlatform=a,t.isPluginAvailable=o,t.registerPlugin=h,t.Exception=Hr,t.DEBUG=!!t.DEBUG,t.isLoggingEnabled=!!t.isLoggingEnabled,t},Nl=r=>r.Capacitor=Wl(r),nt=Nl(typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof globalThis<"u"?globalThis:{}),ei=nt.registerPlugin;class ti{constructor(){this.listeners={},this.retainedEventArguments={},this.windowListeners={}}addListener(e,t){let n=!1;this.listeners[e]||(this.listeners[e]=[],n=!0),this.listeners[e].push(t);const a=this.windowListeners[e];a&&!a.registered&&this.addWindowListener(a),n&&this.sendRetainedArgumentsForEvent(e);const o=async()=>this.removeListener(e,t);return Promise.resolve({remove:o})}async removeAllListeners(){this.listeners={};for(const e in this.windowListeners)this.removeWindowListener(this.windowListeners[e]);this.windowListeners={}}notifyListeners(e,t,n){const i=this.listeners[e];if(!i){if(n){let a=this.retainedEventArguments[e];a||(a=[]),a.push(t),this.retainedEventArguments[e]=a}return}i.forEach(a=>a(t))}hasListeners(e){var t;return!!(!((t=this.listeners[e])===null||t===void 0)&&t.length)}registerWindowListener(e,t){this.windowListeners[t]={registered:!1,windowEventName:e,pluginEventName:t,handler:n=>{this.notifyListeners(t,n)}}}unimplemented(e="not implemented"){return new nt.Exception(e,kt.Unimplemented)}unavailable(e="not available"){return new nt.Exception(e,kt.Unavailable)}async removeListener(e,t){const n=this.listeners[e];if(!n)return;const i=n.indexOf(t);this.listeners[e].splice(i,1),this.listeners[e].length||this.removeWindowListener(this.windowListeners[e])}addWindowListener(e){window.addEventListener(e.windowEventName,e.handler),e.registered=!0}removeWindowListener(e){e&&(window.removeEventListener(e.windowEventName,e.handler),e.registered=!1)}sendRetainedArgumentsForEvent(e){const t=this.retainedEventArguments[e];t&&(delete this.retainedEventArguments[e],t.forEach(n=>{this.notifyListeners(e,n)}))}}const ds=r=>encodeURIComponent(r).replace(/%(2[346B]|5E|60|7C)/g,decodeURIComponent).replace(/[()]/g,escape),us=r=>r.replace(/(%[\dA-F]{2})+/gi,decodeURIComponent);class zl extends ti{async getCookies(){const e=document.cookie,t={};return e.split(";").forEach(n=>{if(n.length<=0)return;let[i,a]=n.replace(/=/,"CAP_COOKIE").split("CAP_COOKIE");i=us(i).trim(),a=us(a).trim(),t[i]=a}),t}async setCookie(e){try{const t=ds(e.key),n=ds(e.value),i=`; expires=${(e.expires||"").replace("expires=","")}`,a=(e.path||"/").replace("path=",""),o=e.url!=null&&e.url.length>0?`domain=${e.url}`:"";document.cookie=`${t}=${n||""}${i}; path=${a}; ${o};`}catch(t){return Promise.reject(t)}}async deleteCookie(e){try{document.cookie=`${e.key}=; Max-Age=0`}catch(t){return Promise.reject(t)}}async clearCookies(){try{const e=document.cookie.split(";")||[];for(const t of e)document.cookie=t.replace(/^ +/,"").replace(/=.*/,`=;expires=${new Date().toUTCString()};path=/`)}catch(e){return Promise.reject(e)}}async clearAllCookies(){try{await this.clearCookies()}catch(e){return Promise.reject(e)}}}ei("CapacitorCookies",{web:()=>new zl});const Ul=async r=>new Promise((e,t)=>{const n=new FileReader;n.onload=()=>{const i=n.result;e(i.indexOf(",")>=0?i.split(",")[1]:i)},n.onerror=i=>t(i),n.readAsDataURL(r)}),Bl=(r={})=>{const e=Object.keys(r);return Object.keys(r).map(i=>i.toLocaleLowerCase()).reduce((i,a,o)=>(i[a]=r[e[o]],i),{})},$l=(r,e=!0)=>r?Object.entries(r).reduce((n,i)=>{const[a,o]=i;let d,c;return Array.isArray(o)?(c="",o.forEach(f=>{d=e?encodeURIComponent(f):f,c+=`${a}=${d}&`}),c.slice(0,-1)):(d=e?encodeURIComponent(o):o,c=`${a}=${d}`),`${n}&${c}`},"").substr(1):null,Hl=(r,e={})=>{const t=Object.assign({method:r.method||"GET",headers:r.headers},e),i=Bl(r.headers)["content-type"]||"";if(typeof r.data=="string")t.body=r.data;else if(i.includes("application/x-www-form-urlencoded")){const a=new URLSearchParams;for(const[o,d]of Object.entries(r.data||{}))a.set(o,d);t.body=a.toString()}else if(i.includes("multipart/form-data")||r.data instanceof FormData){const a=new FormData;if(r.data instanceof FormData)r.data.forEach((d,c)=>{a.append(c,d)});else for(const d of Object.keys(r.data))a.append(d,r.data[d]);t.body=a;const o=new Headers(t.headers);o.delete("content-type"),t.headers=o}else(i.includes("application/json")||typeof r.data=="object")&&(t.body=JSON.stringify(r.data));return t};class Vl extends ti{async request(e){const t=Hl(e,e.webFetchExtra),n=$l(e.params,e.shouldEncodeUrlParams),i=n?`${e.url}?${n}`:e.url,a=await fetch(i,t),o=a.headers.get("content-type")||"";let{responseType:d="text"}=a.ok?e:{};o.includes("application/json")&&(d="json");let c,f;switch(d){case"arraybuffer":case"blob":f=await a.blob(),c=await Ul(f);break;case"json":c=await a.json();break;case"document":case"text":default:c=await a.text()}const h={};return a.headers.forEach((u,y)=>{h[y]=u}),{data:c,headers:h,status:a.status,url:a.url}}async get(e){return this.request(Object.assign(Object.assign({},e),{method:"GET"}))}async post(e){return this.request(Object.assign(Object.assign({},e),{method:"POST"}))}async put(e){return this.request(Object.assign(Object.assign({},e),{method:"PUT"}))}async patch(e){return this.request(Object.assign(Object.assign({},e),{method:"PATCH"}))}async delete(e){return this.request(Object.assign(Object.assign({},e),{method:"DELETE"}))}}ei("CapacitorHttp",{web:()=>new Vl});const dt={apiBaseUrl:"http://192.95.33.150:5003/api",socketUrl:"http://192.95.33.150:5003",appEnv:"production"},dn=()=>({apiBaseUrl:dt.apiBaseUrl,socketUrl:dt.socketUrl,appEnv:dt.appEnv});let ri=dt.apiBaseUrl,un=dt.socketUrl;const ql=({apiBaseUrl:r,socketUrl:e,appEnv:t}={})=>{ri=r||dt.apiBaseUrl,un=e||dt.socketUrl},Yl=({socketManager:r,isVisible:e,onClose:t,callId:n,isTeacher:i=!1})=>{const a=l.useRef(null),[o,d]=l.useState(!1),[c,f]=l.useState("pen"),[h,u]=l.useState("#000000"),[y,O]=l.useState(3),[g,w]=l.useState(null),[x,N]=l.useState(null),[R,j]=l.useState([]),[I,F]=l.useState(-1),[B,$]=l.useState(""),[b,k]=l.useState(null),[L,T]=l.useState(!1),D=["#000000","#FFFFFF","#FF0000","#00FF00","#0000FF","#FFFF00","#FF00FF","#00FFFF","#FFA500","#800080","#FFC0CB","#A52A2A","#808080","#000080","#008000"],_=[{id:"pen",icon:s.jsx(Ga,{}),label:"Pen (Precise)"},{id:"brush",icon:s.jsx(Ha,{}),label:"Brush (Thick)"},{id:"eraser",icon:s.jsx($a,{}),label:"Eraser"},{id:"line",icon:s.jsx(po,{}),label:"Line"},{id:"rectangle",icon:s.jsx(Ja,{}),label:"Rectangle"},{id:"circle",icon:s.jsx(yn,{}),label:"Circle"},{id:"text",icon:s.jsx(fo,{}),label:"Text"}];l.useEffect(()=>{const m=a.current;if(!m)return;const M=m.getContext("2d");m.width=m.offsetWidth,m.height=m.offsetHeight,M.fillStyle="white",M.fillRect(0,0,m.width,m.height),Y()},[e]),l.useEffect(()=>{if(!(r!=null&&r.socket))return;const m=C=>{C.callId===n&&ae(C)},M=C=>{C.callId===n&&z(!1)};return r.socket.on("whiteboard-draw",m),r.socket.on("whiteboard-clear",M),()=>{r.socket.off("whiteboard-draw",m),r.socket.off("whiteboard-clear",M)}},[r,n]);const Y=()=>{const m=a.current;if(!m)return;const M=m.toDataURL(),C=R.slice(0,I+1);C.push(M),j(C),F(C.length-1)},J=()=>{if(I>0){const m=I-1;F(m),X(R[m])}},V=()=>{if(I<R.length-1){const m=I+1;F(m),X(R[m])}},X=m=>{const M=a.current,C=M.getContext("2d"),re=new Image;re.onload=()=>{C.clearRect(0,0,M.width,M.height),C.drawImage(re,0,0)},re.src=m},pe=m=>{const C=a.current.getBoundingClientRect();return{x:m.clientX-C.left,y:m.clientY-C.top}},ae=m=>{const C=a.current.getContext("2d");switch(C.strokeStyle=m.color,C.lineWidth=m.lineWidth,C.lineCap="round",C.lineJoin="round",m.tool){case"pen":C.globalCompositeOperation="source-over",m.type==="start"?(C.beginPath(),C.moveTo(m.x,m.y)):m.type==="draw"&&(C.lineTo(m.x,m.y),C.stroke());break;case"brush":C.globalCompositeOperation="source-over",C.lineCap="round",C.lineJoin="round",m.type==="start"?(C.beginPath(),C.moveTo(m.x,m.y)):m.type==="draw"&&(C.lineTo(m.x,m.y),C.stroke());break;case"eraser":C.globalCompositeOperation="destination-out",C.lineCap="round",C.lineJoin="round",m.type==="start"?(C.beginPath(),C.moveTo(m.x,m.y)):m.type==="draw"&&(C.lineTo(m.x,m.y),C.stroke());break;case"line":m.type==="complete"&&(C.beginPath(),C.moveTo(m.startX,m.startY),C.lineTo(m.endX,m.endY),C.stroke());break;case"rectangle":m.type==="complete"&&(C.beginPath(),C.rect(m.x,m.y,m.width,m.height),C.stroke());break;case"circle":C.globalCompositeOperation="source-over",m.type==="complete"&&(C.beginPath(),C.arc(m.x,m.y,m.radius,0,2*Math.PI),C.stroke());break;case"text":C.globalCompositeOperation="source-over",m.type==="complete"&&(C.font=`${m.fontSize||16}px Arial`,C.fillStyle=m.color,C.fillText(m.text,m.x,m.y));break}},he=m=>{var C,re;if(!(r!=null&&r.socket)){console.error("üé® Student Whiteboard: Cannot broadcast - no socket available");return}if(!r.socket.connected){console.error("üé® Student Whiteboard: Cannot broadcast - socket not connected");return}const M={...m,callId:n,senderId:((C=r.socket.userData)==null?void 0:C.userId)||"student",senderName:((re=r.socket.userData)==null?void 0:re.username)||"Student"};r.socket.emit("whiteboard-draw",M)},xe=m=>{const M=pe(m);if(d(!0),w(M),c==="text")k(M),T(!0);else if(c==="pen"||c==="brush"||c==="eraser"){const C={type:"start",tool:c,x:M.x,y:M.y,color:c==="eraser"?"#FFFFFF":h,lineWidth:c==="brush"?y*3:c==="eraser"?y*2:y};ae(C),he(C)}},be=m=>{if(!o)return;const M=pe(m);if(c==="pen"||c==="brush"||c==="eraser"){const C={type:"draw",tool:c,x:M.x,y:M.y,color:c==="eraser"?"#FFFFFF":h,lineWidth:c==="brush"?y*3:c==="eraser"?y*2:y};ae(C),he(C)}},ge=m=>{if(!o)return;const M=pe(m);if(d(!1),c==="line"){const C={type:"complete",tool:"line",startX:g.x,startY:g.y,endX:M.x,endY:M.y,color:h,lineWidth:y};ae(C),he(C)}else if(c==="rectangle"){const C={type:"complete",tool:"rectangle",x:Math.min(g.x,M.x),y:Math.min(g.y,M.y),width:Math.abs(M.x-g.x),height:Math.abs(M.y-g.y),color:h,lineWidth:y};ae(C),he(C)}else if(c==="circle"){const C=Math.sqrt(Math.pow(M.x-g.x,2)+Math.pow(M.y-g.y,2)),re={type:"complete",tool:"circle",x:g.x,y:g.y,radius:C,color:h,lineWidth:y};ae(re),he(re)}Y(),w(null)},z=(m=!0)=>{var re,A;const M=a.current,C=M.getContext("2d");if(C.fillStyle="white",C.fillRect(0,0,M.width,M.height),m&&(r!=null&&r.socket)){const Q={callId:n,senderId:((re=r.socket.userData)==null?void 0:re.userId)||"student",senderName:((A=r.socket.userData)==null?void 0:A.username)||"Student"};r.socket.emit("whiteboard-clear",Q)}Y()},K=()=>{if(B.trim()&&b){const m={type:"complete",tool:"text",x:b.x,y:b.y,text:B.trim(),color:h,fontSize:y+12};ae(m),he(m),Y()}$(""),k(null),T(!1)},ee=()=>{$(""),k(null),T(!1)},P=m=>{N(m.currentTarget)},W=()=>{N(null)};return e?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"rgba(0, 0, 0, 0.9)",zIndex:1e4,display:"flex",flexDirection:"column"},children:[s.jsxs(ke,{elevation:3,sx:{m:2,p:1,display:"flex",alignItems:"center",gap:1,flexWrap:"wrap"},children:[s.jsx(_n,{size:"small",children:_.map(m=>s.jsx(Ve,{title:m.label,children:s.jsx(se,{onClick:()=>f(m.id),sx:{backgroundColor:c===m.id?"primary.main":"transparent",color:c===m.id?"white":"inherit"},children:m.icon})},m.id))}),s.jsx(Ve,{title:"Colors",children:s.jsx(se,{onClick:P,sx:{backgroundColor:h,border:"2px solid #ccc",width:40,height:40},children:s.jsx(Ya,{sx:{color:h==="#FFFFFF"?"#000":"#fff"}})})}),s.jsx(gs,{open:!!x,anchorEl:x,onClose:W,anchorOrigin:{vertical:"bottom",horizontal:"left"},children:s.jsx(p,{sx:{p:1},children:s.jsx(oe,{container:!0,spacing:1,sx:{width:180},children:D.map(m=>s.jsx(oe,{item:!0,xs:3,children:s.jsx(p,{onClick:()=>{u(m),W()},sx:{width:30,height:30,backgroundColor:m,border:m===h?"3px solid #2196f3":"1px solid #ccc",cursor:"pointer",borderRadius:1}})},m))})})}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1,minWidth:120},children:[s.jsx(S,{variant:"caption",children:"Size:"}),s.jsx(Li,{value:y,onChange:(m,M)=>O(M),min:1,max:20,size:"small",sx:{width:80}})]}),s.jsxs(_n,{size:"small",children:[s.jsx(Ve,{title:"Undo",children:s.jsx("span",{children:s.jsx(se,{onClick:J,disabled:I<=0,children:s.jsx(go,{})})})}),s.jsx(Ve,{title:"Redo",children:s.jsx("span",{children:s.jsx(se,{onClick:V,disabled:I>=R.length-1,children:s.jsx(ao,{})})})}),s.jsx(Ve,{title:"Clear All",children:s.jsx(se,{onClick:()=>z(!0),children:s.jsx(qa,{})})})]}),s.jsx(Ve,{title:"Close Whiteboard",children:s.jsx(se,{onClick:t,sx:{ml:"auto"},children:s.jsx(ur,{})})})]}),s.jsx(p,{sx:{flex:1,m:2,mt:0,position:"relative"},children:s.jsx("canvas",{ref:a,onMouseDown:xe,onMouseMove:be,onMouseUp:ge,onMouseLeave:()=>d(!1),style:{width:"100%",height:"100%",border:"2px solid #ccc",borderRadius:"8px",backgroundColor:"white",cursor:c==="pen"||c==="brush"||c==="eraser"?"crosshair":c==="text"?"text":"crosshair"}})}),s.jsxs(gr,{open:L,onClose:ee,maxWidth:"sm",fullWidth:!0,children:[s.jsx(pn,{children:"Add Text"}),s.jsx(xr,{children:s.jsx(We,{autoFocus:!0,fullWidth:!0,multiline:!0,rows:3,value:B,onChange:m=>$(m.target.value),placeholder:"Enter text to add to whiteboard...",variant:"outlined",onKeyDown:m=>{m.key==="Enter"&&!m.shiftKey&&(m.preventDefault(),K())}})}),s.jsxs(mn,{children:[s.jsx(Ae,{onClick:ee,children:"Cancel"}),s.jsx(Ae,{onClick:K,variant:"contained",disabled:!B.trim(),children:"Add Text"})]})]})]}):null};function Gl({isOpen:r=!1,callData:e,callStatus:t="connecting",onEndCall:n,webrtcService:i,socketManager:a,currentUser:o,sttLanguage:d="en-US"}){var Fn,Mn;const c=l.useRef(null),f=l.useRef(null),[h,u]=l.useState(!0),[y,O]=l.useState(!0),[g,w]=l.useState(null),[x,N]=l.useState(null),[R,j]=l.useState(.7),[I,F]=l.useState(!1),[B,$]=l.useState(!1),[b,k]=l.useState(new Map),[L,T]=l.useState(!1),[D,_]=l.useState(!1),[Y,J]=l.useState([]),[V,X]=l.useState(""),[pe,ae]=l.useState(null),[he,xe]=l.useState(0),be=l.useRef(null),[ge,z]=l.useState(""),[K,ee]=l.useState(""),[P,W]=l.useState(!1),[m,M]=l.useState(!1),[C,re]=l.useState(!0);l.useState([]);const[A,Q]=l.useState("connecting"),[ye,le]=l.useState(0),[me,De]=l.useState(0),[ve,Yt]=l.useState(16/9),[Tt,ci]=l.useState(!1),li=l.useMemo(()=>Tt?{position:"relative",width:{xs:"80%",sm:"70%"},maxWidth:420,maxHeight:"85vh",aspectRatio:ve?`${ve}`:"9 / 16",borderRadius:3,overflow:"hidden",backgroundColor:"#000",boxShadow:"0 12px 28px rgba(0, 0, 0, 0.45)",display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.3s ease"}:{position:"relative",width:"100%",maxWidth:"100vw",aspectRatio:ve?`${ve}`:"16 / 9",height:"auto",maxHeight:"95vh",margin:"0 auto",backgroundColor:"#000",borderRadius:{xs:0,sm:2},overflow:"hidden",transition:"all 0.3s ease"},[Tt,ve]),Cr=l.useCallback(()=>{var E,q,H;try{const Z=f.current,ne=(E=x==null?void 0:x.getVideoTracks)==null?void 0:E.call(x)[0];let ie=(q=ne==null?void 0:ne.getSettings)==null?void 0:q.call(ne).width,we=(H=ne==null?void 0:ne.getSettings)==null?void 0:H.call(ne).height;if((!ie||!we)&&Z&&(ie=Z.videoWidth,we=Z.videoHeight),ie&&we){const Ye=ie/we;Yt(Ye||16/9),ci(Ye<1)}}catch(Z){console.warn("‚ö†Ô∏è Student: Failed to update remote video layout",Z)}},[x]),[pt,di]=l.useState(d||"en-US");l.useEffect(()=>{d&&d!==pt&&di(d)},[d,pt]);const Gt=l.useRef(null),Jt=l.useRef(null);l.useRef(null),l.useEffect(()=>{if(!i)return;i.getStatus().hasLocalStream&&w(i.localStream);const q=H=>{N(H.detail.stream)};return i.addEventListener("remote-stream",q),()=>{i.removeEventListener("remote-stream",q)}},[i]),l.useEffect(()=>{var Z;Cr();const E=f.current,q=(Z=x==null?void 0:x.getVideoTracks)==null?void 0:Z.call(x)[0],H=()=>Cr();return E&&E.addEventListener("loadedmetadata",H),q&&(q.onresize=H),()=>{E&&E.removeEventListener("loadedmetadata",H),q&&(q.onresize=null)}},[x,Cr]),l.useEffect(()=>{C&&setTimeout(()=>{Q("connected")},1e3)},[]),l.useEffect(()=>(t==="connected"&&(g||x)&&(W(!1),re(!0),M(!0),Tn()),()=>{Sr()}),[t,g,x,e]);const Tn=()=>{Q("connecting"),M(!0),g&&ui(),x&&hi(),setTimeout(()=>{Q("connected")},500)},Sr=()=>{if(Q("disconnected"),M(!1),le(0),De(0),Gt.current){try{const{audioContext:E,processor:q,source:H}=Gt.current;H&&q&&(H.disconnect(),q.disconnect()),E&&E.state!=="closed"&&E.close()}catch(E){console.error("‚ùå Error cleaning up mic AudioContext:",E)}Gt.current=null}if(Jt.current){try{const{audioContext:E,processor:q,source:H}=Jt.current;H&&q&&(H.disconnect(),q.disconnect()),E&&E.state!=="closed"&&E.close()}catch(E){console.error("‚ùå Error cleaning up speaker AudioContext:",E)}Jt.current=null}},ui=()=>{try{if(!g){console.error("‚ùå No local stream available for mic transcription");return}const E=new(window.AudioContext||window.webkitAudioContext),q=E.createMediaStreamSource(g),H=E.createScriptProcessor(4096,1,1);Gt.current={audioContext:E,processor:H,source:q};let Z=[],ne=Date.now(),ie=null,we=!1,Ye=!1;const kr=.01,jr=.005,Er=1e3,Tr=8e3,It=Number.POSITIVE_INFINITY;H.onaudioprocess=async Ir=>{var Rt,Pt;const Re=Ir.inputBuffer.getChannelData(0),it=Math.sqrt(Re.reduce(($e,Fe)=>$e+Fe*Fe,0)/Re.length);le(Math.min(100,it*1e3));const Pe=Date.now(),Rr=it>kr,Pr=it<jr;if(Rr&&!we&&(we=!0,Ye=!0,ie=null,ne=Pe,Z=[]),we){const $e=new Int16Array(Re.length);for(let Me=0;Me<Re.length;Me++)$e[Me]=Math.max(-32768,Math.min(32767,Re[Me]*32768));Z.push(...$e),Pr?ie||(ie=Pe):ie=null;const Fe=Pe-ne,Ft=ie?Pe-ie:0;if((Ft>=It&&Fe>=Er||Fe>=Tr)&&Z.length>0){const Me=Ft>=It?"silence detected":"max duration reached",Fr=new Int16Array(Z),Mr=Buffer.from(Fr.buffer).toString("base64");Z=[],ne=Pe,we=!1,Ye=!1,ie=null;try{if(!((Rt=window.electronAPI)!=null&&Rt.stt)){console.error("‚ùå electronAPI.stt not available");return}const _e=await window.electronAPI.stt.transcribeAudio(Mr,{participantType:"teacher",languageCode:pt,encoding:"LINEAR16",sampleRateHertz:E.sampleRate});if(_e.success&&((Pt=_e.transcript)!=null&&Pt.trim())){const _r=_e.transcript.trim();z(_r)}}catch(_e){console.error("‚ùå STT processing error:",_e)}}}},q.connect(H),H.connect(E.destination)}catch(E){console.error("‚ùå Mic transcription error:",E)}},hi=()=>{try{const E=new(window.AudioContext||window.webkitAudioContext),q=E.createMediaStreamSource(x),H=E.createScriptProcessor(4096,1,1);Jt.current={audioContext:E,processor:H,source:q};let Z=[],ne=Date.now(),ie=null,we=!1,Ye=!1;const kr=.01,jr=.005,Er=1e3,Tr=8e3,It=Number.POSITIVE_INFINITY;H.onaudioprocess=async Ir=>{var Rt,Pt;const Re=Ir.inputBuffer.getChannelData(0),it=Math.sqrt(Re.reduce(($e,Fe)=>$e+Fe*Fe,0)/Re.length);De(Math.min(100,it*1e3));const Pe=Date.now(),Rr=it>kr,Pr=it<jr;if(Rr&&!we&&(we=!0,Ye=!0,ie=null,ne=Pe,Z=[]),we){const $e=new Int16Array(Re.length);for(let Me=0;Me<Re.length;Me++)$e[Me]=Math.max(-32768,Math.min(32767,Re[Me]*32768));Z.push(...$e),Pr?ie||(ie=Pe):ie=null;const Fe=Pe-ne,Ft=ie?Pe-ie:0;if((Ft>=It&&Fe>=Er||Fe>=Tr)&&Z.length>0){const Me=Ft>=It?"silence detected":"max duration reached",Fr=new Int16Array(Z),Mr=Buffer.from(Fr.buffer).toString("base64");Z=[],ne=Pe,we=!1,Ye=!1,ie=null;try{if(!((Rt=window.electronAPI)!=null&&Rt.stt)){console.error("‚ùå electronAPI.stt not available for speaker");return}const _e=await window.electronAPI.stt.transcribeAudio(Mr,{participantType:"student",languageCode:pt,encoding:"LINEAR16",sampleRateHertz:E.sampleRate});if(_e.success&&((Pt=_e.transcript)!=null&&Pt.trim())){const _r=_e.transcript.trim();ee(_r)}}catch(_e){console.error("‚ùå STT processing error:",_e)}}}},q.connect(H),H.connect(E.destination)}catch(E){console.error("‚ùå Speaker transcription error:",E)}};l.useEffect(()=>()=>{m&&Sr()},[m]),l.useEffect(()=>{c.current&&g&&(c.current.srcObject=g,c.current.addEventListener("loadedmetadata",async()=>{try{await c.current.play()}catch(E){console.warn("üé• Student: Local video autoplay failed:",E)}}))},[g]),l.useEffect(()=>{f.current&&x?(f.current.srcObject=x,f.current.volume=R,f.current.addEventListener("loadedmetadata",async()=>{try{await f.current.play()}catch(E){console.warn("üì¢ Student: Remote video autoplay failed:",E)}})):(f.current||console.warn("üé• Student: Remote video ref not available"),x||console.warn("üé• Student: Remote stream not available"))},[x,R]);const fi=()=>{if(i){const E=i.toggleAudio();u(E)}},pi=async()=>{if(i)try{const E=await i.toggleVideo();O(E),c.current&&i.localStream&&(c.current.srcObject=i.localStream)}catch(E){console.error("‚ùå Student: Failed to toggle video:",E)}};l.useEffect(()=>{if(!i)return;const E=()=>F(!0),q=()=>F(!1);return i.addEventListener("screen-share-started",E),i.addEventListener("screen-share-stopped",q),()=>{i.removeEventListener("screen-share-started",E),i.removeEventListener("screen-share-stopped",q)}},[i]),l.useEffect(()=>{if(!(a!=null&&a.socket))return;const E=H=>{H.callId===(e==null?void 0:e.callId)&&k(Z=>{const ne=new Map(Z);return H.isRaised?(ne.set(H.studentId,{name:H.studentName,timestamp:H.timestamp||Date.now()}),T(!0),"Notification"in window&&Notification.permission==="granted"&&new Notification("Student Hand Raised",{body:`${H.studentName} wants to speak`,icon:"‚úã"})):(ne.delete(H.studentId),ne.size===0&&T(!1)),ne})},q=H=>{var Z;H.senderId!==((Z=a.socket.userData)==null?void 0:Z.userId)&&(J(ne=>{const ie={id:Date.now()+Math.random(),message:H.message,sender:H.senderName||"Student",senderId:H.senderId,timestamp:new Date,isOwnMessage:!1};return[...ne,ie]}),D||xe(ne=>ne+1))};return a.socket.on("student-raise-hand",E),a.socket.on("call-chat-message",q),()=>{a.socket.off("student-raise-hand",E),a.socket.off("call-chat-message",q)}},[a]);const mi=E=>{k(q=>{const H=new Map(q);return H.delete(E),H}),a!=null&&a.socket&&a.socket.emit("hand-acknowledged",{callId:(e==null?void 0:e.callId)||"unknown",studentId:E}),b.size<=1&&T(!1)},In=()=>{T(!1)},Rn=()=>{_(!D),D||xe(0)},Pn=()=>{var q,H;if(!V.trim())return;if(!a){console.error("‚ùå Teacher: socketManager is null/undefined"),alert("Unable to send message: Socket manager not initialized. Please refresh the page.");return}if(!a.socket){console.error("‚ùå Teacher: socketManager.socket is null/undefined"),alert("Unable to send message: Socket not connected. Please check your connection.");return}if(!a.socket.connected){console.error("‚ùå Teacher: Socket not connected"),alert("Unable to send message: Not connected to server. Please try again.");return}const E={callId:(e==null?void 0:e.callId)||"unknown",message:V.trim(),senderId:((q=a.socket.userData)==null?void 0:q.userId)||"teacher",senderName:((H=a.socket.userData)==null?void 0:H.username)||"Teacher",timestamp:new Date().toISOString()};try{J(Z=>[...Z,{id:Date.now()+Math.random(),message:E.message,sender:"You",senderId:E.senderId,timestamp:new Date,isOwnMessage:!0}]),a.socket.emit("call-chat-message",E,Z=>{Z&&Z.error&&(console.error("‚ùå Teacher: Message send failed:",Z.error),alert("Failed to send message. Please try again."))}),X("")}catch(Z){console.error("‚ùå Teacher: Error sending message:",Z)}},gi=E=>{E.key==="Enter"&&!E.shiftKey&&(E.preventDefault(),Pn())},xi=E=>{ae(E.currentTarget)},bi=()=>{ae(null)},yi=E=>{X(q=>q+E),ae(null)},wi=["üòÄ","üòÇ","ü•∞","üòç","ü§î","üëç","üëé","‚ù§Ô∏è","üéâ","üéä","üòä","üòé","üôÑ","üò¢","üò≠","üò°","ü§ó","ü§∑","üôè","üëè","üî•","‚≠ê","‚úÖ","‚ùå","üíØ","üéØ","üìù","üí°","üöÄ","üéà"];return l.useEffect(()=>{be.current&&(be.current.scrollTop=be.current.scrollHeight)},[Y]),l.useEffect(()=>{m&&pt&&(Sr(),setTimeout(()=>{Tn()},500))},[pt]),r?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,width:"100vw",height:"100vh",backgroundColor:"#000",zIndex:9999,display:"flex",flexDirection:"column"},children:[s.jsxs(p,{sx:{flex:1,display:"flex",flexDirection:"column",position:"relative"},children:[s.jsx(p,{sx:{position:"absolute",top:"max(20px, env(safe-area-inset-top))",left:"max(20px, env(safe-area-inset-left))",zIndex:1e4},children:s.jsxs(p,{sx:{display:"flex",gap:1,flexWrap:"wrap"},children:[s.jsx(Ct,{label:`Status: ${t}`,color:t==="connected"?"success":"warning",size:"small"}),!1,b.size>0&&s.jsx(Ct,{label:`‚úã ${b.size} hand${b.size>1?"s":""} raised`,color:"warning",size:"small",sx:{backgroundColor:"#ff9800",color:"white"}})]})}),s.jsxs(p,{sx:{flex:1,position:"relative",display:"flex",justifyContent:"center",alignItems:"center",overflow:"hidden",padding:Tt?{xs:2,sm:3}:0},children:[s.jsx(p,{sx:li,children:s.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,controls:!1,style:{width:"100%",height:"100%",objectFit:"contain",backgroundColor:"#000",display:"block"}})}),!x&&s.jsxs(p,{sx:{position:"absolute",color:"white",textAlign:"center"},children:[s.jsx(S,{variant:"h6",children:t==="connecting"?"Calling student...":"Waiting for video"}),s.jsx(S,{variant:"body2",color:"grey.400",children:t==="connecting"?"Waiting for student to answer":"Establishing connection"})]}),s.jsxs(p,{sx:{position:"absolute",top:"max(20px, env(safe-area-inset-top))",right:"max(20px, env(safe-area-inset-right))",width:Tt?{xs:88,sm:110}:{xs:120,sm:160},height:Tt?{xs:118,sm:150}:{xs:82,sm:120},"@media (max-height: 500px) and (orientation: landscape)":{width:80,height:100,top:"10px",right:"10px"},borderRadius:3,overflow:"hidden",border:"none",boxShadow:"0 4px 20px rgba(0, 0, 0, 0.35)",transition:"all 0.3s ease"},children:[s.jsx("video",{ref:c,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}}),!y&&s.jsx(p,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"#333",display:"flex",alignItems:"center",justifyContent:"center"},children:s.jsx(rn,{sx:{color:"white",fontSize:32}})})]})]}),s.jsxs(p,{sx:{position:"absolute",left:"max(12px, env(safe-area-inset-left))",top:"50%",transform:"translateY(-50%)",display:"flex",flexDirection:"column",gap:{xs:1,sm:1.5},zIndex:1e4,padding:{xs:"6px",sm:"8px"},backgroundColor:"rgba(0, 0, 0, 0.4)",backdropFilter:"blur(10px)",borderRadius:"20px",border:"1px solid rgba(118, 166, 246, 0.2)",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)","@media (max-height: 500px) and (orientation: landscape)":{padding:"4px",gap:.5,left:"max(8px, env(safe-area-inset-left))"}},children:[s.jsx(se,{onClick:fi,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:h?"rgba(118, 166, 246, 0.15)":"rgba(244, 67, 54, 0.9)",backdropFilter:"blur(10px)",color:h?"#76a6f6":"white",border:`2px solid ${h?"#76a6f6":"#f44336"}`,boxShadow:`0 4px 20px ${h?"rgba(118, 166, 246, 0.25)":"rgba(244, 67, 54, 0.3)"}`,transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:h?"#76a6f6":"#d32f2f",color:"white",boxShadow:`0 6px 24px ${h?"rgba(118, 166, 246, 0.4)":"rgba(244, 67, 54, 0.4)"}`}},children:h?s.jsx(Ms,{sx:{fontSize:{xs:20,sm:24}}}):s.jsx(_s,{sx:{fontSize:{xs:20,sm:24}}})}),s.jsx(se,{onClick:pi,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:y?"rgba(118, 166, 246, 0.15)":"rgba(244, 67, 54, 0.9)",backdropFilter:"blur(10px)",color:y?"#76a6f6":"white",border:`2px solid ${y?"#76a6f6":"#f44336"}`,boxShadow:`0 4px 20px ${y?"rgba(118, 166, 246, 0.25)":"rgba(244, 67, 54, 0.3)"}`,transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:y?"#76a6f6":"#d32f2f",color:"white",boxShadow:`0 6px 24px ${y?"rgba(118, 166, 246, 0.4)":"rgba(244, 67, 54, 0.4)"}`}},children:y?s.jsx(wn,{sx:{fontSize:{xs:20,sm:24}}}):s.jsx(rn,{sx:{fontSize:{xs:20,sm:24}}})}),s.jsx(fn,{badgeContent:he,color:"error",sx:{"& .MuiBadge-badge":{backgroundColor:"#ff4444",color:"white",fontWeight:"bold",fontSize:"10px",minWidth:"16px",height:"16px"}},children:s.jsx(se,{onClick:Rn,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:D?"#76a6f6":"rgba(118, 166, 246, 0.15)",backdropFilter:"blur(10px)",color:D?"white":"#76a6f6",border:"2px solid #76a6f6",boxShadow:"0 4px 20px rgba(118, 166, 246, 0.25)",transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:"#76a6f6",color:"white",boxShadow:"0 6px 24px rgba(118, 166, 246, 0.4)"}},children:s.jsx(Zt,{sx:{fontSize:{xs:20,sm:24}}})})}),s.jsx(se,{onClick:n,sx:{width:{xs:48,sm:56},height:{xs:48,sm:56},backgroundColor:"#f44336",backdropFilter:"blur(10px)",color:"white",border:"2px solid #f44336",boxShadow:"0 4px 20px rgba(244, 67, 54, 0.3)",transition:"all 0.3s ease","&:hover":{transform:"scale(1.05)",backgroundColor:"#d32f2f",boxShadow:"0 6px 24px rgba(244, 67, 54, 0.4)"}},children:s.jsx(bn,{sx:{fontSize:{xs:20,sm:24}}})})]}),B&&s.jsx(Yl,{socketManager:a,isVisible:B,onClose:()=>$(!1),callId:(e==null?void 0:e.callId)||"unknown",isTeacher:!0})]}),s.jsx(xs,{direction:"left",in:D,mountOnEnter:!0,unmountOnExit:!0,children:s.jsxs(p,{sx:{position:"absolute",top:{xs:"max(10px, env(safe-area-inset-top))",sm:"max(20px, env(safe-area-inset-top))"},right:{xs:"max(10px, env(safe-area-inset-right))",sm:"max(20px, env(safe-area-inset-right))"},width:{xs:"calc(100vw - 20px)",sm:"calc(100vw - 40px)",md:400},maxWidth:{xs:"95vw",sm:350,md:400},height:{xs:"calc(100vh - 120px)","@media (max-height: 500px) and (orientation: landscape)":"calc(100vh - 80px)"},"@media (max-height: 500px) and (orientation: landscape)":{width:"300px",maxWidth:"40vw",height:"calc(100vh - 80px)"},background:"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(20px)",borderRadius:"16px",border:"1px solid rgba(255, 255, 255, 0.2)",display:"flex",flexDirection:"column",boxShadow:"0 8px 32px rgba(0, 0, 0, 0.3)",zIndex:10001},children:[s.jsxs(p,{sx:{p:2,background:"rgba(118, 166, 246, 0.2)",backdropFilter:"blur(10px)",color:"#FFFFFF",display:"flex",alignItems:"center",justifyContent:"space-between",borderBottom:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"16px 16px 0 0"},children:[s.jsxs(S,{variant:"h6",sx:{display:"flex",alignItems:"center",gap:1,fontWeight:600,fontSize:"16px",color:"#FFFFFF"},children:[s.jsx(Zt,{sx:{fontSize:20,color:"#76a6f6"}}),"Chat",((Fn=a==null?void 0:a.socket)==null?void 0:Fn.connected)&&s.jsx(p,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"#4caf50",ml:1},title:"Connected"}),!((Mn=a==null?void 0:a.socket)!=null&&Mn.connected)&&s.jsx(p,{sx:{width:8,height:8,borderRadius:"50%",backgroundColor:"#f44336",ml:1},title:"Disconnected"})]}),s.jsx(se,{size:"medium",onClick:Rn,sx:{color:"rgba(255, 255, 255, 0.8)",borderRadius:1,minWidth:44,minHeight:44,"&:hover":{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"#FFFFFF"}},children:s.jsx(ur,{fontSize:"small"})})]}),s.jsx(p,{ref:be,sx:{flex:1,overflowY:"auto",p:2,minHeight:0,"&::-webkit-scrollbar":{width:"6px"},"&::-webkit-scrollbar-track":{background:"rgba(255, 255, 255, 0.1)",borderRadius:"3px"},"&::-webkit-scrollbar-thumb":{background:"rgba(118, 166, 246, 0.6)",borderRadius:"3px","&:hover":{background:"rgba(118, 166, 246, 0.8)"}}},children:Y.length===0?s.jsxs(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100%",color:"rgba(255, 255, 255, 0.7)",flexDirection:"column",gap:1},children:[s.jsx(Zt,{sx:{fontSize:48,opacity:.4,color:"rgba(255, 255, 255, 0.5)"}}),s.jsx(S,{variant:"body2",sx:{color:"rgba(255, 255, 255, 0.8)"},children:"No messages yet"}),s.jsx(S,{variant:"caption",sx:{color:"rgba(255, 255, 255, 0.6)"},children:"Start a conversation!"})]}):Y.map(E=>s.jsxs(p,{sx:{mb:1.5,p:1.5,borderRadius:2,backgroundColor:E.isOwnMessage?"rgba(118, 166, 246, 0.9)":"rgba(255, 255, 255, 0.15)",backdropFilter:"blur(10px)",marginLeft:E.isOwnMessage?4:0,marginRight:E.isOwnMessage?0:4,border:E.isOwnMessage?"1px solid rgba(118, 166, 246, 0.3)":"1px solid rgba(255, 255, 255, 0.2)",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.2)"},children:[s.jsx(S,{variant:"body2",sx:{fontWeight:600,mb:.5,color:E.isOwnMessage?"#ffffff":"rgba(255, 255, 255, 0.9)",fontSize:"13px"},children:E.sender}),s.jsx(S,{variant:"body2",sx:{mb:.5,color:E.isOwnMessage?"#ffffff":"rgba(255, 255, 255, 0.95)",lineHeight:1.4},children:E.message}),s.jsx(S,{variant:"caption",sx:{color:E.isOwnMessage?"rgba(255, 255, 255, 0.7)":"rgba(255, 255, 255, 0.6)",fontSize:"11px"},children:E.timestamp.toLocaleTimeString()})]},E.id))}),s.jsx(Ke,{sx:{borderColor:"rgba(255, 255, 255, 0.2)"}}),s.jsxs(p,{sx:{p:2,background:"rgba(118, 166, 246, 0.15)",backdropFilter:"blur(10px)",borderTop:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"0 0 16px 16px",flexShrink:0},children:[s.jsxs(p,{sx:{display:"flex",gap:1,alignItems:"flex-end"},children:[s.jsx(p,{sx:{flex:1,position:"relative"},children:s.jsx(We,{fullWidth:!0,size:"small",placeholder:"Type a message...",value:V,onChange:E=>X(E.target.value),onKeyPress:gi,multiline:!0,maxRows:3,variant:"outlined",sx:{"& .MuiOutlinedInput-root":{backgroundColor:"rgba(255, 255, 255, 0.1)",backdropFilter:"blur(10px)",color:"#ffffff",borderRadius:2,"& fieldset":{borderColor:"rgba(255, 255, 255, 0.3)"},"&:hover fieldset":{borderColor:"rgba(118, 166, 246, 0.7)"},"&.Mui-focused fieldset":{borderColor:"#76a6f6"}},"& .MuiInputBase-input::placeholder":{color:"rgba(255, 255, 255, 0.7)"}},InputProps:{endAdornment:s.jsx(se,{size:"medium",onClick:xi,sx:{p:.5,minWidth:44,minHeight:44},children:s.jsx(Za,{sx:{fontSize:20,color:"rgba(255, 255, 255, 0.7)"}})})}})}),s.jsx("span",{children:s.jsx(se,{onClick:Pn,disabled:!V.trim(),sx:{backgroundColor:"#76a6f6",color:"white",borderRadius:2,boxShadow:"0 4px 12px rgba(118, 166, 246, 0.3)","&:hover":{backgroundColor:"#5a91e6",transform:"translateY(-1px)",boxShadow:"0 6px 16px rgba(118, 166, 246, 0.4)"},"&:disabled":{backgroundColor:"rgba(255, 255, 255, 0.2)",color:"rgba(255, 255, 255, 0.5)",boxShadow:"none",transform:"none"}},children:s.jsx(As,{})})})]}),s.jsx(gs,{open:!!pe,anchorEl:pe,onClose:bi,anchorOrigin:{vertical:"top",horizontal:"left"},transformOrigin:{vertical:"bottom",horizontal:"left"},sx:{zIndex:10005},children:s.jsx(p,{sx:{p:2,maxWidth:{xs:"95vw",sm:300},background:"rgba(0, 0, 0, 0.8)",backdropFilter:"blur(20px)",borderRadius:2,border:"1px solid rgba(118, 166, 246, 0.3)",display:"grid",gridTemplateColumns:"repeat(6, 1fr)",gap:1},children:wi.map((E,q)=>s.jsx(se,{onClick:()=>yi(E),sx:{fontSize:"1.2rem",width:44,height:44,color:"white","&:hover":{backgroundColor:"rgba(118, 166, 246, 0.3)"}},children:E},q))})})]})]})}),!1,s.jsxs(gr,{open:L,onClose:In,maxWidth:!1,fullWidth:!0,PaperProps:{sx:{backgroundColor:"#2d2d30",color:"#e8e8e8",border:"2px solid #ff9800",maxWidth:{xs:"95vw",sm:"400px"},margin:{xs:"16px",sm:"auto"}}},children:[s.jsxs(pn,{sx:{backgroundColor:"#ff9800",color:"white",display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{sx:{fontSize:"24px"},children:"‚úã"}),"Student Hand Raised"]}),s.jsx(xr,{sx:{pt:2},children:Array.from(b.entries()).map(([E,q])=>s.jsxs(p,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1,mb:1,backgroundColor:"#3d3d40",borderRadius:1},children:[s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(p,{sx:{fontSize:"20px"},children:"‚úã"}),s.jsxs(S,{variant:"body1",children:[q.name," wants to speak"]})]}),s.jsx(S,{variant:"caption",sx:{color:"#a0a0a0"},children:new Date(q.timestamp).toLocaleTimeString()})]},E))}),s.jsxs(mn,{children:[s.jsx(Ae,{onClick:In,sx:{color:"#e8e8e8"},children:"Dismiss"}),Array.from(b.keys()).map(E=>s.jsx(Ae,{onClick:()=>mi(E),variant:"contained",sx:{backgroundColor:"#ff9800","&:hover":{backgroundColor:"#f57c00"}},children:"Acknowledge"},E))]})]})]}):null}function Jl({isOpen:r=!1,callData:e,callStatus:t="connecting",onEndCall:n,webrtcService:i,socketManager:a}){const o=Ie(),d=ut(o.breakpoints.down("md")),c=ut(o.breakpoints.down("sm")),f=l.useRef(null),h=l.useRef(null),[u,y]=l.useState(!0),[O,g]=l.useState(!0),[w,x]=l.useState(!1),[N,R]=l.useState(!1),[j,I]=l.useState(!1),[F,B]=l.useState(!1),[$,b]=l.useState(.7),[k,L]=l.useState(null),[T,D]=l.useState(null),[_,Y]=l.useState(16/9),[J,V]=l.useState(!1),[X,pe]=l.useState(!1),[ae,he]=l.useState(()=>({width:typeof window<"u"?window.innerWidth:0,height:typeof window<"u"?window.innerHeight:0}));l.useEffect(()=>{if(typeof window>"u")return;const A=()=>{he({width:window.innerWidth,height:window.innerHeight})};return A(),window.addEventListener("resize",A),window.addEventListener("orientationchange",A),()=>{window.removeEventListener("resize",A),window.removeEventListener("orientationchange",A)}},[]);const xe=l.useMemo(()=>_?(X?1/_:_)<1:X?!J:J,[J,_,X]),be=l.useMemo(()=>{if(_)return X?_===0?void 0:1/_:_},[_,X]),ge=l.useMemo(()=>{if(!X||!_)return null;const A=_,Q=ae.width||0,ye=ae.height||0;if(!Q||!ye)return null;let le=ye*1.34,me=le/A;const De=Q*1.75;le>De&&(le=De,me=le/A);const ve=Q*1.65;return me>ve&&(me=ve,le=me*A),{displayWidth:le,displayHeight:me}},[X,_,ae]),z=l.useMemo(()=>{const A=be||(xe?.5625:1.7777777777777777);return X&&ge?{position:"relative",width:`${ge.displayHeight}px`,height:`${ge.displayWidth}px`,margin:"0 auto",backgroundColor:"#000",borderRadius:{xs:0,sm:2},overflow:"hidden",display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.3s ease"}:xe?{position:"relative",width:{xs:"88%",sm:"70%"},maxWidth:460,maxHeight:"85vh",aspectRatio:A||9/16,borderRadius:3,overflow:"hidden",backgroundColor:"#000",boxShadow:"0 12px 28px rgba(0, 0, 0, 0.45)",display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.3s ease"}:{position:"relative",width:"100%",maxWidth:"100vw",aspectRatio:A||16/9,height:"auto",maxHeight:"90vh",margin:"0 auto",backgroundColor:"#000",borderRadius:{xs:0,sm:2},overflow:"hidden",transition:"all 0.3s ease"}},[xe,be,X,ge]),K=l.useCallback(()=>{var A,Q,ye;try{const le=h.current,me=(A=T==null?void 0:T.getVideoTracks)==null?void 0:A.call(T)[0];let De=(Q=me==null?void 0:me.getSettings)==null?void 0:Q.call(me).width,ve=(ye=me==null?void 0:me.getSettings)==null?void 0:ye.call(me).height;if((!De||!ve)&&le&&(De=le.videoWidth,ve=le.videoHeight),De&&ve){const Yt=De/ve;Y(Yt||16/9),V(Yt<1)}}catch(le){console.warn("‚ö†Ô∏è Student Mobile: Failed to derive remote video layout",le)}},[T]);l.useEffect(()=>{if(!i)return;const A=i.getStatus();A.hasLocalStream&&i.localStream?L(i.localStream):e!=null&&e.localStream&&L(e.localStream),A.hasRemoteStream&&i.remoteStream&&D(i.remoteStream)},[i,e]),l.useEffect(()=>{if(!i||k)return;const A=setInterval(()=>{i.localStream&&!k&&L(i.localStream)},500),Q=setTimeout(()=>clearInterval(A),5e3);return()=>{clearInterval(A),clearTimeout(Q)}},[i,k]),l.useEffect(()=>{k&&f.current&&(f.current.srcObject=k,f.current.addEventListener("loadedmetadata",async()=>{try{await f.current.play()}catch(A){console.warn("üé• Student Mobile: Local video autoplay failed:",A)}}))},[k]),l.useEffect(()=>{T&&h.current&&(h.current.srcObject=T,h.current.volume=$,h.current.addEventListener("loadedmetadata",async()=>{try{h.current.muted=!1,h.current.autoplay=!0,h.current.playsInline=!0,await h.current.play()}catch(A){console.warn("üé• Student Mobile: Remote video autoplay failed, will try to play when user interacts:",A);const Q=async()=>{try{await h.current.play(),document.removeEventListener("click",Q)}catch(ye){console.error("üé• Student Mobile: Failed to play remote video even after interaction:",ye)}};document.addEventListener("click",Q,{once:!0})}}))},[T,$]),l.useEffect(()=>{var le;K();const A=h.current,Q=(le=T==null?void 0:T.getVideoTracks)==null?void 0:le.call(T)[0],ye=()=>K();return A&&A.addEventListener("loadedmetadata",ye),Q&&(Q.onresize=ye),()=>{A&&A.removeEventListener("loadedmetadata",ye),Q&&(Q.onresize=null)}},[T,K]),l.useEffect(()=>{if(!i)return;const A=Q=>{D(Q.detail.stream)};return i.addEventListener("remote-stream",A),()=>{i.removeEventListener("remote-stream",A)}},[i]);const ee=()=>{if(i){const A=i.toggleAudio();y(A)}},P=async()=>{if(i)try{const A=await i.toggleVideo();g(A),i.localStream&&L(i.localStream)}catch(A){console.error("‚ùå Student Mobile: Failed to toggle video:",A)}};l.useEffect(()=>{h.current&&(h.current.volume=$)},[$]);const W={backgroundColor:v(o.palette.background.paper,.9),backdropFilter:"blur(10px)",color:o.palette.primary.main,border:`2px solid ${v(o.palette.primary.main,.3)}`,boxShadow:`0 4px 12px ${v(o.palette.primary.main,.3)}`,transition:"all 0.3s ease",width:d?48:56,height:d?48:56,"&:hover":{transform:"translateY(-2px)",backgroundColor:o.palette.primary.main,color:"white",boxShadow:`0 6px 16px ${v(o.palette.primary.main,.4)}`}},m={...W,backgroundColor:o.palette.primary.main,color:"white","&:hover":{backgroundColor:o.palette.primary.dark,color:"white"}},M={backgroundColor:"#f44336",color:"white",border:"2px solid #f44336",boxShadow:"0 4px 12px rgba(244, 67, 54, 0.3)",transition:"all 0.3s ease",width:d?56:64,height:d?56:64,"&:hover":{transform:"translateY(-2px)",backgroundColor:"#d32f2f",boxShadow:"0 6px 16px rgba(244, 67, 54, 0.4)"}},C=[{icon:u?s.jsx(Ms,{}):s.jsx(_s,{}),onClick:ee,active:u,color:u?"primary":"error"},{icon:O?s.jsx(wn,{}):s.jsx(rn,{}),onClick:P,active:O,color:O?"primary":"error"},{icon:s.jsx(bn,{}),onClick:n,style:M}],re=[{icon:N?s.jsx(ho,{}):s.jsx(lo,{}),onClick:()=>R(!N),active:N,label:"Screen Share"},{icon:s.jsx(Ka,{}),onClick:()=>I(!j),active:j,label:"Whiteboard"},{icon:s.jsx(bo,{}),onClick:()=>b(Math.max(0,$-.1)),label:"Volume Down"},{icon:s.jsx(yo,{}),onClick:()=>b(Math.min(1,$+.1)),label:"Volume Up"},{icon:s.jsx(Zt,{}),onClick:()=>B(!F),active:F,label:"Chat"},{icon:s.jsx(io,{}),onClick:()=>{},label:"Raise Hand"}];return r?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#000",zIndex:1e4,display:"flex",flexDirection:"column"},children:[s.jsxs(p,{sx:{flex:1,position:"relative",overflow:"hidden",display:"flex",flexDirection:d?"column":"row"},children:[s.jsxs(p,{sx:{flex:1,backgroundColor:"#1a1a1a",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",padding:xe&&!X?{xs:2,sm:3}:0},children:[s.jsx(p,{sx:z,children:s.jsx("video",{ref:h,autoPlay:!0,playsInline:!0,style:{position:X?"absolute":"static",top:X?"50%":void 0,left:X?"50%":void 0,width:X&&ge?`${ge.displayWidth}px`:"100%",height:X&&ge?`${ge.displayHeight}px`:"100%",objectFit:"contain",backgroundColor:"#000",display:"block",transform:X?"translate(-50%, -50%) rotate(90deg)":"none",transformOrigin:"center center"}})}),!T&&s.jsxs(p,{sx:{position:"absolute",color:"white",textAlign:"center"},children:[s.jsx(S,{variant:"h6",children:t==="connecting"?"Calling teacher...":"Waiting for video"}),s.jsx(S,{variant:"body2",color:"grey.400",children:t==="connecting"?"Preparing connection":"Attempting to receive stream"})]}),s.jsxs(p,{sx:{position:"absolute",top:20,left:20,right:20,zIndex:1,display:"flex",justifyContent:"space-between",alignItems:"center",gap:1},children:[s.jsx(ke,{sx:{px:2,py:1,backgroundColor:v(o.palette.background.paper,.9),backdropFilter:"blur(10px)"},children:s.jsxs(S,{variant:"body2",color:"textSecondary",children:[t==="connecting"&&"üìû Connecting...",t==="connected"&&"üü¢ Connected",t==="ended"&&"üìû Call Ended",!k&&" (No local stream)",!T&&" (No remote stream)",k&&T&&" (Both streams ready)"]})}),s.jsxs(p,{sx:{display:"flex",alignItems:"center",gap:1},children:[s.jsx(ke,{sx:{px:2,py:1,backgroundColor:v(o.palette.background.paper,.9),backdropFilter:"blur(10px)"},children:s.jsx(S,{variant:"body2",fontWeight:600,children:(e==null?void 0:e.teacherName)||"Teacher"})}),s.jsx(se,{size:"small",onClick:()=>pe(A=>!A),sx:{backgroundColor:X?o.palette.primary.main:v(o.palette.background.paper,.9),color:X?"#fff":o.palette.primary.main,border:`1px solid ${v(o.palette.primary.main,.4)}`,transition:"all 0.2s ease","&:hover":{backgroundColor:o.palette.primary.main,color:"#fff"}},children:s.jsx(co,{fontSize:"inherit"})})]})]})]}),s.jsx(p,{sx:{position:"absolute",bottom:d?100:20,right:20,width:d?120:200,height:d?160:150,backgroundColor:"#2a2a2a",borderRadius:2,overflow:"hidden",border:`2px solid ${v(o.palette.primary.main,.5)}`,zIndex:2},children:s.jsx("video",{ref:f,autoPlay:!0,playsInline:!0,muted:!0,style:{width:"100%",height:"100%",objectFit:"cover"}})})]}),s.jsxs(p,{sx:{position:"fixed",bottom:0,left:0,right:0,backgroundColor:v(o.palette.background.paper,.95),backdropFilter:"blur(20px)",borderTop:`1px solid ${v(o.palette.divider,.1)}`,p:2,display:"flex",justifyContent:"center",alignItems:"center",gap:2,zIndex:3,px:c?1:2,py:c?1.5:2},children:[d&&s.jsx(Di,{size:"medium",onClick:()=>x(!0),sx:{...W,mr:1},children:s.jsx(Fs,{})}),C.map((A,Q)=>s.jsx(se,{onClick:A.onClick,sx:A.style||(A.active?m:W),children:A.icon},Q))]}),s.jsx(Jr,{anchor:"left",open:w,onClose:()=>x(!1),PaperProps:{sx:{width:280,backgroundColor:v(o.palette.background.paper,.95),backdropFilter:"blur(20px)",border:`1px solid ${v(o.palette.divider,.1)}`}},children:s.jsxs(p,{sx:{p:3},children:[s.jsxs(p,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3},children:[s.jsx(S,{variant:"h6",color:"primary",children:"Call Controls"}),s.jsx(se,{onClick:()=>x(!1),children:s.jsx(ur,{})})]}),re.map((A,Q)=>s.jsxs(p,{sx:{display:"flex",alignItems:"center",mb:2,p:1,borderRadius:1,"&:hover":{backgroundColor:v(o.palette.primary.main,.1)}},children:[s.jsx(se,{onClick:A.onClick,sx:A.active?m:W,children:A.icon}),s.jsx(S,{variant:"body1",sx:{ml:2,flex:1},children:A.label})]},Q))]})}),s.jsx(xs,{direction:"left",in:F,mountOnEnter:!0,unmountOnExit:!0,children:s.jsxs(p,{sx:{position:"fixed",top:0,right:0,width:d?"100%":380,height:"100%",backgroundColor:v(o.palette.background.paper,.95),backdropFilter:"blur(20px)",border:`1px solid ${v(o.palette.divider,.1)}`,zIndex:10001,display:"flex",flexDirection:"column"},children:[s.jsxs(p,{sx:{p:2,backgroundColor:v(o.palette.primary.main,.1),borderBottom:`1px solid ${v(o.palette.divider,.1)}`,display:"flex",alignItems:"center",justifyContent:"space-between"},children:[s.jsx(S,{variant:"h6",color:"primary",children:"Chat"}),s.jsx(se,{onClick:()=>B(!1),children:s.jsx(ur,{})})]}),s.jsx(p,{sx:{flex:1,p:2},children:s.jsx(S,{variant:"body2",color:"textSecondary",children:"Chat feature coming soon..."})})]})})]}):null}function Xl({open:r,callerName:e,callerInfo:t,onAccept:n,onReject:i,autoRejectTimer:a=30}){var O;const o=Ie(),[d,c]=l.useState(a),[f,h]=l.useState(!0);l.useEffect(()=>{if(!r){c(a);return}const g=setInterval(()=>{c(w=>w<=1?(i==null||i({reason:"auto-timeout"}),0):w-1)},1e3);return()=>clearInterval(g)},[r,a,i]),l.useEffect(()=>{if(!r)return;const g=setInterval(()=>{h(w=>!w)},1e3);return()=>clearInterval(g)},[r]),l.useEffect(()=>{let g=null,w=null;if(r)return setTimeout(async()=>{try{w=new(window.AudioContext||window.webkitAudioContext),w.state==="suspended"&&await w.resume();const N=()=>{try{if(w.state!=="running"){console.warn("üìû Student: AudioContext not running, state:",w.state);return}const R=w.createOscillator(),j=w.createGain();R.connect(j),j.connect(w.destination),R.frequency.setValueAtTime(1e3,w.currentTime),j.gain.setValueAtTime(.5,w.currentTime),j.gain.exponentialRampToValueAtTime(.01,w.currentTime+.3),R.start(w.currentTime),R.stop(w.currentTime+.3)}catch(R){console.warn("üìû Student: Failed to play individual beep:",R)}};N(),g=setInterval(N,1500)}catch(N){console.warn("üìû Student: Could not create audio context for ringtone:",N),console.warn("üìû Student: This is normal on some mobile browsers - ringtone will be visual only");try{if("vibrate"in navigator){const R=[200,100,200,100,200],j=setInterval(()=>{navigator.vibrate(R)},2e3);navigator.vibrate(R),g=j}}catch(R){console.warn("üìû Student: Vibration also not available:",R)}}},100),()=>{g&&clearInterval(g),w&&w.state!=="closed"&&w.close()}},[r]);const u=()=>{c(0),n==null||n()},y=()=>{c(0),i==null||i({reason:"user-declined"})};return s.jsx(gr,{open:r,maxWidth:"sm",fullWidth:!0,PaperProps:{sx:{borderRadius:4,backgroundColor:o.palette.background.paper,backgroundImage:`linear-gradient(135deg, ${v(o.palette.primary.main,.05)} 0%, ${v(o.palette.secondary.main,.05)} 100%)`}},children:s.jsxs(xr,{sx:{p:4,textAlign:"center"},children:[s.jsx(S,{variant:"h5",sx:{mb:1,fontWeight:600},children:"Incoming Video Call"}),s.jsx(S,{variant:"body2",color:"textSecondary",sx:{mb:4},children:"Your teacher is calling you"}),s.jsxs(p,{sx:{position:"relative",display:"flex",justifyContent:"center",mb:3},children:[s.jsx(Wi,{in:f,children:s.jsx(p,{sx:{position:"absolute",width:200,height:200,borderRadius:"50%",border:`3px solid ${v(o.palette.primary.main,.3)}`,animation:"ripple 2s infinite","@keyframes ripple":{"0%":{transform:"scale(0.8)",opacity:1},"100%":{transform:"scale(1.2)",opacity:0}}}})}),s.jsx(mr,{sx:{width:120,height:120,fontSize:"3rem",backgroundColor:o.palette.primary.main,border:`4px solid ${o.palette.background.paper}`,boxShadow:o.shadows[8]},children:(O=e==null?void 0:e.charAt(0))==null?void 0:O.toUpperCase()}),s.jsx(p,{sx:{position:"absolute",bottom:0,right:"calc(50% - 80px)",backgroundColor:o.palette.success.main,borderRadius:"50%",p:1,border:`3px solid ${o.palette.background.paper}`},children:s.jsx(wn,{sx:{color:"white",fontSize:20}})})]}),s.jsx(S,{variant:"h6",sx:{mb:1,fontWeight:600},children:e}),t&&s.jsx(S,{variant:"body2",color:"textSecondary",sx:{mb:2},children:t}),s.jsx(ke,{elevation:0,sx:{backgroundColor:v(o.palette.warning.main,.1),color:o.palette.warning.main,py:1,px:2,borderRadius:2,mb:4,display:"inline-block"},children:s.jsxs(S,{variant:"body2",sx:{fontWeight:600},children:["Auto-reject in ",d,"s"]})}),s.jsxs(p,{sx:{display:"flex",justifyContent:"space-around",alignItems:"center",mt:4},children:[s.jsx(se,{onClick:y,sx:{backgroundColor:o.palette.error.main,color:"white",width:80,height:80,"&:hover":{backgroundColor:o.palette.error.dark,transform:"scale(1.1)"},transition:"all 0.2s ease-in-out"},children:s.jsx(bn,{sx:{fontSize:32}})}),s.jsx(se,{onClick:u,sx:{backgroundColor:o.palette.success.main,color:"white",width:80,height:80,animation:"pulse 2s infinite","&:hover":{backgroundColor:o.palette.success.dark,transform:"scale(1.1)"},transition:"all 0.2s ease-in-out","@keyframes pulse":{"0%":{boxShadow:`0 0 0 0 ${v(o.palette.success.main,.7)}`},"70%":{boxShadow:`0 0 0 20px ${v(o.palette.success.main,0)}`},"100%":{boxShadow:`0 0 0 0 ${v(o.palette.success.main,0)}`}}},children:s.jsx(Va,{sx:{fontSize:32}})})]}),s.jsxs(p,{sx:{display:"flex",justifyContent:"space-around",mt:2},children:[s.jsx(S,{variant:"caption",color:"error",children:"Decline"}),s.jsx(S,{variant:"caption",color:"success.main",children:"Accept"})]}),s.jsx(ke,{elevation:0,sx:{backgroundColor:v(o.palette.info.main,.1),color:o.palette.info.main,p:2,borderRadius:2,mt:3},children:s.jsx(S,{variant:"caption",children:"üìπ This call will be automatically recorded for educational purposes"})})]})})}class Kl extends Ht.Component{constructor(e){super(e),this.state={hasError:!1,error:null}}static getDerivedStateFromError(e){return{hasError:!0,error:e}}componentDidCatch(e,t){var n,i;if(console.error("Error caught by ErrorBoundary:",e,t),(n=e.message)!=null&&n.includes("removeChild")||(i=e.message)!=null&&i.includes("not a child of this node")){console.warn("Non-critical DOM cleanup error, ignoring:",e.message),setTimeout(()=>{this.setState({hasError:!1,error:null})},100);return}}render(){var e,t;return this.state.hasError&&!((t=(e=this.state.error)==null?void 0:e.message)!=null&&t.includes("removeChild"))?s.jsxs(p,{sx:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"#000",zIndex:9999,display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",color:"white",textAlign:"center",p:3},children:[s.jsx(S,{variant:"h5",gutterBottom:!0,children:"Meeting Error"}),s.jsx(S,{variant:"body2",color:"text.secondary",sx:{mb:3,maxWidth:600},children:"Something went wrong with the meeting interface. Please try refreshing or rejoining."}),s.jsx(Ae,{variant:"contained",color:"primary",onClick:()=>window.location.reload(),children:"Refresh Page"})]}):this.props.children}}class Ql extends EventTarget{constructor(e=null){super();const t={host:"31.97.188.80",port:3478,username:"coturn_user",credential:"test123"};this.rtcConfig={iceServers:[],iceCandidatePoolSize:10};const n=e||t;this.configureTurnServer(n),this.peerConnection=null,this.localStream=null,this.remoteStream=null,this.isInCall=!1,this.isCaller=!1,this.callId=null,this.remoteUserId=null,this.socket=null,this.userId=null,this.isAudioEnabled=!0,this.isVideoEnabled=!0,this.connectionRetries=0,this.maxRetries=1,this.isEnding=!1,this.isScreenSharing=!1,this.screenStream=null,this.cameraStream=null,this.videoSender=null,this.audioSender=null,this.screenShareEndHandler=null,this.adminPeerConnection=null,this.failureTimeoutId=null,this.pendingIceCandidates=[],this.hasRemoteDescription=!1,this.recoveringVideoTrack=!1,this.callStartTime=null,this.apiClient=null}configureTurnServer(e){if(!e){console.warn("‚ö†Ô∏è Student: No TURN config provided, keeping existing configuration");return}const t=this.normalizeTurnConfig(e),{urls:n,host:i,port:a,username:o,credential:d}=t;if(!n.length){console.warn("‚ö†Ô∏è Student: TURN config missing URLs, keeping existing configuration");return}this.rtcConfig={iceServers:[{urls:n,username:o,credential:d}],iceCandidatePoolSize:10,iceTransportPolicy:"relay",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require",sdpSemantics:"unified-plan",iceConnectionReceiveTimeout:3e4,iceInactiveTimeout:3e4,continualGatheringPolicy:"gather_continually"},console.log("‚úÖ Student: TURN server configured:",{host:i,port:a,username:o,urls:n,iceTransportPolicy:this.rtcConfig.iceTransportPolicy,mode:"TURN relay only (no direct P2P or STUN)"})}normalizeTurnConfig(e){const t=e.port||3478;let n=[];return Array.isArray(e.urls)&&e.urls.length>0?n=e.urls:typeof e.urls=="string"&&(n=[e.urls]),n.length===0&&e.host&&(n=[`turn:${e.host}:${t}`,`turn:${e.host}:${t}?transport=tcp`]),{host:e.host||null,port:t,username:e.username,credential:e.credential,urls:n}}initialize(e,t=null){var n;this.socket=e,this.userId=t||((n=e.userData)==null?void 0:n.userId),this.setupSocketListeners()}setApiClient(e){this.apiClient=e}async trackCallDuration(){if(!(!this.callStartTime||!this.apiClient||!this.remoteUserId))try{const e=new Date,t=Math.floor((e-this.callStartTime)/1e3);t>=5&&await this.apiClient.trackCallSession(t,this.callStartTime,e,this.remoteUserId,this.remoteUserName||"Unknown","teacher")}catch(e){console.error("‚ùå Failed to track call duration:",e)}}setupSocketListeners(){if(!this.socket){console.error("‚ùå Student WebRTC: No socket available for listeners");return}this.socket.on("webrtc-offer",async e=>{var n,i;const t=this.peerConnection&&(this.peerConnection.connectionState==="failed"||this.peerConnection.connectionState==="disconnected"||this.peerConnection.iceConnectionState==="failed"||this.peerConnection.iceConnectionState==="disconnected");if(this.isInCall&&this.callId!==e.callId&&!t){console.warn("üö´ Student(mobile): Rejecting additional offer while already in call",{currentCallId:this.callId,newCallId:e.callId,callerId:e.callerId,connectionState:(n=this.peerConnection)==null?void 0:n.connectionState,iceState:(i=this.peerConnection)==null?void 0:i.iceConnectionState}),this.socket.emit("webrtc-call-rejected",{callId:e.callId,recipientId:e.callerId,reason:"already-in-call"});return}if(t&&this.cleanup(),e.iceRestart&&this.callId===e.callId){await this.handleIceRestartOffer(e);return}this.dispatchEvent(new CustomEvent("incoming-call",{detail:e}))}),this.socket.on("webrtc-answer",async e=>{await this.handleAnswer(e)}),this.socket.on("webrtc-ice-candidate",async e=>{await this.handleIceCandidate(e)}),this.socket.on("webrtc-call-end",e=>{console.warn("üì¥ Student: Received webrtc-call-end from remote",e),this.endCall(!1)}),this.socket.on("webrtc-call-rejected",e=>{console.warn("‚ùå Student: Call rejected by remote",e),this.dispatchEvent(new CustomEvent("call-rejected",{detail:e})),this.cleanup()}),this.socket.on("incoming-call-cancelled",(e={})=>{console.warn("üîï Student(mobile): Incoming call cancelled on another device",e),this.dispatchEvent(new CustomEvent("incoming-call-cancelled",{detail:e}))}),this.socket.on("admin-webrtc-offer",async e=>{await this.handleAdminOffer(e)}),this.socket.on("admin-ice-candidate",async e=>{if(this.adminPeerConnection&&e.candidate)try{await this.adminPeerConnection.addIceCandidate(new RTCIceCandidate(e.candidate))}catch(t){console.error("‚ùå Student: Failed to add admin ICE candidate:",t)}})}async startCall(e,t){var n;try{this.remoteUserId=e,this.remoteUserName=t,this.isCaller=!0,this.callId=`call_${Date.now()}_${Math.random().toString(36).substring(7)}`,this.callStartTime=new Date,await this.getUserMedia({refresh:!0}),this.createPeerConnection(),this.localStream.getTracks().forEach(a=>{this.peerConnection.addTrack(a,this.localStream)}),this.updateSenderReferences();const i=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});return await this.peerConnection.setLocalDescription(i),await this.waitForICEGathering(),this.socket.emit("webrtc-offer",{callId:this.callId,recipientId:e,callerId:this.userId||((n=this.socket.userData)==null?void 0:n.userId),callerName:t,offer:this.peerConnection.localDescription}),this.isInCall=!0,this.dispatchEvent(new CustomEvent("call-started",{detail:{callId:this.callId,remoteUserId:e,localStream:this.localStream}})),{success:!0,callId:this.callId}}catch(i){throw console.error("‚ùå Failed to start call:",i),this.cleanup(),i}}async answerCall(e){try{if(this.callId=e.callId,this.remoteUserId=e.callerId,this.isCaller=!1,await this.getUserMedia({refresh:!0}),this.createPeerConnection(),this.localStream.getTracks().forEach(n=>{this.peerConnection.addTrack(n,this.localStream)}),this.updateSenderReferences(),await this.peerConnection.setRemoteDescription(e.offer),this.hasRemoteDescription=!0,this.pendingIceCandidates.length>0){for(const n of this.pendingIceCandidates)try{await this.peerConnection.addIceCandidate(new RTCIceCandidate(n))}catch(i){console.error("‚ùå Student: Failed to add queued ICE candidate:",i)}this.pendingIceCandidates=[]}const t=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(t),await this.waitForICEGathering(),this.socket.emit("webrtc-answer",{callId:this.callId,recipientId:e.callerId,answer:this.peerConnection.localDescription}),this.isInCall=!0,this.dispatchEvent(new CustomEvent("call-answered",{detail:{callId:this.callId,localStream:this.localStream}})),{success:!0}}catch(t){throw console.error("‚ùå Failed to answer call:",t),this.rejectCall(e.callId,e.callerId),t}}rejectCall(e,t,n="user-rejected"){console.warn("üö´ Student(mobile): Rejecting call",{callId:e,callerId:t,reason:n}),this.socket.emit("webrtc-call-rejected",{callId:e,recipientId:t,reason:n}),this.cleanup()}endCall(e=!0){var t,n;if(this.isEnding){console.warn("‚ö†Ô∏è Student: endCall invoked while already ending");return}this.isEnding=!0,console.warn("‚ö†Ô∏è Student: endCall invoked",{sendSignal:e,callId:this.callId,remoteUserId:this.remoteUserId,connectionState:(t=this.peerConnection)==null?void 0:t.connectionState,iceState:(n=this.peerConnection)==null?void 0:n.iceConnectionState}),this.trackCallDuration(),e&&this.callId&&this.remoteUserId&&this.socket.emit("webrtc-call-end",{callId:this.callId,recipientId:this.remoteUserId}),this.dispatchEvent(new CustomEvent("call-ended",{detail:{sendSignal:e}})),this.cleanup(),setTimeout(()=>{this.isEnding=!1},100)}async getUserMedia({refresh:e=!1}={}){var t,n,i,a;try{if(!e&&this.cameraStream&&this.cameraStream.getVideoTracks().length)return this.localStream=this.cameraStream,this.isVideoEnabled=((t=this.cameraStream.getVideoTracks()[0])==null?void 0:t.enabled)!==!1,this.isAudioEnabled=((n=this.cameraStream.getAudioTracks()[0])==null?void 0:n.enabled)!==!1,this.attachLocalTrackListeners(this.cameraStream),this.cameraStream;if(!navigator.mediaDevices)throw new Error("MediaDevices API not available. This browser does not support WebRTC.");if(!navigator.mediaDevices.getUserMedia)throw new Error("getUserMedia is not available. Please use a modern browser like Chrome, Firefox, or Safari.");if(e&&this.cameraStream){try{this.cameraStream.getTracks().forEach(c=>c.stop())}catch(c){console.warn("‚ö†Ô∏è Student: Failed to stop previous camera stream during refresh:",c)}this.cameraStream=null}const o={video:{width:{ideal:1280},height:{ideal:720},facingMode:"user"},audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!0,sampleRate:48e3,channelCount:1,volume:1,latency:0,googEchoCancellation:!0,googExperimentalEchoCancellation:!0,googAutoGainControl:!0,googExperimentalAutoGainControl:!0,googNoiseSuppression:!0,googExperimentalNoiseSuppression:!0,googBeamforming:!0,googArrayGeometry:!0,googAudioMirroring:!1,mozEchoCancellation:!0,mozNoiseSuppression:!0,mozAutoGainControl:!0}},d=await navigator.mediaDevices.getUserMedia(o);return this.cameraStream=d,this.localStream=d,this.isVideoEnabled=((i=d.getVideoTracks()[0])==null?void 0:i.enabled)!==!1,this.isAudioEnabled=((a=d.getAudioTracks()[0])==null?void 0:a.enabled)!==!1,this.attachLocalTrackListeners(d),d}catch(o){throw console.error("‚ùå Student: Failed to get user media:",o),console.error("‚ùå Student: Error name:",o.name),console.error("‚ùå Student: Error message:",o.message),o.name==="NotAllowedError"?new Error("Camera and microphone access denied. Please allow access and try again."):o.name==="NotFoundError"?new Error("No camera or microphone found. Please check your devices."):o.name==="NotReadableError"?new Error("Camera or microphone is already in use by another application."):o.name==="OverconstrainedError"?new Error("Camera constraints cannot be satisfied. Try with different settings."):new Error(`Media access failed: ${o.message}`)}}createPeerConnection(){this.peerConnection=new RTCPeerConnection(this.rtcConfig),this.peerConnection.ontrack=e=>{this.remoteStream=e.streams[0],this.dispatchEvent(new CustomEvent("remote-stream",{detail:{stream:this.remoteStream}}))},this.peerConnection.onnegotiationneeded=()=>{this.updateSenderReferences()},this.peerConnection.onicecandidate=e=>{e.candidate&&this.socket.emit("webrtc-ice-candidate",{callId:this.callId,recipientId:this.remoteUserId,candidate:e.candidate})},this.peerConnection.onconnectionstatechange=()=>{const e=this.peerConnection.connectionState;e==="connected"?(this.clearFailureTimeout(),this.dispatchEvent(new CustomEvent("connection-established"))):e==="failed"?(console.error("‚ùå Student: WebRTC connection failed"),this.scheduleFailureHandler()):e==="disconnected"&&setTimeout(()=>{this.peerConnection&&this.peerConnection.connectionState},15e3)},this.peerConnection.oniceconnectionstatechange=()=>{const e=this.peerConnection.iceConnectionState;if(e==="connected"||e==="completed")this.dispatchEvent(new CustomEvent("call-connected"));else if(e==="failed"){console.error("‚ùå Student: ICE connection failed - TURN server may not be working");try{this.peerConnection&&typeof this.peerConnection.restartIce=="function"&&this.peerConnection.restartIce().catch(()=>{})}catch(t){console.warn("‚ö†Ô∏è Student: ICE restart attempt after failure did not succeed:",t)}}else if(e==="disconnected"){let t=0;const n=setInterval(()=>{if(t++,!this.peerConnection){clearInterval(n);return}const i=this.peerConnection.iceConnectionState;if(i==="connected"||i==="completed")clearInterval(n);else if(t>=5){clearInterval(n);try{this.peerConnection&&typeof this.peerConnection.restartIce=="function"&&this.peerConnection.restartIce().catch(()=>{})}catch(a){console.warn("‚ö†Ô∏è Student: ICE restart attempt after prolonged disconnect failed:",a)}}},5e3)}},this.peerConnection.onicegatheringstatechange=()=>{}}updateSenderReferences(){if(!this.peerConnection){this.videoSender=null,this.audioSender=null;return}const e=this.peerConnection.getSenders();this.videoSender=e.find(t=>t.track&&t.track.kind==="video")||null,this.audioSender=e.find(t=>t.track&&t.track.kind==="audio")||null}getVideoSender(){return this.videoSender&&this.videoSender.track?this.videoSender:(this.updateSenderReferences(),this.videoSender)}getAudioSender(){return this.audioSender&&this.audioSender.track?this.audioSender:(this.updateSenderReferences(),this.audioSender)}async handleAnswer(e){if(this.peerConnection&&e.answer){if(await this.peerConnection.setRemoteDescription(e.answer),this.hasRemoteDescription=!0,this.pendingIceCandidates.length>0){for(const t of this.pendingIceCandidates)try{await this.peerConnection.addIceCandidate(new RTCIceCandidate(t))}catch(n){console.error("‚ùå Student: Failed to add queued ICE candidate:",n)}this.pendingIceCandidates=[]}this.dispatchEvent(new CustomEvent("call-connected"))}}async handleIceRestartOffer(e){try{if(this.peerConnection&&e.offer){await this.peerConnection.setRemoteDescription(e.offer);const t=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(t),this.socket.emit("webrtc-answer",{callId:this.callId,recipientId:e.callerId,answer:t})}}catch(t){console.error("‚ùå Student: Failed to handle ICE restart:",t)}}async handleIceCandidate(e){if(this.peerConnection&&e.candidate){if(!this.hasRemoteDescription){this.pendingIceCandidates.push(e.candidate);return}try{await this.peerConnection.addIceCandidate(new RTCIceCandidate(e.candidate))}catch(t){console.error("‚ùå Student: Failed to add ICE candidate:",t),console.error("‚ùå Student: Problematic candidate:",e.candidate)}}}async toggleVideo(){var e,t;try{this.isScreenSharing&&await this.stopScreenShare();const n=await this.getUserMedia({refresh:!this.cameraStream});this.cameraStream=n||this.cameraStream,this.attachLocalTrackListeners(this.cameraStream);const i=(t=(e=this.cameraStream)==null?void 0:e.getVideoTracks())==null?void 0:t[0];if(!i)return console.warn("‚ö†Ô∏è Student: No video track available to toggle"),!1;i.enabled=!i.enabled,this.isVideoEnabled=i.enabled;const a=this.getVideoSender();return a&&i&&await a.replaceTrack(i),this.localStream=this.cameraStream,this.isVideoEnabled}catch(n){return console.error("‚ùå Student: Failed to toggle video:",n),!1}}toggleAudio(){const e=this.cameraStream||this.localStream;if(e){const t=e.getAudioTracks()[0];if(t)return t.enabled=!t.enabled,this.isAudioEnabled=t.enabled,this.localStream=e,this.isAudioEnabled}return!1}attachLocalTrackListeners(e){e&&e.getTracks().forEach(t=>{t.kind==="video"&&(t.onended=()=>{console.warn("‚ö†Ô∏è Student: Local video track ended unexpectedly"),this.recoverVideoTrack("track-ended")},t.onmute=()=>{var n;!this.isScreenSharing&&((n=this.getVideoSender())==null?void 0:n.track)===t&&setTimeout(()=>{var i;t.muted&&!this.isScreenSharing&&((i=this.getVideoSender())==null?void 0:i.track)===t&&(console.warn("‚ö†Ô∏è Student: Local video track muted for extended period, attempting recovery"),this.recoverVideoTrack("track-muted"))},3e3)})})}async recoverVideoTrack(e){var t;if(this.isScreenSharing){console.warn("‚ö†Ô∏è Student: Skipping video recovery during screen share",{reason:e});return}if(!this.isVideoEnabled){console.warn("‚ö†Ô∏è Student: Video disabled by user, skipping recovery",{reason:e});return}if(this.recoveringVideoTrack){console.warn("‚ö†Ô∏è Student: Video recovery already in progress, skipping",{reason:e});return}this.recoveringVideoTrack=!0,console.warn("üîß Student: Attempting to recover video track",{reason:e});try{const n=await this.getUserMedia({refresh:!0});if(!n){console.warn("‚ö†Ô∏è Student: getUserMedia returned no stream during recovery");return}this.attachLocalTrackListeners(n);const i=(t=n.getVideoTracks())==null?void 0:t[0],a=this.getVideoSender();a&&i?(i.enabled=this.isVideoEnabled,await a.replaceTrack(i),this.localStream=n,console.log("‚úÖ Student: Video track recovered successfully",{reason:e})):console.warn("‚ö†Ô∏è Student: Unable to recover video track - missing sender or track",{hasSender:!!a,hasTrack:!!i,reason:e})}catch(n){console.error("‚ùå Student: Failed to recover video track:",n)}finally{this.recoveringVideoTrack=!1}}async startScreenShare(){try{if(!window.isSecureContext)throw new Error("Screen sharing requires HTTPS or localhost");if(!navigator.mediaDevices||!navigator.mediaDevices.getDisplayMedia)throw new Error("Screen sharing not supported in this browser. Please use Chrome 72+, Firefox 66+, or Safari 13+");const e=await navigator.mediaDevices.getDisplayMedia({video:{width:{ideal:1920,max:1920},height:{ideal:1080,max:1080},frameRate:{ideal:15,max:30}},audio:!1});if(!this.peerConnection)throw new Error("No active call to share screen");this.cameraStream=this.cameraStream||this.localStream||await this.getUserMedia({refresh:!1});const t=this.getVideoSender();if(t){const n=e.getVideoTracks()[0];return await t.replaceTrack(n),this.isScreenSharing=!0,this.screenStream=e,this.screenShareEndHandler&&(n.removeEventListener("ended",this.screenShareEndHandler),n.removeEventListener("inactive",this.screenShareEndHandler)),this.screenShareEndHandler=()=>{this.stopScreenShare().catch(i=>{console.error("‚ùå Student: Screen share auto-stop failed:",i)})},n.addEventListener("ended",this.screenShareEndHandler),n.addEventListener("inactive",this.screenShareEndHandler),this.socket.emit("webrtc-screen-share",{callId:this.callId,recipientId:this.remoteUserId,isSharing:!0}),this.dispatchEvent(new CustomEvent("screen-share-started")),!0}throw new Error("No video sender found")}catch(e){throw console.error("‚ùå Student: Screen share failed:",e),e}}async stopScreenShare(){var e,t;try{if(!this.isScreenSharing)return;if(this.isScreenSharing=!1,this.screenStream){try{const o=this.screenStream.getVideoTracks()[0];o&&this.screenShareEndHandler&&(o.removeEventListener("ended",this.screenShareEndHandler),o.removeEventListener("inactive",this.screenShareEndHandler)),this.screenStream.getTracks().forEach(d=>d.stop())}catch(o){console.warn("‚ö†Ô∏è Student: Error stopping screen share stream:",o)}this.screenStream=null,this.screenShareEndHandler=null}const n=await this.getUserMedia({refresh:!this.cameraStream});this.cameraStream=n||this.cameraStream,this.attachLocalTrackListeners(this.cameraStream);const i=(t=(e=this.cameraStream)==null?void 0:e.getVideoTracks())==null?void 0:t[0],a=this.getVideoSender();a&&i&&(await a.replaceTrack(i),i.enabled=this.isVideoEnabled),this.localStream=this.cameraStream||this.localStream,this.socket.emit("webrtc-screen-share",{callId:this.callId,recipientId:this.remoteUserId,isSharing:!1}),this.dispatchEvent(new CustomEvent("screen-share-stopped"))}catch(n){throw console.error("‚ùå Student: Failed to stop screen share:",n),n}}getStatus(){var e;return{isInCall:this.isInCall,isCaller:this.isCaller,callId:this.callId,remoteUserId:this.remoteUserId,hasLocalStream:!!this.localStream,hasRemoteStream:!!this.remoteStream,isAudioEnabled:this.isAudioEnabled,isVideoEnabled:this.isVideoEnabled,isScreenSharing:this.isScreenSharing,connectionState:(e=this.peerConnection)==null?void 0:e.connectionState}}scheduleFailureHandler(){this.clearFailureTimeout(),this.failureTimeoutId=setTimeout(()=>{if(this.peerConnection&&this.peerConnection.connectionState==="failed"){console.warn("‚ö†Ô∏è Student: WebRTC still reporting failed state; keeping call alive for manual recovery");try{typeof this.peerConnection.restartIce=="function"&&this.peerConnection.restartIce().catch(()=>{})}catch(e){console.warn("‚ö†Ô∏è Student: ICE restart attempt failed:",e)}}},1e4)}clearFailureTimeout(){this.failureTimeoutId&&(clearTimeout(this.failureTimeoutId),this.failureTimeoutId=null)}waitForICEGathering(e=5e3){return new Promise(t=>{if(!this.peerConnection||this.peerConnection.iceGatheringState==="complete"){t();return}const n=setTimeout(()=>{t()},e),i=()=>{this.peerConnection.iceGatheringState==="complete"&&(clearTimeout(n),this.peerConnection.removeEventListener("icegatheringstatechange",i),t())};this.peerConnection.addEventListener("icegatheringstatechange",i)})}cleanup(){if(console.warn("üßπ Student: cleanup invoked",{hadPeerConnection:!!this.peerConnection,hadLocalStream:!!this.localStream,hadScreenStream:!!this.screenStream,hadAdminConnection:!!this.adminPeerConnection}),this.localStream&&(this.localStream.getTracks().forEach(e=>e.stop()),this.localStream=null),this.cameraStream&&this.cameraStream!==this.localStream){try{this.cameraStream.getTracks().forEach(e=>e.stop())}catch(e){console.warn("‚ö†Ô∏è Student: Failed to stop camera stream during cleanup:",e)}this.cameraStream=null}if(this.screenStream&&(this.screenStream.getTracks().forEach(e=>e.stop()),this.screenStream=null),this.screenShareEndHandler=null,this.adminPeerConnection){try{this.adminPeerConnection.close()}catch(e){console.warn("‚ö†Ô∏è Student: Failed to close admin peer connection:",e)}this.adminPeerConnection=null}this.peerConnection&&(this.peerConnection.close(),this.peerConnection=null),this.isInCall=!1,this.isCaller=!1,this.callId=null,this.remoteUserId=null,this.remoteStream=null,this.isAudioEnabled=!0,this.isVideoEnabled=!0,this.clearFailureTimeout(),this.isEnding=!1,this.isScreenSharing=!1,this.videoSender=null,this.audioSender=null,this.pendingIceCandidates=[],this.hasRemoteDescription=!1,this.recoveringVideoTrack=!1}destroy(){this.cleanup(),this.socket&&(this.socket.off("webrtc-offer"),this.socket.off("webrtc-answer"),this.socket.off("webrtc-ice-candidate"),this.socket.off("webrtc-call-end"),this.socket.off("webrtc-call-rejected"),this.socket.off("admin-webrtc-offer"),this.socket.off("admin-ice-candidate"))}async handleAdminOffer(e){var t;try{this.localStream||await this.getUserMedia({refresh:!this.cameraStream}),this.adminPeerConnection=new RTCPeerConnection(this.rtcConfig),this.localStream&&this.localStream.getTracks().forEach(i=>{this.adminPeerConnection.addTrack(i,this.localStream)}),this.adminPeerConnection.onicecandidate=i=>{var a;i.candidate&&this.socket.emit("admin-ice-candidate",{targetId:e.adminId,adminId:e.adminId,sourceId:((a=this.socket)==null?void 0:a.id)||this.userId,callId:e.callId,candidate:i.candidate})},await this.adminPeerConnection.setRemoteDescription(new RTCSessionDescription(e.offer));const n=await this.adminPeerConnection.createAnswer();await this.adminPeerConnection.setLocalDescription(n),this.socket.emit("admin-webrtc-answer",{targetId:e.adminId,adminId:e.adminId,sourceId:((t=this.socket)==null?void 0:t.id)||this.userId,callId:e.callId,answer:n})}catch(n){console.error("‚ùå Student: Failed to handle admin offer:",n)}}}const ni="appConfig",si="webrtc",ii="student-app-config";let Qe=ai(),cr=null,zt=null;const fr=new Set;function ai(r={}){const e=dn(),t=oi(r.turn||r.turnConfig||r.turnServer);return{apiBaseUrl:r.apiBaseUrl||r.apiUrl||e.apiBaseUrl,socketUrl:r.socketUrl||r.signalingUrl||e.socketUrl,appEnv:r.appEnv||r.environment||e.appEnv,turn:t,updatedAt:r.updatedAt||null}}function oi(r){if(!r)return null;if(Array.isArray(r)){const[c]=r;return oi(c)}const{host:e,port:t,username:n,credential:i,password:a,urls:o}=r,d=Array.isArray(o)?o:typeof o=="string"?[o]:[];return{host:e||null,port:t||3478,username:n||r.user||null,credential:i||a||null,urls:d}}function yt(r){Qe=ai(r),ql({apiBaseUrl:Qe.apiBaseUrl,socketUrl:Qe.socketUrl,appEnv:Qe.appEnv}),Zl(Qe),fr.forEach(e=>{try{e(Qe)}catch(t){console.error("AppConfig listener failed:",t)}})}function Zl(r){try{const e={config:r,cachedAt:Date.now()};localStorage.setItem(ii,JSON.stringify(e))}catch(e){console.warn("Failed to cache app config:",e)}}function hs(){try{const r=localStorage.getItem(ii);if(!r)return null;const e=JSON.parse(r);if(e&&e.config)return e.config}catch(r){console.warn("Failed to parse cached app config:",r)}return null}async function ed(){const r=fe(ce,ni,si),e=await Te(r);if(!e.exists())return console.warn("App config document not found in Firestore, using defaults"),null;const t=e.data()||{};return{...t,updatedAt:t.updatedAt||t.lastUpdated||null}}const td=async({listen:r=!0}={})=>(cr||(cr=(async()=>{try{const e=await ed();if(e)yt(e);else{const t=hs();yt(t||dn())}}catch(e){console.error("Failed to load app config from Firestore:",e);const t=hs();yt(t||dn())}if(r&&!zt){const e=fe(ce,ni,si);zt=Xr(e,t=>{if(t.exists()){const n=t.data()||{};yt({...n,updatedAt:n.updatedAt||n.lastUpdated||null})}},t=>{console.error("App config snapshot listener error:",t)})}return Qe})()),cr),hn=()=>Qe,rd=r=>typeof r!="function"?()=>{}:(fr.add(r),()=>fr.delete(r)),nd=()=>{zt&&(zt(),zt=null),fr.clear(),cr=null},fs="incoming-call-alerts";class sd extends EventTarget{constructor(){super(),this.initialized=!1,this.currentToken=null,this.user=null,this.baseUrl=null,this.listeners=[],this.lastInviteId=null,this.pushPlugin=qr(),this.localPlugin=Yr(),this.pluginsLoaded=!1,this.lastNotificationId=null}async initialize(e){var a;if(!nt.isNativePlatform()){console.info("üìµ Push notifications are only available on native builds; skipping registration.");return}if(this.initialized&&((a=this.user)==null?void 0:a.id)===(e==null?void 0:e.id))return;await this.ensurePluginsLoaded(),this.user=e;const t=hn(),n=((t==null?void 0:t.apiBaseUrl)||ri||"").replace(/\/$/,"");if(this.baseUrl=n.replace(/\/api$/,"")||null,!await this.ensurePermissions()){console.warn("‚ö†Ô∏è Push notifications permission not granted. Call notifications will rely on foreground socket only.");return}await this.ensureNotificationChannel(),await this.attachListeners();try{await this.pushPlugin.register(),this.initialized=!0,console.log("‚úÖ Push notifications registration requested")}catch(o){console.error("‚ùå Failed to register for push notifications:",o)}}async ensurePermissions(){try{return(await this.localPlugin.checkPermissions()).display!=="granted"&&(await this.localPlugin.requestPermissions()).display!=="granted"?(console.warn("‚ö†Ô∏è Local notification permission denied"),!1):(await this.pushPlugin.checkPermissions()).receive==="granted"?!0:(await this.pushPlugin.requestPermissions()).receive==="granted"}catch(e){return console.error("‚ùå Failed to verify push notification permissions:",e),!1}}async ensureNotificationChannel(){if(nt.getPlatform()==="android")try{await this.localPlugin.createChannel({id:fs,name:"Incoming Calls",description:"Alerts for teacher calls",sound:"default",importance:5,visibility:1,lights:!0,vibration:!0})}catch(e){console.warn("‚ö†Ô∏è Failed to create Android notification channel:",e)}}async attachListeners(){if(this.listeners.length>0)return;const e=await this.pushPlugin.addListener("registration",a=>{this.handleRegistration(a).catch(o=>{console.error("‚ùå Failed to handle push registration:",o)})}),t=await this.pushPlugin.addListener("registrationError",a=>{console.error("‚ùå Push registration error:",a)}),n=await this.pushPlugin.addListener("pushNotificationReceived",a=>{this.handleNotification(a).catch(o=>{console.error("‚ùå Failed to process incoming push notification:",o)})}),i=await this.pushPlugin.addListener("pushNotificationActionPerformed",a=>{this.handleNotificationAction(a).catch(o=>{console.error("‚ùå Failed to handle notification action:",o)})});this.listeners.push(e,t,n,i)}async handleRegistration(e){const t=(e==null?void 0:e.value)||(e==null?void 0:e.token)||e;if(!t){console.warn("‚ö†Ô∏è Received empty push token");return}if(this.currentToken=t,!this.user||!this.baseUrl){console.warn("‚ö†Ô∏è Cannot sync push token yet. Missing user or API base URL.");return}try{const n={userId:this.user.id,role:this.user.role,token:t,platform:nt.getPlatform(),app:"student",updatedAt:new Date().toISOString()},i=await fetch(`${this.baseUrl}/push/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(n)});if(!i.ok){const a=await i.text();throw new Error(`Registration failed: ${i.status} ${a}`)}console.log("‚úÖ Push token registered with signaling server")}catch(n){console.error("‚ùå Failed to sync push token with backend:",n)}}async handleNotification(e){const t=(e==null?void 0:e.data)||{};if(t.type==="call_invite"&&!(t.callId&&t.callId===this.lastInviteId)){this.lastInviteId=t.callId||null;try{const n=Date.now()%1e5;await this.localPlugin.schedule({notifications:[{id:n,title:t.title||"Incoming call",body:t.body||`${t.callerName||"Teacher"} is calling you`,extra:t,channelId:fs,sound:"default",schedule:{at:new Date(Date.now()+250)}}]}),this.lastNotificationId=n}catch(n){console.error("‚ùå Failed to schedule local notification:",n)}this.dispatchEvent(new CustomEvent("call-invite",{detail:t}))}}async handleNotificationAction(e){var n,i;const t=((n=e==null?void 0:e.notification)==null?void 0:n.data)||((i=e==null?void 0:e.notification)==null?void 0:i.extra)||{};t.type==="call_invite"&&this.dispatchEvent(new CustomEvent("call-invite-action",{detail:t}))}async clear(){this.user=null,this.currentToken=null,this.baseUrl=null,this.lastInviteId=null,this.initialized=!1,await Promise.all(this.listeners.map(async e=>{try{await e.remove()}catch(t){console.warn("‚ö†Ô∏è Failed to remove push listener:",t)}})),this.listeners=[],this.pushPlugin=qr(),this.localPlugin=Yr(),this.pluginsLoaded=!1,this.lastNotificationId=null}async dismissLastInvite(){if(this.lastNotificationId){try{await this.ensurePluginsLoaded(),await this.localPlugin.cancel({notifications:[{id:this.lastNotificationId}]})}catch(e){console.warn("‚ö†Ô∏è Failed to cancel local notification:",e)}this.lastNotificationId=null}}async ensurePluginsLoaded(){if(!this.pluginsLoaded)try{const[{PushNotifications:e},{LocalNotifications:t}]=await Promise.all([lt(()=>import("./index-1c799971.js"),["./index-1c799971.js","./material-da7e7f42.js","./vendor-e1e3bd03.js","./firebase-f79b6b7d.js"],import.meta.url),lt(()=>import("./index-5f725e3a.js"),["./index-5f725e3a.js","./material-da7e7f42.js","./vendor-e1e3bd03.js","./firebase-f79b6b7d.js"],import.meta.url)]);this.pushPlugin=e,this.localPlugin=t,this.pluginsLoaded=!0}catch(e){console.error("‚ùå Failed to load Capacitor notification plugins:",e),this.pushPlugin=qr(),this.localPlugin=Yr(),this.pluginsLoaded=!1}}}const Vr=new sd;function qr(){return{async addListener(){return{remove:async()=>{}}},async register(){},async checkPermissions(){return{receive:"denied"}},async requestPermissions(){return{receive:"denied"}}}}function Yr(){return{async checkPermissions(){return{display:"granted"}},async requestPermissions(){return{display:"granted"}},async createChannel(){},async schedule(){}}}class id{constructor(){this.token=null}saveToken(e){this.token=e,localStorage.setItem("firebase_token",e)}clearToken(){this.token=null,localStorage.removeItem("auth_token"),localStorage.removeItem("firebase_token")}}class ad{constructor(){this.socket=null,this.eventHandlers=new Map,this.connected=!1}connect(e,t){this.socket&&this.disconnect();try{this.socket=or(e,{transports:["websocket","polling"],autoConnect:!0,forceNew:!0,timeout:1e4}),this.socket.on("connect",()=>{this.connected=!0,this.socket.userData=t,this.socket.emit("join-room",t),this.emit("connected",{socket:this.socket,userData:t})}),this.socket.on("disconnect",()=>{this.connected=!1,this.emit("disconnected")}),this.socket.on("receive-message",n=>{this.emit("message-received",n)}),this.socket.on("ai-alert",n=>{this.emit("ai-alert",n)}),this.socket.on("error",n=>{console.error("üîç Student: Socket error:",n)}),this.socket.on("connect_error",n=>{console.error("Socket connection error:",n),this.emit("connection-error",n)})}catch(n){console.error("Failed to initialize socket:",n)}}on(e,t){this.eventHandlers.has(e)||this.eventHandlers.set(e,[]),this.eventHandlers.get(e).push(t)}off(e,t){if(this.eventHandlers.has(e)){const n=this.eventHandlers.get(e),i=n.indexOf(t);i>-1&&n.splice(i,1)}}emit(e,t){this.eventHandlers.has(e)&&this.eventHandlers.get(e).forEach(n=>{try{n(t)}catch(i){console.error(`Error in ${e} handler:`,i)}})}sendMessage(e){this.socket&&this.connected?this.socket.emit("send-message",e):console.error("Socket not connected, cannot send message. Connected:",this.connected,"Socket exists:",!!this.socket)}disconnect(){this.socket&&(this.socket.disconnect(),this.socket=null),this.connected=!1,this.eventHandlers.clear()}}const Gr=new id,He=new ad;function od(){const r=nt.isNativePlatform();nt.getPlatform(),l.useEffect(()=>{const P=m=>{console.error("üö® Global Error:",m)},W=m=>{console.error("üö® Unhandled Promise Rejection:",m.reason)};return window.addEventListener("error",P),window.addEventListener("unhandledrejection",W),()=>{window.removeEventListener("error",P),window.removeEventListener("unhandledrejection",W)}},[]);const[e,t]=l.useState(!1),[n,i]=l.useState(null),[a,o]=l.useState(!0),[d,c]=l.useState(!1),[f,h]=l.useState(null),[u]=l.useState(()=>{try{return new Ql}catch(P){return console.error("‚ùå Failed to initialize WebRTC service:",P),console.error("‚ùå WebRTC Error Stack:",P.stack),null}}),[y,O]=l.useState(!1),[g,w]=l.useState(null),[x,N]=l.useState(!1),[R,j]=l.useState("idle"),[I,F]=l.useState(null),[B,$]=l.useState(null),[b,k]=l.useState(!1),[L,T]=l.useState(0),[D,_]=l.useState(null),[Y,J]=l.useState(null),[V,X]=l.useState({open:!1,message:"",severity:"info"}),pe=(P,W="info")=>{X({open:!0,message:P,severity:W})},ae=(P,W)=>{W!=="clickaway"&&X(m=>({...m,open:!1}))};l.useEffect(()=>{let P=!0,W=null;const m=C=>{var re,A;!P||!u||(re=C==null?void 0:C.turn)!=null&&re.username&&((A=C==null?void 0:C.turn)!=null&&A.credential)&&u.configureTurnServer(C.turn)};return(async()=>{Gr.clearToken(),localStorage.removeItem("student-app-cache");try{const C=await td();if(!P)return;m(C),W=rd(m)}catch(C){console.error("‚ùå Failed to initialise app config:",C),P&&h(C)}finally{P&&(c(!0),await he())}})(),()=>{P=!1,W&&W(),nd()}},[u]),l.useEffect(()=>{const P=W=>{u&&W.socket&&W.userData?(u.initialize(W.socket,W.userData.userId),xe()):console.error("‚ùå Student: Missing webrtcService or socket data:",{webrtcService:!!u,socket:!!(W!=null&&W.socket),userData:!!(W!=null&&W.userData)})};if(He.connected&&u&&!u.socket){const W={userId:n==null?void 0:n.id,username:n==null?void 0:n.username,role:"student"};u.initialize(He.socket,W.userId),xe()}return He.on("connected",P),()=>{He.off("connected",P)}},[u,n]),l.useEffect(()=>{if(!u)return;const P=async m=>{const M=await ze.startCall(m.detail.teacherId||m.detail.callerId,m.detail.teacherName||m.detail.callerName||"Teacher","video");M.success&&(_(M.callId),J(new Date))},W=async m=>{D&&(await ze.endCall(D,m.detail.reason||"normal"),_(null),J(null))};return u.addEventListener("call-started",P),u.addEventListener("call-ended",W),()=>{u.removeEventListener("call-started",P),u.removeEventListener("call-ended",W)}},[u,D]);const he=async()=>{try{return new Promise(P=>{const W=Ji(Ce,async m=>{if(W(),m)try{const M=await Te(fe(ce,"users",m.uid));if(M.exists()&&M.data().role==="student"){const C=M.data(),re={id:m.uid,email:m.email,username:C.username||m.displayName,role:C.role,...C};i(re),t(!0);const{socketUrl:A}=hn(),Q=A||un;He.connect(Q,{userId:re.id,username:re.username,role:"student"}),Ne.setOnline(),setTimeout(()=>{Ne.setupOnlineStatusTracking()},1e3)}else console.warn("User not student or not found in database"),await Mt(Ce)}catch(M){console.error("Error verifying user role:",M),await Mt(Ce)}o(!1),P()})})}catch(P){console.error("Token verification failed:",P),o(!1)}},xe=()=>{if(!u){console.warn("‚ùå Student: WebRTC service not available for event handlers");return}u.addEventListener("incoming-call",P=>{w({type:"webrtc-call",callId:P.detail.callId,callerId:P.detail.callerId,callerName:P.detail.callerName,offer:P.detail.offer}),O(!0)}),u.addEventListener("call-started",async P=>{j("connecting"),F(P.detail),N(!0),J(new Date);const m=await ze.startCall(P.detail.teacherId||P.detail.callerId,P.detail.teacherName||P.detail.callerName||"Teacher","video");m.success?_(m.callId):console.error("Failed to log call start:",m.error)}),u.addEventListener("call-connected",()=>{j("connected")}),u.addEventListener("call-answered",P=>{j("connecting");const W={...P.detail,teacherName:(g==null?void 0:g.callerName)||"Teacher"};F(W),setTimeout(()=>{N(!0)},500)}),u.addEventListener("remote-stream",P=>{R==="connecting"&&j("connected")}),u.addEventListener("call-ended",()=>{ee("completed")}),u.addEventListener("call-rejected",P=>{var M;const W=(M=P.detail)==null?void 0:M.reason;console.log("‚ùå Student: Call rejected",{reason:W,detail:P.detail}),y&&!x&&(W==="auto-timeout"||W==="cancelled-by-teacher"||!W?pe("Missed call.","warning"):W==="already-in-call"&&pe("Call ignored on this device (already in a call).","info")),ee("rejected")}),u.addEventListener("incoming-call-cancelled",()=>{console.log("üîï Student(mobile): Call answered on another device, closing incoming modal"),O(!1),w(null),pe("Call answered on another device.","info"),Vr.dismissLastInvite().catch(P=>{console.warn("‚ö†Ô∏è Failed to cancel local notification:",P)})}),u.addEventListener("connection-failed",P=>{console.warn("‚ö†Ô∏è Student: WebRTC reported connection failure, keeping call active for manual recovery",P==null?void 0:P.detail)})},be=async(P,W)=>{try{const m=await Xi(Ce,P,W),M=await Te(fe(ce,"users",m.user.uid));if(!M.exists())throw await Mt(Ce),new Error("User not found in database");const C=M.data();if(C.role!=="student")throw await Mt(Ce),new Error("Student access required. User role is: "+C.role);const re={id:m.user.uid,email:m.user.email,username:C.username||m.user.displayName,role:C.role,...C};i(re),t(!0);const{socketUrl:A}=hn(),Q=A||un;He.connect(Q,{userId:re.id,username:re.username,role:"student"}),Ne.setOnline(),setTimeout(()=>{Ne.setupOnlineStatusTracking()},1e3);const ye=await m.user.getIdToken();Gr.saveToken(ye);try{await Vr.initialize(re)}catch(le){console.error("‚ùå Failed to initialise push notifications:",le)}return{success:!0}}catch(m){console.error("Login error:",m);let M="Login failed";return m.code==="auth/invalid-credential"||m.code==="auth/wrong-password"?M="Invalid email or password":m.code==="auth/user-not-found"?M="No account found with this email":m.code==="auth/invalid-email"?M="Invalid email format":m.message&&(M=m.message),{success:!1,error:M}}},ge=async()=>{ee(),await Ne.setOffline(),await Vr.clear();try{await Mt(Ce)}catch(P){console.error("Firebase sign out error:",P)}Gr.clearToken(),He.disconnect(),i(null),t(!1)},z=async()=>{try{if(!u)throw new Error("WebRTC service not initialized");O(!1),await u.answerCall(g)}catch(P){console.error("Failed to accept call:",P),alert("Failed to answer call: "+P.message),ee()}},K=(P={})=>{const W=P.reason||"user-rejected";console.log("‚ùå Student(mobile): Rejecting incoming call",{reason:W}),W==="auto-timeout"?pe("Missed call.","warning"):(W==="user-declined"||W==="user-rejected")&&pe("Call declined.","info");const m=W==="user-declined"?"user-rejected":W;u&&g&&u.rejectCall(g.callId,g.callerId,m),O(!1),w(null)},ee=async(P="completed")=>{if(D&&Y){const m=Math.round((new Date-Y)/1e3),M=await ze.endCall(D,P);M.success?await ze.updateCallDuration(D,m):console.error("Failed to log call end:",M.error)}u&&u.getStatus().isInCall&&u.endCall(),N(!1),j("idle"),F(null),$(null),O(!1),w(null),k(!1),T(0),_(null),J(null)};return f?s.jsxs(Or,{theme:Dr,children:[s.jsx(Ar,{}),s.jsxs(p,{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",p:3,children:[s.jsx("h2",{children:"App Error"}),s.jsx("p",{children:"Something went wrong. Please restart the app."}),s.jsx("p",{style:{fontSize:"12px",opacity:.7},children:f.toString()}),s.jsx("button",{onClick:()=>window.location.reload(),children:"Reload App"})]})]}):!d||a?s.jsx(p,{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",children:"Loading..."}):e?s.jsxs(Or,{theme:Dr,children:[s.jsx(Ar,{}),s.jsxs($c,{apiClient:null,children:[s.jsx($n,{children:s.jsx(Xe,{path:"/*",element:s.jsx(Uc,{user:n,onLogout:ge,children:s.jsxs($n,{children:[s.jsx(Xe,{path:"/",element:s.jsx(Bn,{to:"/dashboard",replace:!0})}),s.jsx(Xe,{path:"/dashboard",element:s.jsx(To,{user:n,webrtcService:u})}),s.jsx(Xe,{path:"/messages",element:s.jsx(Ro,{user:n})}),s.jsx(Xe,{path:"/call-logs",element:s.jsx(Dc,{})}),s.jsx(Xe,{path:"/settings",element:s.jsx(Po,{user:n})}),s.jsx(Xe,{path:"*",element:s.jsx(Bn,{to:"/dashboard",replace:!0})})]})})})}),s.jsx(Xl,{open:y,callerName:(g==null?void 0:g.callerName)||"Teacher",callerInfo:g==null?void 0:g.callerInfo,onAccept:z,onReject:K}),x&&s.jsx(Kl,{children:r?s.jsx(Jl,{isOpen:x,callData:I,callStatus:R,onEndCall:ee,webrtcService:u,socketManager:He}):s.jsx(Gl,{isOpen:x,callData:I,callStatus:R,onEndCall:ee,webrtcService:u,socketManager:He})}),s.jsx(Ni,{open:V.open,autoHideDuration:4e3,onClose:ae,anchorOrigin:{vertical:"bottom",horizontal:"center"},children:s.jsx(vt,{onClose:ae,severity:V.severity,variant:"filled",children:V.message})})]})]}):s.jsxs(Or,{theme:Dr,children:[s.jsx(Ar,{}),s.jsx(wo,{onLogin:be})]})}Kr.createRoot(document.getElementById("root")).render(s.jsx(Ht.StrictMode,{children:s.jsx(Ua,{children:s.jsx(od,{})})}));export{ti as W,lt as _,ei as r};
